(function(a,b,c){"use strict";function d(a,b){this._scaleFactor=a,this._deltaMode=b,this.originalEvent=null}if(!a.qc||!a.qc.Node){var e=function(a){var b=[],c=function(a,b){for(var c in a)if(a[c]==b)return!0;return!1},d=function(a){if("object"!=typeof a||null===a)return a;if(c(b,a))return a;b.push(a);var e={};a.constructor===Array&&(e=[]);for(var f in a)a.hasOwnProperty(f)&&(e[f]=d(a[f]));return e};return d(a)},f=function(a,b,d){for(var e in b)d&&a[e]!==c||(a[e]=b[e]);return a};a.qc||(a.qc={});var g=a.qc,h=a.Phaser,i=a.PIXI;f(g,{PHASER_VERSION:h.VERSION,GAMES:h.GAMES,AUTO:h.AUTO,CANVAS:h.CANVAS,WEBGL:h.WEBGL,HEADLESS:h.HEADLESS,NONE:h.NONE,LEFT:h.LEFT,RIGHT:h.RIGHT,UP:h.UP,DOWN:h.DOWN,scaleModes:h.scaleModes}),this.qc=this.qc||{},this.qc.VERSION="1.0.2";var j=g.Log=function(a){var b=this;b.game=a,b.enableTrace=!1};j.prototype.trace=function(){if(this.game.remoteLogUrl){for(var a=arguments[0],b=1;b<arguments.length;b++){var c=new RegExp("\\{"+(b-1)+"\\}","g");a=a.replace(c,arguments[b])}console.log(a),g.AssetUtil.post(this.game.remoteLogUrl+"/remoteLog",Date.now()+" "+a,function(){})}else if(this.enableTrace){for(var a=arguments[0],b=1;b<arguments.length;b++){var c=new RegExp("\\{"+(b-1)+"\\}","g");a=a.replace(c,arguments[b])}console.log(a)}},j.prototype.important=function(){for(var a=arguments[0],b=1;b<arguments.length;b++){var c=new RegExp("\\{"+(b-1)+"\\}","g");a=a.replace(c,arguments[b])}console.log("%c"+a,"color:green"),this.game.remoteLogUrl&&g.AssetUtil.post(this.game.remoteLogUrl+"/remoteLog",Date.now()+" "+a,function(){})},j.prototype.error=function(){for(var a=arguments[0],b=1;b<arguments.length;b++){var c=new RegExp("\\{"+(b-1)+"\\}","g");a=a.replace(c,arguments[b])}console.log("%c"+a,"color:red"),this.game.remoteLogUrl&&g.AssetUtil.post(this.game.remoteLogUrl+"/remoteLog",Date.now()+" "+a,function(){});for(var b=1;b<arguments.length;b++)if(arguments[b]&&arguments[b].stack)return void console.error(arguments[b].stack);console.trace()},g.Circle=h.Circle,b.defineProperty(g.Circle.prototype,"class",{get:function(){return"qc.Circle"}}),g.Circle.prototype.toJson=function(){return[this.x,this.y,this.diameter]},g.Circle.prototype.fromJson=function(a){this.x=a[0],this.y=a[1],this.diameter=a[2]},g.Ellipse=h.Ellipse,b.defineProperty(g.Ellipse.prototype,"class",{get:function(){return"qc.Ellipse"}}),g.Ellipse.prototype.toJson=function(){return[this.x,this.y,this.width,this.height]},g.Ellipse.prototype.fromJson=function(a){this.x=a[0],this.y=a[1],this.width=a[2],this.height=a[3]},g.Line=h.Line,b.defineProperty(g.Line.prototype,"class",{get:function(){return"qc.Line"}}),g.Line.prototype.toJson=function(){return[this.start.x,this.start.y,this.end.x,this.end.y]},g.Line.prototype.fromJson=function(a){this.start.setTo(a[0],a[1]),this.end.setTo(a[2],a[3])},g.Matrix=h.Matrix,b.defineProperty(g.Matrix.prototype,"class",{get:function(){return"qc.Matrix"}}),g.Matrix.prototype.toJson=function(){return this.toArray()},g.Matrix.prototype.fromJson=function(a){this.fromArray(a)},g.Point=h.Point,b.defineProperty(g.Point.prototype,"class",{get:function(){return"qc.Point"}}),g.Point.prototype.toJson=function(){return[this.x,this.y]},g.Point.prototype.fromJson=function(a){this.x=a[0],this.y=a[1]},g.Polygon=h.Polygon,b.defineProperty(g.Polygon.prototype,"class",{get:function(){return"qc.Polygon"}}),g.Polygon.prototype.toJson=function(){return[this.toNumberArray(),this.closed]},g.Polygon.prototype.fromJson=function(a){this.setTo(a[0]),this.closed=a[1]},g.Rectangle=h.Rectangle,b.defineProperty(g.Rectangle.prototype,"class",{get:function(){return"qc.Rectangle"}}),g.Rectangle.prototype.toJson=function(){return[this.x,this.y,this.width,this.height]},g.Rectangle.prototype.fromJson=function(a){this.setTo(a[0],a[1],a[2],a[3])},g.RoundedRectangle=h.RoundedRectangle,b.defineProperty(g.RoundedRectangle.prototype,"class",{get:function(){return"qc.RoundedRectangle"}}),g.RoundedRectangle.prototype.toJson=function(){return[this.x,this.y,this.width,this.height,this.radius]},g.RoundedRectangle.prototype.fromJson=function(a){this.x=a[0],this.y=a[1],this.width=a[2],this.height=a[3],this.radius=a[4]};var k=g.Keyframe=function(a,b,c,d){this.time=a,this.value=b,this.type=k.FREE_SMOOTH,this.inTangent=isNaN(c)?0:c,this.outTangent=isNaN(d)?0:d};k.prototype={},k.prototype.constructor=k,k.prototype.clone=function(){var a=new k(this.time,this.value,this.inTangent,this.outTangent);return a.type=this.type,a},k.AUTO=0,k.FREE_SMOOTH=1,k.FLAT=2,k.BROKEN=3,k.InfinityValue=Math.tan(Math.PI/2),b.defineProperties(k.prototype,{inAngle:{get:function(){return Math.atan(this.inTangent)},set:function(a){this.inTangent=Math.tan(a*Math.PI/180)}},outAngle:{get:function(){return Math.atan(this.outTangent)},set:function(a){this.outTangent=Math.tan(a*Math.PI/180)}},inTangent:{get:function(){return this._inTangent||0},set:function(a){this._inTangent=Math.abs(a)===k.InfinityValue?(0>a?-1:1)*(1/0):a}},outTangent:{get:function(){return this._outTangent||0},set:function(a){this._outTangent=Math.abs(a)===k.InfinityValue?(0>a?-1:1)*(1/0):a}},isFlat:{get:function(){return this.inTangent===this.outTangent&&0===this.outTangent}},isBroken:{get:function(){return this.inTangent!==this.outTangent}}});var l=g.BezierCurve=function(a){if(this._keys=[],Array.isArray(a))for(var b in a)this.addKey(a[b]);else for(var b=0;b<arguments.length;++b)this.addKey(arguments[b])};l.prototype={},l.prototype.constructor=l,b.defineProperties(l.prototype,{"class":{get:function(){return"qc.BezierCurve"}},keys:{get:function(){return this._keys},set:function(a){this._keys=[];for(var b in a)this.addKey(a[b])}},length:{get:function(){return this._keys.length}},startTime:{get:function(){return this.keys&&this.keys.length?this.keys[0].time:0}},endTime:{get:function(){return this.keys&&this.keys.length?this.keys[this.keys.length-1].time:0}},totalTime:{get:function(){return this.keys&&this.keys.length?this.keys[this.keys.length-1].time-this.keys[0].time:0}},postWrapMode:{get:function(){return isNaN(this._postWrapMode)?l.WRAP_CLAMP:this._postWrapMode},set:function(a){this._postWrapMode=a}},preWrapMode:{get:function(){return isNaN(this._preWrapMode)?l.WRAP_CLAMP:this._preWrapMode},set:function(a){this._preWrapMode=a}}}),l.prototype.toJson=function(){for(var a=[],b=0;b<this._keys.length;++b)a.push([this._keys[b].time,this._keys[b].value,this._keys[b].inTangent===1/0?"Infinity":this._keys[b].inTangent,this._keys[b].outTangent===1/0?"Infinity":this._keys[b].outTangent]);return a.push([this.preWrapMode,this.postWrapMode]),a},l.prototype.fromJson=function(a){for(var b=0;b<a.length;++b)4===a[b].length&&this.addKey(a[b][0],a[b][1],"Infinity"===a[b][2]?1/0:a[b][2],"Infinity"===a[b][3]?1/0:a[b][3]);2===a[a.length-1].length&&(this.preWrapMode=a[a.length-1][0],this.postWrapMode=a[a.length-1][1])},l.prototype.sort=function(){this._keys.sort(function(a,b){return a.time-b.time})},l.prototype.addKey=function(a,b,c,d){var e=!(a instanceof k)&&(isNaN(c)||isNaN(d)),f=a instanceof k?a:new k(a,b,c,d),g=this._searchInsertIndex(this._keys,f,this._keyframeLess),h=0>g?this._keys.push(f)-1:this._keys.splice(g,this._keys[g].time===f?1:0,f)&&g;return e&&this.makeKeyframeAuto(h),h},l.prototype.removeKey=function(a){return this._keys?this._keys.splice(a,1):null},l.prototype._keyframeLess=function(a,b){return a.time<b.time},l.prototype._searchInsertIndex=function(a,b,c){var d=0,e=a.length-1;if(0>e)return-1;for(var f=0;e>d;)f=Math.floor((d+e)/2),c(a[f],b)?d=f+1:e=f;return c(a[d],b)?-1:d},l.prototype._calc=function(a,b,c,d,e){var f=Math.pow(1-a,3)*b+3*Math.pow(1-a,2)*a*c+3*(1-a)*Math.pow(a,2)*e+d*Math.pow(a,3);return f===1/0||isNaN(f)||Math.abs(f)>=2147483647?1===a?d:b:f},l.prototype._calcDerivative=function(a,b,c,d,e){var f=1-a,g=-3*b*f*f+3*c*f*(1-3*a)+3*e*a*(2-3*a)+3*d*Math.pow(a,2);return g===1/0||isNaN(g)?0:g},l.prototype.evaluate=function(a,b){var c=0,d=this._keys?this._keys.length:0;if(0===d)return 0/0;var e=this._keys[0].time,f=this._keys[d-1].time,g=f-e;if(e>a){if(0===g||this.preWrapMode===l.WRAP_CLAMP)return this._keys[0].value;if(this.preWrapMode===l.WRAP_LOOP){var h=e-a;return h-=Math.floor(h/g)*g,this.evaluate(f-h,b)}if(this.preWrapMode===l.WRAP_PINGPONG){var h=e-a;return h-=2*Math.floor(h/(2*g))*g,g>=h?this.evaluate(e+h,b):this.evaluate(f-h+g,b)}}if(a>f){if(0===g||this.postWrapMode===l.WRAP_CLAMP)return this._keys[d-1].value;if(this.postWrapMode===l.WRAP_LOOP){var h=a-f;return h-=Math.floor(h/g)*g,this.evaluate(e+h,b)}if(this.postWrapMode===l.WRAP_PINGPONG){var h=a-f;return h-=2*Math.floor(h/(2*g))*g,g>=h?this.evaluate(f-h,b):this.evaluate(e+h-g,b)}}a===e&&b&&this.preWrapMode!==l.WRAP_CLAMP&&(a=f);for(var i;++c<d;)if(i=this._keys[c].time,i!==e){if(i>=a){var j=i-e,k=(this._keys[c].value-this._keys[c-1].value,(a-e)/j),m=this._calc(k,this._keys[c-1].value,this._keys[c-1].value+j*this._keys[c-1].outTangent/3,this._keys[c].value,this._keys[c].value-j*this._keys[c].inTangent/3);return m}e=this._keys[c].time}return 0/0},l.prototype.evaluateDerivative=function(a){var b=0,c=this._keys?this._keys.length:0;if(0===c)return 0/0;var d=this._keys[0].time;if(d>a||a>this._keys[c-1].time)return 0/0;for(var e;++b<c;)if(e=this._keys[b].time,e!==d){if(e>a){var f=e-d,g=(a-d)/f,h=this._calcDerivative(g,this._keys[b-1].value,this._keys[b-1].value+f*this._keys[b-1].outTangent/3,this._keys[b].value,this._keys[b].value-f*this._keys[b].inTangent/3);return h/f}d=this._keys[b].time}return 0/0},l.prototype.makeKeyframeAuto=function(a){var b=a>=0&&a<this._keys.length?this.keys[a]:null,c=a>0&&a<this._keys.length?this._keys[a-1]:null,d=a<this._keys.length-1&&a>=0?this._keys[a+1]:null,e=0,f=0;b&&(c&&(e++,f+=Math.atan2(b.value-c.value,b.time-c.time)),d&&(e++,f+=Math.atan2(d.value-b.value,d.time-b.time)),e>0&&(b.inTangent=b.outTangent=Math.tan(f/e)))},l.prototype.makeKeyframeSmooth=function(a){var b=a>=0&&a<this._keys.length?this.keys[a]:null;if(b){var c=Math.atan(b.inTangent)+Math.atan(b.outTangent);b.inTangent=b.outTangent=Math.tan(c/2)}},l.prototype.makeKeyframeFlat=function(a){var b=a>=0&&a<this._keys.length?this.keys[a]:null;b&&(b.inTangent=b.outTangent=0)},l.prototype.clone=function(){var a=new l([]);for(var b in this._keys)a.addKey(this._keys[b].clone());return a},l.WRAP_CLAMP=0,l.WRAP_LOOP=1,l.WRAP_PINGPONG=2;var m=g.GeometricTool={};m.flattenPolygon=function(a){for(var b=new Array(2*a.length),c=a.length;c--;)b[2*c]=a[c].x,b[2*c+1]=a[c].y;return b},m.polygonContains=function(a,b,c){if(isNaN(a[0])){for(var d=a.length,e=!1,f=-1,g=d-1;++f<d;g=f){var h=a[f].x,i=a[f].y,j=a[g].x,k=a[g].y;(c>=i&&k>c||c>=k&&i>c)&&(j-h)*(c-i)/(k-i)+h>b&&(e=!e)}return e}for(var d=a.length/2,e=!1,f=-1,g=d-1;++f<d;g=f){var h=a[2*f],i=a[2*f+1],j=a[2*g],k=a[2*g+1];(c>=i&&k>c||c>=k&&i>c)&&(j-h)*(c-i)/(k-i)+h>b&&(e=!e)}return e},m.pointOnLine=function(a,b,c,d){return(c-a.x)*(b.y-a.y)===(b.x-a.x)*(d-a.y)},m.pointOnSegment=function(a,b,c,d){var e=Math.min(a.x,b.x),f=Math.max(a.x,b.x),h=Math.min(a.y,b.y),i=Math.max(a.y,b.y);return g.GeometricTool.pointOnLine(a,b,c,d)&&c>=e&&f>=c&&d>=h&&i>=d},m.lineIntersectsPoints=function(a,b,c,d,e,f){"undefined"==typeof e&&(e=!0),f||(f=new g.Point);var h=b.y-a.y,i=d.y-c.y,j=a.x-b.x,k=c.x-d.x,l=b.x*a.y-a.x*b.y,m=d.x*c.y-c.x*d.y,n=h*k-i*j;if(0===n)return null;if(a.equals(c)||a.equals(d))return f.x=a.x,f.y=a.y,f;if(b.equals(c)||b.equals(d))return f.x=b.x,f.y=b.y,f;if(f.x=(j*m-k*l)/n,f.y=(i*l-h*m)/n,e){var o=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y),p=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))/o,q=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))/o;return p>=0&&1>=p&&q>=0&&1>=q?f:null}return f};var n=m._sutherlandHodgmanInside=function(a,b,c,d){return(b.x-a.x)*(c.y-a.y)+d>=(b.y-a.y)*(c.x-a.x)},o=m._sutherlandHodgmanIntersection=function(a,b,c,d){var e=[a.x-b.x,a.y-b.y],f=[c.x-d.x,c.y-d.y],g=a.x*b.y-a.y*b.x,h=c.x*d.y-c.y*d.x,i=1/(e[0]*f[1]-e[1]*f[0]);return{x:(g*f[0]-h*e[0])*i,y:(g*f[1]-h*e[1])*i}};m.sutherlandHodgman=function(a,b){var c,d,e,f,g,h,i=1e-6,j=a;c=b[b.length-1];for(g in b){var d=b[g],k=j;j=[],e=k[k.length-1];for(h in k){var f=k[h];n(c,d,f,i)?(n(c,d,e,i)||j.push(o(c,d,e,f)),j.push(f)):n(c,d,e,i)&&j.push(o(c,d,e,f)),e=f}c=d}return j},m.Triangulate=function(a){var b=!0,c=a.length;if(3>c)return[];for(var d=[],e=[],f=0;c>f;f++)e.push(f);f=0;for(var g=c;g>3;){var h=e[(f+0)%g],j=e[(f+1)%g],k=e[(f+2)%g],l=a[h].x,m=a[h].y,n=a[j].x,o=a[j].y,p=a[k].x,q=a[k].y,r=!1;if(i.PolyK._convex(l,m,n,o,p,q,b)){r=!0;for(var s=0;g>s;s++){var t=e[s];if(t!==h&&t!==j&&t!==k&&i.PolyK._PointInTriangle(a[t].x,a[t].y,l,m,n,o,p,q)){r=!1;break}}}if(r)d.push(h,j,k),e.splice((f+1)%g,1),g--,f=0;else if(f++>3*g){if(!b)return null;for(d=[],e=[],f=0;c>f;f++)e.push(f);f=0,g=c,b=!1}}return d.push(e[0],e[1],e[2]),d},m.area=function(a,b,c){return a&&b&&c?(b.x-a.x)*(c.y-a.y)-(c.x-a.x)*(b.y-a.y):0},m.left=function(a,b,c){return m.area(a,b,c)>0},m.leftOn=function(a,b,c){return m.area(a,b,c)>=0},m.right=function(a,b,c){return m.area(a,b,c)<0},m.rightOn=function(a,b,c){return m.area(a,b,c)<=0},m.distance=function(a,b){var c=b.x-a.x,d=b.y-a.y;return c*c+d*d},m.atPolygon=function(a,b){var c=a.length;return a[0>b?b%c+c:b%c]},m.lineInt=function(a,b,c){c=c||0;var d,e,f,h,i,j,k,l=new g.Point;return d=a[1].y-a[0].y,e=a[0].x-a[1].x,f=d*a[0].x+e*a[0].y,h=b[1].y-b[0].y,i=b[0].x-b[1].x,j=h*b[0].x+i*b[0].y,k=1/(d*i-h*e),m._equals(k,0,c)||(l.x=(i*f-e*j)*k,l.y=(d*j-h*f)*k),l},m.isPolygonReflex=function(a,b){return m.right(m.atPolygon(a,b-1),m.atPolygon(a,b),m.atPolygon(a,b+1))},m.polygonCanSee=function(a,b,c){var d,e,f=[],g=[];if(m.leftOn(m.atPolygon(a,b+1),m.atPolygon(a,b),m.atPolygon(a,c))&&m.rightOn(m.atPolygon(a,b-1),m.atPolygon(a,b),m.atPolygon(a,c)))return!1;e=m.distance(m.atPolygon(a,b),m.atPolygon(a,c));for(var h=0;h!=a.length;++h)if((h+1)%a.length!==b&&h!==b&&m.leftOn(m.atPolygon(a,b),m.atPolygon(a,c),m.atPolygon(a,h+1))&&m.rightOn(m.atPolygon(a,b),m.atPolygon(a,c),m.atPolygon(a,h))&&(f[0]=m.atPolygon(a,b),f[1]=m.atPolygon(a,c),g[0]=m.atPolygon(a,h),g[1]=m.atPolygon(a,h+1),d=m.lineInt(f,g),m.distance(m.atPolygon(a,b),d)<e))return!1;return!0},m._equals=function(a,b,c){return c=c||0,Math.abs(a-b)<c},m.getIntersectionPoint=function(a,b,c,d,e){e=e||0;var f=b.y-a.y,g=a.x-b.x,h=f*a.x+g*a.y,i=d.y-c.y,j=c.x-d.x,k=i*c.x+j*c.y,l=f*j-i*g;return m._equals(l,0,e)?{x:0,y:0}:{x:(j*h-g*k)/l,y:(f*k-i*h)/l}},m.quickDecomp=function(a,b,c,d,e,f,g){f=f||100,g=g||0,e=e||25,b="undefined"!=typeof b?b:[],c=c||[],d=d||[];var h=[0,0],i=[0,0],j=[0,0],k=0,l=0,n=0,o=0,p=0,q=0,r=0,s=[],t=[],u=a;if(u.length<3)return b;if(g++,g>f)return b;for(var v=0;v<u.length;++v)if(m.isPolygonReflex(u,v)){c.push(u[v]),k=l=Number.MAX_VALUE;for(var w=0;w<u.length;++w)m.left(m.atPolygon(u,v-1),m.atPolygon(u,v),m.atPolygon(u,w))&&m.rightOn(m.atPolygon(u,v-1),m.atPolygon(u,v),m.atPolygon(u,w-1))&&(j=m.getIntersectionPoint(m.atPolygon(u,v-1),m.atPolygon(u,v),m.atPolygon(u,w),m.atPolygon(u,w-1)),m.right(m.atPolygon(u,v+1),m.atPolygon(u,v),j)&&(n=m.distance(u[v],j),l>n&&(l=n,i=j,q=w))),m.left(m.atPolygon(u,v+1),m.atPolygon(u,v),m.atPolygon(u,w+1))&&m.rightOn(m.atPolygon(u,v+1),m.atPolygon(u,v),m.atPolygon(u,w))&&(j=m.getIntersectionPoint(m.atPolygon(u,v+1),m.atPolygon(u,v),m.atPolygon(u,w),m.atPolygon(u,w+1)),m.left(m.atPolygon(u,v-1),m.atPolygon(u,v),j)&&(n=m.distance(u[v],j),k>n&&(k=n,h=j,p=w)));if(q==(p+1)%u.length)j.x=(i.x+h.x)/2,j.y=(i.y+h.y)/2,d.push(j),p>v?(Array.prototype.push.apply(s,u.slice(v,p+1)),s.push(j),t.push(j),0!=q&&Array.prototype.push.apply(t,u.slice(q,u.length)),Array.prototype.push.apply(t,u.slice(0,v+1))):(0!=v&&Array.prototype.push.apply(s,u.slice(v,u.length)),Array.prototype.push.apply(s,u.slice(0,p+1)),s.push(j),t.push(j),Array.prototype.push.apply(t,u.slice(q,v+1)));else{if(q>p&&(p+=u.length),o=Number.MAX_VALUE,q>p)return b;for(var w=q;p>=w;++w)m.leftOn(m.atPolygon(u,v-1),m.atPolygon(u,v),m.atPolygon(u,w))&&m.rightOn(m.atPolygon(u,v+1),m.atPolygon(u,v),m.atPolygon(u,w))&&(n=m.distance(m.atPolygon(u,v),m.atPolygon(u,w)),o>n&&(o=n,r=w%u.length));r>v?(Array.prototype.push.apply(s,u.slice(v,r+1)),0!=r&&Array.prototype.push.apply(t,u.slice(r,u.length)),Array.prototype.push.apply(t,u.slice(0,v+1))):(0!=v&&Array.prototype.push.apply(s,u.slice(v,u.length)),Array.prototype.push.apply(s,u.slice(0,r+1)),Array.prototype.push.apply(t,u.slice(r,v+1)))}return s.length<t.length?(m.quickDecomp(s,b,c,d,e,f,g),m.quickDecomp(t,b,c,d,e,f,g)):(m.quickDecomp(t,b,c,d,e,f,g),m.quickDecomp(s,b,c,d,e,f,g)),b}return b.push(u),b},m.decomp=function(a){var b=m.getCutEdges(a);return b.length>0?m.polygonSlice(a,b):[a]},m.polygonSlice=function(a,b){if(0===b.length)return[this];if(b instanceof Array&&b.length&&b[0]instanceof Array&&2==b[0].length&&b[0][0]instanceof Array){for(var c=[a],d=0;d<b.length;d++)for(var e=b[d],f=0;f<c.length;f++){var g=c[f],h=m.polygonSlice(g,e);if(h){c.splice(f,1),c.push(h[0],h[1]);break}}return c}var e=b,d=a.indexOf(e[0]),f=a.indexOf(e[1]);return-1!=d&&-1!=f?[m.copyPolygon(a,d,f),m.copyPolygon(a,f,1)]:!1},m.copyPolygon=function(a,b,c,d){var e=d||[];if(c>b)for(var f=b;c>=f;f++)e.push(a[f]);else{for(var f=0;c>=f;f++)e.push(a[f]);for(var f=b;f<a.length;f++)e.push(a[f])}return e},m.getCutEdges=function(a){for(var b=[],c=[],d=[],e=Number.MAX_VALUE,f=0;f<a.length;++f)if(m.isPolygonReflex(a,f))for(var g=0;g<a.length;++g)if(m.polygonCanSee(a,f,g)){c=m.getCutEdges(m.copyPolygon(a,f,g)),d=m.getCutEdges(m.copyPolygon(a,g,f));for(var h=0;h<d.length;h++)c.push(d[h]);c.length<e&&(b=c,e=c.length,b.push([m.atPolygon(a,f),m.atPolygon(a,g)]))}return b};var p=g.AssetUtil={ASSET_SCENE:1,ASSET_PREFAB:2,ASSET_ATLAS:3,ASSET_TEXT:4,ASSET_FONT:5,ASSET_SOUND:6,ASSET_EXCEL:7,ASSET_WEBFONT:8,ASSET_JS:100,ASSET_UNKNOWN:101,parse:function(a,b,d){var e,f=b.key,h=b.url;if(!/\.bin$/.test(h)){if(b.isRaw)this._addAtlasToCache(a,f,h);else{var i=a.assets._cache.getSound(h);if(i){var j=new g.SoundAsset(f,h,i.data,{uuid:f,type:p.ASSET_SOUND});a.assets.cache(f,h,j)}}return void(d&&d())}if(b.isSound){var k=a.assets._cache.getBinary(h);delete a.assets._cache._binary[h];var l,m,n=new Uint8Array(k);if(81!==n[0]||67!==n[1])return a.log.error("Asset({0}) parse fail",h),void a.assets._parsing--;l=n,m=2;var o=function(){var a=l[m]<<24|l[m+1]<<16|l[m+2]<<8|l[m+3],b=m+4;return m+=a+4,[b,a]};e=[];var q;q=o(),e.push(a.serializer.unpackUTF8(l.subarray(q[0],q[0]+q[1]))),q=o(),e.push(k.slice(q[0],q[1]))}else{var k=a.assets._cache.getText(h);delete a.assets._cache._text[h];try{e=JSON.parse(k)}catch(r){return a.log.error("Asset{0}/{1} Parse fail",f,h),g.Util.popupError(r.message),void(d&&d())}}var s=JSON.parse(e[0]);switch(s.type){case p.ASSET_ATLAS:return p._parseAtlas(a,s,JSON.parse(e[1]),e[2],e[3]?JSON.parse(e[3]):c,f,h,d);case p.ASSET_PREFAB:return p._parsePrefab(a,JSON.parse(e[1]),f,h,s,d);case p.ASSET_SCENE:return p._parseScene(a,JSON.parse(e[1]),f,h,s,d);case p.ASSET_TEXT:return p._parseText(a,e[1],f,h,s,d);case p.ASSET_FONT:return p._parseFont(a,s,e[1],e[2],f,h,d);case p.ASSET_SOUND:return p._parseSound(a,s,e[1],f,h,d);case p.ASSET_EXCEL:return p._parseExcel(a,s,JSON.parse(e[1]),f,h,d);case p.ASSET_WEBFONT:return p._parseWebFont(a,s,JSON.parse(e[1]),f,h,d);default:throw new Error("unsupported asset type："+s.type)}},isSound:function(a){if(g.Util.isArray(a)){for(var b=0;b<a.length;b++)if(a[b]&&/\.(mp3|ogg|mp3\.bin|ogg\.bin)$/.test(a[b].toLowerCase()))return!0;return!1}return a&&/\.(mp3|ogg|mp3\.bin|ogg\.bin)$/.test(a.toLowerCase())},_parseAtlas:function(a,d,e,f,j,k,l,m){var n=new Image;n.src="data:image/png;base64,"+f,n.onerror=function(){n.onerror=c,m()},n.onload=function(){n.onload=c;var f=a.assets._cache;if(f._images[l]={url:l,data:n},i.BaseTextureCache[l]=new i.BaseTexture(n),i.TextureCache[l]=new i.Texture(i.BaseTextureCache[l]),b.keys(e).length>0)if(!j||d.animationType!==Ma.DRAGON_BONES&&d.animationType!==Ma.FRAME_SAMPLES)f._images[l].frameData=e&&g.Util.isArray(e.frames)?h.AnimationParser.JSONData(a.phaser,e,l):h.AnimationParser.JSONDataHash(a.phaser,e,l);else{var o=g.dragonBones.CoverAtlas(e);f._images[l].frameData=h.AnimationParser.JSONDataHash(a.phaser,o,l)}else f._images[l].frameData=new h.FrameData,f._images[l].frame=new h.Frame(0,0,0,n.width,n.height,"",""),f._images[l].frameData.addFrame(new h.Frame(0,0,0,n.width,n.height,null,a.math.uuid()));f._resolveURL(l,f._images[l]);var p=new g.Atlas(k,l,f._images[l],d,j);p.json=e,p.img=n,a.assets.cache(k,l,p),m()}},addAtlasFromImage:function(a,b,c,d){return a.assets._cache.addImage(c,c,d),this._addAtlasToCache(a,b,c)},_addAtlasToCache:function(a,b,c){var d=a.assets._cache._images[c],e=new g.Atlas(b,c,d,{uuid:a.math.uuid(),type:p.ASSET_ATLAS});return e.img=d.data,a.assets.cache(b,c,e),e},_parseFont:function(a,b,d,e,f,h,i){e=a.assets._loader.parseXml(e);var j=new Image;j.src="data:image/png;base64,"+d,j.onerror=function(){j.onerror=c,i()},j.onload=function(){j.onload=c;var d=new g.Font(f,h,j,e,b);d._fontFamily=g.UIText.BITMAPFONT,a.assets._cache.addBitmapFont(h,h,j,e,d.xSpacing,d.ySpacing),a.assets.cache(f,h,d),i()}},_parseText:function(a,b,c,d,e,f){a.assets._cache.addText(d,d,b),a.assets.cache(c,d,new g.TextAsset(c,d,b,e)),f()},_parseScene:function(a,b,c,d,e,f){return p._parsePrefab(a,b,c,d,e,f)},_parsePrefab:function(a,b,c,d,e,f){a.assets.cache(c,d,new s(c,d,b,e)),f()},_parseSound:function(a,b,c,d,e,f){if(a.assets._cache.addSound(e,e,c),a.assets._cache.isSoundDecoded(d)){var h=new g.SoundAsset(d,e,a.phaser.cache.getSound(e),b);a.assets.cache(d,e,h),f()}else a.sound.phaser.decode(e,{url:e,meta:b,nextStep:f})},_parseExcel:function(a,b,c,d,e,f){a.assets.cache(d,e,new g.ExcelAsset(d,e,c,b)),f()},_parseWebFont:function(c,d,e,f,h,j){p._deleteWebFont(d.uuid),p._loadWebFont(c,d.uuid,e.url);var k=new g.Font(d.uuid,h,k,null,d);k._fontUrl="string"==typeof e.url?[e.url]:e.url,k._fontFamily=g.UIText.WEBFONT,c.assets.cache(f,h.toString(),k),j(),a.WebFont&&WebFont.load({timeout:6e4,custom:{families:[d.uuid]},fontactive:function(a){c.world&&(b.keys(i.Text.fontPropertiesCache).forEach(function(a){a.indexOf(d.uuid)>=0&&delete i.Text.fontPropertiesCache[a]}),p._refreshWebFont(a,c.world)),c.assets.webFontLoaded.dispatch()},fontinactive:function(a){c.log.error("Load "+a+" fail")}})},_webFontType:{eot:"embedded-opentype",ttf:"truetype",ttc:"truetype",woff:"woff",svg:"svg"},_loadWebFont:function(a,b,c){var d=p._webFontType,e=document.createElement("style");e.type="text/css",e.id="qc.webfont."+b,document.getElementsByTagName("head")[0].appendChild(e);var f="@font-face { font-family:"+b+"; src:";if(g.Util.isArray(c))for(var h=0,i=c.length;i>h;h++){var j=(c[h],p._getSuffix(c[h]));f+=c[h].indexOf("http")>=0?"url('"+c[h]+"') format('"+d[j]+"')":"url('"+(a.assets.baseURL+c[h])+"') format('"+d[j]+"')",f+=h===i-1?";":","}else{var j=p._getSuffix(c);f+="url('"+c+"') format('"+d[j]+"');"}e.textContent+=f+"};"},_deleteWebFont:function(a){for(;;){var b=document.getElementById("qc.webfont."+a);if(!b)break;g.Util.removeHTML(b)}},_refreshWebFont:function(a,b){b instanceof g.UIText&&b._refreshWebFont(a);for(var c=b.children,d=c.length;d--;){var e=c[d];p._refreshWebFont(a,e)}},_getSuffix:function(a){var b=a.substr((Math.max(0,a.lastIndexOf("."))||1/0)+1);return b.toLowerCase()},_createStandardXHR:function(){try{return new a.XMLHttpRequest}catch(b){}},_createActiveXHR:function(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}},getXHR:function(){var b;try{b=location.href}catch(c){b=document.createElement("a"),b.href="",b=b.href}var d=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,e=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,f=d.exec(b.toLowerCase())||[],g=e.test(f[1]),h=a.ActiveXObject?function(){return!g&&p._createStandardXHR()||p._createActiveXHR()}:p._createStandardXHR;return h()},get:function(a,b,c){var d=p.getXHR();d.open("GET",a,!0),d.responseType="text",d.onload=function(){return b(d.responseText)},d.onerror=function(){c&&c(d)},d.send()},post:function(a,b,c,d){var e=p.getXHR();e.open("POST",a,!0),e.responseType="text",e.onload=function(){return c(e.responseText)},e.onerror=function(){d&&d(e)},e.send(b)}},q=g.Assets=function(b,c,d){this._loader=c,this._cache=d,this.game=b,c._qc=this,d._qc=this,this._uuid2UrlConf=a.urlMapConfig||{},this._uuid2UrlConf.__builtin_resource__="__builtin_resource__",this.maxRetryTimes=1,this.webFontLoaded=new g.Signal,this._parsing=0,this._loaderTimerMutex=-1024,this._assets={},this._keyUrl={},this._complete={};var e=this;c.onFileComplete.add(function(a,b,c){if(!c){var d=e._complete[b];if(!d||0===d.length)return;return d[0].retry>=e.maxRetryTimes?(e.game.log.important("Asset({0}) load fail",b),void e._callCb(b,null,d[0])):void e.game.timer.add(1e3,function(){e.game.log.trace("Retry download:{0}",b),d[0].retry++,e._internalLoad(d[0])})}e._parseAsset(b)}),b.sound.phaser.onSoundDecode.add(function(a,c){var d=new g.SoundAsset(c.key,c.url,e.game.phaser.cache.getSound(a),c.meta);b.assets.cache(c.key,c.url,d),c.nextStep()}),this._loadBuiltin()};q.prototype={},q.prototype.constructor=q,q.IMAGE=1,q.AUDIO=2,q.TEXT=3,q.BITMAPFONT=4,q.BINARY=5,q.ATLAS=6,q.JSON=7,b.defineProperties(q.prototype,{isLoading:{get:function(){return this._loader.isLoading}},hasLoaded:{get:function(){return this._loader.hasLoaded}},baseURL:{get:function(){return this._loader.baseURL},set:function(a){this._loader.baseURL=a}},parsing:{get:function(){return this._parsing>0}},loaded:{get:function(){return this._loader._loadedFileCount}},total:{get:function(){return this._loader._totalFileCount}}}),q.prototype.loadBatch=function(){var a=function(a,b,c,d){b.loaded=!1,a.load(b.key,b.url,function(a){b.loaded=!0,b.asset=a,b.callback&&b.callback(b);for(var e=0;e<c.length;e++)if(!c[e].loaded)return;d(c)},b.override,b.isRaw)};return function(b,c){for(var d=0;d<b.length;d++)a(this,b[d],b,c)}}(),q.prototype._internalLoad=function(a){var b=this;a.retry||(a.retry=0),a.isSound=p.isSound(a.url),a.isSound&&(a.url=b.game.sound.tryGetUrl(a.url));var c=a.url;if(!a.override){var d=b.find(c);if(!(!d||d instanceof s&&d.hasUnloadedDependence(this.game)))return b._keyUrl[a.key]=c,void(a.callback&&a.callback(d))}if("__builtin_resource__"!==a.key){var e=b._loader;0===a.retry&&(b._complete[c]?b._complete[c].push(a):b._complete[c]=[a]),a.isSound?c.indexOf(".bin")<0?e.audio(c,c):p.isSound(c)&&e.binary(c,c):a.isRaw?e.image(c,c):e.text(c,c),b.start()}},q.prototype.load=function(){var a,b,c,d=this,e=!1,f=!1,g=!1;if(1===arguments.length?b=arguments[0]:2===arguments.length?"string"==typeof arguments[1]?(a=arguments[0],b=arguments[1]):(b=arguments[0],c=arguments[1]):(a=arguments[0],b=arguments[1],c=arguments[2],e=arguments[3],f=arguments[4],g=arguments[5]),a=a||b,!b)throw new Error("url is empty.");var h={key:a,url:b,callback:c,override:e,isRaw:f,inPrefab:g};d.game.phaser.state._created?d.game.timer.add(1,function(){d._internalLoad(h)}):d._internalLoad(h)},q.prototype.loadByUUID=function(a,b,c,d){var e=this._uuid2UrlConf[a];return e?void this.load(a,e,b,c,!1,d):(this.game.log.important("UUID({0}) not found.",a),void(b&&b()))},q.prototype.loadTexture=function(){var a,b,c,d;if(1===arguments.length?"string"==typeof arguments[0]?b=arguments[0]:c=arguments[0]:2===arguments.length?"string"==typeof arguments[0]&&"function"==typeof arguments[1]?(b=arguments[0],d=arguments[1]):"function"==typeof arguments[1]?(c=arguments[0],d=arguments[1]):(a=arguments[0],b=arguments[1]):"string"==typeof arguments[1]?(a=arguments[0],b=arguments[1],d=arguments[2]):(a=arguments[0],c=arguments[1],d=arguments[2]),a=a||b,c){if(!a)throw new Error("key cannot be null.");this._keyUrl[a]=a;var e=p.addAtlasFromImage(this.game,a,a,c);d(e)}else this.load(a,b,d,!1,!0)},q.prototype.find=function(a){if(p.isSound(a)&&(a=this.game.sound.tryGetUrl(a)),!g.Util.isArray(a)){var b=this._keyUrl[a];return b?this._assets[b]:null}for(var c=0;c<a.length;c++){var d=this.find(a[c]);if(d)return d}},q.prototype.unload=function(a){if("string"==typeof a&&!this._keyUrl[a]){var b=p.isSound(a);b&&(a=this.game.sound.tryGetUrl(a))}if(g.Util.isArray(a))for(var c=0;c<a.length;c++)this.unload(a[c]);else if("string"==typeof a){var d=this._keyUrl[a];d&&(this._assets[d]&&this._assets[d].unload(this.game),delete this._assets[d],delete this._keyUrl[a])}else this.unload(a.url)},q.prototype.findByUUID=function(a){for(var b in this._assets){var c=this._assets[b];if(c.uuid===a)return c}},q.prototype.cache=function(a,b,c){a=a||b,this._assets[b]=c,this._keyUrl[a]=b,this._keyUrl[b]=b},q.prototype.clear=function(){var a=this,c=b.keys(i.TextureCache);c.forEach(function(a){"__default"!==a&&"__missing"!==a&&"__builtin_resource__"!==a&&(i.TextureCache[a].destroy(),delete i.TextureCache[a])}),c=b.keys(i.BaseTextureCache),c.forEach(function(a){"__default"!==a&&"__missing"!==a&&"__builtin_resource__"!==a&&delete i.BaseTextureCache[a]});var d=a._cache._images.__builtin_resource__;a._cache.destroy(),a._cache._images.__builtin_resource__=d,c=b.keys(a._keyUrl),c.forEach(function(b){"__builtin_resource__"!==b&&delete a._keyUrl[b]}),c=b.keys(a._assets),c.forEach(function(b){"__builtin_resource__"!==b&&delete a._assets[b]})},q.prototype.start=function(){var a=this;a.game.time.fixedTime-a._loaderTimerMutex<1||(a._loaderTimerMutex=a.game.time.fixedTime,a.game.timer.add(1,function(){a._loaderTimerMutex=-1024,a._loader.start()}))},q.prototype.addUrlConf=function(a,b){this._uuid2UrlConf[a]=b},q.prototype._parseAsset=function(a){var b=this,c=b._complete[a];if(c&&0!=c.length){var d=function(){b._parsing--;var d=b.find(a);if(d&&d.meta.type!==p.ASSET_SCENE&&d instanceof s&&d.hasUnloadedDependence(b.game))for(var e in d.dependences){var f=d.dependences[e],g=function(e){var e=e;return function(f){if(!f){b.game.log.important("预制的依赖资源({0})加载失败.",e.uuid);var g=d.dependences[e.uuid];g&&(g.ok=!0)}d.hasUnloadedDependence(b.game)||b._callCb(a,d,c[0])}};b.loadByUUID(f.uuid,g(f),!1,!0)}else b._callCb(a,d,c[0])};b.nextStep=d,b._parsing++;try{p.parse(this.game,c[0],d)}catch(e){b._parsing--,b.game.log.error("Asset({0}) Parse fail",a,e),g.Util.popupError(e.message),b._callCb(a,null,c[0])}}},q.prototype._callCb=function(a,b){var c=this,d=c._complete[a];d&&(delete c._complete[a],d.forEach(function(d){b&&(c._keyUrl[d.key]=d.url),c.game.loadingProcessCallback&&(d.inPrefab||c.game.loadingProcessCallback(a,b,d)),d.callback&&d.callback(b)}))},q.prototype._loadBuiltin=function(){var a=this,b="__builtin_resource__",d="iVBORw0KGgoAAAANSUhEUgAAAEAAAACACAYAAAC7gW9qAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJqcGAAAEVVJREFUeNrtXHtUFFea/1V1dzU2jwmojUF8NOryMCkRVo0KGtmcQEgyY1COCBp8YcZZXYfpMzEHTZDdyDEaljXO0TnLOiyKgRCJOHEIqMRMZEAMqJQJiok0KgrLQ4lCP6q7q/aPoft0YwPd0N3Amf6dc09DVd176/vVd7/vu9+9VYAL/9ggRtoATdOBJEmucHd3f5Hn+ak///zzNADtXl5ej/V6/VW1Wn0TwHmGYVh73fSLL754kaKoCK1WKyRJEhRFWV33ypUrZjILhyl0qKen5zalUhkfHh7uHR0djblz54IgCAQFBQEAbt26BZ7n19bU1ODcuXNakiRrCYL4o16vP8kwjH44/YaGhi7jef6cn5+feN26dUhMTLT9iRPEiJ62bOnSpeeSk5P5y5cv87aioqKCf/311/9v/vz58bb2vXDhwn8KDQ3lTp8+zY8EwxY+KirqUExMjL6kpIQfKXJzc/nIyMhGmqan26D2XXv27OF1Oh2vUql4jUbDq1Qqvre316Zisw2gadrD29u7Yvny5Qv37t1rpkI8z0Ov14PjOHAcBwDGX5Ikjb8kSUIgEDxTd+PGjb0Mw7x57dq1i4Pdw4IFC34VEBBQkpuba6w7XLi7uxNWE0DT9BRPT8+rb7311vNyudx4XK/XQ6fTQa+3bSgLBAIIhUIIBALjMblczl28ePGda9eu/c8g9/G36urqToIg3gBA2pMAcpBOKalUWrlq1Sqj8DzPQ61WQ6PR2Cy8gTiNRgO1Wm18illZWWRUVNR/h4aGrhyoHs/zMgDTB7vf4WLABv38/EoiIyNnpaamAgBYloVKpTKq+EjAcRxUKhVY9u+e8eOPPybmzZtXRNN04ABVhKbaOiJLbg0B0dHRv/Xw8Hjt/fffBwBoNBrodDq7ByE6nQ4ajQYAkJubK/L29i6laVpgwXV1EgSxzxGBEGlB9X0Igti/adMmEAQBtVo9LHW3ZVio1WoQBIFt27YFUBT12/7XUBR1PDIyssieT35AAnieT58zZ474tddeA8uydlF5a4YEy7JYs2YN/P3902maNgvtamtr92u1WraoqAgEQYzICwxKAE3TE/z9/X+9fv16o6V3FgxeZefOnZ4CgSC5/3mxWPzr7Oxs1NfXgyRJu9kBMwK8vb1XKpVKasGCBUYD5UywLIuXX34ZIpFoZ/9z3333XS6AzHfeeYeTy+Xo7Ow0EmFLsWRdjZgxY8bWWbNmQavV2lXNbIFWq8W8efNC1Gq1D8Mwj0zPXb9+ffeSJUv+eOnSpbrKysrJQqEQUqkUYrF42P2ZEdDb2xseHh7uUKM3GAyR5auvvkrU1NQsBvCX/tdUVVXdByC1uw2gadrnyZMnnjNnzhz1OXpwcDBEItEyZ/RlqgGzHz16BF9f31FTf4MW+Pr6Qq/Xv2hybEQ3RAxiMU2N4C80Gg0mTJgw6hogkUig1+ufc0ZfpgRQGFtwczYBPWKxGCqVatQlVyqVEAgET51NQMfkyZPR2toKR4SctqSsWltbQVHUQ2cT8JO3tzevUChGN0tLEGhqagLHcbVOJYBhGNbb27u1trZ2wKjJGcIDwDfffAOWZS85WwOgVqu/+vbbb43prNEASZKoqalRA6hzOgG1tbVHfXx8UF1dPSokkCSJy5cvA8C54abOR0QAwzB1t2/fvm+YdjpzGBj6O3bsGHp7e//daaT3PyCVSne1t7ejtLTUqVpAkiRKS0vR3NzMMAxTN2oEXLx4scDf37+xsLAQPM87hQSSJMHzPHJzc/nHjx8nO3XYWTpYUVERN3nyZP1HH31kzOs7UniSJLFv3z4olco/MQxzfdQJYBimoaura9Pt27dx6NAhh5FgaPfQoUOoqqq63d7e/hunG96BThQUFBynKOo/z58/j8OHD9udBEN7hw8fRklJSVdnZ2eEPVeQrTa+Q12QkJBwAMDvg4KCsGvXLhAEAY7jhj1lJgjCOOYzMzNRVVXV1NHRsZRhmLZBpsgOmw5b5eeio6OTZs+e/b+dnZ3ChIQExMbGmpEw1P0Z+jcIX1paivz8fPT29n718OHDVQzDjNoMzGpHT9N0yIoVK04qFIrQadOmISEhAQsXLnyGBMOvqdCG3ytXruDTTz/F7du3ewmC+P2FCxeOjvbM0+ZIZ9GiRa+89NJLuXfv3vV/9OgRoqKiEBgYiKCgIJAkieDgYADAzZs3wXEcbt26hcbGRlRUVEAikbAkSWY/ePAgYzSf+ogIMNGIwCVLlvwrRVG/6u7unt7V1QWO43Dnzh0QBIGAgABwHIdJkyb1CoXCS/fu3Tva1dX1F2eFuA4nwAIhUwFMAeAD4BEAlmGYG3DBhTGNAYfA/fv33QsKCuQ1NTVv/PDDD8E8z9s8OzTUmTt37s1FixadXbt2bda0adN6raxLAAgE4D5CGXsBNBIEYdFXW9wml5eXty42Nvbw+vXrn9u8eTMCAgIGFH6o1Vqe59HU1LTg+++/XxAbG5ual5e3Izk5OX+ouz548OBX5eXl0U1NTXj8+PGwJPf29kZAQACio6PLAcRYpQEpKSlnPTw8Hq9cuXLdlClTwPP8iBdKDHP9trY2lJSU5Pf09Hjn5OS8YelauVwed/LkycKenh7R+vXr8eabb0ImkxmjR2uCLkO0qlAo8OWXX+LEiRPw8PDQJiUlLcvKyro8IAEHDhz4oL29PSAlJSXZ0Jm9VolMV2hzcnLypFJp07vvvmuW+EhLS6Ozs7Ovb968mVizZg2kUqlxztBfA/vfl6Xzht1r7e3t+Oyzz3Ds2DE+NTV1amZmZuszBCgUCq+YmJgHp06d8hCJRA7bGEGSJLRaLVavXt1TVlY2VSaTPTGcmz179s+LFy/2+vDDDwEAIpEIAoHgmS121gxBw0KrXq+HVqsFAOzZswfV1dVPfvrpp18YrjPux5k6dequsLCw6Llz5zp8bVAoFEIikVANDQ3q8+fP/9Vgetzc3BYWFBRAJBJhwoQJkEgkcHNzg1gsBkVRxt+hikgkMvvbMItdsWIFjh49Kn769KkbgAozAiiK+kNcXJzUy8vL4QQQBAF3d3cUFhZO/vHHHw3zgdMZGRmYP38+JBIJJBKJUQChUGjcX2hN6X+tKQmenp4oLy+PAJBh5gXa2tqkEydOdMrKMM/zmDhxItra2szW+ZctWwaJRAKxWAyBQDCi/IPB3hhsiKEsW7bMshvkOI50dhKU4zizDmUymV2Et9QXAIjFYshkMssZIT8/v7aOjg6npMIJgkBHRwf8/PzMkiAURdl1A5SlREz/dwuMBERERPy5vr7eaQTU19cjIiLiz6bHDdbeUQQQBGG2T9nMDd65c+e52NjY+1988YWHQCBwqBvU6/WIi4vrKS0tnTZr1qxug2lQq9VmBsve4DgOWq0Wbm5uRtmNPc2aNat7w4YNn+Tm5uYZ1MWeT8K0zdzc3LwNGzZ8YiK82VNypOb1b38shcI8y7IQiUQOHX5ardZgB8w1wICcnJw3QkNDy7dv39595swZNDc3W+1/ByrNzc04c+YMtm/f3h0aGlo+0DzAWatQNk2Hq6urVzY0NMwZSachISE/Ll68uGSI6TCv1WohFAodSoBOpzNoGWHXlJg94iO9Xu9wLeA4zuAJLA+BfzQMqG/Jycmbr169uqS9vd2rp6fHpkY9PDwglUqfhIWFVeXl5R2ztt6JEyeQkJAwor2/g0Gj0aCwsHBwGyCXy6MKCgr2URQ1Yffu3TKZTDaBoijCWk9AEARYluUVCoVq3759CpZlVWvXrt2dlZX19WD1oqKiiisrK+OePHniUAK8vLwQERHxxddff73qGQLS0tLmZGdnn8zIyJBGR0c/D4Aa7pjsC6TY8vLy1vT09PbU1NSkzMzMHwerM3369KevvPKKx9GjR8FxnCFgGTHUajVIksS2bdtw4cKFnnv37nk+kw/os/wFycnJvqtWrZpOURRlmJRYmlUNVkxcoEAmk7lTFKUsKipa2t3dPWgucOvWrdfy8/MTW1paiBdeeAE+Pj52IaC5uRkffPABioqKuOTk5JVVVVU/PTMXAPBJSEjI9E2bNvkLBALRSFJipnUFAoFo06ZN/iEhIdMB7BoiEVq2ZcuW+JKSEjYsLAzx8fG4cWP4ays3btxAfHw8wsLCUFJSwm7ZsiX+4MGDZQPZgNqGhoZwe7+TY5q2CgkJqQPwz0Ndn56eTj18+HDv3bt3NyqVyilKpXJY/fYlVtpmzJiR6+fntzcjI4MdLCtce/PmzVCe5wUOisP1wcHB160hwJkgB8us2lsLxlUc4GwkJyfvuXr1akx7e7vPMOOOR2FhYWV5eXkfjisC5HJ5XH5+/qfFxcXi6OhofP755wgMDLSpjcbGRuzevRvFxcVLfX1996xbty4xKyvrC5uHgLORlpZGHzly5PP4+HhxY2MjTp06ZbPwABAYGIhTp06hsbER8fHx4iNHjnyelpZGWzU0TY3grVu3QjmOc4gRJElSHxQUZGYEZ86c2RoZGTnl+PHjdu3r7bffxqVLl9qam5ufH8tDgGdZFgbheZ6HVqs1+xiDLXN8kiQhEolAEASOHz+OqVOnTgHADzXjHdUhcODAAQB/f4FapVJBp9MNKxfJcRx0Oh1UKpXxnUdD22PaCC5fvhxarda4dmevCY9IJMLy5cttjwMcuSpkqW2pVOqw7xJIpVLbCRAIBKSjcvICgYB0ZnBkbdtmN9XQ0NCt0Wj09l6W0mg0+oaGhu6xGAkaJU1JSfndjh07WnQ6ncqeQ4Hneeh0OtWOHTtaUlJSfjdmCcjJyfmW47ius2fPdqjVav1IFykM9dVqtf7s2bMdHMd15eTkfDtmCQCAxMTE3dnZ2Z3l5eUPlEolq9VqjbssbC1arRZKpZItLy9/kJ2d3ZmYmLh7LA6BAXOC7u7u7u+9995MmUw2QSgUWu2fSZKETqeDQqFQ7d+/v7m3t7d3gJwgz7IsdDqdQ/IPQqHQbAXIagL6EhIihUKxsa6ubmlnZ6dkOLOzSZMmKcPDw/8mk8lyMzIyLDl6Xq1Wj+jdg8EIIEnSbBHUJgKcFQr39PQYt7/ZmwCO4+Dh4TGkjKMaCre1tTlsL0BbW5vtRtARoGl6I03TZf2/DQQAlZWVdl8SN7RXWVk5+gTQNH0CwJ8ARAPYYnouJSXll1u3brV7RGhoa+vWrUhJSfmlzV7AjsL/G4BDJocuMwyz2PQaPz+/xzExMc8ZFkJGshfBdFfYtm3bUFZW1v3w4UPvUdEAmqaXAcgeqq+kpKS1xcXF3M6dO9HS0mK2LdaWYqjX0tKCnTt3ori4mEtKSlo7KoaNpmlfmqZVNE3zJkVN07TPQDlBX19ftaenJ7969WqeYRieZVmbCsMw/OrVq3lPT0/e19dXLZfL44YdCNmBgFb8/dUZU6xiGGbAJGV6ejqlUCjS6urqXuvs7PQcZtzxNDw8/CuZTJZpaQHEKQTQNF0JYGm/w6cZhonDGIU9X5r6LwD9P4LWyTDMZIxhCPsJEd73BP/AMAxng/DrLAjPAfgXjHEQJkJQADR9/5YBWM0wTK8VwtMArqLfUjuADIZh9o51AkxdU6rJ3zEAvqZpevIQwnsAqLIgPDMehO9PwBkApuvQCwHU0DQtG6R+PZ59q0sDYAXGCUy/I3QLQBAA009YyQDU0jS9wMLTPwsgwEKbif0/hDheNAAMw9wHMAeA6XtqPgD+StP0GybC7wXwuoX2Tg/m78eNG+yL2hoBTDI5rAfwGwDdAAot1B3zLs+mOKDPwDUC8Ot3Sm/B6HEA5jMMw4w3AgacDDEM09NnA5r7nbK0evwf41F4qyLBvvjgOoDggbli5mGcwpZPaNQDoC24PL/xZPWHnQ/oe8qXx7PLG3FCpC+jc2G8ujx7Tnv3wwUXXHDBBRdccMEFF1xwwQUXXHDBBRdccMEFF8Yd/h/5AZq7Tc/fygAAAABJRU5ErkJggg==",e={
ver:1,uuid:b,padding:{"button.png":[8,8,8,8],"button2.png":[8,8,8,8],"slider.png":[8,8,8,8],"sliderbg.png":[8,7,8,7],"sliderbg2.png":[10,6,2,6]}},f=JSON.parse('{"frames":{"button.png":{"frame":{"x":30,"y":67,"w":26,"h":23},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":26,"h":23},"sourceSize":{"w":26,"h":23}},"button2.png":{"frame":{"x":2,"y":59,"w":26,"h":23},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":26,"h":23},"sourceSize":{"w":26,"h":23}},"circle.png":{"frame":{"x":2,"y":2,"w":37,"h":37},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":37},"sourceSize":{"w":37,"h":37}},"empty.png":{"frame":{"x":41,"y":18,"w":16,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":16,"h":16},"sourceSize":{"w":16,"h":16}},"ok.png":{"frame":{"x":2,"y":84,"w":25,"h":22},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":25,"h":22},"sourceSize":{"w":25,"h":22}},"slider.png":{"frame":{"x":34,"y":41,"w":28,"h":24},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":28,"h":24},"sourceSize":{"w":28,"h":24}},"sliderbg.png":{"frame":{"x":2,"y":41,"w":30,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":30,"h":16},"sourceSize":{"w":30,"h":16}},"sliderbg2.png":{"frame":{"x":41,"y":2,"w":19,"h":14},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":19,"h":14},"sourceSize":{"w":19,"h":14}}},"meta":{"app":"http://www.codeandweb.com/texturepacker","version":"1.0","image":"__builtin_resource__.png","format":"RGBA8888","size":{"w":64,"h":128},"scale":"1"}}');a._parsing++,p._parseAtlas(this.game,e,f,d,c,e.uuid,b,function(){a._parsing--,a._callCb(b,a.find(b))})};var r=g.Atlas=function(a,b,d,e,f){this.key=b,this.url=b,this.meta=e,this.animation=c,this.json=c,this.img=c,this._data=d,f&&(this.animation={type:e.animationType,data:f})};r.prototype.constructor=r,b.defineProperties(r.prototype,{count:{get:function(){return this._data.frameData.total}},frames:{get:function(){return this._data.frameData._frames}},frameNames:{get:function(){var a=this.frames;if(!a||a.length<2)return[0];var b=[];for(var c in a)b.push(a[c].name);return b}},uuid:{get:function(){return this.meta.uuid}}}),r.prototype.getFrame=function(a){return"number"==typeof a?this._data.frameData.getFrame(a):this._data.frameData.getFrameByName(a)},r.prototype.getPadding=function(a){if(!this.meta||!this.meta.padding)return[0,0,0,0];if(1==this.count){var d=b.keys(this.meta.padding);a=d.length>0?d[0]:0}a===c&&(a=0);var e=this.meta.padding[a];return e&&(e[0]*=1,e[1]*=1,e[2]*=1,e[3]*=1),e||[0,0,0,0]},r.prototype.unload=function(a){a.assets._cache.removeImage(this.key,!1),delete i.TextureCache[this.key],delete i.BaseTextureCache[this.key]};var s=g.Prefab=function(a,b,c,d){this.key=a,this.url=b,this.meta=d,this.json=c};s.prototype.constructor=s,b.defineProperties(s.prototype,{uuid:{get:function(){return this.meta.uuid}},dependences:{get:function(){return this.json.dependences}}}),s.prototype.hasUnloadedDependence=function(a){for(var b in this.dependences){var c=this.dependences[b];if(!c.ok&&c.uuid!==this.uuid){var d=a.assets.find(c.uuid);if(!d)return!0;if(d instanceof s&&d.hasUnloadedDependence(a))return!0;c.ok=!0}}return!1};var t=g.Font=function(a,b,c,d,e){this.key=a,this.url=b,this.meta=e,this.xml=d,this.image=c,this._fontUrl,this._fontFamily=g.UIText.SYSTEMFONT};t.prototype.constructor=t,b.defineProperties(t.prototype,{uuid:{get:function(){return this.meta.uuid}},xSpacing:{get:function(){return this.meta.xSpacing}},ySpacing:{get:function(){return this.meta.ySpacing}}}),t.prototype.unload=function(a){a.assets._cache.removeBitmapData(this.key),a.assets._cache.removeBitmapFont(this.key)};var u=g.SoundAsset=function(a,b,c,d){this.key=b,this.url=b,this.meta=d,this.sound=c};u.prototype.constructor=u,b.defineProperties(u.prototype,{uuid:{get:function(){return this.meta.uuid}}}),u.prototype.unload=function(a){a.assets._cache.removeSound(this.key)};var v=g.TextAsset=function(a,b,c,d){this.key=a,this.url=b,this.meta=d,this.text=c};v.prototype.constructor=v,b.defineProperties(v.prototype,{uuid:{get:function(){return this.meta.uuid}}}),u.prototype.unload=function(a){a.assets._cache.removeText(this.key)};var w=g.ExcelAsset=function(a,b,c,d){this.key=a,this.url=b,this._meta=d,this._data="string"==typeof c?JSON.parse(c):c,this._sheets={},this._makeSheetData()};w.prototype.constructor=w,b.defineProperties(w.prototype,{uuid:{get:function(){return this.meta.uuid}},sheetsName:{get:function(){return this._sheets?b.keys(this._sheets):[]}},sheets:{get:function(){return this._sheets}},meta:{get:function(){return this._meta}}}),w.prototype._makeSheetData=function(){for(var a=this._data?b.keys(this._data):[],c=0;c<a.length;c++){var d=a[c],e=this._data[d].rows,f=this._data[d].cols,h=this._meta[d]?this._meta[d].primaryKey||[]:[],i=new g.ExcelSheet(f,e,h);this._sheets[d]=i}},w.prototype.findSheet=function(a){return this.sheets[a]},w.prototype.unload=function(){},w._EXCEL_DATE_OFF=-22089888e5,w._TIMEZONE_OFF=60*(new Date).getTimezoneOffset()*1e3,w.parseToDate=function(a){return new Date(w._EXCEL_DATE_OFF+864e5*a+w._TIMEZONE_OFF)};var x=g.ExcelSheet=function(a,b,c){this._cols=a||[],this._rows=b||[],this._indexes={},this._primaryKey=c,this._buildPrimaryIndex()};x.prototype.constructor=x,b.defineProperties(x.prototype,{columns:{get:function(){return this._cols}},rows:{get:function(){return this._rows}}}),x.prototype._buildPrimaryIndex=function(){this.addSortIndex("primary",this._primaryKey)},x.prototype.addSortIndex=function(a){var b,c=Array.prototype.slice.call(arguments,1);return b=Array.isArray(c[0])?new g.ExcelSortSheetIndex(this,c[0]):new g.ExcelSortSheetIndex(this,c),this._indexes[a]=b,b},x.prototype.addHashIndex=function(a,b,d){var e=new g.ExcelHashSheetIndex(this,b,d===c||d);return this._indexes[a]=e,e},x.prototype.getIndex=function(a){return this._indexes[a]},x.prototype.getPrimary=function(){return this.getIndex("primary")},x.prototype.find=function(a){for(var b=this._rows,c=b.length,d=-1;++d<c;)if(a(b[d]))return d;return-1},x.prototype.findLast=function(a){for(var b=this._rows,c=b.length;c-->0;)if(a(b[c]))return c;return-1},x.prototype.matches=function(a){for(var b=this._rows,c=b.length,d=-1,e=[];++d<c;)a(b[d])&&e.push(d);return e},x.prototype.parseColumnToData=function(a){for(var b=this._rows,c=b.length,d=-1,e=[];++d<c;)a in b[d]&&(b[d][a]=w.parseToDate(b[d][a]));return e};var y=g.ExcelSortSheetIndex=function(a,b){this.sheet=a,this._keys=b,this._buildIndex()};y.prototype={},y.prototype.constructor=y,b.defineProperties(y.prototype,{columns:{get:function(){return this._cols.slice(0)}},rows:{get:function(){return this._rows}}}),y.prototype._buildIndex=function(){var a=this,b=this.sheet.columns.slice(0);if(this._keys){for(var c=0;c<this._keys.length;c++){var d=b.indexOf(this._keys[c]);b.splice(d,1)}Array.prototype.unshift.apply(b,this._keys)}a._cols=b,a._rows=this.sheet.rows.slice(0),a._rows.sort(function(c,d){a._rowCompare(b,c,d)})},y.prototype.first=function(){var a=arguments.length;if(0===a)return 0;var b=this;return this._dichotomySearchFirst(this._rows,arguments,function(a,c){return b._searchCompare(a,c)})},y.prototype.last=function(){var a=arguments.length;if(0===a)return 0;var b=this;return this._dichotomySearchLast(this._rows,arguments,function(a,c){return b._searchCompare(a,c)})},y.prototype.matches=function(){var a=arguments.length;if(0===a)return[0,this._rows.length];var b=this,c=this._dichotomySearchFirst(this._rows,arguments,function(a,c){return b._searchCompare(a,c)});if(0>c)return null;var d=this._dichotomySearchFirst(this._rows,arguments,function(a,c){return b._searchCompare(a,c)},c);return[c,d]},y.prototype._cellCompare=function(a,b){return a?b?a===b?0:b>a?-1:1:-1:b?1:0},y.prototype._searchCompare=function(a,b){if(!b)return 1;for(var c,d=this._cols,e=a.length,f=-1;++f<e;){if(c=this._cellCompare(a[f],b[d[f]]),c>0)return 1;if(0>c)return-1}return 0},y.prototype._rowCompare=function(a,b,c,d,e){if(!a)return b?1:0;if(!b)return-1;d=d||0;for(var f,g,h=d+(e||c.length-d),i=d;h>i;i++)if(f=c[i],g=this._cellCompare(a[f],b[f]),0!==g)return g;return 0},y.prototype._dichotomySearch=function(a,b,c){for(var d=0,e=a.length-1,f=0,g=0;e>=d;)if(f=Math.floor((d+e)/2),g=c(b,a[f]),0>g)e=f-1;else{if(!(g>0))return f;d=f+1}return-1},y.prototype._dichotomySearchFirst=function(a,b,c,d,e){for(var d=d||0,e=e||a.length-1,f=0,g=0;e>d;)f=Math.floor((d+e)/2),g=c(b,a[f]),0>=g?e=f:d=f+1;return 0===c(b,a[d])?d:-1},y.prototype._dichotomySearchLast=function(a,b,c,d,e){for(var d=d||0,e=e||a.length-1,f=0,g=0;e>d;)f=Math.ceil((d+e)/2),g=c(b,a[f]),0>g?e=f-1:d=f;return 0===c(b,a[e])?d:-1};var z=g.ExcelHashSheetIndex=function(a,b,c){this._buildIndex(a,b,c)};z.prototype={},z.prototype.constructor=z,b.defineProperties(z.prototype,{columns:{get:function(){return this._cols.slice(0)}},rows:{get:function(){return this._rows}},keys:{get:function(){return this._keys}}}),z.prototype._buildIndex=function(a,b,c){var d=a.rows;this._rows=d,this._cols=a.columns.slice(0),this._keys=[];for(var e=d.length,f=-1;++f<e;){var g=d[f],h=g[b];c?(this[h]=g,this._keys.push(h)):h in this?this[h].push(g):(this[h]=[g],this._keys.push(h))}};var A=h.Loader.prototype.fileComplete;h.Loader.prototype.fileComplete=function(a,b){this.game.cache&&A.call(this,a,b)};var B=g.Math=function(a){this.phaserMath=h.Math,this.arrayUtils=h.ArrayUtils,this.phaserRnd=a};B.prototype={},B.prototype.constructor=B,B.prototype.fuzzyEqual=function(a,b,c){return this.phaserMath.fuzzyEqual(a,b,c)},B.prototype.shuffle=function(a){return this.arrayUtils.shuffle(a)},B.prototype.fuzzyLessThan=function(a,b,c){return this.phaserMath.fuzzyLessThan(a,b,c)},B.prototype.fuzzyGreaterThan=function(a,b,c){return this.phaserMath.fuzzyGreaterThan(a,b,c)},B.prototype.fuzzyCeil=function(a,b){return this.phaserMath.fuzzyCeil(a,b)},B.prototype.fuzzyFloor=function(a,b){return this.phaserMath.fuzzyFloor(a,b)},B.prototype.average=function(){return this.phaserMath.average.apply(null,arguments)},B.prototype.shear=function(a){return this.phaserMath.shear(a)},B.prototype.snapTo=function(a,b,c){return this.phaserMath.snapTo(a,b,c)},B.prototype.snapToFloor=function(a,b,c){return this.phaserMath.snapToFloor(a,b,c)},B.prototype.snapToCeil=function(a,b,c){return this.phaserMath.snapToCeil(a,b,c)},B.prototype.roundTo=function(a,b,c){return this.phaserMath.roundTo(a,b,c)},B.prototype.floorTo=function(a,b,c){return this.phaserMath.floorTo(a,b,c)},B.prototype.ceilTo=function(a,b,c){return this.phaserMath.ceilTo(a,b,c)},B.prototype.angleBetween=function(a,b,c,d){return this.phaserMath.angleBetween(a,b,c,d)},B.prototype.angleBetweenY=function(a,b,c,d){return this.phaserMath.angleBetweenY(a,b,c,d)},B.prototype.reverseAngle=function(a){return this.phaserMath.reverseAngle(a)},B.prototype.normalizeAngle=function(a){return this.phaserMath.normalizeAngle(a)},B.prototype.maxAdd=function(a,b,c){return this.phaserMath.maxAdd(a,b,c)},B.prototype.minSub=function(a,b,c){return this.phaserMath.minSub(a,b,c)},B.prototype.wrap=function(a,b,c){return c>b?this.phaserMath.wrap(a,b,c):this.phaserMath.wrap(a,c,b)},B.prototype.wrapValue=function(a,b,c){return this.phaserMath.wrapValue(a,b,c)},B.prototype.isOdd=function(a){return!!this.phaserMath.isOdd(a)},B.prototype.isEven=function(a){return!!this.phaserMath.isEven(a)},B.prototype.min=function(){return this.phaserMath.min.apply(null,arguments)},B.prototype.max=function(){return this.phaserMath.max.apply(null,arguments)},B.prototype.wrapAngle=function(a,b){return this.phaserMath.wrapAngle(a,b)},B.prototype.linear=function(a,b,c){return this.phaserMath.linear(a,b,c)},B.prototype.factorial=function(a){return this.phaserMath.factorial(a)},B.prototype.getRandom=function(a,b,c){return h.ArrayUtils.getRandomItem(a,b,c)},B.prototype.distance=function(a,b,c,d){return this.phaserMath.distance(a,b,c,d)},B.prototype.clamp=function(a,b,c){return this.phaserMath.clamp(a,b,c)},B.prototype.within=function(a,b,c){return this.phaserMath.within(a,b,c)},B.prototype.sign=function(a){return this.phaserMath.sign(a)},B.prototype.degToRad=function(a){return this.phaserMath.degToRad(a)},B.prototype.radToDeg=function(a){return this.phaserMath.radToDeg(a)},B.prototype.random=function(a,b){return"undefined"==typeof a||"undefined"==typeof b?this.phaserRnd.frac():a>b?this.phaserRnd.integerInRange(b,a):this.phaserRnd.integerInRange(a,b)},B.prototype.uuid=function(){return this.phaserRnd.uuid()},B.prototype.id=function(){var a=1;return function(){return++a}}(),B.prototype.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},B.prototype.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},B.prototype.smoothDamp=function(a,b,c,d,e,f){d=Math.max(1e-4,d);var g=2/d,h=g*f,i=1/(1+h+.48*h*h+.235*h*h*h),j=a-b,k=b,l=e*d;j=this.clamp(j,-l,l),b=a-j;var m=(c+g*j)*f;c=(c-g*m)*i;var n=b+(j+m)*i;return k-a>0&&n>k&&(n=k,c=(n-k)/f),[n,c]},g.CleanPIXISpriteRetainer=function(a){this._frameCount=0,this.game=a},g.CleanPIXISpriteRetainer.prototype={postRender:function(){if(this._frameCount++,!(this._frameCount<100)){this._frameCount=0;var a=this.game.phaser.renderer;if(a instanceof i.WebGLRenderer)for(var b=a.spriteBatch.sprites,c=a.spriteBatch.currentBatchSize,d=b.length,e=c;d>e;e++)b[e]=null}}},g.CleanPIXISpriteRetainer.prototype.constructor=g.CleanPIXISpriteRetainer;var C=g.NodePool=function(a){this._game=a,this._nodes={}};C.prototype={},C.prototype.constructor=C,b.defineProperties(C.prototype,{game:{get:function(){return this._game}}}),C.prototype.add=function(a,b){this._nodes[a]&&this.game.log.error("uuid {0} already exists",a),this._nodes[a]=b},C.prototype.remove=function(a){this._nodes[a]&&delete this._nodes[a]},C.prototype.find=function(a){return this._nodes[a]?this._nodes[a]:void 0};var D=g.Behaviour=function(a){this._gameObject=a,this._events=[]};D.prototype.constructor=D,g._userScripts={};var E=g.defineBehaviour=function(c,d,e,h){for(var i=c.split("."),j=a,k=0;k<i.length-1;k++)j[i[k]]||(j[i[k]]={}),j=j[i[k]];var l=i[i.length-1];return d=d||g.Behaviour,"function"==typeof h&&(h=h.call(this)),h=h||{},j[l]=function(a){this.__hadUpdateOrRender=this.preUpdate||this.update||this.postUpdate?!0:!1,d.call(this,a),this["class"]=c,this["super"]=d.prototype,"function"==typeof e&&e.call(this)},j[l].prototype=b.create(d.prototype),j[l].prototype.constructor=j[l],j[l].prototype.getMeta=function(){var a=d.prototype.getMeta.call(this);return f(a,h)},j[l].prototype.clazz=c,g._userScripts[c]=j[l],j[l]};b.defineProperties(D.prototype,{uuid:{get:function(){return this._uuid},set:function(a){this._uuid=a}},gameObject:{get:function(){return this._gameObject}},name:{get:function(){return this.gameObject.name},set:function(a){this.gameObject.name=a}},enable:{get:function(){return this._enable},set:function(a){this._enable!==a&&(this._enable=a,this._enable&&this.onEnable?this.onEnable():!this._enable&&this.onDisable&&this.onDisable())}},runInEditor:{get:function(){return this._runInEditor===!0},set:function(a){this._runInEditor=a}},game:{get:function(){return this.gameObject.game}}}),D.prototype.getScript=function(a){return this.gameObject.getScript(a)},D.prototype.getScripts=function(a){return this.gameObject.getScripts(a)},D.prototype.destroy=function(){this.gameObject.removeScript(this),this.onDestroy&&this.onDestroy(),this._events.forEach(function(a){a[0].remove(a[1],a[2])}),this._events=[]},D.prototype.isEnable=function(){return this._enable},D.prototype.getMeta=function(){return{uuid:g.Serializer.STRING,enable:{get:function(a){return a.enable},set:function(a,b){a._enable=b}}}},D.prototype._restoreInit=function(){this.gameObject._initGetSetField.call(this)},D.prototype.addListener=function(a,b,c,d){a.add(b,c,d),this._events.push([a,b,c])};var F=g.Storage=function(a){this.game=a,this.restore()};F.prototype={},F.prototype.constructor=F,b.defineProperties(F.prototype,{key:{get:function(){return this.game.bundleIdentifier}}}),F.prototype.restore=function(){var b=a.localStorage.getItem(this.key);this._data=b?JSON.parse(b):{}},F.prototype.save=function(){var b=this.key;if(!b||"com.DefaultCompany.Default"===b)throw new Error("game.bundleIdentifier should be set for local storage");var c=JSON.stringify(this._data);a.localStorage.setItem(this.key,c)},F.prototype.set=function(a,b){this._data[a]=b},F.prototype.del=function(a){this._data[a]&&delete this._data[a]},F.prototype.get=function(a){return this._data[a]?this._data[a]:void 0};var G=g.Node=function(a,b,d){var e=this;e.game=a.game._qc,e.phaser=a,a._qc=this,e.uuid=d||e.game.math.uuid(),e._interactive=!1,e._draggable=!1,e._children=null,e._prefab="",e.scripts=[],e["static"]=!1,e.hitArea=c,e._events=[];var f=a.destroy;a.destroy=function(){if(!e._destroy)if(e===e.game.world)f.call(a,!0,!0),e._dispatchModelChangeEvent("destroy",e);else{e.onDestroy(),f.call(a);for(var b=e.scripts.length;b--;)e.scripts[b].destroy();e.scripts=[],e._dispatchModelChangeEvent("destroy",e),e._destroy=!0}},b!==this&&(b||this.game.world).addChild(this),this._defaultTransform()};G.prototype.constructor=G,b.defineProperties(G.prototype,{uuid:{get:function(){return this._uuid},set:function(a){this._uuid&&this.game.nodePool.remove(this.uuid),this._uuid=a,this.game.nodePool.add(this.uuid,this)}},name:{get:function(){return this.phaser.name},set:function(a){a=a||"",a=a.replace(/\//g,""),this.phaser.name=a,this._dispatchModelChangeEvent("name",this)}},ignoreDestroy:{get:function(){return this.phaser.ignoreDestroy},set:function(a){this.phaser.ignoreDestroy=a}},alpha:{get:function(){return this.phaser.alpha},set:function(a){this.phaser.alpha=a}},visible:{get:function(){return this.phaser.visible},set:function(a){this.phaser.visible!==a&&(a&&this._toDestroy||(this.phaser.visible=a,this._isTransformDirty=!0,this._dispatchLayoutArgumentChanged("size"),this._notifyVisibleChanged(a)))}},parent:{get:function(){var a=this.phaser.parent;return a?a._qc:null},set:function(a){a?a.addChild(this):this.parent instanceof G&&this.parent.removeChild(this)}},worldVisible:{get:function(){return this.phaser&&this.phaser.worldVisible}},mask:{get:function(){return this.phaser.mask},set:function(a){this.phaser.mask=a}},children:{get:function(){if(!this._children){this._children=[];for(var a=this.phaser.children,b=0;b<a.length;b++){var c=a[b]._qc;c&&this._children.push(c)}}return this._children}},colorTint:{get:function(){return new oa(this.phaser.tint)},set:function(a){return a=a||new oa(16777215),a instanceof oa?void(this.phaser.tint=a.toNumber()):(console.error(a),void this.game.log.error("Expected qc.Color"))}},onChildrenChanged:{get:function(){return this._onChildrenChanged||(this._onChildrenChanged=new h.Signal)}}}),G.prototype.isVisible=function(){return this.phaser.visible},G.prototype.isWorldVisible=function(){var a=this;do{if(!a.phaser.visible)return!1;a=a.parent}while(a);return!0},G.prototype.addScript=function(a,b){var d=g.Util.findClass(a);if("function"!=typeof d)return void this.game.log.error("Class:{0} not exists",a);var e=new d(this);return e instanceof g.Behaviour?(e.uuid=this.game.math.uuid(),e._clazz=a,this.scripts.push(e),(b||b===c)&&(!e.awake||this.game.device.editor===!0&&e.runInEditor!==!0||e.awake()),e._enable===c&&b!==!1&&(this.game.device.editor===!0&&e.runInEditor!==!0?e._enable=!0:e.enable=!0),e):void this.game.log.error("Must inherit from qc.Behaviour")},G.prototype.removeScript=function(a){var b=this.scripts.indexOf(a);b>-1&&this.scripts.splice(b,1)},G.prototype.getScript=function(a,b){var c=a;if("string"==typeof a&&(c=g.Util.findClass(a)),!c)return this.game.log.error("Class:{0} not exists",a),null;if(1===arguments.length||b){for(var d in this.scripts)if(this.scripts[d]instanceof c)return this.scripts[d]}else for(var d in this.scripts)if(this.scripts[d]["class"]===c.prototype.clazz)return this.scripts[d]},G.prototype.getScripts=function(a,b){var c=a;"string"==typeof a&&(c=g.Util.findClass(a));var d=[];if(!c)return this.game.log.error("Class:{0} not exists",a),d;if(1===arguments.length||b)for(var e in this.scripts)this.scripts[e]instanceof c&&d.push(this.scripts[e]);else for(var e in this.scripts)this.scripts[e]["class"]===c.prototype.clazz&&d.push(this.scripts[e]);return d},G.prototype.isDescendantOf=function(a){for(var b=this.parent;b;){if(a===b)return!0;b=b.parent}return!1},G.prototype.getChildren=function(){var a=this._children;return a||(a=this.children),a},G.prototype.addChild=function(a){return this.addChildAt(a,this.children.length)},G.prototype.addChildAt=function(a,b){if(a.parent!==this){if(!(a instanceof G))throw new Error("Expected qc.Node");if(a===this)throw new Error("The child is myself");if(this.isDescendantOf(a))throw new Error("child is my parent");var c=a.parent;return c instanceof G&&(c._children=null),this.phaser.addAt?this.phaser.addAt(a.phaser,b):this.phaser.addChildAt(a.phaser,b),this._dispatchModelChangeEvent("parent",a),a}},G.prototype.swapChildren=function(a,b){this.phaser.swapChildren(a.phaser,b.phaser),this._dispatchModelChangeEvent("parent",a),this._dispatchModelChangeEvent("parent",b)},G.prototype.getChildIndex=function(a){return this.children.indexOf(a)},G.prototype.setChildIndex=function(a,b){if(a.parent===this){var c=this.phaser.children,d=c.indexOf(a.phaser);d!==b&&(c.splice(d,1),c.splice(b,0,a.phaser),this._dispatchModelChangeEvent("parent",a),this._dispatchChildrenChanged("order",[a]))}},G.prototype.getChildAt=function(a){return this.children[a]},G.prototype.removeChild=function(a){return this.phaser.remove?this.phaser.remove(a.phaser):this.phaser.removeChild(a.phaser),this._children=null,this._dispatchModelChangeEvent("parent",a),a},G.prototype.removeChildAt=function(a){var b=this.getChildAt(a);return this.removeChild(b)},G.prototype.removeChildren=function(){this.phaser.removeAll?this.phaser.removeAll():this.phaser.removeChildren(),this._dispatchModelChangeEvent("removeChildren",this)},G.prototype.onDestroy=function(){this.parent=null,this.game.nodePool.remove(this.uuid)},G.prototype.destroy=function(){this._toDestroy||(this._toDestroy=!0,this.visible=!1,this.game.world.addToDestroy(this))},G.prototype.destroyImmediately=function(){this._destroy||this._destroying||(this._events.forEach(function(a){a[0].remove(a[1],a[2])}),this._events=[],this.visible=!1,this._destroying=!0,this.phaser&&this.phaser.destroy(),this._destroying=!1)},G.prototype.find=function(a){if(""===a||"."===a||"./"===a)return this;for(var b=a.split("/"),c=this,d=0;d<b.length-1;d++){var e=b[d];if(""!==e)if(".."!==e){if(c=c._findByName(b[d]),!c)return c}else if(c=this.parent,c===this.game.stage)return null}var e=b[b.length-1];return""===e||"."===e?c:".."===e?c.parent===this.game.stage?null:c.parent:c._findByName(e)},G.prototype._findByName=function(a){var b=this.children;for(var c in b)if(b[c].name===a)return b[c]},G.prototype._dispatchModelChangeEvent=function(a,b){"name"!==a&&(this._children=null);var c=this.game.world;c.onModelChange.dispatch({type:a,target:b})},G.prototype._sendMessage=function(a,b){if(this.scripts)for(var c=this.scripts.length,d=Array.prototype.slice.call(arguments,2),e=0;c>e;e++){var f=this.scripts[e];if(f&&f.enable){var g=f[a];if(!g)continue;var h=g.apply(f,d);if(b===!0&&h===!0)return!0}}},G.prototype._broadcast=function(a){if(this.scripts){for(var b=this.scripts.length,c=Array.prototype.slice.call(arguments,1);b--;){var d=this.scripts[b];if(d&&d.enable&&(this.game.device.editor!==!0||d.runInEditor===!0)){if(this._toDestroy||this._destroy)return;var e=d[a];e&&e.apply(d,c)}}var f=this._children;f||(f=this.getChildren());var g=f.length;for(b=0;g>b;b++)f[b][a](c)}},G.prototype._dispatchChildrenChanged=function(a,b){for(var c=this,d={source:this,type:a,children:b};c;)c._onChildrenChanged&&c._onChildrenChanged.dispatch(d),c=c.parent},G.prototype._notifyVisibleChanged=function(a){this.onVisibleChange&&this.onVisibleChange();var b=this._children;b||(b=this.children);for(var c=b.length;c--;)b[c].visible&&b[c]._notifyVisibleChanged(a)},G.prototype.addListener=function(a,b,c,d){a.add(b,c,d),this._events.push([a,b,c])},b.defineProperties(G.prototype,{x:{get:function(){return this.phaser.x},set:function(a){this.x!==a&&(this.minAnchor.x<this.maxAnchor.x&&(this._left=this.left+(a-this.x),this._right=this.right-(a-this.x)),this.phaser.x=a,this._calcAnchoredX(),this._isTransformDirty=!0)}},y:{get:function(){return this.phaser.y},set:function(a){this.y!==a&&(this.minAnchor.y<this.maxAnchor.y&&(this._top=this.top+(a-this.y),this._bottom=this.bottom-(a-this.y)),this.phaser.y=a,this._calcAnchoredY(),this._isTransformDirty=!0)}},anchoredX:{get:function(){return this._anchoredX===c&&this._calcAnchoredX(),this._anchoredX},set:function(a){a!==this.anchoredX&&(this._anchoredX=a,this._calcX(),this._isTransformDirty=!0)}},anchoredY:{get:function(){return this._anchoredY===c&&this._calcAnchoredY(),this._anchoredY},set:function(a){a!==this.anchoredY&&(this._anchoredY=a,this._calcY(),this._isTransformDirty=!0)}},scaleX:{get:function(){return this.phaser.scale.x},set:function(a){a!==this.scaleX&&(this.phaser.scale.x=a,this._isTransformDirty=!0)}},scaleY:{get:function(){return this.phaser.scale.y},set:function(a){a!==this.scaleY&&(this.phaser.scale.y=a,this._isTransformDirty=!0)}},pivotX:{get:function(){return this.phaser.anchor||(this.phaser.anchor=new g.Point(0,0)),this.phaser.anchor.x},set:function(a){this.phaser.anchor||(this.phaser.anchor=new g.Point(0,0)),this.phaser.anchor.x!==a&&(this.phaser.anchor.x=a,this.relayout())}},pivotY:{get:function(){return this.phaser.anchor||(this.phaser.anchor=new g.Point(0,0)),this.phaser.anchor.y},set:function(a){this.phaser.anchor||(this.phaser.anchor=new g.Point(0,0)),this.phaser.anchor.y!==a&&(this.phaser.anchor.y=a,this.relayout())}},rotation:{get:function(){return this.phaser.rotation},set:function(a){this.phaser.rotation!==a&&(this.phaser.rotation=a,this._isTransformDirty=!0)}},skewX:{get:function(){return this._skewX},set:function(a){this._skewX!==a&&(this._skewX=a,this._isTransformDirty=!0)}},skewY:{get:function(){return this._skewY},set:function(a){this._skewY!==a&&(this._skewY=a,this._isTransformDirty=!0)}},width:{get:function(){return this._width=this._width||0},set:function(a){if(!this.game.math.fuzzyEqual(this._width,a,.001)){if(this.minAnchor.x<this.maxAnchor.x){var b=a-this.width,c=b*this.pivotX,d=b-c;this._left-=c,this._right-=d}else this.setWidth(a);this.relayout()}}},height:{get:function(){return this._height=this._height?this._height:0},set:function(a){if(!this.game.math.fuzzyEqual(this._height,a,.001)){if(this.minAnchor.y<this.maxAnchor.y){var b=a-this.height,c=b*this.pivotY,d=b-c;this._top-=c,this._bottom-=d}else this.setHeight(a);this.relayout()}}},minAnchor:{get:function(){return this._minAnchor||(this._minAnchor=new g.Point(0,0)),this._minAnchor},set:function(){throw new Error("user function:setAnchor")}},maxAnchor:{get:function(){return this._maxAnchor||(this._maxAnchor=new g.Point(0,0)),this._maxAnchor},set:function(){throw new Error("use function:setAnchor")}},left:{get:function(){return this._left===c&&(this._left=0),this._left},set:function(a){this._left!==a&&(this._left=a,this.relayout())}},right:{get:function(){return this._right===c&&(this._right=0),this._right},set:function(a){this._right!==a&&(this._right=a,this.relayout())}},top:{get:function(){return this._top===c&&(this._top=0),this._top},set:function(a){this._top!==a&&(this._top=a,this.relayout())}},bottom:{get:function(){return this._bottom===c&&(this._bottom=0),this._bottom},set:function(a){this._bottom!==a&&(this._bottom=a,this.relayout())}},rect:{get:function(){var a=this.width,b=this.height;return new g.Rectangle(-this.width*this.pivotX,-this.height*this.pivotY,a,b)}},worldTransform:{get:function(){return this.nodeUpdateTransform(),this.phaser.worldTransform}},localBounds:{get:function(){return this.phaser.getLocalBounds()}},_isTransformDirty:{get:function(){return!this.phaser._isNotNeedCalcTransform},set:function(a){this.phaser._isNotNeedCalcTransform!==!a&&(this.phaser._isNotNeedCalcTransform=!a)}},onLayoutArgumentChanged:{get:function(){return this._onLayoutArgumentChanged||(this._onLayoutArgumentChanged=new h.Signal)}},onRelayout:{get:function(){return this._onRelayout||(this._onRelayout=new h.Signal)}}}),G.prototype.setStretch=function(a,b,d,e){var f=!1;this.minAnchor.x>=this.maxAnchor.x?this._anchoredX!==a&&(this._anchoredX=a,f=!0):(a!==c&&this._left!==a&&(this._left=a,f=!0),b!==c&&this._right!==b&&(this._right=b,f=!0)),this.minAnchor.y>=this.maxAnchor.y?this._anchoredY!==d&&(this._anchoredY=d,f=!0):(d!==c&&this._top!==d&&(this._top=d,f=!0),e!==c&&this._bottom!==e&&(this._bottom=e,f=!0)),f&&this.relayout()},G.prototype.setAnchor=function(a,b,d){if(d=d===c?!0:d,a=a||this.minAnchor,b=b||this.maxAnchor,a.x<0&&(a.x=0),a.y<0&&(a.y=0),a.x>1&&(a.x=1),a.y>1&&(a.y=1),b.x<0&&(b.x=0),b.y<0&&(b.y=0),b.x>1&&(b.x=1),b.y>1&&(b.y=1),a.x>b.x||a.y>b.y)throw new Error("Expected:min < max");(a.x!==this.minAnchor.x||a.y!==this.minAnchor.y||b.x!==this.maxAnchor.x||b.y!==this.maxAnchor.y)&&(this._minAnchor=a,this._maxAnchor=b,d?(this._calcAnchoredX(),this._calcAnchoredY(),this._calcMargin()):this.relayout())},G.prototype.relayout=function(){var a=this.parent.rect;if(this.minAnchor.x<this.maxAnchor.x){var b=a.x+a.width*this.minAnchor.x+this.left,c=a.x+a.width*this.maxAnchor.x-this.right,d=c-b;this.setWidth(d),this.phaser.x=b+d*this.pivotX,this._calcAnchoredX()}else this.phaser.x=a.x+a.width*this.minAnchor.x+this.anchoredX;if(this.minAnchor.y<this.maxAnchor.y){var e=a.y+a.height*this.minAnchor.y+this.top,f=a.y+a.height*this.maxAnchor.y-this.bottom,g=f-e;this.setHeight(g),this.phaser.y=e+g*this.pivotY,this._calcAnchoredY()}else this.phaser.y=a.y+a.height*this.minAnchor.y+this.anchoredY;this._isTransformDirty=!0;for(var h=this.children,i=0;i<h.length;i++)h[i].relayout();this._calcWorldCorners(!0),this._dispatchLayoutArgumentChanged("size"),this._onRelayout&&this._onRelayout.dispatch()},G.prototype.setWidth=function(a){this._width=a},G.prototype.setHeight=function(a){this._height=a},G.prototype._defaultTransform=function(){this.parent&&this.parent!==this.game.stage&&(this.x=0,this.y=0,this.width=100,this.height=100)},G.prototype._calcMargin=function(){var a=this.parent.rect;if(this.minAnchor.x>=this.maxAnchor.x)this._left=this._right=0;else{var b=this.x-this.pivotX*this.width,c=a.x+a.width*this.minAnchor.x;this._left=b-c;var d=a.x+a.width*this.maxAnchor.x;this._right=d-(b+this.width)}if(this.minAnchor.y>=this.maxAnchor.y)this._top=this._bottom=0;else{var e=this.y-this.pivotY*this.height,f=a.y+a.height*this.minAnchor.y;this._top=e-f;var g=a.y+a.height*this.maxAnchor.y;this._bottom=g-(e+this.height)}},G.prototype._calcAnchoredX=function(){var a=this.parent.rect;this._anchoredX=this.x-(a.width*this.minAnchor.x+a.x)},G.prototype._calcAnchoredY=function(){var a=this.parent.rect;this._anchoredY=this.y-(a.height*this.minAnchor.y+a.y)},G.prototype._calcX=function(){var a=this.parent.rect;this.x=this._anchoredX+(a.width*this.minAnchor.x+a.x)},G.prototype._calcY=function(){var a=this.parent.rect;this.y=this._anchoredY+(a.height*this.minAnchor.y+a.y)},G.prototype.toLocal=function(a){return this.worldTransform.applyInverse(a)},G.prototype.toGlobal=function(a){return this.worldTransform.apply(a)},G.prototype.nodeUpdateTransform=function(){var a=!1;return this.parent&&this.parent.nodeUpdateTransform&&(a=this.parent.nodeUpdateTransform()),this._isTransformDirty?(a||this.phaser.updateTransform(),!0):a},G.prototype.getWorldPosition=function(){var a=this.worldTransform;return new g.Point(a.tx,a.ty);

},G.prototype.getWorldScale=function(){var a=this.worldTransform,b=Math.atan2(a.b,a.a),c=Math.atan2(-a.c,a.d);a.b/a.a===-a.c/a.d&&c!==b&&(b=Math.atan(a.b/a.a),c=Math.atan(-a.c/a.d));var d=b===Math.PI||0===b||0===a.b&&0!==a.a?a.a/Math.cos(b):a.b/Math.sin(b),e=c===Math.PI||0===c||0===a.c&&0!==a.d?a.d/Math.cos(c):-a.c/Math.sin(c);return new g.Point(d,e)},G.prototype.getWorldSkew=function(){var a=this.worldTransform;return a.b/a.a===-a.c/a.d?new g.Point(0,0):new g.Point(Math.atan2(-a.c,a.d),Math.atan2(a.b,a.a))},G.prototype.getWorldRotation=function(){var a=this.worldTransform;return a.b/a.a!==-a.c/a.d?0:Math.atan2(a.b,a.a)},G.prototype.setTransformToWorld=function(a,b,c,d,e){this.setTransformTo(this.game.world,a,b,c,d,e)},G.prototype.setTransformTo=function(a,b,c,d,e,f){b=b||0,c=c||0,d=d||1,e=e||1,f=f||0;var g=0,h=0;arguments.length>6&&"number"==typeof arguments[6]&&(g=arguments[6]),arguments.length>7&&"number"==typeof arguments[7]&&(h=arguments[7]);var i=Math.cos(g),j=Math.sin(g),k=Math.cos(h),l=Math.sin(h),m=Math.cos(f),n=Math.sin(f),o=(m*k-n*j)*d,p=(m*l+n*i)*d,q=(-n*k-m*j)*e,r=(-n*l+m*i)*e,s=b,t=c;this.setTransformToWithMatrix(a,o,p,q,r,s,t)},G.prototype.setTransformToWithMatrix=function(a,b,c,d,e,f,h){var i=[b,c,0,d,e,0,f,h,1];if(a){var j=a?a.worldTransform||new g.Matrix:new g.Matrix,k=j.toArray(!0);this.game.math.multiply(i,k,i)}var l=this.parent?this.parent.worldTransform||new g.Matrix:new g.Matrix,m=l.toArray(!0),n=[];this.game.math.invert(n,m),this.game.math.multiply(n,n,i);var b=n[0],c=n[1],d=n[3],e=n[4];if(this.x=n[6],this.y=n[7],c/b!==-d/e){var o=Math.atan2(c,b),p=Math.atan2(-d,e);this.rotation=o,this.scaleX=0===o||0===c&&0!==b?b/Math.cos(o):c/Math.sin(o),this.scaleY=0===p||0===d&&0!==e?e/Math.cos(p):-d/Math.sin(p)}else{var q=Math.atan2(c,b);this.rotation=q,this.scaleX=0===q||0===c&&0!==b?b/Math.cos(q):c/Math.sin(q),this.scaleY=0===q||0===d&&0!==e?e/Math.cos(q):-d/Math.sin(q)}this._calcAnchoredX(),this._calcAnchoredY(),this._calcMargin()};var H=G.prototype.addChildAt;G.prototype.addChildAt=function(a,b){H.call(this,a,b),a._isSwitchParent||a.relayout(),a._isTransformDirty=!0},G.prototype.switchParent=function(a,b){var c=this.worldTransform,d=c.a,e=c.b,f=c.c,g=c.d,h=c.tx,i=c.ty;this._isSwitchParent=!0,this.parent=a,delete this._isSwitchParent,null!=b&&this.parent.setChildIndex(this,b),this.setTransformToWithMatrix(null,d,e,f,g,h,i)},G.prototype._calcWorldCorners=function(a){if(a||this.nodeUpdateTransform()){var b=this.rect,c=new g.Point(b.x,b.y),d=new g.Point(b.x+b.width,b.y),e=new g.Point(b.x+b.width,b.y+b.height),f=new g.Point(b.x,b.y+b.height),h=this.phaser.worldTransform;this._worldLeftTop=h.apply(c),this._worldRightTop=h.apply(d),this._worldRightBottom=h.apply(e),this._worldLeftBottom=h.apply(f);var i=Math.min(this._worldLeftTop.x,this._worldRightTop.x,this._worldRightBottom.x,this._worldLeftBottom.x),j=Math.max(this._worldLeftTop.x,this._worldRightTop.x,this._worldRightBottom.x,this._worldLeftBottom.x),k=Math.min(this._worldLeftTop.y,this._worldRightTop.y,this._worldRightBottom.y,this._worldLeftBottom.y),l=Math.max(this._worldLeftTop.y,this._worldRightTop.y,this._worldRightBottom.y,this._worldLeftBottom.y);this._worldBox=new g.Rectangle(i,k,j-i,l-k)}},G.prototype.getWorldCorners=function(){return this._calcWorldCorners(),[this._worldLeftTop,this._worldRightTop,this._worldRightBottom,this._worldLeftBottom]},G.prototype.getCornersIn=function(a){var b=a&&a.phaser.worldTransform;return this._calcWorldCorners(),b?[b.applyInverse(this._worldLeftTop),b.applyInverse(this._worldRightTop),b.applyInverse(this._worldRightBottom),b.applyInverse(this._worldLeftBottom)]:[this._worldLeftTop,this._worldRightTop,this._worldRightBottom,this._worldLeftBottom]},G.prototype.getWorldBox=function(){return this._calcWorldCorners(),this._worldBox},G.prototype.getBoxIn=function(a){for(var b=this.getCornersIn(a),c=new g.Point(-Number.MAX_VALUE,-Number.MAX_VALUE),d=new g.Point(Number.MAX_VALUE,Number.MAX_VALUE),e=0;4>e;e++){var f=b[e];c.x=Math.max(c.x,f.x),c.y=Math.max(c.y,f.y),d.x=Math.min(d.x,f.x),d.y=Math.min(d.y,f.y)}return new g.Rectangle(d.x,d.y,c.x-d.x,c.y-d.y)},G.prototype.rectContains=function(a){var b=this.toLocal(a);return this.rect.contains(b.x,b.y)},G.prototype._dispatchLayoutArgumentChanged=function(a){this._onLayoutArgumentChanged&&this._onLayoutArgumentChanged.dispatch(a)},b.defineProperties(G.prototype,{hitArea:{get:function(){return this.phaser.hitArea===c?this.rect:this.phaser.hitArea},set:function(a){this.phaser.hitArea=a}},serializeHitArea:{get:function(){return this.phaser.hitArea},set:function(a){this.phaser.hitArea=a}},onDown:{get:function(){return this._onDown||(this._onDown=new h.Signal),this._onDown}},onUp:{get:function(){return this._onUp||(this._onUp=new h.Signal),this._onUp}},onClick:{get:function(){return this._onClick||(this._onClick=new h.Signal),this._onClick}},onDragStart:{get:function(){return this._onDragStart||(this._onDragStart=new h.Signal),this._onDragStart}},onDrag:{get:function(){return this._onDrag||(this._onDrag=new h.Signal),this._onDrag}},onDragEnd:{get:function(){return this._onDragEnd||(this._onDragEnd=new h.Signal),this._onDragEnd}},onDragDrop:{get:function(){return this._onDragDrop||(this._onDragDrop=new h.Signal),this._onDragDrop}},onWheel:{get:function(){return this._onWheel||(this._onWheel=new h.Signal),this._onWheel}},onEnter:{get:function(){return this._onEnter||(this._onEnter=new h.Signal),this._onEnter}},onExit:{get:function(){return this._onExit||(this._onExit=new h.Signal),this._onExit}},onInteractive:{get:function(){return this._onInteractive||(this._onInteractive=new h.Signal),this._onInteractive}},interactive:{get:function(){return this._interactive},set:function(a){this._interactive=a,this._onInteractive&&this._onInteractive.dispatch()}}}),G.prototype.checkAllowDrop=function(a){for(var b=!1,c=this.scripts.length,d=0;c>d;d++){var e=this.scripts[d];if(e){var f=e.isAllowDrop;if(!f)continue;if(f.call(e,a))return!0;b=!0}}return this.isAllowDrop?this.isAllowDrop(a):!b},G.prototype.canHandleInputEvent=function(a){if(!this.interactive)return!1;var b=this["_"+a];if(b&&b.getNumListeners()>0)return!0;for(var c=this.scripts.length,d=0;c>d;d++){var e=this.scripts[d];if(e){var f=e[a];if(!f)continue;return!0}}return!1},G.prototype.getInputEventHandle=function(a){for(var b,c=Array.isArray(a)?a:[a],d=this,e=this.game.stage;d&&d!==e;){for(b=c.length;b--;)if(d.canHandleInputEvent(c[b]))return d;d=d.parent}return null},G.prototype.getInputEventHandleAndEventType=function(a){for(var b,c=Array.isArray(a)?a:[a],d=this,e=this.game.stage;d&&d!==e;){for(b=c.length;b--;)if(d.canHandleInputEvent(c[b]))return[d,c[b]];d=d.parent}return null},G.prototype.fireInputEvent=function(a,b){if(!this.interactive||this.state===g.UIState.DISABLED)return!1;var c=this._sendMessage(a,!0,b);if(c===!0)return!0;var d=this["_"+a];d&&d.getNumListeners()>0&&d.dispatch(this,b)},b.defineProperty(G.prototype,"class",{get:function(){return"qc.Node"}}),G.prototype.getMeta=function(){var a=g.Serializer,b=this;return{uuid:{type:a.STRING,get:function(a){return a.uuid},set:function(a,c){b.game.serializer.restoreContext[c]=b.uuid}},_prefab:a.STRING,__lock:a.BOOLEAN,name:a.STRING,ignoreDestroy:a.BOOLEAN,alpha:a.NUMBER,visible:a.BOOLEAN,colorTint:a.COLOR,"static":a.BOOLEAN,scripts:{get:function(a,c){return b._packScripts.call(a,c)},set:function(a,c){b._unpackScripts.call(a,c)}},position:{get:function(a){return[a.pivotX,a.pivotY,a.anchoredX,a.anchoredY,a.x,a.y,a.width,a.height,a.left,a.right,a.top,a.bottom,a.minAnchor.x,a.minAnchor.y,a.maxAnchor.x,a.maxAnchor.y]},set:function(a,b){var c=a;c._minAnchor=new g.Point(b[12],b[13]),c._maxAnchor=new g.Point(b[14],b[15]),c.phaser.anchor=new g.Point(b[0],b[1]),c._anchoredX=b[2],c._anchoredY=b[3],c._minAnchor.x<c._maxAnchor.x?(c._left=b[8],c._right=b[9]):c.setWidth(b[6]),c._minAnchor.y<c._maxAnchor.y?(c._top=b[10],c._bottom=b[11]):c.setHeight(b[7]),c.relayout()}},scaleX:a.NUMBER,scaleY:a.NUMBER,rotation:a.NUMBER,serializeHitArea:a.AUTO,interactive:a.BOOLEAN,isFiltersThrough:a.BOOLEAN,children:{get:function(a,c){return b._packChildren.call(a,c)},set:function(a,c){b._unpackChildren.call(a,c)}}}},G.prototype._packChildren=function(a){var b=this.children;if(0===b.length)return[];if(this instanceof g.UIText||this instanceof g.Sprite)return[];var c=[];for(var d in b){var e=b[d],f=this.game.serializer.buildBundle(e,a);c.push(f)}return c},G.prototype._unpackChildren=function(a){for(var b in a)var c=this.game.serializer.restoreBundle(a[b],this,!0)},G.prototype._packScripts=function(a){var b=this.scripts;if(!b||0===b.length)return[];var c=[];for(var d in b){var e=b[d],f=null;"qc.NonexistScript"!==e._clazz?(this.__json&&this.__json[e.uuid]&&(f=this.__json[e.uuid].data),f=this.game.serializer.buildBundle(e,a,f),c.push({clazz:e._clazz,data:e.uuid}),this.__json||(this.__json={}),this.__json[e.uuid]=f):c.push({clazz:e.script,data:e.data.uuid[1]})}return c},G.prototype._unpackScripts=function(a){for(var b in a){var c=a[b],d=c.data;d="string"==typeof d?this.__json[d].data:d.data;var e=g.Util.findClass(c.clazz);if("function"==typeof e)try{var f=this.addScript(c.clazz,!1),h={};f.getMeta&&(h=f.getMeta());for(var i in h)try{this.game.serializer.fromJson(f,d,i,h[i])}catch(j){console.error("Deserialize fail!",j),g.Util.popupError(j.message)}}catch(j){console.error("Deserialize error!",j),g.Util.popupError(j.message)}else{if(d&&d.uuid){var f=this.addScript("qc.NonexistScript");f.script=c.clazz,f.data=d}console.error("Class: "+c.clazz+" is not exist!")}}this.game.device.editor||delete this.__json},G.prototype._findPath=function(a,b){var d="";if(a===this)return d;b===c&&(b=!0);var e=this.children;for(var f in e){var g=e[f],h=g._findPath(a,!1);if(""===h)return d+=g.name;if(h)return d+=g.name+"/"+h}if(!b)return null;var i=this.parent;for(d+="/..";i!==this.game.stage;){var h=i._findPath(a,!1);if(""===h)return d;if(h)return d+="/"+h;i=i.parent,d+="/.."}return null},G.prototype._restoreNodeRef=function(){var a={};this.getMeta&&(a=this.getMeta());for(var b in a){var c="__BUILTIN_NODE__"+b;this[c]&&"string"==typeof this[c]&&(this[b]=this.game.serializer.findNodeRef(this[c]),delete this[c]);var d="__BUILTIN_NODE_ARRAY__"+b;if(this[d]&&"object"==typeof this[d]){var e=[];for(var f in this[d])e.push(this[d][f]&&this[d][f][1]?this.game.serializer.findNodeRef(this[d][f][1]):null);this[b]=e,delete this[d]}}for(var f in this.scripts){var g=this.scripts[f],a={};g.getMeta&&(a=g.getMeta());for(var b in a){var c="__BUILTIN_NODE__"+b;g[c]&&"string"==typeof g[c]&&(g[b]=this.game.serializer.findNodeRef(g[c]),delete g[c]);var d="__BUILTIN_NODE_ARRAY__"+b;if(g[d]&&"object"==typeof g[d]){var e=[];for(var f in g[d])e.push(g[d][f]&&g[d][f][1]?this.game.serializer.findNodeRef(g[d][f][1]):null);g[b]=e,delete g[d]}}}var h=this.children;for(var b in h)h[b]._restoreNodeRef()},G.prototype._restoreInit=function(){this._initGetSetField();for(var a in this.scripts){var b=this.scripts[a];b._restoreInit&&b._restoreInit()}var c=this.children;for(var d in c)c[d]._restoreInit()},G.prototype._dispatchAwake=function(){var a=this.children;for(var b in a)a[b]._dispatchAwake();for(var c in this.scripts){var d=this.scripts[c];(this.game.device.editor!==!0||d.runInEditor)&&d.awake&&d.awake.call(d)}},G.prototype._dispatchEnable=function(){var a=this.children;for(var b in a)a[b]._dispatchEnable();for(var c in this.scripts){var d=this.scripts[c];(this.game.device.editor!==!0||d.runInEditor)&&d.enable&&d.onEnable&&d.onEnable()}},G.prototype._initGetSetField=function(){var a=this.__GET_SET__;if(a){for(var b in a){var c=a[b];this[c]=this["__BUILTIN_SET__"+c],delete this["__BUILTIN_SET__"+c]}delete this.__GET_SET__}};var I=function(a,b){return{type:b,get:function(b){return b[a]},set:function(b,c){b["__BUILTIN_SET__"+a]=c,b.__GET_SET__?b.__GET_SET__.push(a):b.__GET_SET__=[a]}}};G.prototype.generateTexture=function(a,b,c,d,e,f){if(!this.phaser)return new g.RenderTexture(0,0,renderer,b,a);var h=this.localBounds;h.x+=c||0,h.y+=d||0,isNaN(e)||(h.width=e),isNaN(f)||(h.height=f);var j=new g.RenderTexture(0|h.width,0|h.height,null,b,a);return i.DisplayObject._tempMatrix.tx=-h.x,i.DisplayObject._tempMatrix.ty=-h.y,j.render(this.phaser,i.DisplayObject._tempMatrix),j},G._snapTempMatrix=new i.Matrix,G.prototype._snapshotAsRenderTexture=function(a,b,c,d){if(!this.phaser)return new g.RenderTexture(0,0);var e=a,f=this.getWorldScale();e||(e=new g.Rectangle(0,0,this.width*f.x,this.height*f.y)),b=b||e.width,c=c||e.height;var h=b/e.width,i=c/e.height;d=d||this.game.resolution,G._snapTempMatrix.a=f.x*h,G._snapTempMatrix.d=f.y*i,G._snapTempMatrix.tx=-e.x*h,G._snapTempMatrix.ty=-e.y*i;var j=this.game.phaser,k=new g.RenderTexture(1,1,j.renderer,j.scale.scaleMode,d);return k.resize(b,c,!0),k.render(this.phaser,G._snapTempMatrix),k},G.prototype.snapshotAsImage=function(a,b,c,d,e){var f=this._snapshotAsRenderTexture(a,b,c,d),g=f.getBase64();f.destroy(!0);var h=new Image;return h.src=g,e&&(h.onload=function(){e(h)}),h},G.prototype.snapshotAsAtlas=function(a,b,c,d,e){var f=this._snapshotAsRenderTexture(b,c,d,e),h=this.game.assets._cache;h.checkImageKey(a)&&h.removeImage(a,!1);var i=g.AssetUtil.addAtlasFromImage(this.game,a,a,f.getCanvas());return i};var J=g.Serializer=function(a){this.game=a};J.prototype={},J.prototype.constructor=J,J.AUTO=0,J.INT=1,J.INTS=2,J.NUMBER=3,J.NUMBERS=4,J.BOOLEAN=5,J.BOOLEANS=6,J.STRING=7,J.STRINGS=8,J.MAPPING=9,J.TEXTURE=10,J.TEXTURES=11,J.AUDIO=12,J.AUDIOS=13,J.COLOR=14,J.COLORS=15,J.PREFAB=16,J.PREFABS=17,J.NODE=18,J.NODES=19,J.SCRIPT=20,J.SCRIPTS=21,J.GEOM=22,J.GEOMS=23,J.POINT=24,J.POINTS=25,J.RECTANGLE=26,J.RECTANGLES=27,J.CIRCLE=28,J.CIRCLES=29,J.ELLIPSE=30,J.ELLIPSES=31,J.FONT=32,J.FONTS=33,J.FILTER=34,J.FILTERS=35,J.TEXTASSET=36,J.TEXTASSETS=37,J.EXCELASSET=38,J.EXCELASSETS=39,J.prototype.buildBundle=function(a,b,c){b.dependences||(b.dependences=[]);var d={};a.getMeta&&(d=a.getMeta()),c=c||{};for(var e in d)this.toJson(a,c,b,e,a[e],d[e]);return{"class":a["class"],data:c,__json:a.__json}},J.prototype.combineDependence=function(a){var b={};for(var c in a.dependences){var d=a.dependences[c];b[d.uuid]||(b[d.uuid]=d)}return b},J.prototype.restoreBundle=function(a,b,c){c||(this.restoreContext={});var d=a.data.uuid;this.game.nodePool.find(d)&&(d=this.game.math.uuid());var f=this.newNode(a["class"],b,d);a.__json&&(f.__json=e(a.__json));var g={};f.getMeta&&(g=f.getMeta());var h=a.data;for(var i in g)this.fromJson(f,h,i,g[i]);return c?f:(f._restoreNodeRef(),f._restoreInit(),f._dispatchAwake(),f._dispatchEnable(),this.restoreContext={},f)},J.prototype.restoreState=function(a){var b=[];this.restoreContext={};for(var c in a.children){var d=this.restoreBundle(a.children[c],this.game.world,!0);b.push(d)}for(var c in b)b[c]._restoreNodeRef();for(var c in b)b[c]._restoreInit();for(var c in b)b[c]._dispatchAwake();for(var c in b)b[c]._dispatchEnable();this.restoreContext={}},J.prototype.toJson=function(a,b,d,e,f,g){if(g=g||J.AUTO,"object"==typeof g&&"function"==typeof g.get&&"function"==typeof g.set)return void(b[e]=g.get.call(a,a,d));switch(g){case J.AUTO:g=this.getAutoType(f),g===c?b[e]=f:this.toJson(a,b,d,e,f,g);break;case J.INT:case J.INTS:case J.NUMBER:case J.NUMBERS:case J.STRING:case J.STRINGS:case J.BOOLEAN:case J.BOOLEANS:case J.MAPPING:this._saveCommonType(a,b,d,e,f,g);break;case J.COLOR:this.saveColor(a,b,d,e,f);break;case J.COLORS:this._saveArray(a,b,d,e,f,g,this._saveColorItem);break;case J.GEOM:case J.POINT:case J.RECTANGLE:case J.CIRCLE:case J.ELLIPSE:this.saveGeom(a,b,d,e,f);break;case J.POINTS:case J.RECTANGLES:case J.CIRCLES:case J.ELLIPSES:this._saveArray(a,b,d,e,f,g,this._saveGeomItem);break;case J.PREFAB:this.savePrefab(a,b,d,e,f);break;case J.PREFABS:this._saveArray(a,b,d,e,f,g,this._savePrefabItem);break;case J.TEXTURE:this.saveTexture(a,b,d,e,f);break;case J.TEXTURES:this._saveArray(a,b,d,e,f,g,this._saveTextureItem);break;case J.AUDIO:this.saveAudio(a,b,d,e,f);break;case J.AUDIOS:this._saveArray(a,b,d,e,f,g,this._saveAudioItem);break;case J.TEXTASSET:this.saveTextAsset(a,b,d,e,f);break;case J.TEXTASSETS:this._saveArray(a,b,d,e,f,g,this._saveTextAssetItem);break;case J.EXCELASSET:this.saveExcelAsset(a,b,d,e,f);break;case J.EXCELASSETS:this._saveArray(a,b,d,e,f,g,this._saveExcelAssetItem);break;case J.FONT:this.saveFont(a,b,d,e,f);break;case J.FONTS:this._saveArray(a,b,d,e,f,g,this._saveFontItem);break;case J.NODE:this.saveNode(a,b,d,e,f);break;case J.NODES:this._saveArray(a,b,d,e,f,g,this._saveNodeItem);break;case J.FILTER:this._saveFilter(a,b,d,e,f);break;case J.FILTERS:this._saveArray(a,b,d,e,f,g,this._saveFilterItem);break;default:throw new Error("unsupported asset type:"+g)}},J.prototype.fromJson=function(a,b,d,e){if(e=e||J.AUTO,"object"==typeof e&&"function"==typeof e.get&&"function"==typeof e.set)return void e.set.call(a,a,b[d]);var f=b[d];if(f!==c){if(null===f||f===0/0)return void(a[d]=f);switch(f[0]){case J.INT:case J.INTS:case J.NUMBER:case J.NUMBERS:case J.STRING:case J.STRINGS:case J.BOOLEAN:case J.BOOLEANS:case J.MAPPING:this._restoreCommonType(a,b,d,f[0]);break;case J.COLOR:this.restoreColor(a,b,d,f);break;case J.COLORS:this._restoreArray(a,b,d,f,this._restoreColorItem);break;case J.GEOM:case J.POINT:case J.RECTANGLE:case J.CIRCLE:case J.ELLIPSE:this.restoreGeom(a,b,d,f);break;case J.POINTS:case J.RECTANGLES:case J.CIRCLES:case J.ELLIPSES:this._restoreArray(a,b,d,f,this._restoreGeomItem);break;case J.PREFAB:this.restorePrefab(a,b,d,f);break;case J.PREFABS:this._restoreArray(a,b,d,f,this._restorePrefabItem);break;case J.TEXTURE:this.restoreTexture(a,b,d,f);break;case J.TEXTURES:this._restoreArray(a,b,d,f,this._restoreTextureItem);break;case J.EXCELASSET:this.restoreExcelAsset(a,b,d,f);break;case J.EXCELASSETS:this._restoreArray(a,b,d,f,this._restoreExcelAssetItem);break;case J.AUDIO:this.restoreAudio(a,b,d,f);break;case J.AUDIOS:this._restoreArray(a,b,d,f,this._restoreAudioItem);break;case J.TEXTASSET:this.restoreTextAsset(a,b,d,f);break;case J.TEXTASSETS:this._restoreArray(a,b,d,f,this._restoreTextAssetItem);break;case J.FONT:this.restoreFont(a,b,d,f);break;case J.FONTS:this._restoreArray(a,b,d,f,this._restoreFontItem);break;case J.NODE:this.restoreNode(a,b,d,f);break;case J.NODES:this.restoreNodes(a,b,d,f);break;case J.FILTER:this._restoreFilter(a,b,d,f);break;case J.FILTERS:this._restoreArray(a,b,d,f,this._restoreFilterItem);break;default:throw new Error("unsupported asset type:"+e)}}},J.prototype.atob=function(a){return decodeURIComponent(atob(a))},J.prototype.btoa=function(a){return btoa(encodeURIComponent(a))},J.prototype.unpackUTF8=function(a){var b,c,d,e,f,g,c=0,d=a.length;for(b="";d>c;)switch(e=a[c++],e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=String.fromCharCode(e);break;case 12:case 13:f=a[c++],b+=String.fromCharCode((31&e)<<6|63&f);break;case 14:f=a[c++],g=a[c++],b+=String.fromCharCode((15&e)<<12|(63&f)<<6|(63&g)<<0)}return b},J.prototype.findNodeRef=function(a){var b=this.restoreContext[a]?this.restoreContext[a]:a;return this.game.nodePool.find(b)},J.prototype.saveAudio=function(a,b,c,d,e){b[d]=this._saveAudioItem(e,c)},J.prototype.restoreAudio=function(a,b,c,d){a[c]=this._restoreAudioItem(d)},J.prototype._saveAudioItem=function(a,b){return a instanceof g.SoundAsset?(b.dependences.push({key:a.key,uuid:a.uuid}),[J.AUDIO,a.key,a.uuid]):null},J.prototype._restoreAudioItem=function(a){if(!a)return null;var b=this.game.assets.find(a[1]);return b||(b=this.game.assets.findByUUID(a[2])),b?b instanceof g.SoundAsset?b:null:(console.error("音频资源尚未载入, 无法反序列化.",a[1]),null)},J.prototype.saveColor=function(a,b,c,d,e){b[d]=this._saveColorItem(e)},J.prototype.restoreColor=function(a,b,c,d){a[c]=this._restoreColorItem(d)},J.prototype._saveColorItem=function(a){return a instanceof oa?[J.COLOR,a.toNumber(!0)]:null},J.prototype._restoreColorItem=function(a){return a?new oa(a[1]):null},J.prototype.saveExcelAsset=function(a,b,c,d,e){b[d]=this._saveExcelAssetItem(e,c)},J.prototype.restoreExcelAsset=function(a,b,c,d){a[c]=this._restoreExcelAssetItem(d)},J.prototype._saveExcelAssetItem=function(a,b){return a instanceof g.ExcelAsset?(b.dependences.push({key:a.key,uuid:a.uuid}),[J.EXCELASSET,a.key,a.uuid]):null},J.prototype._restoreExcelAssetItem=function(a){if(!a)return null;var b=this.game.assets.find(a[1]);return b||(b=this.game.assets.findByUUID(a[2])),b&&b instanceof g.ExcelAsset?b:null},J.prototype.saveFont=function(a,b,c,d,e){b[d]=this._saveFontItem(e,c)},J.prototype.restoreFont=function(a,b,c,d){a[c]=this._restoreFontItem(d)},J.prototype._saveFontItem=function(a,b){if(a instanceof g.Font)var c=a;if(c&&c instanceof g.Font){b.dependences.push({key:c.key,uuid:c.uuid});var d=c.uuid;a=c.key}return[J.FONT,a,d]},J.prototype._restoreFontItem=function(a,b){if(!a)return null;b=b||this;var c=b.game.assets.find(a[1]);return c||(c=b.game.assets.findByUUID(a[2])),c||(c=a[1]),c},J.prototype.isGeom=function(a){return a instanceof g.Circle||a instanceof g.Ellipse||a instanceof g.Line||a instanceof g.Matrix||a instanceof g.Polygon||a instanceof g.Rectangle||a instanceof g.RoundedRectangle||a instanceof g.Point},J.prototype.saveGeom=function(a,b,c,d,e){b[d]=this._saveGeomItem(e,c)},J.prototype.restoreGeom=function(a,b,c,d){a[c]=this._restoreGeomItem(d)},J.prototype._saveGeomItem=function(a){var b=J.GEOM;return a instanceof g.Point?b=J.POINT:a instanceof g.Rectangle?b=J.RECTANGLE:a instanceof g.Circle?b=J.CIRCLE:a instanceof g.Ellipse&&(b=J.ELLIPSE),a?[b,a["class"],a.toJson()]:null},J.prototype._restoreGeomItem=function(a){if(!a)return null;var b=g.Util.findClass(a[1]),c=new b;return c.fromJson(a[2]),c},J.prototype.saveNode=function(a,b,c,d,e){b[d]=this._saveNodeItem(e,c)},J.prototype.restoreNode=function(a,b,c,d){a["__BUILTIN_NODE__"+c]=d[1]},J.prototype.restoreNodes=function(a,b,c,d){a["__BUILTIN_NODE_ARRAY__"+c]=d[1]},J.prototype._saveNodeItem=function(a){return a instanceof g.Node?[J.NODE,a.uuid]:null},J.prototype.savePrefab=function(a,b,c,d,e){b[d]=this._savePrefabItem(e,c)},J.prototype.restorePrefab=function(a,b,c,d){a[c]=this._restorePrefabItem(d)},J.prototype._savePrefabItem=function(a,b){return a instanceof s?(b.dependences.push({key:a.uuid,uuid:a.uuid}),[J.PREFAB,a.uuid]):null},J.prototype._restorePrefabItem=function(a){if(!a)return null;var b=this.game.assets.findByUUID(a[1]);return b instanceof s?b:null},J.prototype.saveTexture=function(a,b,c,d,e){b[d]=this._saveTextureItem(e,c)},J.prototype.restoreTexture=function(a,b,c,d){a[c]=this._restoreTextureItem(d)},J.prototype._saveTextureItem=function(a,b){return a instanceof g.Atlas?(b.dependences.push({key:a.key,uuid:a.uuid}),[J.TEXTURE,a.key,a.uuid]):null},J.prototype._restoreTextureItem=function(a){if(!a)return null;var b=this.game.assets.find(a[1]);return b||(b=this.game.assets.findByUUID(a[2])),b?b instanceof g.Atlas?b:null:(console.error("贴图资源尚未载入，无法反序列化。",a[1]),null)},J.prototype.saveTextAsset=function(a,b,c,d,e){b[d]=this._saveTextAssetItem(e,c)},J.prototype.restoreTextAsset=function(a,b,c,d){a[c]=this._restoreTextAssetItem(d)},J.prototype._saveTextAssetItem=function(a,b){return a instanceof g.TextAsset?(b.dependences.push({key:a.key,uuid:a.uuid}),[J.TEXTASSET,a.key,a.uuid]):null},J.prototype._restoreTextAssetItem=function(a){if(!a)return null;var b=this.game.assets.find(a[1]);return b||(b=this.game.assets.findByUUID(a[2])),b?b instanceof g.TextAsset?b:null:(console.error("文本资源尚未载入, 无法反序列化.",a[1]),null)},J.prototype.getAutoType=function(a){if(a===c||null===a||a===0/0)return c;if("number"==typeof a)return J.NUMBER;if("string"==typeof a)return J.STRING;if("boolean"==typeof a)return J.BOOLEAN;if(a instanceof g.Node)return J.NODE;if(a instanceof g.Atlas)return J.TEXTURE;if(a instanceof g.SoundAsset)return J.AUDIO;if(a instanceof g.TextAsset)return J.TEXTASSET;if(this.isGeom(a))return J.GEOM;throw console.error(a),new Error("")},J.prototype.newNode=function(a,b,c){switch(a){case"qc.UIImage":return this.game.add.image(b,c);case"qc.Sprite":return this.game.add.sprite(b,c);case"qc.UIRoot":return new g.UIRoot(this.game,c);case"qc.Button":return this.game.add.button(b,c);case"qc.Toggle":return new g.Toggle(this.game,b,c);case"qc.UIText":return this.game.add.text(b,c);case"qc.Sound":return this.game.add.sound(b,c);case"qc.Node":return this.game.add.node(b,c);case"qc.ScrollView":return this.game.add.scrollView(b,c);case"qc.ScrollBar":return this.game.add.scrollBar(b,!1,c);case"qc.InputField":return this.game.add.inputField(b,c);case"qc.ProgressBar":return this.game.add.progressBar(b,!1,c);case"qc.Slider":return this.game.add.slider(b,!1,c);case"qc.Emitter":return this.game.add.emitter(b,c);case"qc.Tilemap":return this.game.add.tilemap(b,c);case"qc.TileLayer":return this.game.add.tileLayer(b,c);case"qc.ObjectLayer":return this.game.add.objectLayer(b,c);case"qc.Dom":return this.game.add.dom(b,c);case"qc.Graphics":return this.game.add.graphics(b,c);default:throw new Error("unsupported class:"+a)}},J.prototype._saveCommonType=function(a,b,c,d,e,f){b[d]=[f,e]},J.prototype._restoreCommonType=function(a,b,c){a[c]=b[c][1]},J.prototype._saveArray=function(a,b,c,d,e,f,g){if(b[d]=[f,[]],e)for(var h in e){var i=e[h],j=g.call(this,i,c);b[d][1].push(j)}},J.prototype._restoreArray=function(a,b,c,d,e){var f=this,g=[];if(d)for(var h in d[1])g.push(e.call(this,d[1][h],f));a[c]=g};var K=g.Camera=function(a){this.phaser=a,a._qc=this,a.roundPx=!1};K.prototype={},K.prototype.constructor=K,b.defineProperties(K.prototype,{game:{get:function(){return this.phaser.game._qc}},world:{get:function(){return this.phaser.world._qc}},id:{get:function(){return this.phaser.id}},view:{get:function(){return this.phaser.view}},position:{get:function(){return this.phaser.position},set:function(a){this.phaser.position=a}},size:{get:function(){return new g.Point(this.view.width,this.view.height)},set:function(a){this.setSize(a.x,a.y)}},x:{get:function(){return this.phaser.x},set:function(a){this.phaser.x=a}},y:{get:function(){return this.phaser.y},set:function(a){this.phaser.y=a}},width:{get:function(){return this.phaser.width},set:function(a){this.phaser.width=a}},height:{get:function(){return this.phaser.height},set:function(a){this.phaser.height=a}},bounds:{get:function(){return this.phaser.bounds},set:function(a){this.phaser.bounds=a}},visible:{get:function(){return this.phaser.visible},set:function(a){this.phaser.visible=a}},target:{get:function(){return this.phaser.target}}}),K.FOLLOW_LOCKON=h.Camera.FOLLOW_LOCKON,K.FOLLOW_PLATFORMER=h.Camera.FOLLOW_PLATFORMER,K.FOLLOW_TOPDOWN=h.Camera.FOLLOW_TOPDOWN,K.FOLLOW_TOPDOWN_TIGHT=h.Camera.FOLLOW_TOPDOWN_TIGHT,K.prototype.follow=function(a,b){null===a?this.phaser.unfollow():this.phaser.follow(a,b)},K.prototype.focusOn=function(a,b){this.phaser.focusOnXY(a,b)},K.prototype.reset=function(){this.phaser.reset()};var L=g.Game=function(b,c,d,e,f,i,j,k){var l=this;l.onStart=new g.Signal,l.log=new g.Log(l),l._debug=new g.Debug(l),l._device=new g.Device(l,h.Device);var m;m="object"==typeof arguments[0]&&1===arguments.length?arguments[0]:{width:b,height:c,parent:d,state:e,transparent:f,physicsConfig:k},l.debug.on=m.debug,l.device.editor=m.editor,l.remoteLogUrl=m.remoteLogUrl,e=m.state,e=e||{preload:function(){},create:function(){}};var n=e.init;if(e.init=function(){var b=l.phaser;l._nodePool=new g.NodePool(l),new g.StateManager(b.state),new g.PluginManager(b.plugins),b.math._qc=new g.Math(b.rnd),l.timer=new g.Timer(l),l.time=new g.Time(l),l.sound=new g.SoundManager(l),l._assets=new g.Assets(l,b.load,b.cache),new g.Stage(b.stage),new g.Camera(b.camera),new g.World(b.world),new g.Input(b.input),l.canvas.style.outline=0,l.container.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null),l.plugins.add(g.dragonBonesDriver),l.plugins.add(g.CleanPIXISpriteRetainer),l._serializer=new g.Serializer(l),l._storage=new g.Storage(l),l.phaser.scale.onSizeChange.add(function(){l.device.resetOrientation()}),l.device.resetOrientation(),n&&n.call(e),a.qc.initGame&&a.qc.initGame(l),l.onStart.dispatch()},m.state=e,m.renderer=null==m.renderer?h.AUTO:m.renderer,!("antialias"in m)){var o;switch(m.renderer){case h.HEADLESS:case h.CANVAS:o=!1;break;case h.AUTO:var p=function(){try{var b=document.createElement("canvas");return b.screencanvas=!1,!!a.WebGLRenderingContext&&(b.getContext("webgl")||b.getContext("experimental-webgl"))}catch(c){return!1}}();o=p?!0:!1;default:o=!0}m.antialias=o}m.disableVisibilityChange=m.runInBackground,m.disableVisibilityChange=null==m.disableVisibilityChange?!0:m.disableVisibilityChange,m.resolution||(m.resolution=a.devicePixelRatio);var q=m.backgroundColor;null==q&&(q=oa.background),q instanceof oa&&(q=q.toNumber()),m.backgroundColor=q,l.phaser=new h.Game(m),l.phaser._qc=this,this.phaser._calcTransformCount=0,l.phaser.forceSingleUpdate=!0,l.add=new Ca(l)};b.defineProperties(L.prototype,{id:{get:function(){return this.phaser.id}},config:{get:function(){return this.phaser.config},set:function(a){this.phaser.config=a}},physicsConfig:{get:function(){return this.phaser.physicsConfig},set:function(a){this.phaser.physicsConfig=a}},parent:{get:function(){return this.phaser.parent}},width:{get:function(){return this.phaser.width}},height:{get:function(){return this.phaser.height}},resolution:{get:function(){return this.phaser.resolution}},transparent:{get:function(){return this.phaser.renderer.transparent},set:function(a){this.phaser.renderer.transparent=a}},isBooted:{get:function(){return this.phaser.isBooted}},isRunning:{get:function(){return this.phaser.isRunning}},camera:{get:function(){return this.phaser.camera._qc}},canvas:{get:function(){return this.phaser.canvas}},onPause:{get:function(){return this.phaser.onPause}},onResume:{get:function(){return this.phaser.onResume}},onBlur:{get:function(){return this.phaser.onBlur}},onFocus:{get:function(){return this.phaser.onFocus}},state:{get:function(){return this.phaser.state._qc}},stage:{get:function(){return this.phaser.stage._qc}},container:{get:function(){return this.phaser.canvas.parentNode}},input:{get:function(){return this.phaser.input._qc}},plugins:{get:function(){return this.phaser.plugins._qc}},math:{get:function(){return this.phaser.math._qc}},assets:{get:function(){return this._assets}},world:{get:function(){return this.phaser.world?this.phaser.world._qc:null}},serializer:{get:function(){return this._serializer}},nodePool:{get:function(){return this._nodePool}},storage:{get:function(){return this._storage}},paused:{get:function(){return this.phaser.paused},set:function(a){this.phaser.paused=a}},stepCount:{get:function(){return this.phaser.stepCount}},stepping:{get:function(){return this.phaser.stepping}},device:{get:function(){return this._device}},debug:{get:function(){return this._debug}}}),L.prototype.shutdown=function(){this.input.enable=!1,this.state.clearWorld(!0),this.assets.clear(),this.phaser.destroy()},L.prototype.enableStep=function(){this.phaser.enableStep()},L.prototype.disableStep=function(){this.phaser.disableStep()},L.prototype.step=function(){this.phaser.step()},L.prototype.updateScale=function(a){var b=this.phaser.scale;b&&(b._lastUpdate=0,a&&b.preUpdate())},L.prototype.fullScreen=function(){var b=this;if(!b.adjustGameSize){var c,d;b.phaser.scale.scaleMode=h.ScaleManager.SHOW_ALL;var e=b.adjustGameSize=function(e){if(!b.isBooted||!b.input.inputting){var f=document.documentElement.clientWidth;a.innerWidth&&a.innerWidth<f&&(f=a.innerWidth);var g=document.documentElement.clientHeight;a.innerHeight&&a.innerHeight<g&&(g=a.innerHeight),(c!==f||d!==g||e)&&(c=f,d=g,b.device.iOS?(b.phaser.scale.setGameSize(f-5,g+5),b.phaser.time.events.add(1,function(){b.phaser.scale.setGameSize(f,g)})):b.phaser.scale.setGameSize(f,g),b.container.style.width=f+"px",b.container.style.height=g+"px",b.updateScale(),b.device.phaser.UCBrowser&&(a.scrollTo(0,1),setTimeout(function(){var b=document.createElement("div");b.style.position="absolute",b.style.top=g+"px",b.style.width="100px",b.style.height="100px",document.body.appendChild(b),a.scrollTo(0,g),setTimeout(function(){a.scrollTo(0,1),document.body.removeChild(b);

},10)},10)))}},f=b.time.now;b._checkFullScreen=function(){var a=b.time.now;1e3>a-f||(e(),f=a)},a.addEventListener("orientationchange",e,!1),a.addEventListener("resize",e,!1),a.scrollTo(0,1),e()}},L.prototype.update=function(a){var b=this.phaser;this._checkFullScreen&&this._checkFullScreen(),b._calcTransformCount=0,b.time.update(a);var c=1/b.time.desiredFps;if(b._kickstart)return this.updateLogic(c),b.stage.updateTransform(),this.updateRender(b.time.slowMotion*b.time.desiredFps),void(b._kickstart=!1);if(!(b._spiraling>1)||b.forceSingleUpdate){var d=1e3*b.time.slowMotion/b.time.desiredFps;b._deltaTime+=Math.max(Math.min(3*d,b.time.elapsed),0);var e=0;b.updatesThisFrame=Math.floor(b._deltaTime/d),b.forceSingleUpdate&&(b.updatesThisFrame=Math.min(1,b.updatesThisFrame));for(var f=!1;b._deltaTime>=d&&(b._deltaTime-=d,b.currentUpdateID=e,f||this._paused||this.pendingStep||(f=!0),f&&(b.updateFrameDelta(),this.updateLogic(c),b.stage.updateTransform()),e++,!b.forceSingleUpdate||1!==e););return e>b._lastCount?b._spiraling++:e<b._lastCount&&(b._spiraling=0),b._lastCount=e,f&&this.updateRender(b._deltaTime/d),f}b.time.time>b._nextFpsNotification&&(b._nextFpsNotification=b.time.time+1e4,b.fpsProblemNotifier.dispatch()),b._deltaTime=0,b._spiraling=0,b.updateRender(b.time.slowMotion*b.time.desiredFps)},L.prototype.updateLogic=function(a){var b=Date.now(),c=this.phaser;if(c._paused||c.pendingStep)c.scale.pauseUpdate(),c.state.pauseUpdate(),c.debug.preUpdate();else{this.timer&&this.timer.update(this.time.now),c.stepping&&(c.pendingStep=!0);var d=Date.now();c.scale.preUpdate(),c.debug.preUpdate(),c.world.camera.preUpdate(),c.physics.preUpdate(),c.state.preUpdate(a),c.plugins.preUpdate(a),c.stage.preUpdate(),this.debug.preUpdate+=Date.now()-d,d=Date.now(),c.state.update(),c.stage.update(),c.tweens.update(a),c.sound.update(),c.input.update(),c.physics.update(),c.particles.update(),c.plugins.update(),this.debug.update+=this.time.now-d,d=Date.now(),c.stage.postUpdate(),c.plugins.postUpdate(),this.debug.postUpdate+=Date.now()-d,d=Date.now()}this.debug.logic+=Date.now()-b},L.prototype.updateRender=function(a){var b=Date.now(),c=this.phaser;c.lockRender||(c.state.preRender(a),c.renderer.render(c.stage),c.plugins.render(a),c.state.render(a),c.plugins.postRender(a),g.CanvasPool.postRender(),this.debug.render+=Date.now()-b)},h.Game.prototype.gamePaused=function(a){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.setMute(),this.onPause.dispatch(a),this.device.cordova&&this.device.iOS&&(this.lockRender=!0))},h.Game.prototype.gameResumed=function(a){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.unsetMute(),this.onResume.dispatch(a),this.device.cordova&&this.device.iOS&&(this.lockRender=!1))};var M=h.Game.prototype.parseConfig;h.Game.prototype.parseConfig=function(a){M.call(this,a),"antialias"in a&&(this.antialias=!!a.antialias)};var N=h.RequestAnimationFrame.prototype.updateSetTimeout;h.RequestAnimationFrame.prototype.updateSetTimeout=function(){try{N.call(this)}catch(a){this.game._qc.log.error("Error：{0}",a)}};var O=h.RequestAnimationFrame.prototype.updateRAF;h.RequestAnimationFrame.prototype.updateRAF=function(a){try{O.call(this,a)}catch(b){this.game._qc.log.error("Error：{0}",b)}},h.Game.prototype.updateFrameDelta=function(a){var b=this,c=b.time,d=c.time,e=b.__lastFrameTime?d-b.__lastFrameTime:a;b.__lastFrameTime=d,c.frameDeltaTime=e/c.slowMotion,c._totalEscapeTime=c.frameDeltaTime+(c._totalEscapeTime||0)};var P=(g.Plugin=h.Plugin,g.PluginManager=function(a){a._qc=this,this.phaser=a});P.prototype={},P.prototype.constructor=P,b.defineProperties(P.prototype,{game:{get:function(){return this.phaser.game._qc}},plugins:{get:function(){return this.phaser.plugins}}}),P.prototype.add=function(a){var a=this.phaser.add.apply(this.phaser,arguments);return a.game=this.game,a},P.prototype.remove=function(a){this.phaser.remove(a)},P.prototype.removeAll=function(){this.phaser.removeAll()},P.prototype.destroy=function(){this.phaser.destroy(),delete this.phaser},g.Signal=h.Signal,g.SignalBinding=h.SignalBinding;var Q=g.Stage=function(a){this.phaser=a,a._qc=this};Q.prototype={},Q.prototype.constructor=Q,b.defineProperties(Q.prototype,{game:{get:function(){return this.phaser.game._qc}},name:{get:function(){return this.phaser.name},set:function(a){this.phaser.name=a}},runInBackground:{get:function(){return this.phaser.disableVisibilityChange},set:function(a){this.phaser.disableVisibilityChange=a}},backgroundColor:{get:function(){return new oa(this.phaser.backgroundColor)},set:function(a){if(a=a||oa.background,!(a instanceof oa))throw new Error("Expected qc.Color");this.phaser.backgroundColor=a.toNumber()}},x:{get:function(){return 0}},y:{get:function(){return 0}},rect:{get:function(){return new g.Rectangle(0,0,this.game.width,this.game.height)}},pivotX:{get:function(){return 0},set:function(){throw new Error("pivotX cannot be modified")}},pivotY:{get:function(){return 0},set:function(){throw new Error("pivotY cannot be modified")}},worldTransform:{get:function(){return this.phaser.worldTransform}}}),Q.prototype.updateTransform=function(){this.phaser.updateTransform()},Q.prototype.destroy=function(){this.phaser.destroy(),delete this.phaser};var R=g.State=function(){var a=new h.State;this.phaser=a,a._qc=this};R.prototype={},R.prototype.constructor=R,b.defineProperties(R.prototype,{game:{get:function(){return this.phaser.game}},key:{get:function(){return this.phaser.key},set:function(a){this.phaser.key=a}},add:{get:function(){return this.phaser.add._qc},set:function(a){this.phaser.add=a.phaser,a.phaser._qc=a}},make:{get:function(){return this.phaser.make._qc},set:function(a){this.phaser.make=a.phaser,a.phaser._qc=a}},camera:{get:function(){return this.phaser.camera._qc},set:function(a){this.phaser.camera=a.phaser,a.phaser._qc=a}},assets:{get:function(){return this._assets},set:function(a){this._assets=a}},input:{get:function(){return this.phaser.input._qc},set:function(a){this.phaser.input=a.phaser,a.phaser._qc=a}},math:{get:function(){return this.phaser.math._qc},set:function(a){this.phaser.math=a.phaser,a.phaser._qc=a}},time:{get:function(){return this.phaser.time._qc},set:function(a){this.phaser.time=a.phaser,a.phaser._qc=a}},tweens:{get:function(){return this.phaser.tweens._qc},set:function(a){this.phaser.tweens=a.phaser,a.phaser._qc=a}},world:{get:function(){return this.phaser.world?this.phaser.world._qc:null},set:function(a){this.phaser.world=a.phaser,a.phaser._qc=a}},particles:{get:function(){return this.phaser.particles._qc},set:function(a){this.phaser.particles=a.phaser,a.phaser._qc=a}},physics:{get:function(){return this.phaser.physics._qc},set:function(a){this.phaser.physics=a.phaser,a.phaser._qc=a}}});var S=g.StateManager=function(a){a._qc=this,this.phaser=a,this._onPreload=new g.Signal,this._onCreate=new g.Signal,this.onStartLoad=new g.Signal,this.onEndLoad=new g.Signal};S.prototype={},S.prototype.constructor=S,b.defineProperties(S.prototype,{game:{get:function(){return this.phaser.game._qc}},entry:{get:function(){return this._entry},set:function(a){this._entry=a}},list:{get:function(){return this._list},set:function(a){this._list=a;var b=this;for(var c in a){var d={preload:function(){b._onPreload.dispatch();var a=b.game.assets.find(b.list[b.current]);if(a)for(var c in a.dependences){var d=a.dependences[c];b.game.assets.loadByUUID(d.uuid,function(a){a||(b.game.log.important("场景的依赖资源({0})加载失败.",d.uuid),"function"==typeof b.game.loadingProcessCallback&&b.game.loadingProcessCallback())})}},create:function(){try{b._parse()}catch(a){b.game.log.error("Parse scene fail：{0}",a),g.Util.popupError(a.message)}b.loading=!1,b._onCreate.dispatch(),b.onEndLoad.dispatch(d)}};this.phaser.add(c,d,!1)}}},loading:{get:function(){return this._loading||!1},set:function(a){this._loading=a}},current:{get:function(){return this.phaser.current}}}),S.prototype.download=function(a,b){a=a||this.entry;var c=this.list[a];this.game.log.trace("Start downloading scene:{0}",a),this.game.assets.load(c,c,b)},S.prototype.load=function(a,b,c,d){var e=this;return e.loading?void console.warn("Cannot call when switching scene."):(a=a||e.entry,b!==!0&&(b=!1),e.list[a]?(e.loading=!0,e.onStartLoad.dispatch(a),e.clearWorld(),b&&e.game.assets.clear(),void e.download(a,function(){"function"==typeof c&&e._onPreload.addOnce(c),"function"==typeof d&&e._onCreate.addOnce(d),e.phaser.start(a,!1,b)})):void e.game.log.error("Scene:{0} not exists",a))},S.prototype.clearWorld=function(a){var b=this.game.world.children.slice(0);b.forEach(function(b){(a||!b.ignoreDestroy)&&b.destroy()})},S.prototype.destroy=function(){this.entry=c,this.list={},this.phaser.destroy()},S.prototype._parse=function(){var a=this.list[this.current],b=this.game.assets.find(a);if(b){var c=b.json.data;this.game.serializer.restoreState(c),this.game.world._prefab=a}};var T=g.World=function(a){var b=this;b.onModelChange=new g.Signal,g.Node.call(b,a,b),b.name="world",b.onSizeChange.add(function(){b.relayout()}),b._toDestroyQ=[],b.game.container.style.overflow="hidden",b.backDomRoot=document.createElement("div"),b.backDomRoot.style.left="0px",b.backDomRoot.style.top="0px",b.game.container.insertBefore(b.backDomRoot,b.game.canvas),b.frontDomRoot=document.createElement("div"),b.frontDomRoot.style.left="0px",b.frontDomRoot.style.top="0px",b.game.container.appendChild(b.frontDomRoot),b._resetDomSize()};T.prototype=b.create(g.Node.prototype),T.prototype.constructor=T,T.prototype.getMeta=function(){var a=(g.Serializer,g.Node.prototype.getMeta.call(this));return delete a.uuid,a},T.prototype.relayout=function(){for(var a=this.children,b=0;b<a.length;b++)a[b].relayout()},b.defineProperties(T.prototype,{bounds:{get:function(){return this.phaser.bounds},set:function(a){this.phaser.setBounds(a.x,a.y,a.width,a.height)}},camera:{get:function(){return this.phaser.camera}},width:{get:function(){return this._editorWidth!==c?this._editorWidth:this.phaser.width},set:function(a){this.width!==a&&(this.phaser.width=a,b.getOwnPropertyDescriptor(g.Node.prototype,"width").set.call(this,a))}},height:{get:function(){return this._editorHeight!==c?this._editorHeight:this.phaser.height},set:function(a){this.height!==a&&(this.phaser.height=a,b.getOwnPropertyDescriptor(g.Node.prototype,"height").set.call(this,a))}},centerX:{get:function(){return this.phaser.centerX}},centerY:{get:function(){return this.phaser.centerY}},pivotX:{get:function(){return 0},set:function(){throw new Error("pivotX cannot be modified")}},pivotY:{get:function(){return 0},set:function(){throw new Error("pivotY cannot be modified")}},onSizeChange:{get:function(){return this.game.phaser.scale.onSizeChange}}}),T.prototype.preUpdate=function(){this._toDestroyQ.forEach(function(a){a.destroyImmediately()}),this._toDestroyQ.length=0},T.prototype.addToDestroy=function(a){this._toDestroyQ.push(a)},T.prototype._resetDomSize=function(){var a=this;[a.backDomRoot,a.frontDomRoot].forEach(function(a){a.style.position="absolute",a.style.overflow="hidden",a.style.width="100%",a.style.height="100%"})};var U=g.Input=function(a){var b=this;a._qc=b;var c=a.destroy;a.destroy=function(){b.destroy(),c.call(a)};var d=a.update;a.update=function(){b.update(),d.call(a)},b.phaser=a,b.game=a.game._qc,b._inputting=0,b.cursorPosition=new g.Point(0/0,0/0),b.onKeyDown=new h.Signal,b.onKeyUp=new h.Signal,b.onKeyRepeat=new h.Signal,b.onCursorMove=new h.Signal,b.onWheel=new h.Signal,b.onPointerUp=new h.Signal,b.onPointerDown=new h.Signal,b.onPointerMove=new h.Signal,b.nativeMode=!1,b.keyboard=new g.Keyboard(this),b.mouse=new g.Mouse(this),b.touch=new g.Touch(this),b.module=new g.BaseInputModule(b.game,b),b._init()};U.prototype={},U.prototype.constructor=U,b.defineProperties(U.prototype,{wheelDeltaX:{get:function(){return this._wheelDeltaX}},wheelDeltaY:{get:function(){return this._wheelDeltaY}},keyCount:{get:function(){return this.keyboard.keyCount}},keyCodes:{get:function(){return this.keyboard.keyCodes}},mouseCount:{get:function(){return this.mouse.mouseCount}},mouseIds:{get:function(){return this.mouse.mouseIds}},touchCount:{get:function(){return this.touch.touchCount}},touchIds:{get:function(){return this.touch.touchIds}},pointerCount:{get:function(){return this.mouseCount+this.touchCount}},pointers:{get:function(){return this.mouseIds.concat(this.touchIds)}},enable:{get:function(){return this._enable},set:function(a){this._setEnable(a)}},inputting:{get:function(){return this._inputting>0}}}),U.prototype._init=function(){var a=this;a.phaser.game.onBlur.add(this._onBlur,this),a.keyboard.onKeyUp.add(this.processKeyUp,this),a.keyboard.onKeyDown.add(this.processKeyDown,this),a.keyboard.onKeyRepeat.add(this.processKeyRepeat,this),a.mouse.onMouseDown.add(this.processPointerDown,this),a.mouse.onMouseUp.add(this.processPointerUp,this),a.mouse.onMousePressMove.add(this.processPointerMove,this),a.mouse.onMouseMove.add(this.processMouseMove,this),a.mouse.onMouseWheel.add(this.processMouseWheel,this),a.touch.onTouchStart.add(this.processPointerDown,this),a.touch.onTouchEnd.add(this.processPointerUp,this),a.touch.onTouchMove.add(this.processPointerMove,this),a.enable=!0},U.prototype.destroy=function(){this.phaser.game.onBlur.remove(this._onBlur,this),this.keyboard.onKeyUp.remove(this.processKeyUp,this),this.keyboard.onKeyDown.remove(this.processKeyDown,this),this.keyboard.onKeyRepeat.remove(this.processKeyRepeat,this),this.mouse.onMouseDown.remove(this.processPointerDown,this),this.mouse.onMouseUp.remove(this.processPointerUp,this),this.mouse.onMousePressMove.remove(this.processPointerDown,this),this.mouse.onMouseMove.remove(this.processMouseMove,this),this.mouse.onMouseWheel.remove(this.processMouseWheel,this),this.touch.onTouchStart.remove(this.processPointerDown,this),this.touch.onTouchEnd.remove(this.processPointerUp,this),this.touch.onTouchMove.remove(this.processPointerMove,this),this.module&&this.module.destroy(),this.keyboard&&this.keyboard.destroy(),this.mouse&&this.mouse.destroy(),this.touch&&this.touch.destroy(),this.onKeyDown.removeAll(),this.onKeyUp.removeAll(),this.onKeyRepeat.removeAll(),this.onCursorMove.removeAll(),this.onWheel.removeAll(),this.onPointerDown.removeAll(),this.onPointerMove.removeAll(),this.onPointerUp.removeAll(),this.phaser=null,this.module=null,this.keyboard=null,this.mouse=null,this.touch=null},U.prototype._setEnable=function(a){this._enable!==a&&(this._enable=a,this.touch&&(this.touch.enable=a),this.mouse&&(this.mouse.enable=a),this.keyboard&&(this.keyboard.enable=a))},U.prototype.update=function(){this._wheelDeltaX=0,this._wheelDeltaY=0,this.keyboard.update(),this.touch.update(),this.mouse.update(),this.module.update()},U.prototype._onBlur=function(){this.module.lossFocus(),this.keyboard.lossFocus(),this.mouse.lossFocus(),this.touch.lossFocus()},U.prototype.processKeyDown=function(a,b){this.onKeyDown.dispatch(a,b)},U.prototype.processKeyUp=function(a,b){this.onKeyUp.dispatch(a,b)},U.prototype.processKeyRepeat=function(a,b){this.onKeyRepeat.dispatch(a,b)},U.prototype.isKeyDown=function(a){return this.keyboard.isKeyDown(a)},U.prototype.isAnyKeyDown=function(){return this.keyboard.isAnyKeyDown()},U.prototype.isAnyKey=function(){return this.keyboard.isAnyKey()},U.prototype.isAltDown=function(){return this.isKeyDown(g.Keyboard.ALT)},U.prototype.isControlDown=function(){return this.isKeyDown(g.Keyboard.CONTROL)},U.prototype.isShiftDown=function(){return this.isKeyDown(g.Keyboard.SHIFT)},U.prototype.isMetaDown=function(){return this.isKeyDown(g.Keyboard.META)||this.isKeyDown(g.Keyboard.META_RWIN)||this.isKeyDown(g.Keyboard.META_RMAC)},U.prototype.hasCursor=function(){return!isNaN(this.cursorPosition.x)&&!isNaN(this.cursorPosition.y)},U.prototype.isMouse=function(a){return 0>a&&a>=g.Mouse.BUTTON_FORWORD},U.prototype.isAnyMouse=function(){return this.mouse.isAnyMouse()},U.prototype.isAnyMouseDown=function(){return this.mouse.isAnyMouseDown()},U.prototype.isMouseDown=function(a){return this.mouse.isMouseDown(a)},U.prototype.isAnyTouch=function(){return this.touch.isAnyTouch()},U.prototype.isAnyTouchStart=function(){return this.touch.isAnyTouchStart()},U.prototype.isTouchStart=function(a){return this.touch.isTouchStart(a)},U.prototype.isAnyPointer=function(){return this.touch.isAnyTouch()||this.mouse.isAnyMouse()},U.prototype.isAnyPointerStart=function(){return this.touch.isAnyTouchStart()||this.mouse.isAnyMouseDown()},U.prototype.isPointerStart=function(a){return this.isMouse(a)?this.isMouseDown(a):this.isTouchStart(a)},U.prototype.getPointer=function(a){return 0>a&&a>=g.Mouse.BUTTON_FORWORD?this.mouse.getMouseById(a):this.touch.getTouchById(a)},U.prototype.processMouseMove=function(a,b){this.cursorPosition.x=a,this.cursorPosition.y=b,this.onCursorMove.dispatch(a,b)},U.prototype.processMouseWheel=function(a,b){this._wheelDeltaX=a,this._wheelDeltaY=b,this.onWheel.dispatch(a,b)},U.prototype.processPointerDown=function(a,b,c){this.onPointerDown.dispatch(a,b,c)},U.prototype.processPointerUp=function(a,b,c){this.onPointerUp.dispatch(a,b,c)},U.prototype.processPointerMove=function(a,b,c){this.onPointerMove.dispatch(a,b,c)},U.prototype.ignoreDomEvent=function(a){var b=this,c=b.findDomNodeWithEvent(a);return c&&c.interactive&&c.hitArea},U.prototype.findDomNodeWithEvent=function(a){var b=this,c=a.target;if(!c||c===b.game.world.frontDomRoot||c===b.game.world.backDomRoot||c===b.game.canvas.parentNode)return null;for(;c&&!c._qc;)c=c.parentNode;return c?c._qc:null};var V=g.Debug=function(a){var b=this;b._game=a,b.on=!1,b.animation=0,b.total=0,b.logic=0,b.render=0,b.preUpdate=0,b.update=0,b.postUpdate=0};V.prototype={},V.prototype.constructor=V,b.defineProperties(V.prototype,{game:{get:function(){return this._game}},on:{get:function(){return this._on||!1},set:function(a){this._on=a,a&&(this.game.log.enableTrace=!0)}}});var W=g.Device=function(a,b){var c=this;c.phaser=b,c._game=a,c._orientation=W.PORTRAIT,c.onOrientationChange=new g.Signal};W.prototype={},W.prototype.constructor=V,b.defineProperties(W.prototype,{game:{get:function(){return this._game}},desktop:{get:function(){return this.phaser.desktop}},iOS:{get:function(){return this.phaser.iOS}},android:{get:function(){return this.phaser.android}},webGL:{get:function(){return this.phaser.webGL}},vibration:{get:function(){return this.phaser.vibration}},browser:{get:function(){return this.phaser.chrome?W.CHROME:this.phaser.arora?W.ARORA:this.phaser.epiphany?W.EPIPHANY:this.phaser.firefox?W.FIREFOX:this.phaser.trident?W.TRIDENT:this.phaser.ie?W.IE:this.phaser.mobileSafari?W.MOBILE_SAFARI:this.phaser.midori?W.MIDORI:this.phaser.opera?W.OPERA:this.phaser.safari?W.SAFARI:this.phaser.silk?W.SILK:this.phaser.UCBrowser?W.UCBROWSER:W.UNKNOW}},resolution:{get:function(){return a.devicePixelRatio}},fullscreen:{get:function(){return this.phaser.fullscreen}},editor:{get:function(){return this._editor||!1},set:function(a){this._editor=a,a&&(this.game.debug.on=!0)}},orientation:{get:function(){return this._orientation},set:function(a){this.orientation!==a&&(this._orientation=a,this.onOrientationChange.dispatch(a))}}}),W.UNKNOW=-1,W.CHROME=0,W.ARORA=1,W.EPIPHANY=2,W.FIREFOX=3,W.IE=4,W.TRIDENT=5,W.MOBILE_SAFARI=6,W.MIDORI=7,W.OPERA=8,W.SAFARI=9,W.WEBAPP=10,W.SILK=11,W.UCBROWSER=12,W.AUTO=0,W.PORTRAIT=1,W.LANDSCAPE=2,W.prototype.resetOrientation=function(){this.orientation=this.game.world.width>this.game.world.height?W.LANDSCAPE:W.PORTRAIT},g.RenderTexture=i.RenderTexture,g.RenderTexture.prototype.resize=function(a,b,c){(a!==this.width||b!==this.height)&&(this.valid=a>0&&b>0,this.width=a,this.height=b,this.frame.width=this.crop.width=a*this.resolution,this.frame.height=this.crop.height=b*this.resolution,c&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===i.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width*this.resolution,this.height*this.resolution))},g.RenderTexture.prototype.directRenderWebGL=function(a,b,c){if(this.valid){var d={x:this.renderer.offset.x,y:this.renderer.offset.y};this.renderer.offset.x=b?b.x:0,this.renderer.offset.y=b?b.y:0;var e=this.renderer.gl;if(e.isContextLost())return!1;if(!e.replace){var f=e.viewport;e.viewport=function(a,b,c,d){(0===c||0===d||0>c*d)&&console.log("viewPort:",a,b,c,d,c*d),f.call(e,a,b,c,d)},e.replace=!0}e.viewport(0,0,this.width*this.resolution,this.height*this.resolution),e.bindFramebuffer(e.FRAMEBUFFER,this.textureBuffer.frameBuffer),c&&this.textureBuffer.clear();var g=e.getError();g&&console.log("webgl gl.getError(",g,")"),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(a,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0,this.renderer.offset.x=d.x,this.renderer.offset.y=d.y}},i.RenderTexture.prototype.directRenderCanvas=function(a,b,c){if(this.valid){var d={x:this.renderer.offset.x,y:this.renderer.offset.y};this.renderer.offset.x=b?b.x:0,this.renderer.offset.y=b?b.y:0,c&&this.textureBuffer.clear();var e=this.textureBuffer.context,f=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(a,e),this.renderer.resolution=f,this.renderer.offset.x=d.x,this.renderer.offset.y=d.y}},g.RenderTexture.prototype.renderWebGL=function(a,b,c){if(this.valid){var d=a.getWorldTransform();d.identity(),d.translate(0,2*this.projection.y),b&&d.append(b),d.scale(1,-1),a.worldAlpha=1,a._isSubNeedCalcTransform=!0;for(var e=a.children,f=0,g=e.length;g>f;f++)e[f].updateTransform();var h=this.renderer.gl;h.viewport(0,0,this.width*this.resolution,this.height*this.resolution),h.bindFramebuffer(h.FRAMEBUFFER,this.textureBuffer.frameBuffer),c&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(a,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0,a._isNotNeedCalcTransform=!1}},i.RenderTexture.prototype.renderCanvas=function(a,b,c){if(this.valid){var d=a.worldTransform;d.identity(),b&&d.append(b),a.worldAlpha=1,a._isSubNeedCalcTransform=!0;for(var e=a.children,f=0,g=e.length;g>f;f++)e[f].updateTransform();c&&this.textureBuffer.clear();var h=this.textureBuffer.context,i=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(a,h),this.renderer.resolution=i,a._isNotNeedCalcTransform=!1}};var X=g.SoftClipManager=function(a){this.renderSession=a,this._polygons=[]};X.prototype={},X.prototype.constructor=X,b.defineProperties(X.prototype,{needClip:{get:function(){return!!this._polygons.length}}}),X.getManager=function(a){var b=a.softClipManager;return b||(b=a.softClipManager=new X(a)),b},X.prototype.pushPolygon=function(a){var b=this,c=[];if(b.renderSession.spriteBatch.batchType=g.BATCH_TRIANGLES,!b._polygons.length){for(var d=arguments.length;d--;){var e=arguments[d],f=g.GeometricTool.quickDecomp(e);if(f.length)Array.prototype.push.apply(c,f);else for(var h=m.Triangulate(e),i=0;i<h.length;i+=3){var j=h[i],k=h[i+1],l=h[i+2];c.push([e[j],e[k],e[l]])}}return void b._polygons.push(c)}for(var n=b._polygons[b._polygons.length-1],o=n.length;o--;)for(var p=n[o],d=arguments.length;d--;){a=arguments[d];var f=g.GeometricTool.sutherlandHodgman(a,p);c.push(f)}b._polygons.push(c)},X.prototype.popPolygon=function(){var a=this;a._polygons.length&&a._polygons.splice(a._polygons.length-1,1),a._polygons.length||(a.renderSession.spriteBatch.batchType=g.BATCH_QUAD)},X.prototype.getClipPolygon=function(a,b,c,d,e,f){var h=this,i=[],j=h._polygons[h._polygons.length-1],k=j.length,l=1/(a*d+c*-b);a*=l,b*=l,c*=l,d*=l;for(var m=f*c-e*d,n=-f*a+e*b,o=-1;++o<k;){for(var p=j[o],q=[],r=p.length,s=-1;++s<r;){var t=p[s];q.push(new g.Point(d*t.x-c*t.y+m,a*t.y-b*t.x+n))}i.push(q)}return i},X.prototype.renderSprite=function(a,b,c,d,e,f,h,i,j,k,l,m,n,o,p,q,r){var s=this.getClipPolygon(l,m,n,o,p,q);if(0!==s.length){var t=[new g.Point(c,d),new g.Point(e,d),new g.Point(e,f),new g.Point(c,f)],u={x:c,y:d,width:e-c,height:f-d};if(u.width&&u.height)for(var v=function(a,b,c,d,e,f){return{x:b+(a.x-f.x)/f.width*(c-b),y:d+(a.y-f.y)/f.height*(e-d)}},w=s.length;w--;){var x=s[w],y=g.GeometricTool.sutherlandHodgman(x,t),z=y.length;if(!(3>z)){for(var A=[],B=[],C=-1;++C<z;)A[C]=v(y[C],h,j,i,k,u),B.push({x:l*y[C].x+n*y[C].y+p,y:o*y[C].y+m*y[C].x+q});var D=g.GeometricTool.Triangulate(B);if(D)for(var C=0;C<D.length;C+=3){var E=D[C],F=D[C+1],G=D[C+2];this._addWebGLTriangle(a.spriteBatch,b,r,B[E],B[F],B[G],A[E],A[F],A[G])}}}}},X.prototype._addWebGLTriangle=function(a,b,c,d,e,f,g,h,i){a.currentBatchSize>=a.triangleSize&&(a.flush(),a.currentBaseTexture=b.texture.baseTexture);var j=a.colors,k=a.positions,l=3*a.currentBatchSize*a.vertSize;a.renderSession.roundPixels?(k[l]=0|d.x,k[l+1]=0|d.y,k[l+5]=0|e.x,k[l+6]=0|e.y,k[l+10]=0|f.x,k[l+11]=0|f.y):(k[l]=d.x,k[l+1]=d.y,k[l+5]=e.x,k[l+6]=e.y,k[l+10]=f.x,k[l+11]=f.y),k[l+2]=g.x,k[l+3]=g.y,k[l+7]=h.x,k[l+8]=h.y,k[l+12]=i.x,k[l+13]=i.y,j[l+4]=j[l+9]=j[l+14]=c,a.sprites[a.currentBatchSize++]=b};var Y=g.SoundManager=function(a){this.game=a,this.phaser=a.phaser.sound,this.phaser._qc=this;var b=this;a.onStart.add(function(){b._boot()})};Y.prototype.constructor=Y,Y.prototype._boot=function(){var b=this.phaser,c=this.game.input;!b.game.device.cocoonJS&&b.game.device.iOS||a.PhaserGlobal&&a.PhaserGlobal.fakeiOSTouchLock?(c.touch.callbackContext=b,b.game.device.iOSVersion>8?c.touch.touchEndCallback=b.unlock:c.touch.touchStartCallback=b.unlock,c.mouse.callbackContext=b,c.mouse.mouseDownCallback=b.unlock,b.touchLocked=!0):b.touchLocked=!1},b.defineProperties(Y.prototype,{mute:{get:function(){return this.phaser.mute},set:function(a){this.phaser.mute=a}},volume:{get:function(){return this.phaser.volume},set:function(a){this.phaser.volume=a}},usingWebAudio:{get:function(){return this.phaser.usingWebAudio}},usingAudioTag:{get:function(){return this.phaser.usingAudioTag}},mp3Support:{get:function(){return this.game.phaser.device.mp3}},oggSupport:{get:function(){return this.game.phaser.device.ogg||this.game.phaser.device.opus}},webAudioSupport:{get:function(){return this.game.phaser.sound.usingWebAudio}}}),Y.prototype.tryGetUrl=function(a){var b=a;return b.indexOf(".mp3.bin")>0?this.mp3Support||(b=b.replace(".mp3.bin",".ogg.bin")):b.indexOf(".ogg.bin")>0&&(this.oggSupport||(b=b.replace(".ogg.bin",".mp3.bin"))),this.webAudioSupport||(b=b.replace(".bin","")),b};var Z=g.Key=function(a,b){this.game=a,this._keycode=b,this._isDown=!1,this._justDown=!1,this._justUp=!1,this.downTime=0,this.repeats=0,this._lastRepeatTime=0,this._eventList=[]};Z.prototype={},Z.prototype.constructor=Z,b.defineProperties(Z.prototype,{keyCode:{get:function(){return this._keycode}},currCharCode:{get:function(){return this._charCode},set:function(a){this._charCode=a}},isJustDown:{get:function(){var a=this._justDown;return a&&(this._justDown=!1,this._isDown=!0),a}},isJustUp:{get:function(){var a=this._justUp;return a&&(this._justUp=!1,this._isDown=!1),a}},isDown:{get:function(){return this._isDown}},duringTime:{get:function(){return this.isDown?this.game.time.fixedTime-this.downTime:-1}}}),Z.prototype.destroy=function(){this.game=null},Z.prototype.hasEvent=function(){return!!this._eventList.length},Z.prototype.nextEvent=function(){if(!this._eventList.length)return!1;var a=this._eventList.shift();do{if(!a)break;switch(a.type){case Z.DOWN:this._onDown(a.time);break;case $.UP:this._onUp()}return!0}while(!1);return!1},Z.prototype.onDown=function(){return this._eventList.push({type:Z.DOWN,time:this.game.time.fixedTime}),!0},Z.prototype.onUp=function(){return this._eventList.push({type:Z.UP}),!0},Z.prototype._onDown=function(a){return this.isDown||this._justDown?!1:(this._justDown=!0,this.downTime=a,this._lastRepeatTime=this.downTime,!0)},Z.prototype._onUp=function(){return!this._isDown&&!this._justDown||this._justUp?!1:(this._justUp=!0,!0)},Z.prototype.setState=function(a){var b=(this._isDown||this._justDown)&&!this._justUp;return this._isDown=a,this._justDown=!1,this._justUp=!1,b^a},Z.prototype.checkRepeat=function(a){if(!this.isDown)return!1;var b=this.game.time.fixedTime;return b-this._lastRepeatTime-a>0?(this.repeats++,this._lastRepeatTime=b,!0):!1},Z.UP=-1,Z.DOWN=0;var $=g.Pointer=function(a,b){this.game=a,this._id=b,this._isDown=!1,this._justDown=!1,this._justUp=!1,this.downTime=0,this.withinGame=!1,this.previousStatus=[],this._eventList=[]};$.prototype={},$.prototype.constructor=$,b.defineProperties($.prototype,{id:{get:function(){return this._id}},x:{get:function(){return this._x}},y:{get:function(){return this._y}},startX:{get:function(){return this._startX}},startY:{get:function(){return this._startY}},isMouse:{get:function(){return this._id<g.Mouse.NONE&&this._id>=g.Mouse.BUTTON_FORWORD}},isJustDown:{get:function(){var a=this._justDown;return a&&(this._justDown=!1,this._isDown=!0),a}},isJustUp:{get:function(){var a=this._justUp;return a&&(this._justUp=!1,this._isDown=!1),a}},isDown:{get:function(){return this._isDown}},isDowning:{get:function(){return this._justDown}},isUpping:{get:function(){return this._justUp}},deltaX:{get:function(){return this._deltaX}},deltaY:{get:function(){return this._deltaY}},distanceX:{get:function(){return this.x-this.startX}},distanceY:{get:function(){return this.y-this.startY}},deviceId:{get:function(){return this._deviceId||this.id},set:function(a){this._deviceId=a}},eventId:{get:function(){return this._eventId||this.id},set:function(a){this._eventId=a}},duringTime:{get:function(){return this.isDown?this.game.time.fixedTime-this.downTime:-1}}}),$.prototype.destroy=function(){this.game=null},$.prototype.update=function(){this._deltaX=this._tempX-this._x,this._deltaY=this._tempY-this._y,this._x=this._tempX,this._y=this._tempY},$.prototype.hasEvent=function(){return!!this._eventList.length},$.prototype.nextEvent=function(){if(!this._eventList.length)return!1;var a=this._eventList.shift();do{if(!a)break;switch(a.type){case $.DOWN:this.withinGame=!0,this._onDown(a.x,a.y,a.time);break;case $.UP:this._onUp(a.time);break;case $.LEAVE:this.withinGame=!1,this._onMove(a.x,a.y);break;case $.ENTER:this.withinGame=!0,this._onMove(a.x,a.y);break;case $.MOVE:this._onMove(a.x,a.y);break;case $.CANCEL:this._onCancel(a.time)}return!0}while(!1);return!1},$.prototype.onDown=function(a,b){return this._eventList.push({type:$.DOWN,x:a,y:b,time:this.game.time.fixedTime}),!0},$.prototype.onMove=function(a,b){var c=this._eventList.length;return c>0&&this._eventList[c-1].type===$.MOVE?(this._eventList[c-1].x=a,this._eventList[c-1].y=b):this._eventList.push({type:$.MOVE,x:a,y:b}),!0},$.prototype.onLeave=function(a,b){return this._eventList.push({type:$.LEAVE,x:a,y:b}),!0},$.prototype.onEnter=function(a,b){return this._eventList.push({type:$.ENTER,x:a,y:b}),!0},$.prototype.onUp=function(){return this._eventList.push({type:$.UP,time:this.game.time.fixedTime}),!0},$.prototype.onCancel=function(){return this._eventList.push({type:$.CANCEL,time:this.game.time.fixedTime}),!0},$.prototype._onDown=function(a,b,c){return this.isDown||this._justDown?!1:(this._justDown=!0,this.downTime=c,this._x=a,this._y=b,this._startX=a,this._startY=b,this._tempX=a,this._tempY=b,this._deltaX=0,this._deltaY=0,!0)},$.prototype._onUp=function(a){if(!this._isDown&&!this._justDown||this._justUp)return!1;for(this._justUp=!0,this.previousStatus.unshift({startX:this._startX,startY:this._startY,endX:this.x,endY:this.y,downTime:this.downTime,upTime:a});this.previousStatus.length>10;)this.previousStatus.pop();return!0},$.prototype._onCancel=function(a){return this._justUp?!1:(this._onUp(a),!0)},$.prototype._onMove=function(a,b){this._tempX=a,this._tempY=b},$.prototype.isDouble=function(){},$.UP=-1,$.DOWN=0,$.MOVE=1,$.ENTER=2,$.LEAVE=3,$.CANCEL=4;var _=g.Keyboard=function(a,b){this.input=a,this.game=a.game,this.repeatInterval=100,this.onKeyDown=new h.Signal,this.onKeyUp=new h.Signal,this.onKeyRepeat=new h.Signal,this._keys=[],this._keyCodes={},this._capture={},this._keyDownNum=0,this._anyKeyDown=!1,this._init(b)};_.prototype={},
_.prototype.constructor=_,b.defineProperties(_.prototype,{enable:{get:function(){return this._enable},set:function(a){this._setEnable(a)}},generator:{get:function(){return this._generator||a},set:function(a){if(a!==this._generator){var b=this.enable;this.enable=!1,this._generator=a,b&&(this.enable=!0)}}},gainFocusType:{get:function(){return this._gainFocusType},set:function(a){this._gainFocusType=a}},keyCount:{get:function(){return this._keyDownNum}},keyCodes:{get:function(){return b.keys(this._keyCodes)}}}),_.prototype._init=function(a){this._onKeyDown=this._processKeyDown.bind(this),this._onKeyUp=this._processKeyUp.bind(this),this._onBlur=this.lossFocus.bind(this),this._onMouseOver=this._onOver.bind(this),this._onMouseClick=this._onClick.bind(this),this.generator=a,this.gainFocusType=_.GAINFOCUS_CLICK,this.enable=!0,this.game.device.phaser.windows&&this.game.device.phaser.desktop&&this.addKeyCapture(_.ALT)},_.prototype.destroy=function(){this.enable=!1,this.input=null,this.generator=null,this._onKeyDown=null,this._onKeyUp=null,this._onBlur=null,this._onMouseOver=null,this._onMouseClick=null},_.prototype.update=function(){if(this.enable){this._anyKeyDown=!1;for(var a,b=this._keys.length;b--;)if(a=this._keys[b])for(;a.nextEvent();)a.isJustDown&&(this._anyKeyDown=!0,this._recordKey(a.keyCode,!0),this.onKeyDown.dispatch(a.keyCode)),a.isJustUp&&(this._recordKey(a.keyCode,!1),this.onKeyUp.dispatch(a.keyCode)),a.checkRepeat(this.repeatInterval)&&this.onKeyRepeat.dispatch(a._keycode)}},_.prototype.isKeyDown=function(a){return this._keys[a]&&this._keys[a].isDown},_.prototype.isAnyKey=function(){return this._keyDownNum>0},_.prototype.isAnyKeyDown=function(){return this._anyKeyDown},_.prototype._recordKey=function(a,b){b?(this._keyDownNum++,this._keyCodes[a]=!0):(this._keyDownNum--,delete this._keyCodes[a])},_.prototype._setEnable=function(a){if(this._enable!==a){this._enable=a;var b=this.generator;a?(b.addEventListener("keydown",this._onKeyDown,!1),b.addEventListener("keyup",this._onKeyUp,!1),b.addEventListener("blur",this._onBlur,!1),this._addFocusAbility(b,!0)):(b.removeEventListener("keydown",this._onKeyDown),b.removeEventListener("keyup",this._onKeyUp),b.removeEventListener("blur",this._onBlur),this._removeFocusAbility(b),this._clearKeys())}},_.prototype._addFocusAbility=function(b,c){if(b!==a||a.parent&&a.parent!==a){b.tabIndex=b.tabIndex||-1;var d=this;b.addEventListener("mouseover",d._onMouseOver,!1),b.addEventListener("click",d._onMouseClick,!1),this.input.onPointerDown.add(d._onMouseClick,d),c&&setTimeout(function(){d.gainFocus()},1)}},_.prototype._removeFocusAbility=function(b){(b!==a||a.parent&&a.parent!==a)&&(b.removeEventListener("mouseover",this._onMouseOver),b.removeEventListener("click",this._onMouseClick),this.input.onPointerDown.remove(this._onMouseClick,this))},_.prototype._prepareKey=function(a){this._keys[a]||(this._keys[a]=new g.Key(this.game,a))},_.prototype.setModifierKeysState=function(a,b){a.altKey!==c&&(this._setKeyCodeState(_.ALT,a.altKey,b),this._setKeyCodeState(_.SHIFT,a.shiftKey,b),this._setKeyCodeState(_.CONTROL,a.ctrlKey,b),b!=_.META&&b!=_.META_RWIN&&b!=_.META_RMAC&&this._setKeyCodeState(_.META,a.metaKey,b))},_.prototype._setKeyCodeState=function(a,b,c){a!==c&&(this._prepareKey(a),this._keys[a].setState(b)&&this._recordKey(a,b))},_.prototype._processKeyDown=function(a){this._prepareKey(a.keyCode),this._capture[a.keyCode]&&a.preventDefault(),this._keys[a.keyCode].onDown(),this._keys[a.keyCode].currCharCode=a.charCode,this.setModifierKeysState(a,a.keyCode),this.input.nativeMode&&this.update()},_.prototype._processKeyUp=function(a){this._prepareKey(a.keyCode),this._capture[a.keyCode]&&a.preventDefault(),this._keys[a.keyCode].onUp(),this.setModifierKeysState(a,a.keyCode),this.input.nativeMode&&this.update()},_.prototype._onOver=function(){this.gainFocusType===_.GAINFOCUS_OVER&&this.gainFocus()},_.prototype._onClick=function(){this.gainFocusType===_.GAINFOCUS_CLICK&&this.gainFocus()},_.prototype.gainFocus=function(){(this.generator!==a||a.parent&&a.parent!==a)&&this.generator.focus()},_.prototype._clearKeys=function(){for(;this._keys.length>0;){var a=this._keys.pop();a&&a.destroy()}this._keyDownNum=0,this._keyCodes={}},_.prototype.lossFocus=function(){this._clearKeys()},_.prototype.addKeyCapture=function(a){if("object"==typeof a)for(var b in a)this._capture[a[b]]=!0;else this._capture[a]=!0},_.prototype.removeKeyCapture=function(a){delete this._capture[a]},_.prototype.clearCapture=function(){this._capture={}},_.GAINFOCUS_OVER=0,_.GAINFOCUS_CLICK=1,_.A="A".charCodeAt(0),_.B="B".charCodeAt(0),_.C="C".charCodeAt(0),_.D="D".charCodeAt(0),_.E="E".charCodeAt(0),_.F="F".charCodeAt(0),_.G="G".charCodeAt(0),_.H="H".charCodeAt(0),_.I="I".charCodeAt(0),_.J="J".charCodeAt(0),_.K="K".charCodeAt(0),_.L="L".charCodeAt(0),_.M="M".charCodeAt(0),_.N="N".charCodeAt(0),_.O="O".charCodeAt(0),_.P="P".charCodeAt(0),_.Q="Q".charCodeAt(0),_.R="R".charCodeAt(0),_.S="S".charCodeAt(0),_.T="T".charCodeAt(0),_.U="U".charCodeAt(0),_.V="V".charCodeAt(0),_.W="W".charCodeAt(0),_.X="X".charCodeAt(0),_.Y="Y".charCodeAt(0),_.Z="Z".charCodeAt(0),_.ZERO="0".charCodeAt(0),_.ONE="1".charCodeAt(0),_.TWO="2".charCodeAt(0),_.THREE="3".charCodeAt(0),_.FOUR="4".charCodeAt(0),_.FIVE="5".charCodeAt(0),_.SIX="6".charCodeAt(0),_.SEVEN="7".charCodeAt(0),_.EIGHT="8".charCodeAt(0),_.NINE="9".charCodeAt(0),_.NUMPAD_0=96,_.NUMPAD_1=97,_.NUMPAD_2=98,_.NUMPAD_3=99,_.NUMPAD_4=100,_.NUMPAD_5=101,_.NUMPAD_6=102,_.NUMPAD_7=103,_.NUMPAD_8=104,_.NUMPAD_9=105,_.NUMPAD_MULTIPLY=106,_.NUMPAD_ADD=107,_.NUMPAD_ENTER=108,_.NUMPAD_SUBTRACT=109,_.NUMPAD_DECIMAL=110,_.NUMPAD_DIVIDE=111,_.F1=112,_.F2=113,_.F3=114,_.F4=115,_.F5=116,_.F6=117,_.F7=118,_.F8=119,_.F9=120,_.F10=121,_.F11=122,_.F12=123,_.F13=124,_.F14=125,_.F15=126,_.COLON=186,_.EQUALS=187,_.UNDERSCORE=189,_.QUESTION_MARK=191,_.TILDE=192,_.OPEN_BRACKET=219,_.BACKWARD_SLASH=220,_.CLOSED_BRACKET=221,_.QUOTES=222,_.BACKSPACE=8,_.TAB=9,_.CLEAR=12,_.ENTER=13,_.SHIFT=16,_.CONTROL=17,_.ALT=18,_.META=91,_.META_RWIN=92,_.META_RMAC=93,_.CAPS_LOCK=20,_.ESC=27,_.SPACEBAR=32,_.PAGE_UP=33,_.PAGE_DOWN=34,_.END=35,_.HOME=36,_.LEFT=37,_.UP=38,_.RIGHT=39,_.DOWN=40,_.INSERT=45,_.DELETE=46,_.HELP=47,_.NUM_LOCK=144,_.PLUS=43,_.MINUS=45;var aa=g.Mouse=function(a,b){this.input=a,this.game=a.game,this._wheelEvent=null,this.capture=!0,this.callbackContext=this.game,this.mouseDownCallback=null,this.onMouseDown=new h.Signal,this.onMouseUp=new h.Signal,this.onMouseMove=new h.Signal,this.onMousePressMove=new h.Signal,this.onMouseWheel=new h.Signal,this._mouses=[],this._mouseIds={},this._mouseDownNum=0,this._anyMouseDown=!1,this._checkEventHandledByTouch=this.game.phaser.device.android&&this.game.phaser.device.chrome===!1,this._wheelInfo={deltaX:0,deltaY:0},this._init(b)};aa.prototype={},aa.prototype.constructor=aa,b.defineProperties(aa.prototype,{enable:{get:function(){return this._enable},set:function(a){this._setEnable(a)}},generator:{get:function(){return this._generator||this.game.canvas.parentNode||this.game.canvas},set:function(a){if(a!==this._generator){var b=this.enable;this.enable=!1,this._generator=a,b&&(this.enable=!0)}}},mouseWheel:{get:function(){return this._wheelInfo}},mouseCount:{get:function(){return this._mouseDownNum}},mouseIds:{get:function(){return b.keys(this._mouseIds)}}}),aa.prototype._init=function(a){this._mouseKeyMap={0:aa.BUTTON_LEFT,1:aa.BUTTON_MIDDLE,2:aa.BUTTON_RIGHT,3:aa.BUTTON_BACK,4:aa.BUTTON_FORWORD},this._mouseKeyMap[-1]=aa.NONE,this._onMouseDown=this.processMouseDown.bind(this),this._onMouseUp=this.processMouseUp.bind(this),this._onMouseOver=this.processMouseOver.bind(this),this._onMouseOut=this.processMouseOut.bind(this),this._onMouseUpGlobal=this.processMouseUpGlobal.bind(this),this._onMouseMove=this.processMouseMove.bind(this),this._onMouseWheel=this.processMouseWheel.bind(this),this.generator=a,this.enable=!0},aa.prototype.update=function(){if(this.enable){this._anyMouseDown=!1;for(var a,b=this._mouses.length;b-->1;)if(a=this._mouses[b])for(;a.nextEvent();)a.isJustDown&&(this._anyMouseDown=!0,this._recordMouse(a.id,!0),this.onMouseDown.dispatch(a.id,a.x,a.y)),a.update(),a.isDown&&(a.deltaX||a.deltaY)&&this.onMousePressMove.dispatch(a.id,a.x,a.y),a.isJustUp&&(this._recordMouse(a.id,!1),this.onMouseUp.dispatch(a.id,a.x,a.y));if(a=this.getMouseById(aa.NONE))for(;a.nextEvent();)a.update(),(a.deltaX||a.deltaY)&&this.onMouseMove.dispatch(a.x,a.y);var c=this._tempWheelInfo||(this._tempWheelInfo={deltaX:0,deltaY:0});c&&(c.deltaX||c.deltaY)?(this._wheelInfo.deltaX=c.deltaX||0,this._wheelInfo.deltaY=c.deltaY||0,this.onMouseWheel.dispatch(this._wheelInfo.deltaX,this._wheelInfo.deltaY)):(this._wheelInfo.deltaX=0,this._wheelInfo.deltaY=0),c.deltaX=0,c.deltaY=0}},aa.prototype.destroy=function(){this.enable=!1,this._onMouseDown=null,this._onMouseUp=null,this._onMouseOver=null,this._onMouseOut=null,this._onMouseUpGlobal=null,this._onMouseMove=null,this._onMouseWheel=null,this.input=null,this.game=null,this.generator=null},aa.prototype._setEnable=function(b){if(this._enable!==b&&(!this.game.phaser.device.android||this.game.phaser.device.chrome!==!1)){this._enable=b;var c=this.generator,e=this.game.phaser.device;if(b){c.addEventListener("mousedown",this._onMouseDown,!0),c.addEventListener("mouseup",this._onMouseUp,!0),c.addEventListener("mousemove",this._onMouseMove,!0),e.cocoonJS||(c===a||a.addEventListener("mouseup",this._onMouseUpGlobal,!0),c.addEventListener("mouseout",this._onMouseOut,!0),c.addEventListener("mouseover",this._onMouseOver,!0));var f=e.wheelEvent;f&&(c.addEventListener(f,this._onMouseWheel,!0),"mousewheel"===f?this._wheelEvent=new d(-1/40,1):"DOMMouseScroll"===f&&(this._wheelEvent=new d(1,1))),this.getMouseById(aa.NONE)}else{c.removeEventListener("mousedown",this._onMouseDown,!0),c.removeEventListener("mousemove",this._onMouseMove,!0),c.removeEventListener("mouseup",this._onMouseUp,!0),c.removeEventListener("mouseout",this._onMouseOut,!0),c.removeEventListener("mouseover",this._onMouseOver,!0);var f=e.wheelEvent;f&&c.removeEventListener(f,this._onMouseWheel,!0),c===a||a.removeEventListener("mouseup",this._onMouseUpGlobal,!0),this._clearMouses()}}},aa.prototype._clearMouses=function(){for(;this._mouses.length>0;){var a=this._mouses.pop();a&&a.destroy()}this._mouseDownNum=0,this._mouseIds={}},aa.prototype.lossFocus=function(){this._clearMouses(),this.getMouseById(aa.NONE)},aa.prototype.isAnyMouse=function(){return this._mouseDownNum>0},aa.prototype.isAnyMouseDown=function(){return this._anyMouseDown},aa.prototype.isMouseDown=function(a){return!!this._mouseIds[a]},aa.prototype._recordMouse=function(a,b){b?(this._mouseDownNum++,this._mouseIds[a]=!0):(this._mouseDownNum--,delete this._mouseIds[a])},aa.prototype.getMouseById=function(a){var b=Math.abs(a);return this._mouses[b]||(this._mouses[b]=new g.Pointer(this.game,a)),this._mouses[b]},aa.prototype._updateMousesPosition=function(a,b,c){for(var d,e=this._mouses.length;e--;)d=this._mouses[e],d&&(c===g.Pointer.ENTER?d.onEnter(a,b):c===g.Pointer.LEAVE?d.onLeave(a,b):d.onMove(a,b))},aa.prototype._toWorld=function(a,b,c){var d=this.game.canvas,e=this.game.phaser.scale.scaleFactor,f=d.ownerDocument===(this.generator.ownerDocument||this.generator.document)?d.getBoundingClientRect():this.generator.getBoundingClientRect&&this.generator.getBoundingClientRect()||{left:0,top:0};return{x:(b-f.left)*e.x,y:(c-f.top)*e.y}},aa.prototype.processMouseDown=function(a){!this.input.ignoreDomEvent(a)&&this.capture&&a.preventDefault(),this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,a);var b=this._mouseKeyMap[a.button];if(b!=c){var d=this._toWorld(this.generator,a.clientX,a.clientY);if(!this._checkEventHandledByTouch||!this.input.touch.checkEventHandled(!0,d.x,d.y)){var e=this.getMouseById(b);e.deviceId=a.button,e.onDown(d.x,d.y),this.input.keyboard.setModifierKeysState(a),this.input.nativeMode&&this.update()}}},aa.prototype.processMouseUp=function(a){!this.input.ignoreDomEvent(a)&&this.capture&&a.preventDefault();var b=this._mouseKeyMap[a.button];if(b!=c){var d=this.getMouseById(b);d.deviceId=a.button,d.onUp(),this.input.keyboard.setModifierKeysState(a),this.input.nativeMode&&this.update()}},aa.prototype.processMouseUpGlobal=function(a){var b=this._mouseKeyMap[a.button];if(b!=c){var d=this.getMouseById(b);d.onUp(),this.input&&this.input.keyboard&&this.input.keyboard.setModifierKeysState(a),this.input.nativeMode&&this.update()}},aa.prototype.processMouseOut=function(a){!this.input.ignoreDomEvent(a)&&this.capture&&a.preventDefault();var b=this._mouseKeyMap[a.button];if(b!=c){var d=this._toWorld(this.generator,a.clientX,a.clientY);this._updateMousesPosition(d.x,d.y,g.Pointer.LEAVE),this.input.nativeMode&&this.update()}},aa.prototype.processMouseOver=function(a){!this.input.ignoreDomEvent(a)&&this.capture&&a.preventDefault();var b=this._mouseKeyMap[a.button];if(b!=c){var d=this._toWorld(this.generator,a.clientX,a.clientY);this._updateMousesPosition(d.x,d.y,g.Pointer.ENTER),this.input.keyboard.setModifierKeysState(a),this.input.nativeMode&&this.update()}},aa.prototype.processMouseMove=function(a){!this.input.ignoreDomEvent(a)&&this.capture&&a.preventDefault();var b=this._mouseKeyMap[a.button];if(b!=c){var d=this._toWorld(this.generator,a.clientX,a.clientY);this._updateMousesPosition(d.x,d.y,g.Pointer.MOVE),this.input.keyboard.setModifierKeysState(a),this.input.nativeMode&&this.update()}},aa.prototype.processMouseWheel=function(a){this._wheelEvent&&(a=this._wheelEvent.bindEvent(a)),!this.input.ignoreDomEvent(a)&&this.capture&&a.preventDefault();var b=(h.Math.clamp(-a.deltaY,-1,1),this._tempWheelInfo||(this._tempWheelInfo={deltaX:0,deltaY:0}));b.deltaX+=a.deltaX,b.deltaY+=a.deltaY,this.input.keyboard.setModifierKeysState(a),this.input.nativeMode&&this.update()},aa.NONE=0,aa.BUTTON_LEFT=-1,aa.BUTTON_MIDDLE=-2,aa.BUTTON_RIGHT=-3,aa.BUTTON_BACK=-4,aa.BUTTON_FORWORD=-5,d.prototype={},d.prototype.constructor=d,d.prototype.bindEvent=function(a){if(!d._stubsGenerated&&a){var c=function(a){return function(){var b=this.originalEvent[a];return"function"!=typeof b?b:b.bind(this.originalEvent)}};for(var e in a)e in d.prototype||b.defineProperty(d.prototype,e,{get:c(e)});d._stubsGenerated=!0}return this.originalEvent=a,this},b.defineProperties(d.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}});var ba=g.Touch=function(a,b){this.input=a,this.game=a.game,this.capture=!0,this.onTouchStart=new h.Signal,this.onTouchEnd=new h.Signal,this.onTouchMove=new h.Signal,this._touches=[],this._touchIds={},this._deviceIdMap={},this._touchesStartPosition=[],this._touchStartNum=0,this._anyTouchStart=!1,this._init(b),this.callbackContext=this.game,this.touchStartCallback=null,this.touchMoveCallback=null,this.touchEndCallback=null,this.touchEnterCallback=null,this.touchLeaveCallback=null,this.touchCancelCallback=null};ba.prototype={},ba.prototype.constructor=ba,b.defineProperties(ba.prototype,{enable:{get:function(){return this._enable},set:function(a){this._setEnable(a)}},generator:{get:function(){return this._generator||this.game.canvas.parentNode||this.game.canvas},set:function(a){if(a!==this._generator){var b=this.enable;this.enable=!1,this._generator=a,b&&(this.enable=!0)}}},touchCount:{get:function(){return this._touchStartNum}},touchIds:{get:function(){return b.keys(this._touchIds)}}}),ba.prototype._init=function(a){this._onTouchStart=this.processTouchStart.bind(this),this._onTouchCancel=this.processTouchCancel.bind(this),this._onTouchEnd=this.processTouchEnd.bind(this),this._onTouchEnter=this.processTouchEnter.bind(this),this._onTouchLeave=this.processTouchLeave.bind(this),this._onTouchMove=this.processTouchMove.bind(this),this.generator=a,this.enable=!0},ba.prototype.update=function(){if(this.enable){this._touchesStartPosition.splice(0,this._touchesStartPosition.length),this._anyTouchStart=!1;for(var a,b=this._touches.length;b--;)if(a=this._touches[b])for(;a.nextEvent();)a.isJustDown&&(this._anyTouchStart=!0,this._recordTouch(a.id,!0),this.onTouchStart.dispatch(a.id,a.x,a.y)),a.update(),a.isDown&&(a.deltaX||a.deltaY)&&this.onTouchMove.dispatch(a.id,a.x,a.y),a.isJustUp&&(this._recordTouch(a.id,!1),this.onTouchEnd.dispatch(a.id,a.x,a.y)),a.isDown||this._removeTouch(a.id)}},ba.prototype.destroy=function(){this.enable=!1,this._onTouchStart=null,this._onTouchCancel=null,this._onTouchEnd=null,this._onTouchEnter=null,this._onTouchLeave=null,this._onTouchMove=null,this.input=null,this.game=null,this.generator=null},ba.prototype.checkEventHandled=function(a,b,c){for(var d=this._touchesStartPosition.length;d--;){var e=this._touchesStartPosition[d];if(e.isDown===a&&e.x===b&&e.y===c)return!0}return!1},ba.prototype._setEnable=function(a){if(this._enable!==a){var b=this.generator,c=this.game.phaser.device;if(!c.touch)return void(this._enable=!1);this._enable=a,a?(b.addEventListener("touchstart",this._onTouchStart,!1),b.addEventListener("touchmove",this._onTouchMove,!1),b.addEventListener("touchend",this._onTouchEnd,!1),b.addEventListener("touchcancel",this._onTouchCancel,!1),c.cocoonJS||(b.addEventListener("touchenter",this._onTouchEnter,!1),b.addEventListener("touchleave",this._onTouchLeave,!1))):(b.removeEventListener("touchstart",this._onTouchStart),b.removeEventListener("touchmove",this._onTouchMove),b.removeEventListener("touchend",this._onTouchEnd),b.removeEventListener("touchcancel",this._onTouchCancel),b.removeEventListener("touchenter",this._onTouchEnter),b.removeEventListener("touchleave",this._onTouchLeave),this._clearTouches())}},ba.prototype._clearTouches=function(){for(var a;this._touches.length>0;)a=this._touches.pop(),a&&a.destroy();this._deviceIdMap={},this._touchStartNum=0,this._touchIds={}},ba.prototype.lossFocus=function(){this._clearTouches()},ba.prototype.isAnyTouch=function(){return this._touchStartNum>0},ba.prototype.isAnyTouchStart=function(){return this._anyTouchStart},ba.prototype.isTouchStart=function(a){return!!this._touchIds[a]},ba.prototype._recordTouch=function(a,b){b?(this._touchStartNum++,this._touchIds[a]=!0):(this._touchStartNum--,delete this._touchIds[a])},ba.prototype.getTouchById=function(a){return this._touches[a]},ba.prototype._getFirstInvalidTouch=function(){for(var a=-1,b=this._touches.length+1;++a<b;){var c=this._touches[a];if(!c)break;if(!c.isDown&&!c.hasEvent())return c}var d=new g.Pointer(this.game,a);return this._touches[a]=d,d},ba.prototype._removeTouch=function(a){var b=this._touches[a];b&&delete this._deviceIdMap[b.deviceId]},ba.prototype.getTouchByDeviceId=function(a,b){if(this._deviceIdMap[a]===c){if(b){var d=this._getFirstInvalidTouch();return d.deviceId=a,this._deviceIdMap[a]=d.id,d}return null}return this.getTouchById(this._deviceIdMap[a])},ba.prototype._toWorld=function(a,b,c){var d=this.game.canvas,e=this.game.phaser.scale.scaleFactor,f=d.ownerDocument===(this.generator.ownerDocument||this.generator.document)?d.getBoundingClientRect():this.generator.getBoundingClientRect&&this.generator.getBoundingClientRect()||{left:0,top:0};return{x:(b-f.left)*e.x,y:(c-f.top)*e.y}},ba.prototype._updateTouchWithTouches=function(a){for(var b=a.length,c={};b--;){var d=a[b];c[d.identifier]=!0;var e=this._toWorld(this.generator,d.clientX,d.clientY),f=this.getTouchByDeviceId(d.identifier);f&&(f.deviceId=d.identifier,f.onMove(e.x,e.y))}for(var b=this._touches.length;b--;){var d=this._touches[b];d&&!c[d.deviceId]&&d.onCancel(!1)}},ba.prototype.processTouchStart=function(a){this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,a),!this.input.ignoreDomEvent(a)&&this.capture&&a.preventDefault();for(var b=a.changedTouches.length;b--;){var c=a.changedTouches[b];if(c){var d=this.getTouchByDeviceId(c.identifier,!0),e=this._toWorld(this.generator,c.clientX,c.clientY);this._touchesStartPosition.push({isDown:!0,x:e.x,y:e.y}),d.onDown(e.x,e.y)}}this._updateTouchWithTouches(a.touches),this.input.keyboard.setModifierKeysState(a),this.input.nativeMode&&this.update()},ba.prototype.processTouchEnd=function(a){this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,a),!this.input.ignoreDomEvent(a)&&this.capture&&a.preventDefault();for(var b=a.changedTouches.length;b--;){var c=a.changedTouches[b];if(c){var d=this.getTouchByDeviceId(c.identifier);if(d){var e=this._toWorld(this.generator,c.clientX,c.clientY);this._touchesStartPosition.push({isDown:!1,x:e.x,y:e.y}),d.onUp(e.x,e.y)}}}this._updateTouchWithTouches(a.touches),this.input.keyboard.setModifierKeysState(a),this.input.nativeMode&&this.update()},ba.prototype.processTouchCancel=function(a){this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,a),this.processTouchEnd(a,!0)},ba.prototype.processTouchLeave=function(a){this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,a),this.processTouchMove(a,!0)},ba.prototype.processTouchEnter=function(a){this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,a),this.processTouchMove(a,!0)},ba.prototype.processTouchMove=function(a,b){!b&&this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,a),!this.input.ignoreDomEvent(a)&&this.capture&&a.preventDefault();for(var c=a.changedTouches.length;c--;){var d=a.changedTouches[c];if(d){var e=this.getTouchByDeviceId(d.identifier);if(e){var f=this._toWorld(this.generator,d.clientX,d.clientY);e.onMove(f.x,f.y)}}}this._updateTouchWithTouches(a.touches),this.input.keyboard.setModifierKeysState(a),this.input.nativeMode&&this.update()},ba.MAIN=0;var ca=g.BaseInputEvent=function(a){this.source=a,this.effect=!0};ca.prototype={},ca.prototype.constructor=ca;var da=g.WheelEvent=function(a,b){ca.call(this,{deltaX:a,deltaY:b})};da.prototype=b.create(ca.prototype),da.prototype.constructor=da,b.defineProperties(da.prototype,{deltaX:{get:function(){return this.source.deltaX}},deltaY:{get:function(){return this.source.deltaY}}});var ea=g.CursorMoveEvent=function(a,b){ca.call(this,{x:a,y:b})};ea.prototype=b.create(ca.prototype),ea.prototype.constructor=ea,b.defineProperties(ea.prototype,{x:{get:function(){return this.source.x}},y:{get:function(){return this.source.y}}});var fa=g.PointerEvent=function(a){ca.call(this,a)};fa.prototype=b.create(ca.prototype),fa.prototype.constructor=fa;var ga=g.ClickEvent=function(a){fa.call(this,a),this.isTap=!1,this.isDoubleTap=!1,this.isDoubleClick=!1};ga.prototype=b.create(fa.prototype),ga.prototype.constructor=ga;var ha=g.DragStartEvent=function(a){fa.call(this,a),this.started=!0};ha.prototype=b.create(fa.prototype),ha.prototype.constructor=ha;var ia=g.DragEvent=function(a){fa.call(this,a)};ia.prototype=b.create(fa.prototype),ia.prototype.constructor=ia;var ja=g.DragEndEvent=function(a,b){fa.call(this,a),this.result=b};ja.prototype=b.create(fa.prototype),ja.prototype.constructor=ja;var ka=g.DropEvent=function(a,b){fa.call(this,a),this.dragging=b,this.result=null};ka.prototype=b.create(fa.prototype),ka.prototype.constructor=ka;var la=g.BaseInputModule=function(a,b){this.game=a,this.input=b,this.handleTouchAsMouse=!0,this._currMainPointerId=0/0,this._needHandleEventTypes=["onDown","onUp","onClick"],this._needHandleDragTypes=["onDragStart","onDrag","onDragEnd"],this._needHandleClickAndDragType=["onClick","onDragStart","onDrag","onDragEnd"],this._startDragMoveDistance=10,this.tapDuringTime=200,this.doubleClickDuringTime=600,this._pointersEvent={},this._init()};la.prototype={},la.prototype.constructor=la,la.prototype._init=function(){this.input.onPointerDown.add(this.onPointerDown,this),this.input.onPointerUp.add(this.onPointerUp,this),this.input.onPointerMove.add(this.onPointerMove,this),this.input.onWheel.add(this.onWheel,this),this.input.onCursorMove.add(this.onCursorMove,this)},la.prototype._buildPointerRecord=function(a,b){return{eventId:a,deviceId:a,isMouse:b,downNode:null,draggingNode:null,overNode:null}},la.prototype.destroy=function(){this.input.onPointerDown.remove(this.onPointerDown,this),this.input.onPointerUp.remove(this.onPointerUp,this),this.input.onPointerMove.remove(this.onPointerMove,this),this.input.onWheel.remove(this.onWheel,this),this.input.onCursorMove.remove(this.onCursorMove,this),this.reset()},la.prototype.lossFocus=function(){this.reset()},la.prototype.update=function(){},la.prototype.reset=function(){for(var a in this._pointersEvent){var b,c=this._pointersEvent[a];if(isNaN(c.deviceId)||(b=this.input.getPointer(c.deviceId),c.deviceId=0/0),null!==c.downNode){var d=new g.PointerEvent(b);c.downNode.fireInputEvent("onUp",d),c.downNode=null}if(c.draggingNode){var e=new g.DragEndEvent(b,null);c.draggingNode.fireInputEvent("onDragEnd",e),c.draggingNode=null}if(c.overNode){var f=new g.CursorMoveEvent(0/0,0/0);this.doPointerExitAndEnter(c,f,null),c.overNode=null}}this._pointersEvent={},this._currMainPointerId=0/0},la.prototype.checkEventRecordNode=function(a){a.draggingNode&&a.draggingNode._destroy&&(a.draggingNode=null),a.downNode&&a.downNode._destroy&&(a.downNode=null),a.overNode&&a.overNode._destroy&&(a.overNode=null)},la.prototype.onPointerDown=function(a,b,c){var d=this.input.getPointer(a),e=this._pointersEvent[a]||(this._pointersEvent[a]=this._buildPointerRecord(a,this.input.isMouse(a)));if(this.handleTouchAsMouse&&(a===g.Mouse.BUTTON_LEFT||a===g.Touch.MAIN)){if(!isNaN(this._currMainPointerId)&&this._currMainPointerId!==a)return;this._currMainPointerId=a,d.eventId=g.Mouse.BUTTON_LEFT,e.eventId=g.Mouse.BUTTON_LEFT}this.checkEventRecordNode(e);var f=this._fetchNodeInParent(this.game.world,b,c);if(!e.isMouse){var h=new g.CursorMoveEvent(b,c);this.doPointerExitAndEnter(e,h,f)}var i=f?f.getInputEventHandle(this._needHandleEventTypes):null;if(i){e.downNode=i;var j=new g.PointerEvent(d);i&&i.fireInputEvent("onDown",j)}},la.prototype.onPointerUp=function(a,b,c){var d=this.input.getPointer(a),e=this._pointersEvent[a]||(this._pointersEvent[a]=this._buildPointerRecord(a,this.input.isMouse(a)));if(this.handleTouchAsMouse&&(a===g.Mouse.BUTTON_LEFT||a===g.Touch.MAIN)){if(this._currMainPointerId!==a)return;this._currMainPointerId=0/0,d.eventId=g.Mouse.BUTTON_LEFT,e.eventId=d.eventId}this.checkEventRecordNode(e);var f=this._fetchNodeInParent(this.game.world,b,c,e.draggingNode),h=f?f.getInputEventHandle(this._needHandleEventTypes):null,i=new g.PointerEvent(d);if(null!==e.draggingNode){var j=f?f.getInputEventHandle("onDragDrop"):null,k=new g.DropEvent(d,e.draggingNode);j&&j.checkAllowDrop(e.draggingNode)&&j.fireInputEvent("onDragDrop",k);var l=new g.DragEndEvent(d,k.result);e.draggingNode.fireInputEvent("onDragEnd",l),e.draggingNode=null}else if(h&&h===e.downNode){var m=new g.ClickEvent(d);if(d.previousStatus.length){var n=d.previousStatus[0],o=d.previousStatus[1];m.isTap=n.upTime-n.downTime<this.tapDuringTime,m.isDoubleTap=o&&n.upTime-o.downTime<2*this.tapDuringTime,m.isDoubleClick=o&&n.upTime-o.downTime<this.doubleClickDuringTime}h.fireInputEvent("onClick",m)}if(e.downNode&&(i.downInside=!0,i.upInside=e.downNode===h,e.downNode.fireInputEvent("onUp",i)),h&&h!==e.downNode&&(i.downInside=!1,i.upInside=!0,h.fireInputEvent("onUp",i)),e.downNode=null,!e.isMouse){var p=new g.CursorMoveEvent(b,c);this.doPointerExitAndEnter(e,p,null)}delete this._buildPointerRecord[e.deviceId]},la.prototype.onPointerMove=function(a,b,c){var d=this.input.getPointer(a),e=this._pointersEvent[a]||(this._pointersEvent[a]=this._buildPointerRecord(a,this.input.isMouse(a)));this.checkEventRecordNode(e);var f=this._fetchNodeInParent(this.game.world,b,c);if(!e.isMouse){var h=new g.CursorMoveEvent(b,c);this.doPointerExitAndEnter(e,h,f)}if(!e.draggingNode){var i=this._fetchNodeInParent(this.game.world,d.startX,d.startY),j={x:d.x,y:d.y},k=null;do{if(!i)break;var l=i.getInputEventHandleAndEventType(this._needHandleClickAndDragType);if(!l)break;if("onClick"===l[1]&&(Math.abs(d.distanceX)<this._startDragMoveDistance||Math.abs(d.distanceY)<this._startDragMoveDistance))break;k=l[0]}while(!1);var m=new g.DragStartEvent(d);d._x=d.startX,d._y=d.startY,k&&k.fireInputEvent("onDragStart",m),d._x=j.x,d._y=j.y,e.draggingNode=k}if(!e.draggingNode&&(Math.abs(d.distanceX)>=this._startDragMoveDistance||Math.abs(d.distanceY)>=this._startDragMoveDistance)){var i=this._fetchNodeInParent(this.game.world,d.startX,d.startY),j={x:d.x,y:d.y},k=i?i.getInputEventHandle(this._needHandleDragTypes):null,m=new g.DragStartEvent(d);d._x=d.startX,d._y=d.startY,k&&k.fireInputEvent("onDragStart",m),d._x=j.x,d._y=j.y,e.draggingNode=k}if(e.draggingNode){var k=f?f.getInputEventHandle("onDragDrop"):null,n=new g.DropEvent(d,e.draggingNode);!k||k.isAllowDrop&&!k.isAllowDrop(e.draggingNode)||k.fireInputEvent("onDragOver",n);var o=new g.DragEvent(d);e.draggingNode.fireInputEvent("onDrag",o)}},la.prototype.onWheel=function(a,b){if(this.input.hasCursor){var c=this.input.cursorPosition,d=this._fetchNodeInParent(this.game.world,c.x,c.y),e=d?d.getInputEventHandle("onWheel"):null;if(e){var f=new g.WheelEvent(-a,-b);e.fireInputEvent("onWheel",f),this.onCursorMove(c.x,c.y)}}},la.prototype.onCursorMove=function(a,b){var c=this._fetchNodeInParent(this.game.world,a,b),d=new g.CursorMoveEvent(a,b);this.checkEventRecordNode(this),this.doPointerExitAndEnter(this,d,c)},la.prototype.doPointerExitAndEnter=function(a,b,c){if(a.overNode!==c){var d=this.findCommonRoot(a.overNode,c);if(a.overNode)for(var e=a.overNode;e&&e!==this.game.world&&(!d||d!==e);)e.fireInputEvent("onExit",b),e=e.parent;if(c)for(var e=c;e&&e!==d&&e!==this.game.world;)e.fireInputEvent("onEnter",b),e=e.parent;a.overNode=c}},la.prototype._flattenPolygonContains=function(a,b,c){for(var d=a.length/2,e=!1,f=-1,g=d-1;++f<d;g=f){var h=a[2*f],i=a[2*f+1],j=a[2*g],k=a[2*g+1];(c>=i&&k>c||c>=k&&i>c)&&(j-h)*(c-i)/(k-i)+h>b&&(e=!e)}return e},la.prototype.findCommonRoot=function(a,b){if(!a||!b)return null;for(var c=a,d=b;c;){for(d=b;d;){if(c===d)return c;d=d.parent}c=c.parent}return null},la.prototype._fetchNodeInParent=function(a,b,c,d){if(!a||!a.phaser.visible)return null;var e=a.toLocal({x:b,y:c});if(a===this.game.world&&!a.rect.contains(e.x,e.y))return null;if(a===d)return null;if(a.phaser.mask){for(var f=a.phaser.mask.graphicsData.length,h=!1,i=0;i<a.phaser.mask.graphicsData.length;i++){var j=a.phaser.mask.graphicsData[i];if(j.fill&&j.shape){j.shape.points&&j.shape.points.length>0&&!(j.shape.points[0]instanceof g.Point)&&this._flattenPolygonContains(j.shape.points,b,c)?h=!0:j.shape.contains(b,c)&&(h=!0);break}}if(0!=f&&!h)return null}if(a.phaser.softClip&&a.phaser.softClip.length&&!g.GeometricTool.polygonContains(a.phaser.softClip,b,c))return null;for(var k=null,l=a.children,i=l.length;i--;)if(k=this._fetchNodeInParent(l[i],b,c,d))return k;return a.interactive&&a.hitArea&&a.hitArea.contains&&a.hitArea.contains(e.x,e.y)?a:null};var ma,na=function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c};!function(a){!function(a){var b=function(){function a(a,b){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),this.x=a,this.y=b}return a.prototype.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"},a}();a.Point=b;var c=function(){function a(a,b,c,d){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=0),this.x=a,this.y=b,this.width=c,this.height=d}return a}();a.Rectangle=c;var d=function(){function a(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0}return a.prototype.invert=function(){var a=this.a,b=this.b,c=this.c,d=this.d,e=this.tx,f=a*d-b*c;this.a=d/f,this.b=-b/f,this.c=-c/f,this.d=a/f,this.tx=(c*this.ty-d*e)/f,this.ty=-(a*this.ty-b*e)/f},a}();a.Matrix=d;var e=function(){function a(){this.alphaMultiplier=0,this.alphaOffset=0,this.blueMultiplier=0,this.blueOffset=0,this.greenMultiplier=0,this.greenOffset=0,this.redMultiplier=0,this.redOffset=0}return a}();a.ColorTransform=e}(a.geom||(a.geom={}));var b=a.geom;!function(a){
var b=function(){function a(a){this.type=a}return a}();a.Event=b;var c=function(a){function b(b){a.call(this,b)}return na(b,a),b.FADE_IN="fadeIn",b.FADE_OUT="fadeOut",b.START="start",b.COMPLETE="complete",b.LOOP_COMPLETE="loopComplete",b.FADE_IN_COMPLETE="fadeInComplete",b.FADE_OUT_COMPLETE="fadeOutComplete",b}(b);a.AnimationEvent=c;var d=function(a){function b(b){a.call(this,b)}return na(b,a),b.Z_ORDER_UPDATED="zOrderUpdated",b}(b);a.ArmatureEvent=d;var e=function(a){function b(b){a.call(this,b)}return na(b,a),b.ANIMATION_FRAME_EVENT="animationFrameEvent",b.BONE_FRAME_EVENT="boneFrameEvent",b}(b);a.FrameEvent=e;var f=function(a){function b(b){a.call(this,b)}return na(b,a),b.SOUND="sound",b.BONE_FRAME_EVENT="boneFrameEvent",b}(b);a.SoundEvent=f;var g=function(){function a(){}return a.prototype.hasEventListener=function(a){return this._listenersMap&&this._listenersMap[a]?!0:!1},a.prototype.addEventListener=function(a,b){if(a&&b){this._listenersMap||(this._listenersMap={});var c=this._listenersMap[a];c&&this.removeEventListener(a,b),c?c.push(b):this._listenersMap[a]=[b]}},a.prototype.removeEventListener=function(a,b){if(this._listenersMap&&a&&b){var c=this._listenersMap[a];if(c)for(var d=c.length,e=0;d>e;e++)c[e]==b&&(1==d?(c.length=0,delete this._listenersMap[a]):c.splice(e,1))}},a.prototype.removeAllEventListeners=function(a){a?delete this._listenersMap[a]:this._listenersMap=null},a.prototype.dispatchEvent=function(a){if(a){var b=this._listenersMap[a.type];if(b){a.target=this;for(var c=b.concat(),d=b.length,e=0;d>e;e++)c[e](a)}}},a}();a.EventDispatcher=g;var h=function(a){function b(){if(a.call(this),b._instance)throw new Error("Singleton already constructed!")}return na(b,a),b.getInstance=function(){return b._instance||(b._instance=new b),b._instance},b}(g);a.SoundEventManager=h}(a.events||(a.events={}));var d=a.events;!function(a){var c=function(){function a(){this.transform=new f.DBTransform,this.pivot=new b.Point,this._durationTransform=new f.DBTransform,this._durationPivot=new b.Point,this._durationColor=new b.ColorTransform}return a._borrowObject=function(){return 0==a._pool.length?new a:a._pool.pop()},a._returnObject=function(b){a._pool.indexOf(b)<0&&(a._pool[a._pool.length]=b),b.clear()},a._clear=function(){for(var b=a._pool.length;b--;)a._pool[b].clear();a._pool.length=0},a.getEaseValue=function(b,c){if(c>1){var d=.5*(1-Math.cos(b*Math.PI))-b;c-=1}else c>0?d=Math.sin(b*a.HALF_PI)-b:0>c&&(d=1-Math.cos(b*a.HALF_PI)-b,c*=-1);return d*c+b},a.prototype.fadeIn=function(a,b,c){switch(this._bone=a,this._animationState=b,this._timeline=c,this._originTransform=this._timeline.originTransform,this._originPivot=this._timeline.originPivot,this._tweenTransform=!1,this._tweenColor=!1,this._totalTime=this._animationState.totalTime,this.transform.x=0,this.transform.y=0,this.transform.scaleX=0,this.transform.scaleY=0,this.transform.skewX=0,this.transform.skewY=0,this.pivot.x=0,this.pivot.y=0,this._durationTransform.x=0,this._durationTransform.y=0,this._durationTransform.scaleX=0,this._durationTransform.scaleY=0,this._durationTransform.skewX=0,this._durationTransform.skewY=0,this._durationPivot.x=0,this._durationPivot.y=0,this._currentFrame=null,this._timeline.getFrameList().length){case 0:this._bone._arriveAtFrame(null,this,this._animationState,!1),this._updateState=0;break;case 1:this._updateState=-1;break;default:this._updateState=1}},a.prototype.fadeOut=function(){this.transform.skewX=g.TransformUtil.formatRadian(this.transform.skewX),this.transform.skewY=g.TransformUtil.formatRadian(this.transform.skewY)},a.prototype.update=function(b){if(this._updateState)if(this._updateState>0){0==this._timeline.scale?b=1:b/=this._timeline.scale,1==b&&(b=.99999999),b+=this._timeline.offset;var c=Math.floor(b);b-=c;for(var d,e=this._totalTime*b,f=!1;!this._currentFrame||e>this._currentFramePosition+this._currentFrameDuration||e<this._currentFramePosition;)f&&this._bone._arriveAtFrame(this._currentFrame,this,this._animationState,!0),f=!0,this._currentFrame?(d=this._timeline.getFrameList().indexOf(this._currentFrame)+1,d>=this._timeline.getFrameList().length&&(d=0),this._currentFrame=this._timeline.getFrameList()[d]):(d=0,this._currentFrame=this._timeline.getFrameList()[0]),this._currentFrameDuration=this._currentFrame.duration,this._currentFramePosition=this._currentFrame.position;if(f){this.tweenActive=this._currentFrame.displayIndex>=0,d++,d>=this._timeline.getFrameList().length&&(d=0);var h=this._timeline.getFrameList()[d];0==d&&this._animationState.loop&&this._animationState.loopCount>=Math.abs(this._animationState.loop)-1&&((this._currentFramePosition+this._currentFrameDuration)/this._totalTime+c-this._timeline.offset)*this._timeline.scale>.99999999?(this._updateState=0,this._tweenEasing=0/0):this._tweenEasing=this._currentFrame.displayIndex<0||h.displayIndex<0||!this._animationState.tweenEnabled?0/0:isNaN(this._animationState.clip.tweenEasing)?this._currentFrame.tweenEasing:this._animationState.clip.tweenEasing,isNaN(this._tweenEasing)?(this._tweenTransform=!1,this._tweenColor=!1):(this._durationTransform.x=h.transform.x-this._currentFrame.transform.x,this._durationTransform.y=h.transform.y-this._currentFrame.transform.y,this._durationTransform.skewX=h.transform.skewX-this._currentFrame.transform.skewX,this._durationTransform.skewY=h.transform.skewY-this._currentFrame.transform.skewY,this._durationTransform.scaleX=h.transform.scaleX-this._currentFrame.transform.scaleX,this._durationTransform.scaleY=h.transform.scaleY-this._currentFrame.transform.scaleY,0==d&&(this._durationTransform.skewX=g.TransformUtil.formatRadian(this._durationTransform.skewX),this._durationTransform.skewY=g.TransformUtil.formatRadian(this._durationTransform.skewY)),this._durationPivot.x=h.pivot.x-this._currentFrame.pivot.x,this._durationPivot.y=h.pivot.y-this._currentFrame.pivot.y,this._tweenTransform=0!=this._durationTransform.x||0!=this._durationTransform.y||0!=this._durationTransform.skewX||0!=this._durationTransform.skewY||0!=this._durationTransform.scaleX||0!=this._durationTransform.scaleY||0!=this._durationPivot.x||0!=this._durationPivot.y?!0:!1,this._currentFrame.color&&h.color?(this._durationColor.alphaOffset=h.color.alphaOffset-this._currentFrame.color.alphaOffset,this._durationColor.redOffset=h.color.redOffset-this._currentFrame.color.redOffset,this._durationColor.greenOffset=h.color.greenOffset-this._currentFrame.color.greenOffset,this._durationColor.blueOffset=h.color.blueOffset-this._currentFrame.color.blueOffset,this._durationColor.alphaMultiplier=h.color.alphaMultiplier-this._currentFrame.color.alphaMultiplier,this._durationColor.redMultiplier=h.color.redMultiplier-this._currentFrame.color.redMultiplier,this._durationColor.greenMultiplier=h.color.greenMultiplier-this._currentFrame.color.greenMultiplier,this._durationColor.blueMultiplier=h.color.blueMultiplier-this._currentFrame.color.blueMultiplier,this._tweenColor=0!=this._durationColor.alphaOffset||0!=this._durationColor.redOffset||0!=this._durationColor.greenOffset||0!=this._durationColor.blueOffset||0!=this._durationColor.alphaMultiplier||0!=this._durationColor.redMultiplier||0!=this._durationColor.greenMultiplier||0!=this._durationColor.blueMultiplier?!0:!1):this._currentFrame.color?(this._tweenColor=!0,this._durationColor.alphaOffset=-this._currentFrame.color.alphaOffset,this._durationColor.redOffset=-this._currentFrame.color.redOffset,this._durationColor.greenOffset=-this._currentFrame.color.greenOffset,this._durationColor.blueOffset=-this._currentFrame.color.blueOffset,this._durationColor.alphaMultiplier=1-this._currentFrame.color.alphaMultiplier,this._durationColor.redMultiplier=1-this._currentFrame.color.redMultiplier,this._durationColor.greenMultiplier=1-this._currentFrame.color.greenMultiplier,this._durationColor.blueMultiplier=1-this._currentFrame.color.blueMultiplier):h.color?(this._tweenColor=!0,this._durationColor.alphaOffset=h.color.alphaOffset,this._durationColor.redOffset=h.color.redOffset,this._durationColor.greenOffset=h.color.greenOffset,this._durationColor.blueOffset=h.color.blueOffset,this._durationColor.alphaMultiplier=h.color.alphaMultiplier-1,this._durationColor.redMultiplier=h.color.redMultiplier-1,this._durationColor.greenMultiplier=h.color.greenMultiplier-1,this._durationColor.blueMultiplier=h.color.blueMultiplier-1):this._tweenColor=!1),this._tweenTransform||(this._animationState.blend?(this.transform.x=this._originTransform.x+this._currentFrame.transform.x,this.transform.y=this._originTransform.y+this._currentFrame.transform.y,this.transform.skewX=this._originTransform.skewX+this._currentFrame.transform.skewX,this.transform.skewY=this._originTransform.skewY+this._currentFrame.transform.skewY,this.transform.scaleX=this._originTransform.scaleX+this._currentFrame.transform.scaleX,this.transform.scaleY=this._originTransform.scaleY+this._currentFrame.transform.scaleY,this.pivot.x=this._originPivot.x+this._currentFrame.pivot.x,this.pivot.y=this._originPivot.y+this._currentFrame.pivot.y):(this.transform.x=this._currentFrame.transform.x,this.transform.y=this._currentFrame.transform.y,this.transform.skewX=this._currentFrame.transform.skewX,this.transform.skewY=this._currentFrame.transform.skewY,this.transform.scaleX=this._currentFrame.transform.scaleX,this.transform.scaleY=this._currentFrame.transform.scaleY,this.pivot.x=this._currentFrame.pivot.x,this.pivot.y=this._currentFrame.pivot.y)),this._bone._arriveAtFrame(this._currentFrame,this,this._animationState,!1),this._tweenColor||(this._currentFrame.color?this._bone._updateColor(this._currentFrame.color.alphaOffset,this._currentFrame.color.redOffset,this._currentFrame.color.greenOffset,this._currentFrame.color.blueOffset,this._currentFrame.color.alphaMultiplier,this._currentFrame.color.redMultiplier,this._currentFrame.color.greenMultiplier,this._currentFrame.color.blueMultiplier,!0):this._bone._isColorChanged&&this._bone._updateColor(0,0,0,0,1,1,1,1,!1))}if((this._tweenTransform||this._tweenColor)&&(b=(e-this._currentFramePosition)/this._currentFrameDuration,this._tweenEasing&&(b=a.getEaseValue(b,this._tweenEasing))),this._tweenTransform){var i=this._currentFrame.transform,j=this._currentFrame.pivot;this._animationState.blend?(this.transform.x=this._originTransform.x+i.x+this._durationTransform.x*b,this.transform.y=this._originTransform.y+i.y+this._durationTransform.y*b,this.transform.skewX=this._originTransform.skewX+i.skewX+this._durationTransform.skewX*b,this.transform.skewY=this._originTransform.skewY+i.skewY+this._durationTransform.skewY*b,this.transform.scaleX=this._originTransform.scaleX+i.scaleX+this._durationTransform.scaleX*b,this.transform.scaleY=this._originTransform.scaleY+i.scaleY+this._durationTransform.scaleY*b,this.pivot.x=this._originPivot.x+j.x+this._durationPivot.x*b,this.pivot.y=this._originPivot.y+j.y+this._durationPivot.y*b):(this.transform.x=i.x+this._durationTransform.x*b,this.transform.y=i.y+this._durationTransform.y*b,this.transform.skewX=i.skewX+this._durationTransform.skewX*b,this.transform.skewY=i.skewY+this._durationTransform.skewY*b,this.transform.scaleX=i.scaleX+this._durationTransform.scaleX*b,this.transform.scaleY=i.scaleY+this._durationTransform.scaleY*b,this.pivot.x=j.x+this._durationPivot.x*b,this.pivot.y=j.y+this._durationPivot.y*b)}this._tweenColor&&(this._currentFrame.color?this._bone._updateColor(this._currentFrame.color.alphaOffset+this._durationColor.alphaOffset*b,this._currentFrame.color.redOffset+this._durationColor.redOffset*b,this._currentFrame.color.greenOffset+this._durationColor.greenOffset*b,this._currentFrame.color.blueOffset+this._durationColor.blueOffset*b,this._currentFrame.color.alphaMultiplier+this._durationColor.alphaMultiplier*b,this._currentFrame.color.redMultiplier+this._durationColor.redMultiplier*b,this._currentFrame.color.greenMultiplier+this._durationColor.greenMultiplier*b,this._currentFrame.color.blueMultiplier+this._durationColor.blueMultiplier*b,!0):this._bone._updateColor(this._durationColor.alphaOffset*b,this._durationColor.redOffset*b,this._durationColor.greenOffset*b,this._durationColor.blueOffset*b,1+this._durationColor.alphaMultiplier*b,1+this._durationColor.redMultiplier*b,1+this._durationColor.greenMultiplier*b,1+this._durationColor.blueMultiplier*b,!0))}else this._updateState=0,this._animationState.blend?(this.transform.copy(this._originTransform),this.pivot.x=this._originPivot.x,this.pivot.y=this._originPivot.y):(this.transform.x=this.transform.y=this.transform.skewX=this.transform.skewY=this.transform.scaleX=this.transform.scaleY=0,this.pivot.x=0,this.pivot.y=0),this._currentFrame=this._timeline.getFrameList()[0],this.tweenActive=this._currentFrame.displayIndex>=0,this._bone._arriveAtFrame(this._currentFrame,this,this._animationState,!1),this._currentFrame.color?this._bone._updateColor(this._currentFrame.color.alphaOffset,this._currentFrame.color.redOffset,this._currentFrame.color.greenOffset,this._currentFrame.color.blueOffset,this._currentFrame.color.alphaMultiplier,this._currentFrame.color.redMultiplier,this._currentFrame.color.greenMultiplier,this._currentFrame.color.blueMultiplier,!0):this._bone._isColorChanged&&this._bone._updateColor(0,0,0,0,1,1,1,1,!1)},a.prototype.clear=function(){this._updateState=0,this._bone=null,this._animationState=null,this._timeline=null,this._currentFrame=null,this._originTransform=null,this._originPivot=null},a.HALF_PI=.5*Math.PI,a._pool=[],a}();a.TimelineState=c;var e=function(){function a(){this.loop=0,this.layer=0,this._timelineStates={}}return a._borrowObject=function(){return 0==a._pool.length?new a:a._pool.pop()},a._returnObject=function(b){a._pool.indexOf(b)<0&&(a._pool[a._pool.length]=b),b.clear()},a._clear=function(){for(var b=a._pool.length;b--;)a._pool[b].clear();a._pool.length=0},a.prototype.fadeIn=function(a,b,c,d,e,f,g,h){this.layer=f,this.clip=b,this.name=this.clip.name,this.totalTime=this.clip.duration,this._armature=a,Math.round(this.clip.duration*this.clip.frameRate)<2||d==1/0?(this.timeScale=1,this.currentTime=this.totalTime,this.loop=this.loop>=0?1:-1):(this.timeScale=d,this.currentTime=0,this.loop=e),this._pauseBeforeFadeInComplete=h,this._fadeInTime=c*this.timeScale,this._fadeState=1,this._fadeOutBeginTime=0,this._fadeOutWeight=-1,this._fadeWeight=0,this._fadeIn=!0,this._fadeOut=!1,this.loopCount=-1,this.displayControl=g,this.isPlaying=!0,this.isComplete=!1,this.weight=1,this.blend=!0,this.enabled=!0,this.tweenEnabled=!0,this.updateTimelineStates()},a.prototype.fadeOut=function(a,b){if("undefined"==typeof b&&(b=!1),this._armature&&!(this._fadeOutWeight>=0)){this._fadeState=-1,this._fadeOutWeight=this._fadeWeight,this._fadeOutTime=a*this.timeScale,this._fadeOutBeginTime=this.currentTime,this._fadeOut=!0,this.isPlaying=!b,this.displayControl=!1;for(var c in this._timelineStates)this._timelineStates[c].fadeOut();this.enabled=!0}},a.prototype.play=function(){this.isPlaying=!0},a.prototype.stop=function(){this.isPlaying=!1},a.prototype.getMixingTransform=function(a){return this._mixingTransforms?Number(this._mixingTransforms[a]):-1},a.prototype.addMixingTransform=function(a,b,c){if("undefined"==typeof b&&(b=2),"undefined"==typeof c&&(c=!0),!this.clip||!this.clip.getTimeline(a))throw new Error;if(this._mixingTransforms||(this._mixingTransforms={}),c)for(var d,e,f=this._armature._boneList.length;f--;)d=this._armature._boneList[f],d.name==a&&(e=d),e&&(e==d||e.contains(d))&&(this._mixingTransforms[d.name]=b);else this._mixingTransforms[a]=b;this.updateTimelineStates()},a.prototype.removeMixingTransform=function(a,b){if("undefined"==typeof a&&(a=null),"undefined"==typeof b&&(b=!0),a){if(b)for(var c,d,e=this._armature._boneList.length;e--;)c=this._armature._boneList[e],c.name==a&&(d=c),d&&(d==c||d.contains(c))&&delete this._mixingTransforms[c.name];else delete this._mixingTransforms[a];for(var f in this._mixingTransforms){var g=!0;break}g||(this._mixingTransforms=null)}else this._mixingTransforms=null;this.updateTimelineStates()},a.prototype.advanceTime=function(a){if(!this.enabled)return!1;var b,c;if(this._fadeIn&&(this._fadeIn=!1,this._armature.hasEventListener(d.AnimationEvent.FADE_IN)&&(b=new d.AnimationEvent(d.AnimationEvent.FADE_IN),b.animationState=this,this._armature._eventList.push(b))),this._fadeOut&&(this._fadeOut=!1,this._armature.hasEventListener(d.AnimationEvent.FADE_OUT)&&(b=new d.AnimationEvent(d.AnimationEvent.FADE_OUT),b.animationState=this,this._armature._eventList.push(b))),this.currentTime+=a*this.timeScale,this.isPlaying&&!this.isComplete){var e,f;this._pauseBeforeFadeInComplete?(this._pauseBeforeFadeInComplete=!1,this.isPlaying=!1,e=0,f=Math.floor(e)):(e=this.currentTime/this.totalTime,f=Math.floor(e),f!=this.loopCount&&(-1==this.loopCount&&this._armature.hasEventListener(d.AnimationEvent.START)&&(b=new d.AnimationEvent(d.AnimationEvent.START),b.animationState=this,this._armature._eventList.push(b)),this.loopCount=f,this.loopCount&&(this.loop&&this.loopCount*this.loopCount>=this.loop*this.loop-1?(c=!0,e=1,f=0,this._armature.hasEventListener(d.AnimationEvent.COMPLETE)&&(b=new d.AnimationEvent(d.AnimationEvent.COMPLETE),b.animationState=this,this._armature._eventList.push(b))):this._armature.hasEventListener(d.AnimationEvent.LOOP_COMPLETE)&&(b=new d.AnimationEvent(d.AnimationEvent.LOOP_COMPLETE),b.animationState=this,this._armature._eventList.push(b)))));for(var g in this._timelineStates)this._timelineStates[g].update(e);var h=this.clip.getFrameList();if(h.length>0){for(var i,j=this.totalTime*(e-f),k=!1;!this._currentFrame||j>this._currentFrame.position+this._currentFrame.duration||j<this._currentFrame.position;)k&&this._armature._arriveAtFrame(this._currentFrame,null,this,!0),k=!0,this._currentFrame?(i=h.indexOf(this._currentFrame),i++,i>=h.length&&(i=0),this._currentFrame=h[i]):this._currentFrame=h[0];k&&this._armature._arriveAtFrame(this._currentFrame,null,this,!1)}}if(this._fadeState>0)0==this._fadeInTime?(this._fadeWeight=1,this._fadeState=0,this.isPlaying=!0,this._armature.hasEventListener(d.AnimationEvent.FADE_IN_COMPLETE)&&(b=new d.AnimationEvent(d.AnimationEvent.FADE_IN_COMPLETE),b.animationState=this,this._armature._eventList.push(b))):(this._fadeWeight=this.currentTime/this._fadeInTime,this._fadeWeight>=1&&(this._fadeWeight=1,this._fadeState=0,this.isPlaying||(this.currentTime-=this._fadeInTime),this.isPlaying=!0,this._armature.hasEventListener(d.AnimationEvent.FADE_IN_COMPLETE)&&(b=new d.AnimationEvent(d.AnimationEvent.FADE_IN_COMPLETE),b.animationState=this,this._armature._eventList.push(b))));else if(this._fadeState<0){if(0==this._fadeOutTime)return this._fadeWeight=0,this._fadeState=0,this._armature.hasEventListener(d.AnimationEvent.FADE_OUT_COMPLETE)&&(b=new d.AnimationEvent(d.AnimationEvent.FADE_OUT_COMPLETE),b.animationState=this,this._armature._eventList.push(b)),!0;if(this._fadeWeight=(1-(this.currentTime-this._fadeOutBeginTime)/this._fadeOutTime)*this._fadeOutWeight,this._fadeWeight<=0)return this._fadeWeight=0,this._fadeState=0,this._armature.hasEventListener(d.AnimationEvent.FADE_OUT_COMPLETE)&&(b=new d.AnimationEvent(d.AnimationEvent.FADE_OUT_COMPLETE),b.animationState=this,this._armature._eventList.push(b)),!0}return c&&(this.isComplete=!0,this.loop<0&&this.fadeOut((this._fadeOutWeight||this._fadeInTime)/this.timeScale,!0)),!1},a.prototype.updateTimelineStates=function(){if(this._mixingTransforms){for(var a in this._timelineStates)null==this._mixingTransforms[a]&&this.removeTimelineState(a);for(a in this._mixingTransforms)this._timelineStates[a]||this.addTimelineState(a)}else for(a in this.clip.getTimelines())this._timelineStates[a]||this.addTimelineState(a)},a.prototype.addTimelineState=function(a){var b=this._armature.getBone(a);if(b){var d=c._borrowObject(),e=this.clip.getTimeline(a);d.fadeIn(b,this,e),this._timelineStates[a]=d}},a.prototype.removeTimelineState=function(a){c._returnObject(this._timelineStates[a]),delete this._timelineStates[a]},a.prototype.clear=function(){this.clip=null,this.enabled=!1,this._armature=null,this._currentFrame=null,this._mixingTransforms=null;for(var a in this._timelineStates)this.removeTimelineState(a)},a._pool=[],a}();a.AnimationState=e;var h=function(){function a(a){this._armature=a,this._animationLayer=[],this._isPlaying=!1,this.animationNameList=[],this.tweenEnabled=!0,this.timeScale=1}return a.prototype.getLastAnimationName=function(){return this._lastAnimationState?this._lastAnimationState.name:null},a.prototype.getLastAnimationState=function(){return this._lastAnimationState},a.prototype.getAnimationDataList=function(){return this._animationDataList},a.prototype.setAnimationDataList=function(a){this._animationDataList=a,this.animationNameList.length=0;for(var b in this._animationDataList)this.animationNameList[this.animationNameList.length]=this._animationDataList[b].name},a.prototype.getIsPlaying=function(){return this._isPlaying&&!this.getIsComplete()},a.prototype.getIsComplete=function(){if(this._lastAnimationState){if(!this._lastAnimationState.isComplete)return!1;for(var a=this._animationLayer.length;a--;)for(var b=this._animationLayer[a],c=b.length;c--;)if(!b[c].isComplete)return!1;return!0}return!1},a.prototype.dispose=function(){if(this._armature){this.stop();for(var a=this._animationLayer.length;a--;){for(var b=this._animationLayer[a],c=b.length;c--;)e._returnObject(b[c]);b.length=0}this._animationLayer.length=0,this.animationNameList.length=0,this._armature=null,this._animationLayer=null,this._animationDataList=null,this.animationNameList=null}},a.prototype.gotoAndPlay=function(b,c,d,f,g,h,i,j,k,l){if("undefined"==typeof c&&(c=-1),"undefined"==typeof d&&(d=-1),"undefined"==typeof f&&(f=0/0),"undefined"==typeof g&&(g=0),"undefined"==typeof h&&(h=null),"undefined"==typeof i&&(i=a.SAME_LAYER_AND_GROUP),"undefined"==typeof j&&(j=!0),"undefined"==typeof k&&(k=!0),"undefined"==typeof l&&(l=!0),!this._animationDataList)return null;for(var m,n=this._animationDataList.length;n--;)if(this._animationDataList[n].name==b){m=this._animationDataList[n];break}if(!m)return null;this._isPlaying=!0,c=0>c?m.fadeInTime<0?.3:m.fadeInTime:c;var o;o=0>d?m.scale<0?1:m.scale:d/m.duration,f=isNaN(f)?m.loop:f,g=this.addLayer(g);var p,q;switch(i){case a.NONE:break;case a.SAME_LAYER:for(q=this._animationLayer[g],n=q.length;n--;)p=q[n],p.fadeOut(c,k);break;case a.SAME_GROUP:for(r=this._animationLayer.length;r--;)for(q=this._animationLayer[r],n=q.length;n--;)p=q[n],p.group==h&&p.fadeOut(c,k);break;case a.ALL:for(var r=this._animationLayer.length;r--;)for(q=this._animationLayer[r],n=q.length;n--;)p=q[n],p.fadeOut(c,k);break;case a.SAME_LAYER_AND_GROUP:default:for(q=this._animationLayer[g],n=q.length;n--;)p=q[n],p.group==h&&p.fadeOut(c,k)}this._lastAnimationState=e._borrowObject(),this._lastAnimationState.group=h,this._lastAnimationState.tweenEnabled=this.tweenEnabled,this._lastAnimationState.fadeIn(this._armature,m,c,1/o,f,g,j,l),this.addState(this._lastAnimationState);var s,t,u=this._armature._slotList;for(n=u.length;n--;)s=u[n],t=s.getChildArmature(),t&&t.animation.gotoAndPlay(b,c);return this._lastAnimationState},a.prototype.play=function(){this._animationDataList&&0!=this._animationDataList.length&&(this._lastAnimationState?this._isPlaying?this.gotoAndPlay(this._lastAnimationState.name):this._isPlaying=!0:this.gotoAndPlay(this._animationDataList[0].name))},a.prototype.stop=function(){this._isPlaying=!1},a.prototype.getState=function(a,b){"undefined"==typeof b&&(b=0);var c=this._animationLayer.length;if(0==c)return null;b>=c&&(b=c-1);var d=this._animationLayer[b];if(!d)return null;for(var e=d.length;e--;)if(d[e].name==a)return d[e];return null},a.prototype.hasAnimation=function(a){for(var b=this._animationDataList.length;b--;)if(this._animationDataList[b].name==a)return!0;return!1},a.prototype.advanceTime=function(a){if(this._isPlaying){a*=this.timeScale;var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=this._armature._boneList.length,x=w;for(w--;x--;){for(e=this._armature._boneList[x],f=e.name,g=1,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,b=this._animationLayer.length;b--;){for(p=0,q=this._animationLayer[b],d=q.length,c=0;d>c;c++)r=q[c],x==w&&r.advanceTime(a)?(this.removeState(r),c--,d--):(s=r._timelineStates[f],s&&s.tweenActive&&(t=r._fadeWeight*r.weight*g,u=s.transform,v=s.pivot,h+=u.x*t,i+=u.y*t,j+=u.skewX*t,k+=u.skewY*t,l+=u.scaleX*t,m+=u.scaleY*t,n+=v.x*t,o+=v.y*t,p+=t));if(p>=g)break;g-=p}u=e.tween,v=e._tweenPivot,u.x=h,u.y=i,u.skewX=j,u.skewY=k,u.scaleX=l,u.scaleY=m,v.x=n,v.y=o}}},a.prototype.addLayer=function(a){return a>=this._animationLayer.length&&(a=this._animationLayer.length,this._animationLayer[a]=[]),a},a.prototype.addState=function(a){var b=this._animationLayer[a.layer];b.push(a)},a.prototype.removeState=function(a){var b=a.layer,c=this._animationLayer[b];c.splice(c.indexOf(a),1),e._returnObject(a),0==c.length&&b==this._animationLayer.length-1&&this._animationLayer.length--},a.NONE="none",a.SAME_LAYER="sameLayer",a.SAME_GROUP="sameGroup",a.SAME_LAYER_AND_GROUP="sameLayerAndGroup",a.ALL="all",a}();a.Animation=h}(a.animation||(a.animation={}));var e=a.animation;!function(a){var d=function(){function a(){this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.scaleX=1,this.scaleY=1}return a.prototype.getRotation=function(){return this.skewX},a.prototype.setRotation=function(a){this.skewX=this.skewY=a},a.prototype.copy=function(a){this.x=a.x,this.y=a.y,this.skewX=a.skewX,this.skewY=a.skewY,this.scaleX=a.scaleX,this.scaleY=a.scaleY},a.prototype.toString=function(){return"[DBTransform (x="+this.x+" y="+this.y+" skewX="+this.skewX+" skewY="+this.skewY+" scaleX="+this.scaleX+" scaleY="+this.scaleY+")]"},a}();a.DBTransform=d;var e=function(){function a(){this.position=0,this.duration=0}return a.prototype.dispose=function(){},a}();a.Frame=e;var f=function(a){function c(){a.call(this),this.tweenEasing=0,this.tweenRotate=0,this.displayIndex=0,this.zOrder=0/0,this.visible=!0,this.global=new d,this.transform=new d,this.pivot=new b.Point}return na(c,a),c.prototype.dispose=function(){a.prototype.dispose.call(this),this.global=null,this.transform=null,this.pivot=null,this.color=null},c}(e);a.TransformFrame=f;var h=function(){function a(){this._frameList=[],this.duration=0,this.scale=1}return a.prototype.getFrameList=function(){return this._frameList},a.prototype.dispose=function(){for(var a=this._frameList.length;a--;)this._frameList[a].dispose();this._frameList.length=0,this._frameList=null},a.prototype.addFrame=function(a){if(!a)throw new Error;if(!(this._frameList.indexOf(a)<0))throw new Error;this._frameList[this._frameList.length]=a},a}();a.Timeline=h;var i=function(a){function c(){a.call(this),this.originTransform=new d,this.originPivot=new b.Point,this.offset=0,this.transformed=!1}return na(c,a),c.prototype.dispose=function(){this!=c.HIDE_TIMELINE&&(a.prototype.dispose.call(this),this.originTransform=null,this.originPivot=null)},c.HIDE_TIMELINE=new c,c}(h);a.TransformTimeline=i;var j=function(a){function b(){a.call(this),this.frameRate=0,this.loop=0,this.tweenEasing=0/0,this.fadeInTime=0,this._timelines={}}return na(b,a),b.prototype.getTimelines=function(){return this._timelines},b.prototype.dispose=function(){a.prototype.dispose.call(this);for(var b in this._timelines)this._timelines[b].dispose();this._timelines=null},b.prototype.getTimeline=function(a){return this._timelines[a]},b.prototype.addTimeline=function(a,b){if(!a)throw new Error;this._timelines[b]=a},b}(h);a.AnimationData=j;var k=function(){function a(){this.transform=new d}return a.prototype.dispose=function(){this.transform=null,this.pivot=null},a.ARMATURE="armature",a.IMAGE="image",a}();a.DisplayData=k;var l=function(){function a(){this._displayDataList=[],this.zOrder=0}return a.prototype.getDisplayDataList=function(){return this._displayDataList},a.prototype.dispose=function(){for(var a=this._displayDataList.length;a--;)this._displayDataList[a].dispose();this._displayDataList.length=0,this._displayDataList=null},a.prototype.addDisplayData=function(a){if(!a)throw new Error;if(!(this._displayDataList.indexOf(a)<0))throw new Error;this._displayDataList[this._displayDataList.length]=a},a.prototype.getDisplayData=function(a){for(var b=this._displayDataList.length;b--;)if(this._displayDataList[b].name==a)return this._displayDataList[b];return null},a}();a.SlotData=l;var m=function(){function a(){this.length=0,this.global=new d,this.transform=new d}return a.prototype.dispose=function(){this.global=null,this.transform=null},a}();a.BoneData=m;var n=function(){function a(){this._slotDataList=[]}return a.prototype.getSlotDataList=function(){return this._slotDataList},a.prototype.dispose=function(){for(var a=this._slotDataList.length;a--;)this._slotDataList[a].dispose();this._slotDataList.length=0,this._slotDataList=null},a.prototype.getSlotData=function(a){for(var b=this._slotDataList.length;b--;)if(this._slotDataList[b].name==a)return this._slotDataList[b];return null},a.prototype.addSlotData=function(a){if(!a)throw new Error;if(!(this._slotDataList.indexOf(a)<0))throw new Error;this._slotDataList[this._slotDataList.length]=a},a}();a.SkinData=n;var o=function(){function a(){this._boneDataList=[],this._skinDataList=[],this._animationDataList=[]}return a.prototype.getBoneDataList=function(){return this._boneDataList},a.prototype.getSkinDataList=function(){return this._skinDataList},a.prototype.getAnimationDataList=function(){return this._animationDataList},a.prototype.dispose=function(){for(var a=this._boneDataList.length;a--;)this._boneDataList[a].dispose();for(a=this._skinDataList.length;a--;)this._skinDataList[a].dispose();for(a=this._animationDataList.length;a--;)this._animationDataList[a].dispose();this._boneDataList.length=0,this._skinDataList.length=0,this._animationDataList.length=0,this._boneDataList=null,this._skinDataList=null,this._animationDataList=null},a.prototype.getBoneData=function(a){for(var b=this._boneDataList.length;b--;)if(this._boneDataList[b].name==a)return this._boneDataList[b];return null},a.prototype.getSkinData=function(a){if(!a)return this._skinDataList[0];for(var b=this._skinDataList.length;b--;)if(this._skinDataList[b].name==a)return this._skinDataList[b];return null},a.prototype.getAnimationData=function(a){for(var b=this._animationDataList.length;b--;)if(this._animationDataList[b].name==a)return this._animationDataList[b];return null},a.prototype.addBoneData=function(a){if(!a)throw new Error;if(!(this._boneDataList.indexOf(a)<0))throw new Error;this._boneDataList[this._boneDataList.length]=a},a.prototype.addSkinData=function(a){if(!a)throw new Error;if(!(this._skinDataList.indexOf(a)<0))throw new Error;this._skinDataList[this._skinDataList.length]=a},a.prototype.addAnimationData=function(a){if(!a)throw new Error;this._animationDataList.indexOf(a)<0&&(this._animationDataList[this._animationDataList.length]=a)},a.prototype.sortBoneDataList=function(){var a=this._boneDataList.length;if(0!=a){for(var b=[];a--;){for(var c=this._boneDataList[a],d=0,e=c;e&&e.parent;)d++,e=this.getBoneData(e.parent);b[a]={level:d,boneData:c}}for(b.sort(this.sortBoneData),a=b.length;a--;)this._boneDataList[a]=b[a].boneData}},a.prototype.sortBoneData=function(a,b){return a.level>b.level?1:-1},a}();a.ArmatureData=o;var p=function(){function a(){this._armatureDataList=[],this._subTexturePivots={}}return a.prototype.getArmatureNames=function(){var a=[];for(var b in this._armatureDataList)a[a.length]=this._armatureDataList[b].name;return a},a.prototype.getArmatureDataList=function(){return this._armatureDataList},a.prototype.dispose=function(){for(var a in this._armatureDataList)this._armatureDataList[a].dispose();this._armatureDataList.length=0,this._armatureDataList=null,this._subTexturePivots=null},a.prototype.getArmatureData=function(a){for(var b=this._armatureDataList.length;b--;)if(this._armatureDataList[b].name==a)return this._armatureDataList[b];return null},a.prototype.addArmatureData=function(a){if(!a)throw new Error;if(!(this._armatureDataList.indexOf(a)<0))throw new Error;this._armatureDataList[this._armatureDataList.length]=a},a.prototype.removeArmatureData=function(a){
var b=this._armatureDataList.indexOf(a);b>=0&&this._armatureDataList.splice(b,1)},a.prototype.removeArmatureDataByName=function(a){for(var b=this._armatureDataList.length;b--;)this._armatureDataList[b].name==a&&this._armatureDataList.splice(b,1)},a.prototype.getSubTexturePivot=function(a){return this._subTexturePivots[a]},a.prototype.addSubTexturePivot=function(a,c,d){var e=this._subTexturePivots[d];return e?(e.x=a,e.y=c):this._subTexturePivots[d]=e=new b.Point(a,c),e},a.prototype.removeSubTexturePivot=function(a){if(a)delete this._subTexturePivots[a];else for(a in this._subTexturePivots)delete this._subTexturePivots[a]},a}();a.SkeletonData=p;var q=function(){function a(){}return a.parseTextureAtlasData=function(a,c){if("undefined"==typeof c&&(c=1),!a)throw new Error;var d={};d.__name=a[g.ConstValues.A_NAME];var e=a[g.ConstValues.SUB_TEXTURE];for(var f in e){var h=e[f],i=h[g.ConstValues.A_NAME],j=new b.Rectangle(Number(h[g.ConstValues.A_X])/c,Number(h[g.ConstValues.A_Y])/c,Number(h[g.ConstValues.A_WIDTH])/c,Number(h[g.ConstValues.A_HEIGHT])/c);d[i]=j}return d},a.parseSkeletonData=function(b){if(!b)throw new Error;var c=Number(b[g.ConstValues.A_FRAME_RATE]),d=new p;d.name=b[g.ConstValues.A_NAME];var e=b[g.ConstValues.ARMATURE];for(var f in e){var h=e[f];d.addArmatureData(a.parseArmatureData(h,d,c))}return d},a.parseArmatureData=function(b,c,d){var e=new o;e.name=b[g.ConstValues.A_NAME];var f=b[g.ConstValues.BONE];for(var h in f){var i=f[h];e.addBoneData(a.parseBoneData(i))}var j=b[g.ConstValues.SKIN];for(var h in j){var k=j[h];e.addSkinData(a.parseSkinData(k,c))}g.DBDataUtil.transformArmatureData(e),e.sortBoneDataList();var l=b[g.ConstValues.ANIMATION];for(var h in l){var m=l[h];e.addAnimationData(a.parseAnimationData(m,e,d))}return e},a.parseBoneData=function(b){var c=new m;return c.name=b[g.ConstValues.A_NAME],c.parent=b[g.ConstValues.A_PARENT],c.length=Number(b[g.ConstValues.A_LENGTH])||0,a.parseTransform(b[g.ConstValues.TRANSFORM],c.global),c.transform.copy(c.global),c},a.parseSkinData=function(b,c){var d=new n;d.name=b[g.ConstValues.A_NAME];var e=b[g.ConstValues.SLOT];for(var f in e){var h=e[f];d.addSlotData(a.parseSlotData(h,c))}return d},a.parseSlotData=function(b,c){var d=new l;d.name=b[g.ConstValues.A_NAME],d.parent=b[g.ConstValues.A_PARENT],d.zOrder=Number(b[g.ConstValues.A_Z_ORDER]);var e=b[g.ConstValues.DISPLAY];for(var f in e){var h=e[f];d.addDisplayData(a.parseDisplayData(h,c))}return d},a.parseDisplayData=function(b,c){var d=new k;return d.name=b[g.ConstValues.A_NAME],d.type=b[g.ConstValues.A_TYPE],d.pivot=c.addSubTexturePivot(0,0,d.name),a.parseTransform(b[g.ConstValues.TRANSFORM],d.transform,d.pivot),d},a.parseAnimationData=function(b,d,e){var f=new j;if(f.name=b[g.ConstValues.A_NAME],f.frameRate=e,f.loop=Number(b[g.ConstValues.A_LOOP])||0,f.fadeInTime=Number(b[g.ConstValues.A_FADE_IN_TIME]),f.duration=Number(b[g.ConstValues.A_DURATION])/e,f.scale=Number(b[g.ConstValues.A_SCALE]),b.hasOwnProperty(g.ConstValues.A_TWEEN_EASING)){var h=b[g.ConstValues.A_TWEEN_EASING];f.tweenEasing=h==c||null==h?0/0:Number(h)}else f.tweenEasing=0/0;a.parseTimeline(b,f,a.parseMainFrame,e);var i,k,l=b[g.ConstValues.TIMELINE];for(var m in l){var n=l[m];i=a.parseTransformTimeline(n,f.duration,e),k=n[g.ConstValues.A_NAME],f.addTimeline(i,k)}return g.DBDataUtil.addHideTimeline(f,d),g.DBDataUtil.transformAnimationData(f,d),f},a.parseTimeline=function(a,b,c,d){var e,f=0,h=a[g.ConstValues.FRAME];for(var i in h){var j=h[i];e=c(j,d),e.position=f,b.addFrame(e),f+=e.duration}e&&(e.duration=b.duration-e.position)},a.parseTransformTimeline=function(b,c,d){var e=new i;return e.duration=c,a.parseTimeline(b,e,a.parseTransformFrame,d),e.scale=Number(b[g.ConstValues.A_SCALE]),e.offset=Number(b[g.ConstValues.A_OFFSET]),e},a.parseFrame=function(a,b,c){b.duration=Number(a[g.ConstValues.A_DURATION])/c,b.action=a[g.ConstValues.A_ACTION],b.event=a[g.ConstValues.A_EVENT],b.sound=a[g.ConstValues.A_SOUND]},a.parseMainFrame=function(b,c){var d=new e;return a.parseFrame(b,d,c),d},a.parseTransformFrame=function(d,e){var h=new f;if(a.parseFrame(d,h,e),h.visible=1!=Number(d[g.ConstValues.A_HIDE]),d.hasOwnProperty(g.ConstValues.A_TWEEN_EASING)){var i=d[g.ConstValues.A_TWEEN_EASING];h.tweenEasing=i==c||null==i?0/0:Number(i)}else h.tweenEasing=0;h.tweenRotate=Number(d[g.ConstValues.A_TWEEN_ROTATE])||0,h.displayIndex=Number(d[g.ConstValues.A_DISPLAY_INDEX])||0,h.zOrder=Number(d[g.ConstValues.A_Z_ORDER])||0,a.parseTransform(d[g.ConstValues.TRANSFORM],h.global,h.pivot),h.transform.copy(h.global);var j=d[g.ConstValues.COLOR_TRANSFORM];return j&&(h.color=new b.ColorTransform,h.color.alphaOffset=Number(j[g.ConstValues.A_ALPHA_OFFSET]),h.color.redOffset=Number(j[g.ConstValues.A_RED_OFFSET]),h.color.greenOffset=Number(j[g.ConstValues.A_GREEN_OFFSET]),h.color.blueOffset=Number(j[g.ConstValues.A_BLUE_OFFSET]),h.color.alphaMultiplier=.01*Number(j[g.ConstValues.A_ALPHA_MULTIPLIER]),h.color.redMultiplier=.01*Number(j[g.ConstValues.A_RED_MULTIPLIER]),h.color.greenMultiplier=.01*Number(j[g.ConstValues.A_GREEN_MULTIPLIER]),h.color.blueMultiplier=.01*Number(j[g.ConstValues.A_BLUE_MULTIPLIER])),h},a.parseTransform=function(a,b,c){"undefined"==typeof c&&(c=null),a&&(b&&(b.x=Number(a[g.ConstValues.A_X]),b.y=Number(a[g.ConstValues.A_Y]),b.skewX=Number(a[g.ConstValues.A_SKEW_X])*g.ConstValues.ANGLE_TO_RADIAN,b.skewY=Number(a[g.ConstValues.A_SKEW_Y])*g.ConstValues.ANGLE_TO_RADIAN,b.scaleX=Number(a[g.ConstValues.A_SCALE_X]),b.scaleY=Number(a[g.ConstValues.A_SCALE_Y])),c&&(c.x=Number(a[g.ConstValues.A_PIVOT_X]),c.y=Number(a[g.ConstValues.A_PIVOT_Y])))},a}();a.DataParser=q}(a.objects||(a.objects={}));var f=a.objects;!function(b){var c=function(b){function c(){b.call(this),this._dataDic={},this._textureAtlasDic={},this._textureAtlasLoadingDic={}}return na(c,b),c.prototype.getSkeletonData=function(a){return this._dataDic[a]},c.prototype.addSkeletonData=function(a,b){if(!a)throw new Error;if(b=b||a.name,!b)throw new Error("Unnamed data!");this._dataDic[b],this._dataDic[b]=a},c.prototype.removeSkeletonData=function(a){delete this._dataDic[a]},c.prototype.getTextureAtlas=function(a){return this._textureAtlasDic[a]},c.prototype.addTextureAtlas=function(a,b){if(!a)throw new Error;if(b=b||a.name,!b)throw new Error("Unnamed data!");this._textureAtlasDic[b],this._textureAtlasDic[b]=a},c.prototype.removeTextureAtlas=function(a){delete this._textureAtlasDic[a]},c.prototype.dispose=function(a){if("undefined"==typeof a&&(a=!0),a){for(var b in this._dataDic)this._dataDic[b].dispose();for(var b in this._textureAtlasDic)this._textureAtlasDic[b].dispose()}this._dataDic=null,this._textureAtlasDic=null,this._textureAtlasLoadingDic=null,this._currentDataName=null,this._currentTextureAtlasName=null},c.prototype.buildArmature=function(b,c,d,e,g){if(d){var h=this._dataDic[d];if(h)var i=h.getArmatureData(b)}else for(d in this._dataDic)if(h=this._dataDic[d],i=h.getArmatureData(b))break;if(!i)return null;this._currentDataName=d,this._currentTextureAtlasName=e||d;var j=this._generateArmature(b);j.name=b;var k,l,m=i.getBoneDataList();for(var n in m)l=m[n],k=new a.Bone,k.name=l.name,k.origin.copy(l.transform),i.getBoneData(l.parent)?j.addChild(k,l.parent):j.addChild(k,null);if(c&&c!=b){var o=h.getArmatureData(c);if(!o)for(d in this._dataDic)if(h=this._dataDic[d],o=h.getArmatureData(c))break}j.animation.setAnimationDataList(o?o.getAnimationDataList():i.getAnimationDataList());var p=i.getSkinData(g);if(!p)throw new Error;var q,r,s,t,u,v,w=[],x=p.getSlotDataList();for(var n in x)if(u=x[n],k=j.getBone(u.parent)){for(v=u.getDisplayDataList(),q=this._generateSlot(),q.name=u.name,q._originZOrder=u.zOrder,q._dislayDataList=v,w.length=0,t=v.length;t--;)switch(r=v[t],r.name=""+r.name,r.type){case f.DisplayData.ARMATURE:s=this.buildArmature(r.name,null,this._currentDataName,this._currentTextureAtlasName,null),s&&(w[t]=s);break;case f.DisplayData.IMAGE:default:w[t]=this._generateDisplay(this._textureAtlasDic[this._currentTextureAtlasName],r.name,r.pivot.x,r.pivot.y)}q.setDisplayList(w),q._changeDisplay(0),k.addChild(q)}return j._slotsZOrderChanged=!0,j.advanceTime(0),j},c.prototype.getTextureDisplay=function(a,b,c,d){if(b)var e=this._textureAtlasDic[b];if(!e&&!b)for(b in this._textureAtlasDic){if(e=this._textureAtlasDic[b],e.getRegion(a))break;e=null}if(e){if(isNaN(c)||isNaN(d)){var f=this._dataDic[b];if(f){var g=f.getSubTexturePivot(a);g&&(c=g.x,d=g.y)}}return this._generateDisplay(e,a,c,d)}return null},c.prototype._generateArmature=function(){return null},c.prototype._generateSlot=function(){return null},c.prototype._generateDisplay=function(){return null},c}(d.EventDispatcher);b.BaseFactory=c}(a.factorys||(a.factorys={}));a.factorys;!function(a){var c=function(){function a(){}return a.ANGLE_TO_RADIAN=Math.PI/180,a.DRAGON_BONES="dragonBones",a.ARMATURE="armature",a.SKIN="skin",a.BONE="bone",a.SLOT="slot",a.DISPLAY="display",a.ANIMATION="animation",a.TIMELINE="timeline",a.FRAME="frame",a.TRANSFORM="transform",a.COLOR_TRANSFORM="colorTransform",a.TEXTURE_ATLAS="TextureAtlas",a.SUB_TEXTURE="SubTexture",a.A_VERSION="version",a.A_IMAGE_PATH="imagePath",a.A_FRAME_RATE="frameRate",a.A_NAME="name",a.A_PARENT="parent",a.A_LENGTH="length",a.A_TYPE="type",a.A_FADE_IN_TIME="fadeInTime",a.A_DURATION="duration",a.A_SCALE="scale",a.A_OFFSET="offset",a.A_LOOP="loop",a.A_EVENT="event",a.A_SOUND="sound",a.A_ACTION="action",a.A_HIDE="hide",a.A_TWEEN_EASING="tweenEasing",a.A_TWEEN_ROTATE="tweenRotate",a.A_DISPLAY_INDEX="displayIndex",a.A_Z_ORDER="z",a.A_WIDTH="width",a.A_HEIGHT="height",a.A_X="x",a.A_Y="y",a.A_SKEW_X="skX",a.A_SKEW_Y="skY",a.A_SCALE_X="scX",a.A_SCALE_Y="scY",a.A_PIVOT_X="pX",a.A_PIVOT_Y="pY",a.A_ALPHA_OFFSET="aO",a.A_RED_OFFSET="rO",a.A_GREEN_OFFSET="gO",a.A_BLUE_OFFSET="bO",a.A_ALPHA_MULTIPLIER="aM",a.A_RED_MULTIPLIER="rM",a.A_GREEN_MULTIPLIER="gM",a.A_BLUE_MULTIPLIER="bM",a}();a.ConstValues=c;var d=function(){function a(){}return a.transformPointWithParent=function(b,c){var d=a._helpMatrix;a.transformToMatrix(c,d),d.invert();var e=b.x,f=b.y;b.x=d.a*e+d.c*f+d.tx,b.y=d.d*f+d.b*e+d.ty,b.skewX=a.formatRadian(b.skewX-c.skewX),b.skewY=a.formatRadian(b.skewY-c.skewY)},a.transformToMatrix=function(a,b){b.a=a.scaleX*Math.cos(a.skewY),b.b=a.scaleX*Math.sin(a.skewY),b.c=-a.scaleY*Math.sin(a.skewX),b.d=a.scaleY*Math.cos(a.skewX),b.tx=a.x,b.ty=a.y},a.formatRadian=function(b){return b%=a.DOUBLE_PI,b>Math.PI&&(b-=a.DOUBLE_PI),b<-Math.PI&&(b+=a.DOUBLE_PI),b},a.DOUBLE_PI=2*Math.PI,a._helpMatrix=new b.Matrix,a}();a.TransformUtil=d;var g=function(){function a(){}return a.transformArmatureData=function(a){for(var b,c,e=a.getBoneDataList(),f=e.length;f--;)b=e[f],b.parent&&(c=a.getBoneData(b.parent),c&&(b.transform.copy(b.global),d.transformPointWithParent(b.transform,c.global)))},a.transformArmatureDataAnimations=function(b){for(var c=b.getAnimationDataList(),d=c.length;d--;)a.transformAnimationData(c[d],b)},a.transformAnimationData=function(b,c){for(var e,f,g,h,i,j,k,l,m,n,o=c.getSkinData(null),p=c.getBoneDataList(),q=o.getSlotDataList(),r=p.length;r--;)if(e=p[r],f=b.getTimeline(e.name)){g=null;for(var s in q)if(g=q[s],g.parent==e.name)break;h=e.parent?b.getTimeline(e.parent):null,i=f.getFrameList(),j=null,k=null,l=null,n=i.length;for(var t=0;n>t;t++){if(m=i[t],h?(a._helpTransform1.copy(m.global),a.getTimelineTransform(h,m.position,a._helpTransform2),d.transformPointWithParent(a._helpTransform1,a._helpTransform2),m.transform.copy(a._helpTransform1)):m.transform.copy(m.global),m.transform.x-=e.transform.x,m.transform.y-=e.transform.y,m.transform.skewX-=e.transform.skewX,m.transform.skewY-=e.transform.skewY,m.transform.scaleX-=e.transform.scaleX,m.transform.scaleY-=e.transform.scaleY,f.transformed||g&&(m.zOrder-=g.zOrder),j||(j=f.originTransform,j.copy(m.transform),j.skewX=d.formatRadian(j.skewX),j.skewY=d.formatRadian(j.skewY),k=f.originPivot,k.x=m.pivot.x,k.y=m.pivot.y),m.transform.x-=j.x,m.transform.y-=j.y,m.transform.skewX=d.formatRadian(m.transform.skewX-j.skewX),m.transform.skewY=d.formatRadian(m.transform.skewY-j.skewY),m.transform.scaleX-=j.scaleX,m.transform.scaleY-=j.scaleY,f.transformed||(m.pivot.x-=k.x,m.pivot.y-=k.y),l){var u=m.transform.skewX-l.transform.skewX;l.tweenRotate?l.tweenRotate>0?(0>u&&(m.transform.skewX+=2*Math.PI,m.transform.skewY+=2*Math.PI),l.tweenRotate>1&&(m.transform.skewX+=2*Math.PI*(l.tweenRotate-1),m.transform.skewY+=2*Math.PI*(l.tweenRotate-1))):(u>0&&(m.transform.skewX-=2*Math.PI,m.transform.skewY-=2*Math.PI),l.tweenRotate<1&&(m.transform.skewX+=2*Math.PI*(l.tweenRotate+1),m.transform.skewY+=2*Math.PI*(l.tweenRotate+1))):(m.transform.skewX=l.transform.skewX+d.formatRadian(m.transform.skewX-l.transform.skewX),m.transform.skewY=l.transform.skewY+d.formatRadian(m.transform.skewY-l.transform.skewY))}l=m}f.transformed=!0}},a.getTimelineTransform=function(a,b,c){for(var f,g,h,i,j=a.getFrameList(),k=j.length;k--;)if(f=j[k],f.position<=b&&f.position+f.duration>b){g=f.tweenEasing,k==j.length-1||isNaN(g)||b==f.position?c.copy(f.global):(h=(b-f.position)/f.duration,g&&(h=e.TimelineState.getEaseValue(h,g)),i=j[k+1],c.x=f.global.x+(i.global.x-f.global.x)*h,c.y=f.global.y+(i.global.y-f.global.y)*h,c.skewX=d.formatRadian(f.global.skewX+(i.global.skewX-f.global.skewX)*h),c.skewY=d.formatRadian(f.global.skewY+(i.global.skewY-f.global.skewY)*h),c.scaleX=f.global.scaleX+(i.global.scaleX-f.global.scaleX)*h,c.scaleY=f.global.scaleY+(i.global.scaleY-f.global.scaleY)*h);break}},a.addHideTimeline=function(a,b){for(var c,d,e=b.getBoneDataList(),g=e.length;g--;)c=e[g],d=c.name,a.getTimeline(d)||a.addTimeline(f.TransformTimeline.HIDE_TIMELINE,d)},a._helpTransform1=new f.DBTransform,a._helpTransform2=new f.DBTransform,a}();a.DBDataUtil=g}(a.utils||(a.utils={}));var g=a.utils,h=function(){function a(){this.global=new f.DBTransform,this.origin=new f.DBTransform,this.offset=new f.DBTransform,this.tween=new f.DBTransform,this.tween.scaleX=this.tween.scaleY=0,this._globalTransformMatrix=new b.Matrix,this._visible=!0,this._isColorChanged=!1,this._isDisplayOnStage=!1,this._scaleType=0,this.fixedRotation=!1}return a.prototype.getVisible=function(){return this._visible},a.prototype.setVisible=function(a){this._visible=a},a.prototype._setParent=function(a){this.parent=a},a.prototype._setArmature=function(a){this.armature&&this.armature._removeDBObject(this),this.armature=a,this.armature&&this.armature._addDBObject(this)},a.prototype.dispose=function(){this.parent=null,this.armature=null,this.global=null,this.origin=null,this.offset=null,this.tween=null,this._globalTransformMatrix=null},a.prototype._update=function(){if(this.global.scaleX=(this.origin.scaleX+this.tween.scaleX)*this.offset.scaleX,this.global.scaleY=(this.origin.scaleY+this.tween.scaleY)*this.offset.scaleY,this.parent){var a=this.origin.x+this.offset.x+this.tween.x,b=this.origin.y+this.offset.y+this.tween.y,c=this.parent._globalTransformMatrix;this._globalTransformMatrix.tx=this.global.x=c.a*a+c.c*b+c.tx,this._globalTransformMatrix.ty=this.global.y=c.d*b+c.b*a+c.ty,this.fixedRotation?(this.global.skewX=this.origin.skewX+this.offset.skewX+this.tween.skewX,this.global.skewY=this.origin.skewY+this.offset.skewY+this.tween.skewY):(this.global.skewX=this.origin.skewX+this.offset.skewX+this.tween.skewX+this.parent.global.skewX,this.global.skewY=this.origin.skewY+this.offset.skewY+this.tween.skewY+this.parent.global.skewY),this.parent.scaleMode>=this._scaleType&&(this.global.scaleX*=this.parent.global.scaleX,this.global.scaleY*=this.parent.global.scaleY)}else this._globalTransformMatrix.tx=this.global.x=this.origin.x+this.offset.x+this.tween.x,this._globalTransformMatrix.ty=this.global.y=this.origin.y+this.offset.y+this.tween.y,this.global.skewX=this.origin.skewX+this.offset.skewX+this.tween.skewX,this.global.skewY=this.origin.skewY+this.offset.skewY+this.tween.skewY;this._globalTransformMatrix.a=this.global.scaleX*Math.cos(this.global.skewY),this._globalTransformMatrix.b=this.global.scaleX*Math.sin(this.global.skewY),this._globalTransformMatrix.c=-this.global.scaleY*Math.sin(this.global.skewX),this._globalTransformMatrix.d=this.global.scaleY*Math.cos(this.global.skewX)},a}();a.DBObject=h;var i=function(a){function b(b){a.call(this),this._displayBridge=b,this._displayList=[],this._displayIndex=-1,this._scaleType=1,this._originZOrder=0,this._tweenZorder=0,this._offsetZOrder=0,this._isDisplayOnStage=!1,this._isHideDisplay=!1}return na(b,a),b.prototype.getZOrder=function(){return this._originZOrder+this._tweenZorder+this._offsetZOrder},b.prototype.setZOrder=function(a){this.getZOrder()!=a&&(this._offsetZOrder=a-this._originZOrder-this._tweenZorder,this.armature&&(this.armature._slotsZOrderChanged=!0))},b.prototype.getDisplay=function(){var a=this._displayList[this._displayIndex];return a instanceof k?a.getDisplay():a},b.prototype.setDisplay=function(a){this._displayList[this._displayIndex]=a,this._setDisplay(a)},b.prototype.getChildArmature=function(){var a=this._displayList[this._displayIndex];return a instanceof k?a:null},b.prototype.setChildArmature=function(a){this._displayList[this._displayIndex]=a,a&&this._setDisplay(a.getDisplay())},b.prototype.getDisplayList=function(){return this._displayList},b.prototype.setDisplayList=function(a){if(!a)throw new Error;for(var b=this._displayList.length=a.length;b--;)this._displayList[b]=a[b];if(this._displayIndex>=0){var c=this._displayIndex;this._displayIndex=-1,this._changeDisplay(c)}},b.prototype._setDisplay=function(a){this._displayBridge.getDisplay()?this._displayBridge.setDisplay(a):(this._displayBridge.setDisplay(a),this.armature&&(this._displayBridge.addDisplay(this.armature.getDisplay(),-1),this.armature._slotsZOrderChanged=!0)),this.updateChildArmatureAnimation(),this._isDisplayOnStage=!this._isHideDisplay&&this._displayBridge.getDisplay()?!0:!1},b.prototype._changeDisplay=function(a){if(0>a)this._isHideDisplay||(this._isHideDisplay=!0,this._displayBridge.removeDisplay(),this.updateChildArmatureAnimation());else{if(this._isHideDisplay){this._isHideDisplay=!1;var b=!0;this.armature&&(this._displayBridge.addDisplay(this.armature.getDisplay(),-1),this.armature._slotsZOrderChanged=!0)}var c=this._displayList.length;if(a>=c&&c>0&&(a=c-1),this._displayIndex!=a){this._displayIndex=a;var d=this._displayList[this._displayIndex];this._setDisplay(d instanceof k?d.getDisplay():d),this._dislayDataList&&this._displayIndex<this._dislayDataList.length&&this.origin.copy(this._dislayDataList[this._displayIndex].transform)}else b&&this.updateChildArmatureAnimation()}this._isDisplayOnStage=!this._isHideDisplay&&this._displayBridge.getDisplay()?!0:!1},b.prototype.setVisible=function(a){a!=this._visible&&(this._visible=a,this._updateVisible(this._visible))},b.prototype._setArmature=function(b){a.prototype._setArmature.call(this,b),this.armature?(this.armature._slotsZOrderChanged=!0,this._displayBridge.addDisplay(this.armature.getDisplay(),-1)):this._displayBridge.removeDisplay()},b.prototype.dispose=function(){this._displayBridge&&(a.prototype.dispose.call(this),this._displayBridge.dispose(),this._displayList.length=0,this._displayBridge=null,this._displayList=null,this._dislayDataList=null)},b.prototype._update=function(){if(a.prototype._update.call(this),this._isDisplayOnStage){var b=this.parent._tweenPivot.x,c=this.parent._tweenPivot.y;if(b||c){var d=this.parent._globalTransformMatrix;this._globalTransformMatrix.tx+=d.a*b+d.c*c,this._globalTransformMatrix.ty+=d.b*b+d.d*c}this._displayBridge.updateTransform(this._globalTransformMatrix,this.global)}},b.prototype._updateVisible=function(a){this._displayBridge.setVisible(this.parent.getVisible()&&this._visible&&a)},b.prototype.updateChildArmatureAnimation=function(){var a=this.getChildArmature();if(a)if(this._isHideDisplay)a.animation.stop(),a.animation._lastAnimationState=null;else{var b=this.armature?this.armature.animation.getLastAnimationName():null;b&&a.animation.hasAnimation(b)?a.animation.gotoAndPlay(b):a.animation.play()}},b}(h);a.Slot=i;var j=function(a){function c(){a.call(this),this._children=[],this._scaleType=2,this._tweenPivot=new b.Point,this.scaleMode=1}return na(c,a),c.prototype.setVisible=function(a){if(this._visible!=a){this._visible=a;for(var b=this._children.length;b--;){var c=this._children[b];c instanceof i&&c._updateVisible(this._visible)}}},c.prototype._setArmature=function(b){a.prototype._setArmature.call(this,b);for(var c=this._children.length;c--;)this._children[c]._setArmature(this.armature)},c.prototype.dispose=function(){if(this._children){a.prototype.dispose.call(this);for(var b=this._children.length;b--;)this._children[b].dispose();this._children.length=0,this._children=null,this._tweenPivot=null,this.slot=null}},c.prototype.contains=function(a){if(!a)throw new Error;if(a==this)return!1;for(var b=a;b!=this&&null!=b;)b=b.parent;return b==this},c.prototype.addChild=function(a){if(!a)throw new Error;if(a==this||a instanceof c&&a.contains(this))throw new Error("An Bone cannot be added as a child to itself or one of its children (or children's children, etc.)");a.parent&&a.parent.removeChild(a),this._children[this._children.length]=a,a._setParent(this),a._setArmature(this.armature),!this.slot&&a instanceof i&&(this.slot=a)},c.prototype.removeChild=function(a){if(!a)throw new Error;var b=this._children.indexOf(a);if(!(b>=0))throw new Error;this._children.splice(b,1),a._setParent(null),a._setArmature(null),a==this.slot&&(this.slot=null)},c.prototype.getSlots=function(){for(var a=[],b=this._children.length;b--;)this._children[b]instanceof i&&a.unshift(this._children[b]);return a},c.prototype._arriveAtFrame=function(a,b,e){if(a){var f=e.getMixingTransform(name);if(!(!e.displayControl||2!=f&&-1!=f||this.displayController&&this.displayController!=e.name)){var g=a;if(this.slot){var h=g.displayIndex;h>=0&&(isNaN(g.zOrder)||g.zOrder==this.slot._tweenZorder||(this.slot._tweenZorder=g.zOrder,this.armature._slotsZOrderChanged=!0)),this.slot._changeDisplay(h),this.slot._updateVisible(g.visible)}}if(a.event&&this.armature.hasEventListener(d.FrameEvent.BONE_FRAME_EVENT)){var j=new d.FrameEvent(d.FrameEvent.BONE_FRAME_EVENT);j.bone=this,j.animationState=e,j.frameLabel=a.event,this.armature._eventList.push(j)}if(a.sound&&c._soundManager.hasEventListener(d.SoundEvent.SOUND)){var k=new d.SoundEvent(d.SoundEvent.SOUND);k.armature=this.armature,k.animationState=e,k.sound=a.sound,c._soundManager.dispatchEvent(k)}if(a.action)for(var l in this._children)if(this._children[l]instanceof i){var m=this._children[l].getChildArmature();m&&m.animation.gotoAndPlay(a.action)}}else this.slot&&this.slot._changeDisplay(-1)},c.prototype._updateColor=function(a,b,c,d,e,f,g,h,j){for(var k=this._children.length;k--;){var l=this._children[k];l instanceof i&&l._displayBridge.updateColor(a,b,c,d,e,f,g,h)}this._isColorChanged=j},c._soundManager=d.SoundEventManager.getInstance(),c}(h);a.Bone=j;var k=function(a){function b(b){a.call(this),this.animation=new e.Animation(this),this._display=b,this._slotsZOrderChanged=!1,this._slotList=[],this._boneList=[],this._eventList=[]}return na(b,a),b.prototype.getDisplay=function(){return this._display},b.prototype.dispose=function(){if(this.animation){this.animation.dispose();for(var a=this._slotList.length;a--;)this._slotList[a].dispose();for(a=this._boneList.length;a--;)this._boneList[a].dispose();this._slotList.length=0,this._boneList.length=0,this._eventList.length=0,this._slotList=null,this._boneList=null,this._eventList=null,this._display=null,this.animation=null}},b.prototype.advanceTime=function(a){this.animation.advanceTime(a),a*=this.animation.timeScale;for(var b=this._boneList.length;b--;)this._boneList[b]._update();b=this._slotList.length;for(var c;b--;)if(c=this._slotList[b],c._update(),c._isDisplayOnStage){var e=c.getChildArmature();e&&e.advanceTime(a)}if(this._slotsZOrderChanged&&(this.updateSlotsZOrder(),this.hasEventListener(d.ArmatureEvent.Z_ORDER_UPDATED)&&this.dispatchEvent(new d.ArmatureEvent(d.ArmatureEvent.Z_ORDER_UPDATED))),this._eventList.length){var f=this._eventList.length;for(b=0;f>b;b++)this.dispatchEvent(this._eventList[b]);this._eventList.length=0}},b.prototype.getSlots=function(a){return"undefined"==typeof a&&(a=!0),a?this._slotList.concat():this._slotList},b.prototype.getBones=function(a){return"undefined"==typeof a&&(a=!0),a?this._boneList.concat():this._boneList},b.prototype.getSlot=function(a){for(var b=this._slotList.length;b--;)if(this._slotList[b].name==a)return this._slotList[b];return null},b.prototype.getSlotByDisplay=function(a){if(a)for(var b=this._slotList.length;b--;)if(this._slotList[b].getDisplay()==a)return this._slotList[b];return null},b.prototype.removeSlot=function(a){if(!a)throw new Error;if(!(this._slotList.indexOf(a)>=0))throw new Error;a.parent.removeChild(a)},b.prototype.removeSlotByName=function(a){if(a){var b=this.getSlot(a);b&&this.removeSlot(b)}},b.prototype.getBone=function(a){for(var b=this._boneList.length;b--;)if(this._boneList[b].name==a)return this._boneList[b];return null},b.prototype.getBoneByDisplay=function(a){var b=this.getSlotByDisplay(a);return b?b.parent:null},b.prototype.removeBone=function(a){if(!a)throw new Error;if(!(this._boneList.indexOf(a)>=0))throw new Error;a.parent?a.parent.removeChild(a):a._setArmature(null)},b.prototype.removeBoneByName=function(a){if(a){var b=this.getBone(a);b&&this.removeBone(b)}},b.prototype.addChild=function(a,b){if(!a)throw new Error;if(b){var c=this.getBone(b);if(!c)throw new Error;c.addChild(a)}else a.parent&&a.parent.removeChild(a),a._setArmature(this)},b.prototype.updateSlotsZOrder=function(){this._slotList.sort(this.sortSlot);for(var a,b=this._slotList.length;b--;)a=this._slotList[b],a._isDisplayOnStage&&a._displayBridge.addDisplay(this._display,-1);this._slotsZOrderChanged=!1},b.prototype._addDBObject=function(a){if(a instanceof i){var b=a;this._slotList.indexOf(b)<0&&(this._slotList[this._slotList.length]=b)}else if(a instanceof j){var c=a;this._boneList.indexOf(c)<0&&(this._boneList[this._boneList.length]=c,this._sortBoneList())}},b.prototype._removeDBObject=function(a){if(a instanceof i){var b=a,c=this._slotList.indexOf(b);c>=0&&this._slotList.splice(c,1)}else if(a instanceof j){var d=a;c=this._boneList.indexOf(d),c>=0&&this._boneList.splice(c,1)}},b.prototype._sortBoneList=function(){var a=this._boneList.length;if(0!=a){for(var b,c,d,e=[];a--;){for(b=0,c=this._boneList[a],d=c;d;)b++,d=d.parent;e[a]={level:b,bone:c}}for(e.sort(this.sortBone),a=e.length;a--;)this._boneList[a]=e[a].bone}},b.prototype._arriveAtFrame=function(a,c,e){if(a.event&&this.hasEventListener(d.FrameEvent.ANIMATION_FRAME_EVENT)){var f=new d.FrameEvent(d.FrameEvent.ANIMATION_FRAME_EVENT);f.animationState=e,f.frameLabel=a.event,this._eventList.push(f)}if(a.sound&&b._soundManager.hasEventListener(d.SoundEvent.SOUND)){var g=new d.SoundEvent(d.SoundEvent.SOUND);g.armature=this,g.animationState=e,g.sound=a.sound,b._soundManager.dispatchEvent(g)}a.action&&e.isPlaying&&this.animation.gotoAndPlay(a.action)},b.prototype.sortSlot=function(a,b){return a.getZOrder()<b.getZOrder()?1:-1},b.prototype.sortBone=function(a,b){return a.level<b.level?1:-1},b._soundManager=d.SoundEventManager.getInstance(),b}(d.EventDispatcher);a.Armature=k}(ma||(ma={}));var ma;!function(a){!function(a){var b=function(){function a(){}return a.prototype.getVisible=function(){return this._display?this._display.visible:!1},a.prototype.setVisible=function(a){this._display&&(this._display.visible=a)},a.prototype.getDisplay=function(){return this._display},a.prototype.setDisplay=function(a){if(this._display!=a){var b=-1;if(this._display){var c=this._display.parent;c&&(b=this._display.parent.children.indexOf(this._display)),this.removeDisplay()}this._display=a,this.addDisplay(c,b)}},a.prototype.dispose=function(){this._display=null},a.prototype.updateTransform=function(a,b){this._display.x=a.tx,this._display.y=a.ty,this._display.skewX=b.skewX,this._display.skewY=b.skewY,this._display.scaleX=b.scaleX,this._display.scaleY=b.scaleY},a.prototype.updateColor=function(a,b,c,d,e){this._display&&(this._display.alpha=e)},a.prototype.addDisplay=function(a,b){var c=a;c&&this._display&&(0>b||"undefined"==typeof b?(this._display.parent===c&&c.removeChild(this._display),c.addChild(this._display)):c.addChildAt(this._display,Math.min(b,c.children.length)))},a.prototype.removeDisplay=function(){this._display&&this._display.parent&&this._display.parent.removeChild(this._display)},a.RADIAN_TO_ANGLE=180/Math.PI,a}();a.QcDisplayBridge=b}(a.display||(a.display={}));var b=a.display;!function(b){var c=function(){function b(a,b,c){"undefined"==typeof c&&(c=1),this._regions={},this.image=a,this.scale=c,this.atlasId=b.atlasId,this.parseData(b)}return b.prototype.dispose=function(){this.image=null,this._regions=null},b.prototype.getRegion=function(a){return this._regions[a]},b.prototype.parseData=function(b){var c=a.objects.DataParser.parseTextureAtlasData(b,this.scale);this.name=c.__name,delete c.__name;for(var d in c)this._regions[d]=c[d]},b}();b.QcBonesAtlas=c}(a.textures||(a.textures={}));a.textures;!function(c){var d=function(c){function d(){c.call(this)}return na(d,c),d.prototype._generateArmature=function(b){var c=new g.Node(new h.Group(a.game,null)),d=new a.Armature(c);return c.name=b,c._bone=!0,d},d.prototype._generateSlot=function(){var c=new a.Slot(new b.QcDisplayBridge);return c},d.prototype._generateDisplay=function(b,c,d,e){var f=new g.UIImage(a.game._qc),h=b.atlasId;return f.texture=f.game.assets.find(h),f.frame=c,f.name=c,f._bone=!0,f.resetNativeSize(),f.pivotX=d/f.width,f.pivotY=e/f.height,f.parent&&f.parent.removeChild(f),f},d}(c.BaseFactory);c.QcBonesFactory=d}(a.factorys||(a.factorys={}));a.factorys}(ma||(ma={})),ma.CoverAtlas=function(a){for(var b,c,d={meta:{image:a.imagePath},frames:b={}},e=a.SubTexture,f=e.length,g=0;f>g;g++)c=e[g],b[c.name]={filename:c.name,frame:{x:c.x,y:c.y,w:c.width,h:c.height},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:c.width,h:c.height},sourceSize:{w:c.width,h:c.height}};return d},ma.findArmature=function(a){return a.armature[0].name},ma.makeQcArmature=function(a,b,c,d){b.name=d,a.name=d;var e=b;e.atlasId=e.name;var f=new ma.factorys.QcBonesFactory;f.addSkeletonData(ma.objects.DataParser.parseSkeletonData(a));var g=new ma.textures.QcBonesAtlas(c,e);f.addTextureAtlas(g);var h=f.buildArmature(ma.findArmature(a));return h},g.dragonBones=ma,g.dragonBonesDriver=function(a){g.dragonBones.game=a},g.dragonBonesDriver.prototype={update:function(){}},g.dragonBonesDriver.prototype.constructor=g.dragonBonesDriver,g.Transition={NONE:0,COLOR_TINT:1,TEXTURE_SWAP:2,ANIMATION:3},g.UIState={NORMAL:0,PRESSED:1,DISABLED:2},g.Util={findClass:function(b){for(var c=b.split("."),d=a,e=0;e<c.length-1;e++){if(!d[c[e]])return;d=d[c[e]]}return d[c[c.length-1]]},clone:function(a){if(null===a||"object"!=typeof a)return a;var b=new a.constructor;for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},isArray:Array.isArray||function(a){return"[object Array]"===toString.call(a)},removeHTML:function(){var a;return function(b){if(b&&b.parentNode){if(a===b)return;a=b,b.parentNode.removeChild(b),a=null}}}(),updateTransform:function(a,b){var c=a.game,d=c.phaser.scale.scaleFactorInversed,e=c.canvas.getBoundingClientRect(),f=c.canvas.parentNode.getBoundingClientRect(),g=e.left-f.left,h=e.top-f.top,i=b.style,j=a.rect,k=a.worldTransform,l=(-j.x).toFixed(5)+"px "+(-j.y).toFixed(5)+"px",m="matrix("+(k.a*d.x).toFixed(5)+","+(k.b*d.x).toFixed(5)+","+(k.c*d.y).toFixed(5)+","+(k.d*d.y).toFixed(5)+","+(k.tx*d.x+g).toFixed(0)+","+(k.ty*d.y+h).toFixed(0)+")";i.left=j.x.toFixed(5)+"px",i.top=j.y.toFixed(5)+"px",i.width=j.width.toFixed(5)+"px",i.height=j.height.toFixed(5)+"px",i.webkitTransform=m,i.mozTransform=m,i.msTransform=m,i.oTransform=m,i.transform=m,i.webkitTransformOrigin=l,i.mozTransformOrigin=l,i.msTransformOrigin=l,i.oTransformOrigin=l,i.transformOrigin=l},formatString:function(a){var b=arguments;return b.length<=1?a:a.replace(/\{(\d+)\}/g,function(a,c){return b[parseInt(c)+1]})},popupError:function(b){if(a.parent&&a.parent.G&&a.parent.G.notification){
var c=a.parent.G,d=g.Util.formatString(c._("Exception notification"),b);c.notification.error(d)}else{var d="Error: "+b;if("undefined"!=typeof qici&&qici.config){var e=qici.config.gameInstance,f=a[e];f&&(f.log.error(d),f.debug.on&&alert(d))}else console.trace(d)}}},a.onerror=function(a){g.Util.popupError(a)};var oa=g.Color=function(a){if(this.alpha=1,this._rgb=[255,255,255],null!=a)if("number"==typeof a)this._rgb[0]=a>>16&255,this._rgb[1]=a>>8&255,this._rgb[2]=255&a,this.alpha=(a>>>24)/255;else if(g.Util.isArray(a))this.rgb=a;else{if("string"!=typeof a)throw new Error("Invalid color");if(a=a.toLowerCase(),0===a.indexOf("rgb"))var b=h.Color.webToColor(a);else{var b=this._hexToColor(a);b.a=b.a/255}this._rgb[0]=b.r,this._rgb[1]=b.g,this._rgb[2]=b.b,this.alpha=b.a}};oa.prototype={},oa.prototype.constructor=oa,b.defineProperties(oa.prototype,{alpha:{get:function(){return this._alpha},set:function(a){(0>a||a>1)&&(a=1),this._alpha=a}},rgb:{get:function(){return this._rgb},set:function(a){if(!g.Util.isArray(a))throw new Error("Expected:Array");if(a.length<3)throw new Error("Invalid rgb");this._rgb[0]=a[0],this._rgb[1]=a[1],this._rgb[2]=a[2],this.alpha=4===a.length?a[3]:1}},"class":{get:function(){return"qc.Color"}}}),oa.prototype.toString=function(a){switch(a){case"#rgb":return"#"+h.Color.componentToHex(this._rgb[0])+h.Color.componentToHex(this._rgb[1])+h.Color.componentToHex(this._rgb[2]);case"#argb":return"#"+h.Color.componentToHex(Math.round(255*this.alpha))+h.Color.componentToHex(this._rgb[0])+h.Color.componentToHex(this._rgb[1])+h.Color.componentToHex(this._rgb[2]);case"rgb":return"rgb("+this._rgb[0].toString()+","+this._rgb[1].toString()+","+this._rgb[2].toString()+")";default:return"rgba("+this._rgb[0].toString()+","+this._rgb[1].toString()+","+this._rgb[2].toString()+","+this.alpha+")"}},oa.prototype.toNumber=function(a){return a?(255*this.alpha<<24|this._rgb[0]<<16|this._rgb[1]<<8|this._rgb[2])>>>0:(this._rgb[0]<<16|this._rgb[1]<<8|this._rgb[2])>>>0},oa.prototype._hexToColor=function(a){if(a.length<=0||"#"!==a[0])return{r:255,g:255,b:255,a:255};a=a.substr(1,a.length-1);var b=!1;if(a.length>6&&a.length<=8)for(b=!0;a.length<8;)a="0"+a;for(;a.length<6;)a="0"+a;var c=255,d=0;b&&(c=parseInt(a.substr(d,2),16),d+=2);var e=parseInt(a.substr(d,2),16);d+=2;var f=parseInt(a.substr(d,2),16);d+=2;var g=parseInt(a.substr(d,2),16);return{r:e,g:f,b:g,a:c}},oa.black=new oa(4278190080),oa.white=new oa(4294967295),oa.red=new oa(4294901760),oa.yellow=new oa(4294967040),oa.blue=new oa(4278255615),oa.green=new oa(4278255360),oa.grey=new oa(4291611852),oa.shadow=new oa(2147483648),oa.background=new oa(4282861383),g.CanvasPool={pool:{},unused:[],cookie:19870101,get:function(a){var b=g.CanvasPool.pool,c=b[a],d=!1;if(!c){d=!0;var e=g.CanvasPool.unused;b[a]=c=e.length?e.pop():h.Canvas.create(1,1)}return c._cookie=g.CanvasPool.cookie,{canvas:c,dirty:d}},stat:function(){var a=0,b=0,c=g.CanvasPool.pool;for(var d in c){var e=c[d];e&&(a++,b+=e.width*e.height)}console.info("当前Canvas使用中："+a+"，总像素为："+b+"，未使用的Canvas数量："+g.CanvasPool.unused.length)},postRender:function(){var a=g.CanvasPool,c=a.cookie;a.cookie=c+1;for(var d=a.pool,e=a.unused,f=b.keys(d),h=0,i=f.length;i>h;h++){var j=f[h],k=d[j];k._cookie!==c&&(delete d[j],k.width=1,k.height=1,e.push(k))}}};var pa=a.applicationCache;if(pa){var qa=function(){},ra=function(){};pa.addEventListener("cached",qa,!1),pa.addEventListener("checking",qa,!1),pa.addEventListener("downloading",qa,!1),pa.addEventListener("error",ra,!1),pa.addEventListener("noupdate",qa,!1),pa.addEventListener("obsolete",qa,!1),pa.addEventListener("progress",qa,!1),pa.addEventListener("updateready",qa,!1)}h.Game.prototype.update=function(a){var b=Date.now();this._qc.update(a),this._qc.debug.total+=Date.now()-b};var sa=h.Game.prototype.setUpRenderer;h.Game.prototype.setUpRenderer=function(){!this.device.webGL||this.device.desktop||this.device.iOS||g.isSupportWebGL&&!g.isSupportWebGL(this._qc)&&(this.device.webGL=!1),sa.call(this)},h.Group.prototype.preUpdate=function(){var a=this._qc;if(a&&!a["static"]){a.preUpdate&&a.preUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.preUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)&&(d.preUpdate(),!this.visible))return}}for(var e=this.children.slice(0),c=e.length;c--;)e[c].visible?e[c].preUpdate():e[c].renderOrderID=-1;return!0},h.Group.prototype.update=function(){var a=this._qc;if(a&&!a["static"]){a.update&&a.update();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.update&&(a.game.device.editor!==!0||d.runInEditor===!0)&&(d.update(),!this.visible))return}}for(var e=this.children.slice(0),c=e.length;c--;)e[c].visible&&e[c].update()},h.Group.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);var a=this._qc;if(a&&!a["static"]){a.postUpdate&&a.postUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.postUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)&&(d.postUpdate(),!this.visible))return}}for(var e=this.children.slice(0),c=e.length;c--;)e[c].visible&&e[c].postUpdate()},h.StateManager.prototype.loadComplete=function(){var a=this;if(a._created!==!0){var b=a.game._qc;return b.assets.parsing?void b.timer.add(15,function(){a.loadComplete()}):void(a._created===!1&&a.onCreateCallback?b.state.loadingAnimation?b.state.delayCreateCallback=function(){a._created=!0,a.onCreateCallback.call(a.callbackContext,a.game)}:(a._created=!0,a.onCreateCallback.call(a.callbackContext,a.game)):a._created=!0)}};var ta=h.Device._initialize;h.Device._initialize=function(){ta.call(this);var b=a.navigator.userAgent;this.UCBrowser=/UCBrowser/.test(b),this.iOS&&(navigator.appVersion.match(/OS (\d+)/),this.iOSVersion=parseInt(RegExp.$1,10));var c=/AppleWebKit\/([0-9\.]+)/,d=c.exec(navigator.userAgent);d&&d.length>0?(this.AppleWebKit=!0,this.AppleWebKitVersion=d[1].split(".")):this.AppleWebKit=!1,this.supportStencil=!this.AppleWebKit||this.AppleWebKitVersion[0]>534,this.android&&this.UCBrowser&&(g.__IS_ANDROID_UC=!0)},h.Animation=function(a,b,c,d,e,f,g){"undefined"==typeof g&&(g=!1),this.game=a,this._parent=b,this._frameData=d,this.name=c,this._frames=[],this._frames=this._frames.concat(e),this.delay=1e3/f,this.loop=g,this.loopCount=0,this.killOnComplete=!1,this.isFinished=!1,this.isPlaying=!1,this.isPaused=!1,this._pauseStartTime=0,this._frameIndex=0,this._frameDiff=0,this._frameSkip=1,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this.onStart=new h.Signal,this.onUpdate=null,this.onComplete=new h.Signal,this.onLoop=new h.Signal,this.game.onPause.add(this.onPause,this),this.game.onResume.add(this.onResume,this)},h.Animation.prototype={play:function(a,b,c){return"number"==typeof a&&(this.delay=1e3/a),"boolean"==typeof b&&(this.loop=b),"undefined"!=typeof c&&(this.killOnComplete=c),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.updateCurrentFrame(!1),this._parent.events.onAnimationStart$dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this},restart:function(){this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this._parent.setFrame(this.currentFrame),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this.onStart.dispatch(this._parent,this)},setFrame:function(a,b){var c;if("undefined"==typeof b&&(b=!1),"string"==typeof a)for(var d=0;d<this._frames.length;d++)this._frameData&&this._frameData.getFrame(this._frames[d]).name===a&&(c=d);else if("number"==typeof a)if(b)c=a;else for(var d=0;d<this._frames.length;d++)this._frames[d]===c&&(c=d);c&&(this._frameIndex=c-1,this._timeNextFrame=this.game.time.time,this.update())},stop:function(a,b){"undefined"==typeof a&&(a=!1),"undefined"==typeof b&&(b=!1),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,a&&(this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[0]):0,this._parent.setFrame(this.currentFrame)),b&&(this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.time)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.time+this._frameDiff)},update:function(){return this.isPaused?!1:this.isPlaying&&this.game.time.time>=this._timeNextFrame?(this._frameSkip=1,this._frameDiff=this.game.time.time-this._timeNextFrame,this._timeLastFrame=this.game.time.time,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay,this._frameSkip+=1),this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff),this._frameIndex+=this._frameSkip,this._frameIndex>=this._frames.length?this.loop?(this._frameIndex%=this._frames.length,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this.loopCount++,this._parent.events.onAnimationLoop$dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this),this.updateCurrentFrame(!0)):(this.complete(),!1):this.updateCurrentFrame(!0)):!1},updateCurrentFrame:function(a){return this._frameData?(this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1)),this.onUpdate&&a?(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData):!0):!1},next:function(a){"undefined"==typeof a&&(a=1);var b=this._frameIndex+a;b>=this._frames.length&&(this.loop?b%=this._frames.length:b=this._frames.length-1),b!==this._frameIndex&&(this._frameIndex=b,this.updateCurrentFrame(!0))},previous:function(a){"undefined"==typeof a&&(a=1);var b=this._frameIndex-a;0>b&&(this.loop?b=this._frames.length+b:b++),b!==this._frameIndex&&(this._frameIndex=b,this.updateCurrentFrame(!0))},updateFrameData:function(a){this._frameData=a,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):this._frameIndex%this._frames.length},destroy:function(){this.game&&(this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&this.onUpdate.dispose())},complete:function(){this._frameIndex=this._frames.length-1,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this.isPlaying=!1,this.isFinished=!0,this.paused=!1,this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this),this.killOnComplete&&this._parent.kill()}},h.Animation.prototype.constructor=h.Animation,b.defineProperty(h.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(a){this.isPaused=a,a?this._pauseStartTime=this.game.time.time:this.isPlaying&&(this._timeNextFrame=this.game.time.time+this.delay)}}),b.defineProperty(h.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}}),b.defineProperty(h.Animation.prototype,"frame",{get:function(){return null!==this.currentFrame?this.currentFrame.index:this._frameIndex},set:function(a){this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[a]):a,null!==this.currentFrame&&(this._frameIndex=a,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}}),b.defineProperty(h.Animation.prototype,"speed",{get:function(){return Math.round(1e3/this.delay)},set:function(a){a>=1&&(this.delay=1e3/a)}}),b.defineProperty(h.Animation.prototype,"enableUpdate",{get:function(){return null!==this.onUpdate},set:function(a){a&&null===this.onUpdate?this.onUpdate=new h.Signal:a||null===this.onUpdate||(this.onUpdate.dispose(),this.onUpdate=null)}}),h.Animation.generateFrameNames=function(a,b,c,d,e){"undefined"==typeof d&&(d="");var f=[],g="";if(c>b)for(var i=b;c>=i;i++)g="number"==typeof e?h.Utils.pad(i.toString(),e,"0",1):i.toString(),g=a+g+d,f.push(g);else for(var i=b;i>=c;i--)g="number"==typeof e?h.Utils.pad(i.toString(),e,"0",1):i.toString(),g=a+g+d,f.push(g);return f},h.AnimationManager=function(a){this.sprite=a,this.game=a.game,this.currentFrame=null,this.currentAnim=null,this.updateIfVisible=!0,this.isLoaded=!1,this._frameData=null,this._anims={},this._outputFrames=[]},h.AnimationManager.prototype={loadFrameData:function(a,b){if("undefined"==typeof a)return!1;if(this.isLoaded)for(var c in this._anims)this._anims[c].updateFrameData(a);return this._frameData=a,"undefined"==typeof b||null===b?this.frame=0:"string"==typeof b?this.frameName=b:this.frame=b,this.isLoaded=!0,!0},copyFrameData:function(a,b){if(this._frameData=a.clone(),this.isLoaded)for(var c in this._anims)this._anims[c].updateFrameData(this._frameData);return"undefined"==typeof b||null===b?this.frame=0:"string"==typeof b?this.frameName=b:this.frame=b,this.isLoaded=!0,!0},add:function(a,b,c,d,e){if(b=b||[],c=c||60,"undefined"==typeof d&&(d=!1),"undefined"==typeof e&&(e=b&&"number"==typeof b[0]?!0:!1),this._outputFrames.length=0,this.sprite._qc&&this.sprite._qc.animationType===g.Sprite.FRAME_ANIMATION)this._frameData.getFrameIndexes(b,e,this._outputFrames),this._anims[a]=new h.Animation(this.game,this.sprite,a,this._frameData,this._outputFrames,c,d);else{for(var f=this.sprite._qc._animation[a].last,i=new Array(f),j=0,k=f;k>j;j++)i[j]=j;this._anims[a]=new h.Animation(this.game,this.sprite,a,null,i,c,d)}return this.currentAnim=this._anims[a],this.sprite._qc&&this.sprite._qc.animationType===g.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame),this.sprite.__tilePattern&&(this.sprite.__tilePattern=!1,this.tilingTexture=!1),this._anims[a]},validateFrames:function(a,b){"undefined"==typeof b&&(b=!0);for(var c=0;c<a.length;c++)if(b===!0){if(a[c]>this._frameData.total)return!1}else if(this._frameData.checkFrameName(a[c])===!1)return!1;return!0},play:function(a,b,c,d){if(this._anims[a]){var e=this.currentAnim;return e===this._anims[a]?e.isPlaying===!1?(e.paused=!1,e.play(b,c,d)):("number"==typeof b&&e.delay!==1e3/b&&(e.delay=1e3/b,e._timeNextFrame=e._timeLastFrame+e.delay),"boolean"==typeof c&&(e.loop=c),"undefined"!=typeof d&&(e.killOnComplete=d),e):(e&&e.isPlaying&&e.stop(),e=this._anims[a],e.paused=!1,this.sprite._qc&&this.sprite._qc.animationType===g.Sprite.FRAME_ANIMATION&&(this.currentFrame=e.currentFrame),e.play(b,c,d))}},stop:function(a,b){"undefined"==typeof b&&(b=!1),"string"==typeof a?this._anims[a]&&(this.currentAnim=this._anims[a],this.currentAnim.stop(b)):this.currentAnim&&this.currentAnim.stop(b)},update:function(){return this.updateIfVisible&&!this.sprite.visible?!1:this.currentAnim&&this.currentAnim.update()?(this.sprite._qc&&this.sprite._qc.animationType===g.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame),!0):!1},next:function(a){this.currentAnim&&(this.currentAnim.next(a),this.sprite._qc&&this.sprite._qc.animationType===g.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame))},previous:function(a){this.currentAnim&&(this.currentAnim.previous(a),this.sprite._qc&&this.sprite._qc.animationType===g.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame))},getAnimation:function(a){return"string"==typeof a&&this._anims[a]?this._anims[a]:null},refreshFrame:function(){this.sprite.setTexture(i.TextureCache[this.currentFrame.uuid]),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)},destroy:function(){var a=null;for(var a in this._anims)this._anims.hasOwnProperty(a)&&this._anims[a].destroy();this._anims={},this._outputFrames=[],this._frameData=null,this.currentAnim=null,this.currentFrame=null,this.sprite=null,this.game=null}},h.AnimationManager.prototype.constructor=h.AnimationManager,b.defineProperty(h.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}}),b.defineProperty(h.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}}),b.defineProperty(h.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(a){this.currentAnim.paused=a}}),b.defineProperty(h.AnimationManager.prototype,"name",{get:function(){return this.currentAnim?this.currentAnim.name:void 0}}),b.defineProperty(h.AnimationManager.prototype,"frame",{get:function(){return this.currentFrame?this.currentFrame.index:void 0},set:function(a){"number"==typeof a&&this._frameData&&null!==this._frameData.getFrame(a)&&(this.currentFrame=this._frameData.getFrame(a),this.currentFrame&&(this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)))}}),b.defineProperty(h.AnimationManager.prototype,"frameName",{get:function(){return this.currentFrame?this.currentFrame.name:void 0},set:function(a){"string"==typeof a&&null!==this._frameData.getFrameByName(a)?(this.currentFrame=this._frameData.getFrameByName(a),this.currentFrame&&(this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1))):console.warn("Cannot set frameName: "+a)}}),g.BATCH_QUAD=0,g.BATCH_TRIANGLES=1;var ua=i.WebGLSpriteBatch.prototype.setContext;i.WebGLSpriteBatch.prototype.setContext=function(a){ua.call(this,a),this.quadSize=this.size,this.triangleSize=300,this.batchIndexNumber=6;var b=3*this.triangleSize;this.triangleIndices=new i.Uint16Array(b);for(var c=0;b>c;++c)this.triangleIndices[c]=c;this._batchType=g.BATCH_QUAD,this.quadIndexBuffer=this.indexBuffer,this.triangleIndexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.triangleIndexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.triangleIndices,a.STATIC_DRAW)};var va=i.WebGLSpriteBatch.prototype.destroy;i.WebGLSpriteBatch.prototype.destroy=function(){this.triangleIndices=null,this.gl.deleteBuffer(this.triangleIndexBuffer),va.call(this)},b.defineProperties(i.WebGLSpriteBatch.prototype,{batchType:{get:function(){return this._batchType},set:function(a){a!==this._batchType&&(this.stop(),a===g.BATCH_TRIANGLES?(this.size=this.triangleSize,this.indexBuffer=this.triangleIndexBuffer,this._batchType=a,this.batchIndexNumber=3):(this.size=this.quadSize,this.indexBuffer=this.quadIndexBuffer,this._batchType=a,this.batchIndexNumber=6),this.start())}}}),i.WebGLSpriteBatch.prototype.renderBatch=function(a,b,c){if(0!==b){var d=this.gl;a._dirty[d.id]?this.renderSession.renderer.updateTexture(a):d.bindTexture(d.TEXTURE_2D,a._glTextures[d.id]),d.drawElements(d.TRIANGLES,b*this.batchIndexNumber,d.UNSIGNED_SHORT,c*this.batchIndexNumber*2),this.renderSession.drawCount++}},i.CanvasMaskManager.prototype.popMask=function(a){if(a.context.restore(),g.__IS_ANDROID_UC){var b=g._tempCanvas;b||(b=g._tempCanvas=document.createElement("canvas"),b.width=128,b.height=128),a.context.drawImage(b,0,0,2,2,-5,-5,1,1)}},i.CanvasTinter.getTintedTexture=function(a,b){var c=a.tintedTexture||document.createElement("canvas");return i.CanvasTinter.tintMethod(a.texture,b,c),c},i.DisplayObject.prototype.updateTransform=function(){var a=this.parent;if(a){var b=!this._isNotNeedCalcTransform||a._isSubNeedCalcTransform;if(b){this.game&&this.game._calcTransformCount++;var c,d,e,f,g,h,j=this.parent.worldTransform,k=this.worldTransform;k.inUpdate=!0,this.rotation%i.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),c=this._cr*this.scale.x,d=this._sr*this.scale.x,e=-this._sr*this.scale.y,f=this._cr*this.scale.y,g=this.position.x,h=this.position.y,(this.pivot.x||this.pivot.y)&&(g-=this.pivot.x*c+this.pivot.y*e,h-=this.pivot.x*d+this.pivot.y*f),k.a=c*j.a+d*j.c,k.b=c*j.b+d*j.d,k.c=e*j.a+f*j.c,k.d=e*j.b+f*j.d,k.tx=g*j.a+h*j.c+j.tx,k.ty=g*j.b+h*j.d+j.ty):(c=this.scale.x,f=this.scale.y,g=this.position.x-this.pivot.x*c,h=this.position.y-this.pivot.y*f,k.a=c*j.a,k.b=c*j.b,k.c=f*j.c,k.d=f*j.d,k.tx=g*j.a+h*j.c+j.tx,k.ty=g*j.b+h*j.d+j.ty),this._isNotNeedCalcTransform=!0,this._isSubNeedCalcTransform=!0,this.worldTransformChangedCallback&&this.worldTransformChangedCallback.call(this.worldTransformChangedContext)}else{this._isSubNeedCalcTransform=!1;var k=this.worldTransform,j=a.worldTransform}k.inUpdate=!1,this.worldAlpha=this.alpha*this.parent.worldAlpha,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,k,j)}},i.DisplayObject.prototype.displayObjectUpdateTransform=i.DisplayObject.prototype.updateTransform,i.DisplayObject.prototype.getWorldTransform=function(){for(var a=!1,b=this,c=null;b;)b._isNotNeedCalcTransform||(a=!0,c=b),b=b.parent;return a&&c.updateTransform(),this.worldTransform},i.DisplayObjectContainer.prototype._renderWebGL=function(a){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return void this._renderCachedSprite(a);var b;if(this.softClip&&X.getManager(a).pushPolygon(this.softClip),this._graphicsFilter||this._mask||this._filters){for(this._graphicsFilter&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._graphicsFilter)),this._filters&&!this.filterSelf&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),b=0;b<this.children.length;b++)this.children[b]._renderWebGL(a);a.spriteBatch.stop(),this._mask&&a.maskManager.popMask(this._mask,a),this._filters&&!this.filterSelf&&a.filterManager.popFilter(),this._graphicsFilter&&a.filterManager.popFilter(),a.spriteBatch.start()}else for(b=0;b<this.children.length;b++)this.children[b]._renderWebGL(a);this.softClip&&X.getManager(a).popPolygon()}},i.DisplayObjectContainer.prototype.addChildAt=function(a,b){if(b>=0&&b<=this.children.length)return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.splice(b,0,a),this._qc&&this._qc._dispatchChildrenChanged("add",[a._qc]),this.stage&&a.setStageReference(this.stage),a;throw new Error(a+"addChildAt: The index "+b+" supplied is out of bounds "+this.children.length)},i.DisplayObjectContainer.prototype.swapChildren=function(a,b){if(a!==b){var c=this.getChildIndex(a),d=this.getChildIndex(b);if(0>c||0>d)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[c]=b,this.children[d]=a,this._qc&&this._qc._dispatchChildrenChanged("order",[a._qc,b._qc])}},i.DisplayObjectContainer.prototype.setChildIndex=function(a,b){if(0>b||b>=this.children.length)throw new Error("The supplied index is out of bounds");var c=this.getChildIndex(a);this.children.splice(c,1),this.children.splice(b,0,a),this._qc&&this._qc._dispatchChildrenChanged("order",[a._qc])},i.DisplayObjectContainer.prototype.removeChildAt=function(a){var b=this.getChildAt(a);return this.stage&&b.removeStageReference(),b.parent=c,this.children.splice(a,1),this._qc&&this._qc._dispatchChildrenChanged("remove",[b._qc]),b},i.DisplayObjectContainer.prototype.removeChildren=function(a,b){var d=a||0,e="number"==typeof b?b:this.children.length,f=e-d;if(f>0&&e>=f){for(var g=this.children.splice(d,f),h=[],i=0;i<g.length;i++){var j=g[i];this.stage&&j.removeStageReference(),j.parent=c,j._qc&&h.push(j._qc)}return this._qc&&this._qc._dispatchChildrenChanged("remove",h),g}if(0===f&&0===this.children.length)return this._qc&&this._qc._dispatchChildrenChanged("remove",[]),[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},i.DisplayObjectContainer.prototype.getLocalBounds=function(){var a=this.worldTransform;this._isSubNeedCalcTransform=!0,this.worldTransform=i.identityMatrix;for(var b=0,c=this.children.length;c>b;b++)this.children[b].updateTransform();var d=this.getBounds();return this.worldTransform=a,this._isSubNeedCalcTransform=!0,this._isNotNeedCalcTransform=!1,d},i.PixiShader.prototype.init=function(){var a=this.gl,b=i.compileProgram(a,this.vertexSrc||i.PixiShader.defaultVertexSrc,this.fragmentSrc);if(a.useProgram(b),this.uSampler=a.getUniformLocation(b,"uSampler"),this.uSourceSampler=a.getUniformLocation(b,"uSourceSampler"),this.projectionVector=a.getUniformLocation(b,"projectionVector"),this.offsetVector=a.getUniformLocation(b,"offsetVector"),this.dimensions=a.getUniformLocation(b,"dimensions"),this.pixelSize=a.getUniformLocation(b,"pixelSize"),this.aVertexPosition=a.getAttribLocation(b,"aVertexPosition"),this.aTextureCoord=a.getAttribLocation(b,"aTextureCoord"),this.colorAttribute=a.getAttribLocation(b,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute],this.extraAttribute)for(var c in this.extraAttribute){var d=this.extraAttribute[c].name;this[d]=a.getAttribLocation(b,d),this.attributes.push(this[d])}for(var d in this.uniforms)this.uniforms[d].uniformLocation=a.getUniformLocation(b,d);this.initUniforms(),this.program=b},i.Sprite.prototype._renderWebGL=function(a){if(this.visible&&!(this.alpha<=0)&&this.renderable){var b;if(this.softClip&&X.getManager(a).pushPolygon(this.softClip),this.maskPixel){var c=a.spriteBatch;for(c.flush(),a.filterManager.pushFilter(this.maskPixel),b=0;b<this.children.length;b++)this.children[b]._renderWebGL(a);c.stop(),a.filterManager.popFilter(),c.start()}else if(this._graphicsFilter||this._mask||this._filters){var c=a.spriteBatch;if(this._graphicsFilter&&(c.flush(),a.filterManager.pushFilter(this._graphicsFilter)),this._filters&&!this.filterSelf&&(c.flush(),a.filterManager.pushFilter(this._filterBlock)),this._mask&&(c.stop(),a.maskManager.pushMask(this.mask,a),c.start()),this._filters&&this.filterSelf){c.stop();var d=this.texture.baseTexture._glTextures[a.gl.id],e=a.filterManager.buildFilterTexture(a,this._filterBlock,this);c.start();var f=this.texture._uvs;e&&(this.texture.baseTexture._glTextures[a.gl.id]=e.texture),this._renderWebGLImpl(a),c.flush(),e&&(this.texture.baseTexture._glTextures[a.gl.id]=d,a.filterManager.texturePool.push(e),this.texture._uvs=f)}else this._renderWebGLImpl(a);for(b=0;b<this.children.length;b++)this.children[b]._renderWebGL(a);c.stop(),this._mask&&a.maskManager.popMask(this._mask,a),this._filters&&!this.filterSelf&&a.filterManager.popFilter(),this._graphicsFilter&&a.filterManager.popFilter(),c.start()}else for(this._renderWebGLImpl(a),b=0;b<this.children.length;b++)this.children[b]._renderWebGL(a);this.softClip&&X.getManager(a).popPolygon()}},i.WebGLStencilManager.prototype.pushSpriteStencil=function(a,b){var c=this.gl;0===this.stencilStack.length&&(c.enable(c.STENCIL_TEST),c.clear(c.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(a);var d=this.count;c.colorMask(!1,!1,!1,!1),c.stencilFunc(c.ALWAYS,0,255),c.stencilOp(c.KEEP,c.KEEP,c.INVERT),this.reverse?(c.stencilFunc(c.EQUAL,d,255),c.stencilOp(c.KEEP,c.KEEP,c.INCR)):(c.stencilFunc(c.EQUAL,255-d,255),c.stencilOp(c.KEEP,c.KEEP,c.DECR)),a._renderWebGLImpl(b),b.spriteBatch.flush(),this.reverse?c.stencilFunc(c.EQUAL,d+1,255):c.stencilFunc(c.EQUAL,255-(d+1),255),c.colorMask(!0,!0,!0,!0),c.stencilOp(c.KEEP,c.KEEP,c.KEEP),this.count++},i.WebGLStencilManager.prototype.popSpriteStencil=function(a,b){var c=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)c.disable(c.STENCIL_TEST);else{var d=this.count;c.colorMask(!1,!1,!1,!1),this.reverse?(c.stencilFunc(c.EQUAL,d+1,255),c.stencilOp(c.KEEP,c.KEEP,c.DECR)):(c.stencilFunc(c.EQUAL,255-(d+1),255),c.stencilOp(c.KEEP,c.KEEP,c.INCR)),a._renderWebGLImpl(b),b.spriteBatch.flush(),this.reverse?c.stencilFunc(c.EQUAL,d,255):c.stencilFunc(c.EQUAL,255-d,255),c.colorMask(!0,!0,!0,!0),c.stencilOp(c.KEEP,c.KEEP,c.KEEP)}},i.Sprite.prototype._renderWebGLImpl=function(a){var b=a.softClipManager,c=a.spriteBatch;if(b&&b.needClip){var d=this.texture,e=d.baseTexture.resolution,f=this.worldTransform,g=d._uvs;if(!g)return;var h,i,j,k,l=f.a/e,m=f.b/e,n=f.c/e,o=f.d/e,p=f.tx,q=f.ty,r=this.anchor.x,s=this.anchor.y;if(d.trim){var t=d.trim;i=t.x-r*t.width,h=i+d.crop.width,k=t.y-s*t.height,j=k+d.crop.height}else h=d.frame.width*(1-r),i=d.frame.width*-r,j=d.frame.height*(1-s),k=d.frame.height*-s;var u=this.tint;u=(u>>16)+(65280&u)+((255&u)<<16)+(255*this.worldAlpha<<24),b.renderSprite(a,this,i,k,h,j,g.x0,g.y0,g.x2,g.y2,l,m,n,o,p,q,u)}else c.render(this)},i.Sprite.prototype._renderCanvas=function(a){if(!(this.visible===!1||0===this.alpha||this.renderable===!1||this.texture.crop.width<=0||this.texture.crop.height<=0)){if(this.maskPixel){var b=a.bufferPool||(a.bufferPool=[]),c=a.context,d=c.globalOffX||0,e=c.globalOffY||0,f=this.maskPixel.target.filterArea||this.maskPixel.target.getBounds(),g=Math.max(d,f.x),h=Math.max(e,f.y),j=Math.min(f.x+f.width,c.canvas.width+d),k=Math.min(f.y+f.height,c.canvas.height+e);f.x=g,f.y=h,f.width=j-g,f.height=k-h;var l=b.pop();l||(l=new i.CanvasBuffer(a.context.canvas.width*a.resolution,a.context.canvas.height*a.resolution),l.context._setTransform=l.context.setTransform,l.context.setTransform=function(a,b,c,d,e,f){this._setTransform(a,b,c,d,e-(this.globalOffX||0),f-(this.globalOffY||0))}),l.resize(f.width*a.resolution,f.height*a.resolution),l.context.clearRect(0,0,f.width*a.resolution,f.height*a.resolution),l.context.globalOffX=f.x*a.resolution+d,l.context.globalOffY=f.y*a.resolution+e,a.context=l.context}if(this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,a.context.globalCompositeOperation=i.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a),this.texture.valid){var m=this.texture.baseTexture.resolution/a.resolution;a.context.globalAlpha=this.worldAlpha,a.smoothProperty&&a.scaleMode!==this.texture.baseTexture.scaleMode&&(a.scaleMode=this.texture.baseTexture.scaleMode,a.context[a.smoothProperty]=a.scaleMode===i.scaleModes.LINEAR);var n=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,o=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;a.roundPixels?(a.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution|0,this.worldTransform.ty*a.resolution|0),n=0|n,o=0|o):a.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution,this.worldTransform.ty*a.resolution),this.maskPixel||(16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=i.CanvasTinter.getTintedTexture(this,this.tint)),a.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,n/m,o/m,this.texture.frame.width/m,this.texture.frame.height/m)):a.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,n/m,o/m,this.texture.frame.width/m,this.texture.frame.height/m))}for(var p=0;p<this.children.length;p++)this.children[p]._renderCanvas(a);if(this._mask&&a.maskManager.popMask(a),this.maskPixel&&this.texture.valid){var q=a.context;q.globalCompositeOperation="destination-in",a.roundPixels?(q.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution|0,this.worldTransform.ty*a.resolution|0),
n=0|n,o=0|o):q.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution,this.worldTransform.ty*a.resolution),q.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,n/m,o/m,this.texture.crop.width/m,this.texture.crop.height/m),q.globalCompositeOperation="source-over",a.context=c,a.roundPixels?a.context.setTransform(1,0,0,1,f.x*a.resolution|0,f.y*a.resolution|0):a.context.setTransform(1,0,0,1,f.x*a.resolution,f.y*a.resolution),a.context.drawImage(l.canvas,0,0,l.canvas.width,l.canvas.height,0,0,l.canvas.width,l.canvas.height),b.push(l)}}};var wa=i.WebGLFastSpriteBatch.prototype.setContext;i.WebGLFastSpriteBatch.prototype.setContext=function(a){wa.call(this,a),this.quadSize=this.size,this.triangleSize=300,this.batchIndexNumber=6;var b=3*this.triangleSize;this.triangleIndices=new i.Uint16Array(b);for(var c=0;b>c;++c)this.triangleIndices[c]=c;this._batchType=g.BATCH_QUAD,this.quadIndexBuffer=this.indexBuffer,this.triangleIndexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.triangleIndexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.triangleIndices,a.STATIC_DRAW)};var xa=i.WebGLFastSpriteBatch.prototype.destroy;i.WebGLFastSpriteBatch.prototype.destroy=function(){this.triangleIndices=null,this.gl.deleteBuffer(this.triangleIndexBuffer),xa.call(this)},b.defineProperties(i.WebGLFastSpriteBatch.prototype,{batchType:{get:function(){return this._batchType},set:function(a){a!==this._batchType&&(this.stop(),a===g.BATCH_TRIANGLES?(this.size=this.triangleSize,this.indexBuffer=this.triangleIndexBuffer,this._batchType=a,this.batchIndexNumber=3):(this.size=this.quadSize,this.indexBuffer=this.quadIndexBuffer,this._batchType=a,this.batchIndexNumber=6),this.start())}}}),i.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(this.currentBaseTexture._glTextures[a.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,a),a.bindTexture(a.TEXTURE_2D,this.currentBaseTexture._glTextures[a.id]),this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var b=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,b)}a.drawElements(a.TRIANGLES,this.currentBatchSize*this.batchIndexNumber,a.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},i.WebGLFilterManager.prototype.initShaderBuffers=function(){var a=this.gl;this.vertexBuffer=a.createBuffer(),this.uvBuffer=a.createBuffer(),this.colorBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),this.vertexArray=new i.Float32Array([0,0,1,0,0,1,1,1]),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertexArray,a.STATIC_DRAW),this.uvArray=new i.Float32Array(8*Cb.MAX_SAMPLE_COUNT),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),a.bufferData(a.ARRAY_BUFFER,this.uvArray,a.STATIC_DRAW),this.colorArray=new i.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),a.bindBuffer(a.ARRAY_BUFFER,this.colorBuffer),a.bufferData(a.ARRAY_BUFFER,this.colorArray,a.STATIC_DRAW),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),a.STATIC_DRAW)},i.WebGLFilterManager.prototype.pushFilter=function(a){var b=this.gl,c=this.renderSession.projection,d=this.renderSession.offset;a._filterArea=a.target.filterArea||a.target.getBounds(),a._previous_stencil_mgr=this.renderSession.stencilManager,this.renderSession.stencilManager=new i.WebGLStencilManager,this.renderSession.stencilManager.setContext(b),b.disable(b.STENCIL_TEST),this.filterStack.push(a);var e=a.filterPasses[0];this.offsetX+=a._filterArea.x,this.offsetY+=a._filterArea.y;var f=this.texturePool.pop();f?f.resize(this.width,this.height):f=new i.FilterTexture(this.gl,this.width,this.height),b.bindTexture(b.TEXTURE_2D,f.texture);var g=a._filterArea,h=e.padding;g.x-=h,g.y-=h,g.width+=2*h,g.height+=2*h,b.bindFramebuffer(b.FRAMEBUFFER,f.frameBuffer),b.viewport(0,0,g.width,g.height),c.x=g.width/2,c.y=-g.height/2,d.x=-g.x,d.y=-g.y,b.colorMask(!0,!0,!0,!0),b.clearColor(0,0,0,0),b.clear(b.COLOR_BUFFER_BIT),a._glFilterTexture=f},i.WebGLFilterManager.prototype.popFilter=function(){var a=this.gl,b=this.filterStack.pop(),c=b._filterArea,d=b._glFilterTexture,e=b._glFilterTexture,f=this.renderSession.projection,g=this.renderSession.offset;if(b.filterPasses.length>1){a.viewport(0,0,c.width,c.height),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=c.height,this.vertexArray[2]=c.width,this.vertexArray[3]=c.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=c.width,this.vertexArray[7]=0,a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),this.uvArray[0]=0,this.uvArray[1]=0,this.uvArray[2]=c.width/this.width,this.uvArray[3]=0,this.uvArray[4]=0,this.uvArray[5]=c.height/this.height,this.uvArray[6]=c.width/this.width,this.uvArray[7]=c.height/this.height,a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray);var h=d,j=this.texturePool.pop();j||(j=new i.FilterTexture(this.gl,this.width,this.height)),j.resize(this.width,this.height),a.bindFramebuffer(a.FRAMEBUFFER,j.frameBuffer),a.clear(a.COLOR_BUFFER_BIT),a.disable(a.BLEND);for(var k=0;k<b.filterPasses.length-1;k++){var l=b.filterPasses[k],m=l.extraAttribute;if(m){a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);for(var n=0;n<m.length;++n){var o=l.uniforms[m[n].texture].value;if(o){var p=o._uvs;this.uvArray[8*(n+1)]=p.x3,this.uvArray[8*(n+1)+1]=p.y3,this.uvArray[8*(n+1)+2]=p.x2,this.uvArray[8*(n+1)+3]=p.y2,this.uvArray[8*(n+1)+4]=p.x0,this.uvArray[8*(n+1)+5]=p.y0,this.uvArray[8*(n+1)+6]=p.x1,this.uvArray[8*(n+1)+7]=p.y1}}a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray)}a.bindFramebuffer(a.FRAMEBUFFER,j.frameBuffer),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,h.texture),this.applyFilterPass(l,c,c.width,c.height,e);var q=h;h=j,q===e?(j=this.texturePool.pop(),j||(j=new i.FilterTexture(this.gl,this.width,this.height))):j=q}a.enable(a.BLEND),d=h,this.texturePool.push(j)}var r=b.filterPasses[b.filterPasses.length-1];this.offsetX-=c.x,this.offsetY-=c.y;var s=this.width,t=this.height,u=0,v=0,w=this.buffer;if(0===this.filterStack.length)a.colorMask(!0,!0,!0,!0);else{var x=this.filterStack[this.filterStack.length-1];c=x._filterArea,s=c.width,t=c.height,u=c.x,v=c.y,w=x._glFilterTexture.frameBuffer}f.x=s/2,f.y=-t/2,g.x=u,g.y=v,c=b._filterArea;var y=c.x-u,z=c.y-v;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=y,this.vertexArray[1]=z+c.height,this.vertexArray[2]=y+c.width,this.vertexArray[3]=z+c.height,this.vertexArray[4]=y,this.vertexArray[5]=z,this.vertexArray[6]=y+c.width,this.vertexArray[7]=z,a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),this.uvArray[0]=0,this.uvArray[1]=0,this.uvArray[2]=c.width/this.width,this.uvArray[3]=0,this.uvArray[4]=0,this.uvArray[5]=c.height/this.height,this.uvArray[6]=c.width/this.width,this.uvArray[7]=c.height/this.height;var m=r.extraAttribute;if(m)for(var n=0;n<m.length;++n){var o=r.uniforms[m[n].texture].value;if(o){var p=o._uvs;this.uvArray[8*(n+1)]=p.x3,this.uvArray[8*(n+1)+1]=p.y3,this.uvArray[8*(n+1)+2]=p.x2,this.uvArray[8*(n+1)+3]=p.y2,this.uvArray[8*(n+1)+4]=p.x0,this.uvArray[8*(n+1)+5]=p.y0,this.uvArray[8*(n+1)+6]=p.x1,this.uvArray[8*(n+1)+7]=p.y1}}a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray),a.viewport(0,0,s*this.renderSession.resolution,t*this.renderSession.resolution),a.bindFramebuffer(a.FRAMEBUFFER,w),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,d.texture),this.renderSession.stencilManager&&this.renderSession.stencilManager.destroy(),this.renderSession.stencilManager=b._previous_stencil_mgr,b._previous_stencil_mgr=null,this.renderSession.stencilManager.count>0?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.applyFilterPass(r,c,s,t,e),d!==e&&this.texturePool.push(e),this.texturePool.push(d),b._glFilterTexture=null},i.WebGLFilterManager.prototype.buildFilterTexture=function(a,b,c){var d=a.gl,e=d.isEnabled(d.STENCIL_TEST);e&&d.disable(d.STENCIL_TEST);var f=c.texture.baseTexture;f._glTextures[d.id]||a.renderer.updateTexture(f,d);var h=f._glTextures[d.id],j={texture:h},k=new g.Rectangle(0,0,f.width,f.height),l=c.texture.crop,m=c.texture._uvs,n=this.texturePool.pop();n||(n=new i.FilterTexture(this.gl,k.width,k.height)),n.resize(k.width,k.height),d.bindFramebuffer(d.FRAMEBUFFER,n.frameBuffer),d.viewport(0,0,k.width,k.height),d.colorMask(!0,!0,!0,!0),d.clearColor(0,0,0,0),d.clear(d.COLOR_BUFFER_BIT),d.disable(d.BLEND),d.bindBuffer(d.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=l.x,this.vertexArray[1]=k.height-l.y,this.vertexArray[2]=l.x+l.width,this.vertexArray[3]=k.height-l.y,this.vertexArray[4]=l.x,this.vertexArray[5]=k.height-l.y-l.height,this.vertexArray[6]=l.x+l.width,this.vertexArray[7]=k.height-l.y-l.height,d.bufferSubData(d.ARRAY_BUFFER,0,this.vertexArray);var o=b.filterPasses[0];d.bindBuffer(d.ARRAY_BUFFER,this.uvBuffer),this.uvArray[0]=m.x0,this.uvArray[1]=m.y0,this.uvArray[2]=m.x1,this.uvArray[3]=m.y1,this.uvArray[4]=m.x3,this.uvArray[5]=m.y3,this.uvArray[6]=m.x2,this.uvArray[7]=m.y2;var p=o.extraAttribute;if(p)for(var q=0;q<p.length;++q){var r=o.uniforms[p[q].texture].value;if(r){var m=r._uvs;this.uvArray[8*(q+1)]=m.x0,this.uvArray[8*(q+1)+1]=m.y0,this.uvArray[8*(q+1)+2]=m.x1,this.uvArray[8*(q+1)+3]=m.y1,this.uvArray[8*(q+1)+4]=m.x3,this.uvArray[8*(q+1)+5]=m.y3,this.uvArray[8*(q+1)+6]=m.x2,this.uvArray[8*(q+1)+7]=m.y2}}d.bufferSubData(d.ARRAY_BUFFER,0,this.uvArray),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,j.texture),this.applyFilterPass(o,new g.Rectangle(0,0,k.width,k.height),k.width,k.height,j,k.width,k.height);for(var s=null,t=1;t<b.filterPasses.length;t++){var u=s;s=n,n=u,n||(n=this.texturePool.pop(),n||(n=new i.FilterTexture(this.gl,k.width,k.height)),n.resize(k.width,k.height)),d.bindBuffer(d.ARRAY_BUFFER,this.uvBuffer),d.bufferSubData(d.ARRAY_BUFFER,0,this._filterSelfUVArray);var o=b.filterPasses[t],p=o.extraAttribute;if(p){d.bindBuffer(d.ARRAY_BUFFER,this.uvBuffer);for(var q=0;q<p.length;++q){var r=o.uniforms[p[q].texture].value;if(r){var m=r._uvs;this.uvArray[8*(q+1)]=m.x0,this.uvArray[8*(q+1)+1]=m.y0,this.uvArray[8*(q+1)+2]=m.x1,this.uvArray[8*(q+1)+3]=m.y1,this.uvArray[8*(q+1)+4]=m.x3,this.uvArray[8*(q+1)+5]=m.y3,this.uvArray[8*(q+1)+6]=m.x2,this.uvArray[8*(q+1)+7]=m.y2}}d.bufferSubData(d.ARRAY_BUFFER,0,this.uvArray)}d.bindFramebuffer(d.FRAMEBUFFER,n.frameBuffer),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,s.texture),this.applyFilterPass(o,new g.Rectangle(0,0,k.width,k.height),k.width,k.height,j,k.width,k.height)}return e&&d.enable(d.STENCIL_TEST),d.enable(d.BLEND),d.viewport(0,0,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),d.bindFramebuffer(d.FRAMEBUFFER,this.buffer),d.colorMask(!0,!0,!0,!0),n},i.WebGLFilterManager.prototype.applyFilterPass=function(a,b,c,d,e,f,g){var h=this.gl,j=a.shaders[h.id];if(j||(j=new i.PixiShader(h),j.fragmentSrc=a.fragmentSrc,a.vertexSrc&&(j.vertexSrc=a.vertexSrc),j.uniforms=a.uniforms,a.extraAttribute&&(j.extraAttribute=a.extraAttribute),j.init(),a.shaders[h.id]=j),this.renderSession.shaderManager.setShader(j),f=isNaN(f)?this.width:f,g=isNaN(g)?this.height:g,h.uniform2f(j.projectionVector,c/2,-d/2),h.uniform2f(j.offsetVector,0,0),j.pixelSize&&h.uniform2f(j.pixelSize,1/f,1/g),a.uniforms.dimensions&&(a.uniforms.dimensions.value[0]=f,a.uniforms.dimensions.value[1]=g,a.uniforms.dimensions.value[2]=this.vertexArray[0],a.uniforms.dimensions.value[3]=this.vertexArray[5]),j.syncUniforms(),j.uSourceSampler&&e){var k=j.textureCount++;h.activeTexture(h["TEXTURE"+k]),h.bindTexture(h.TEXTURE_2D,e.texture),h.uniform1i(j.uSourceSampler,k)}h.bindBuffer(h.ARRAY_BUFFER,this.vertexBuffer),h.vertexAttribPointer(j.aVertexPosition,2,h.FLOAT,!1,0,0);var l=a.extraAttribute;if(h.bindBuffer(h.ARRAY_BUFFER,this.uvBuffer),h.vertexAttribPointer(j.aTextureCoord,2,h.FLOAT,!1,0,0),l)for(var m=0;m<l.length;++m)h.vertexAttribPointer(j[l[m].name],2,h.FLOAT,!1,0,32*(m+1));h.bindBuffer(h.ARRAY_BUFFER,this.colorBuffer),h.vertexAttribPointer(j.colorAttribute,2,h.FLOAT,!1,0,0),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.indexBuffer),h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0),this.renderSession.drawCount++},i.WebGLMaskManager.prototype.popMask=function(a,b){var c=this.gl;a._webGL[c.id].data.length&&b.stencilManager.popStencil(a,a._webGL[c.id].data[0],b)},b.defineProperty(h.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width/this.resolution},set:function(a){this.scale.x=a/this.texture.frame.width,this._width=a}}),b.defineProperty(h.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height/this.resolution},set:function(a){this.scale.y=a/this.texture.frame.height,this._height=a}});var ya=200,za=i.Sprite.prototype._renderCanvas,Aa=i.Sprite.prototype._renderWebGL,Ba=function(a){return function(b){if(this.dirty)this.updateText(),this.getWorldTransform(),this.dirty=!1;else{var c=this._nqc,d=c.getWorldScale(),e=c._preWorldScale,f=c.game.time.fixedTime;if(e)if(e.x!==d.x||e.y!==d.y)e.x=d.x,e.y=d.y,c._worldScaleChangeTime=f,0===c.scaleDirtyInterval&&(this.updateText(),this.getWorldTransform(),this.dirty=!1);else{var h=this._worldScale,i=c.scaleDirtyInterval||ya;f-c._worldScaleChangeTime>i&&(!h||d.x!==h.x||d.y!==h.y)&&(this.updateText(),this.getWorldTransform(),this.dirty=!1)}else c._preWorldScale=new g.Point(d.x,d.y),c._worldScaleChangeTime=f}var j=this._canvasDownScale;if(!j)return void a.call(this,b);var k=this.worldTransform,l=k.a,m=k.b,n=k.c,o=k.d,p=j.x,q=j.y;k.a*=p,k.b*=p,k.c*=q,k.d*=q,a.call(this,b),k.a=l,k.b=m,k.c=n,k.d=o}};i.Text.prototype._renderCanvas=function(){return Ba(za)}(),i.Text.prototype._renderWebGL=function(){return Ba(Aa)}(),h.Text.prototype.updateLine=function(a,b,c,d,e,f,h,i,j,k){for(var l=0;l<a.length;l++){var m=a[l];this.colors[this._charCount]&&("defaultColor"===this.colors[this._charCount]?(d.fillStyle=f,d.strokeStyle=h):(d.fillStyle=this.colors[this._charCount],d.strokeStyle=this.colors[this._charCount]));var n=d.fillStyle,o=d.strokeStyle;this.style.stroke&&e&&(d.strokeStyle=this.style.stroke,d.strokeText(m,b,c)),d.fillStyle=n,d.strokeStyle=o;var p=d.measureText(m).width;if(this.style.fill)if(j===n&&k){if(d.save(),d.fillStyle="black",d.fillText(m,b,c),d.globalCompositeOperation="source-in",d.fillStyle=j,d.beginPath(),d.rect(b,c-i/2,p,i),d.clip(),d.fillRect(b,c-i/2,p,i),d.restore(),g.__IS_ANDROID_UC){var q=g._tempCanvas;q||(q=g._tempCanvas=document.createElement("canvas"),q.width=128,q.height=128),d.drawImage(q,0,0,2,2,-5,-5,1,1)}}else d.fillText(m,b,c);b+=p,this._charCount++}},h.Text.prototype._getWorldWidth=function(a){if(a.length>0&&"\n"===a[a.length-1]){var b=a.substr(0,a.length-1);return this.context.measureText(b).width}return this.context.measureText(a).width},h.Text.prototype._isLetter=function(a){return!1},h.Text.prototype.runWordWrap=function(a,b){for(var c=b,d=[],e=0,f=!1,g=0;g<a.length;)if("\n"===a[g]){var h=a.substr(e,g-e+1);1===h.length&&d.length>0&&!f?d[d.length-1]+="\n":d.push(h),g++,e=g,f=!0}else{f=!1;for(var i=-1;g<a.length;){var j=a.charAt(g);if(!this._isLetter(j)){i>=0&&g--;break}-1===i&&(i=g),g++}g===a.length&&g--;var k=this._getWorldWidth(a.substr(e,g-e+1));if(k>c)if(i>=0&&i===e){var h=a.substr(e,g-e+1);d.push(h),g++,e=g}else if(i>=0){var l=i-e,h=a.substr(e,l);d.push(h),g=e+l,e=g}else if(g-e===0){var h=a.substr(e,g-e+1);d.push(h),g++,e=g}else{var h=a.substr(e,g-e);d.push(h),e=g}else if(g++,g===a.length){var h=a.substr(e,g-e+1);d.push(h)}}return d},h.Text.prototype.preUpdate=function(){var a=this._qc;if(a&&!a["static"]){a.preUpdate&&a.preUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.preUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)){if(!this.visible)return;d.preUpdate()}}}if(this.fresh)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.inUpdate=!0,this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this._isNotNeedCalcTransform=!1,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.fresh=!1,!1;this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation;for(var c=this.children.length;c--;)this.children[c].visible?this.children[c].preUpdate():this.children[c].renderOrderID=-1;return!0},h.Text.prototype.update=function(){var a=this._qc;if(a&&!a["static"]){a.preUpdate&&a.preUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.preUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)){if(!this.visible)return;d.preUpdate()}}}},h.BitmapText.prototype._isLetter=h.Text.prototype._isLetter,h.BitmapText.prototype.runWordWrap=h.Text.prototype.runWordWrap,h.BitmapText.prototype._getWorldWidth=function(a){var b=0,c=i.BitmapText.fonts[this.fontName];if(!c||!a)return b;for(var d=this.fontSize/c.size,e=null,f=0;f<a.length;f++){var g=a.charCodeAt(f),h=c.chars[g];h&&(e&&h.kerning[e]&&(b+=h.kerning[e]),b+=h.xAdvance,e=g)}return b*d},i.BitmapText.prototype.updateText=function(){var a=this.text;if(this._nqc){var b=i.BitmapText.fonts[this.fontName];if(b){var c=new i.Point,d=null,e=[],f=0,g=[],h=this.fontSize/b.size,j=[];if(this._nqc.wrap){a=a.replace(/\r/gi,"").replace(/\n/gi,"\n");var j=this.runWordWrap(a,this._nqc.width)}else for(var j=a.split(/(?:\r\n|\r|\n)/),k=0;k<j.length-1;k++)j[k]+="\n";c.x=0,c.y=0;for(var k=0;k<j.length;k++){c.x=0,d=null;for(var l=j[k],m=0;m<l.length;m++){var n=l.charCodeAt(m),o=b.chars[n];o&&(d&&o.kerning[d]&&(c.x+=o.kerning[d]),e.push({texture:o.texture,line:k,charCode:n,position:new i.Point(c.x+o.xOffset,c.y+o.yOffset)}),c.x+=o.xAdvance,d=n)}g.push(c.x),f=Math.max(f,c.x),c.y+=b.lineHeight}var p=[];for(k=0;k<=j.length;k++){var q=0;"right"===this.style.align?q=f-g[k]:"center"===this.style.align&&(q=(f-g[k])/2),p.push(q)}var r=this.children.length,s=e.length,t=this.tint||16777215;this.textWidth=f*h,this.textHeight=b.lineHeight*h;var u=this.textWidth*this.anchor.x,v=this.textHeight*this.anchor.y;for(k=0;s>k;k++){var w=r>k?this.children[k]:this._pool.pop();w?w.setTexture(e[k].texture):w=new i.Sprite(e[k].texture),w.position.x=(e[k].position.x+p[e[k].line])*h-u,w.position.y=Math.floor(e[k].position.y*h-v),w.scale.x=w.scale.y=h,w.tint=t,w.parent||this.addChild(w)}for(;this.children.length>s;){var x=this.getChildAt(this.children.length-1);this._pool.push(x),this.removeChild(x)}this._nqc.textRealWidth=this.textWidth,this._nqc.textRealHeight=this.textHeight,this.realWidth=this.textWidth,this.realHeight=this.textHeight,this._nqc._adjustTextPos(this.textWidth,this.textHeight)}}},h.BitmapText.prototype.preUpdate=function(){var a=this._qc;if(a&&!a["static"]){a.preUpdate&&a.preUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.preUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)){if(!this.visible)return;d.preUpdate()}}}if(this.fresh)return a&&(a._isTransformDirty=!0),this.fresh=!1,!1;this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.renderOrderID=this.game.stage.currentRenderOrderID++;for(var c=this.children.length;c--;)this.children[c].visible?this.children[c].preUpdate():this.children[c].renderOrderID=-1;return!0},h.BitmapText.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);var a=this._qc;if(a&&!a["static"]){a.postUpdate&&a.postUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.postUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)&&(d.postUpdate(),!this.visible))return}}},h.Graphics.prototype.preUpdate=function(){var a=this._qc;if(a&&!a["static"]){a.preUpdate&&a.preUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.preUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)){if(!this.visible)return;d.preUpdate()}}}if(this.fresh)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,a&&(a._isTransformDirty=!0),this.fresh=!1,!1;this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.renderOrderID=this.game.stage.currentRenderOrderID++;for(var c=this.children.length;c--;)this.children[c].visible?this.children[c].preUpdate():this.children[c].renderOrderID=-1;return!0},h.Graphics.prototype.update=function(){var a=this._qc;if(a&&!a["static"]){a.update&&a.update();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.update&&(a.game.device.editor!==!0||d.runInEditor===!0)&&(d.update(),!this.visible))return}}for(var c=this.children.length;c--;)this.children[c].visible&&this.children[c].update()},h.Graphics.prototype.postUpdate=function(){this.key instanceof h.BitmapData&&this.key.render();var a=this._qc;if(a&&!a["static"]){a.postUpdate&&a.postUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.postUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)&&(d.postUpdate(),!this.visible))return}}for(var c=this.children.length;c--;)this.children[c].visible&&this.children[c].postUpdate()},h.Particle.prototype.updateTransform=function(){if(this.parent&&this.visible){var a=this._worldTransform;if(a){var b,c,d,e,f,g,h=this.worldTransform;this.rotation%i.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),b=this._cr*this.scale.x,c=this._sr*this.scale.x,d=-this._sr*this.scale.y,e=this._cr*this.scale.y,f=this.position.x,g=this.position.y,(this.pivot.x||this.pivot.y)&&(f-=this.pivot.x*b+this.pivot.y*d,g-=this.pivot.x*c+this.pivot.y*e),h.a=b*a.a+c*a.c,h.b=b*a.b+c*a.d,h.c=d*a.a+e*a.c,h.d=d*a.b+e*a.d,h.tx=f*a.a+g*a.c+a.tx,h.ty=f*a.b+g*a.d+a.ty):(b=this.scale.x,e=this.scale.y,f=this.position.x-this.pivot.x*b,g=this.position.y-this.pivot.y*e,h.a=b*a.a,h.b=b*a.b,h.c=e*a.c,h.d=e*a.d,h.tx=f*a.a+g*a.c+a.tx,h.ty=f*a.b+g*a.d+a.ty),this.worldAlpha=this.alpha,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,h,a)}}},h.Particle.prototype.update=function(){var a=this._qc;if(a&&!a["static"]){a.update&&a.update();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.update&&(a.game.device.editor!==!0||d.runInEditor===!0)&&(d.update(),!this.visible))return}}this.autoScale&&(this._s--,this._s>=0?this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y):this.autoScale=!1),this.autoAlpha&&(this._a--,this._a>=0?this.alpha=this.alphaData[this._a].v:this.autoAlpha=!1)},h.Sprite.prototype.preUpdate=function(){var a=this._qc;if(a&&!a["static"]){a.preUpdate&&a.preUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.preUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)){if(!this.visible)return;d.preUpdate()}}}if(this.fresh)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.body&&this.body.preUpdate(),a&&(a._isTransformDirty=!0),this.fresh=!1,!1;if(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.lifespan>0&&(this.lifespan-=this.game.time.physicsElapsedMS,this.lifespan<=0))return this.kill(),!1;this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.renderOrderID=this.game.stage.currentRenderOrderID++,this.animations&&this.animations.update(),this.body&&this.body.preUpdate();for(var c=this.children.length;c--;)this.children[c].visible?this.children[c].preUpdate():this.children[c].renderOrderID=-1;return!0},h.Sprite.prototype.update=function(){var a=this._qc;if(a&&!a["static"]){a.update&&a.update();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.update&&(a.game.device.editor!==!0||d.runInEditor===!0)&&(d.update(),!this.visible))return}}for(var c=this.children.length;c--;)this.children[c].visible&&this.children[c].update()},h.Sprite.prototype.postUpdate=function(){this.key instanceof h.BitmapData&&this.key.render(),this.body&&this.body.postUpdate(),this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);var a=this._qc;if(a&&!a["static"]){a.postUpdate&&a.postUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.postUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)&&(d.postUpdate(),!this.visible))return}}for(var c=this.children.length;c--;)this.children[c].visible&&this.children[c].postUpdate()},h.Tileset.prototype.updateTileData=function(a,b){a-=this.tileMargin,b-=this.tileMargin;var c,d;c=b>this.tileHeight?(b-this.tileHeight)/(this.tileHeight+this.tileSpacing)+1:b/this.tileHeight,d=a>this.tileWidth?(a-this.tileWidth)/(this.tileWidth+this.tileSpacing)+1:a/this.tileWidth,c=Math.floor(c),d=Math.floor(d),(this.rows&&this.rows!==c||this.columns&&this.columns!==d)&&console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ"),this.rows=c,this.columns=d,this.total=c*d,this.drawCoords.length=0;for(var e=this.tileMargin,f=this.tileMargin,g=0;g<this.rows;g++){for(var h=0;h<this.columns;h++)this.drawCoords.push(e),this.drawCoords.push(f),e+=this.tileWidth+this.tileSpacing;e=this.tileMargin,f+=this.tileHeight+this.tileSpacing}},h.Cache.prototype.getSound=function(a){return this._sounds[a]?this._sounds[a]:null},h.Loader.prototype.loadAudioTag=function(a){var b=this;if(this.game.sound.touchLocked)a.data=new Audio,a.data.name=a.key,a.data.preload="auto",a.data.src=this.transformUrl(a.url,a),this.fileComplete(a);else{a.data=new Audio,a.data.name=a.key;var c=function(){a.data.removeEventListener("canplaythrough",c,!1),a.data.onerror=null,h.GAMES[b.game.id].load.fileComplete(a)};a.data.onerror=function(){a.data.removeEventListener("canplaythrough",c,!1),a.data.onerror=null,b.fileError(a)},a.data.preload="auto",a.data.src=this.transformUrl(a.url,a),a.data.addEventListener("canplaythrough",c,!1)}},h.Sound.prototype.resume=function(){if(this.paused&&this._sound){if(this.usingWebAudio){var a=this.position+this.pausedPosition/1e3;this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.connect(this.externalNode?this.externalNode:this.gainNode),this.loop&&(this._sound.loop=!0),this.loop||""!==this.currentMarker||(this._sound.onended=this.onEndedHandler.bind(this));var b=this.duration-this.pausedPosition/1e3;"undefined"==typeof this._sound.start?this._sound.noteGrainOn(0,a,b):this.loop?this._sound.start(0,a):this._sound.start(0,a,b)}else this._sound.play();this.isPlaying=!0,this.paused=!1,this.startTime+=this.game.time.time-this.pausedTime,this.onResume.dispatch(this)}},h.SoundManager.prototype.decode=function(a,b){b=b||null;var c=this.game.cache.getSoundData(a);if(c&&this.game.cache.isSoundDecoded(a)===!1){this.game.cache.updateSound(a,"isDecoding",!0);var d=this;this.context.decodeAudioData(c,function(c){d.game.cache&&c&&(d.game.cache.decodedSound(a,c),d.onSoundDecode.dispatch(a,b))})}},h.SoundManager.prototype.boot=function(){if(this.game.device.iOS&&this.game.device.webAudio===!1&&(this.channels=1),a.PhaserGlobal){if(a.PhaserGlobal.disableAudio===!0)return this.usingWebAudio=!1,void(this.noAudio=!0);if(a.PhaserGlobal.disableWebAudio===!0)return this.usingWebAudio=!1,this.usingAudioTag=!0,void(this.noAudio=!1)}if(a.PhaserGlobal&&a.PhaserGlobal.audioContext)this.context=a.PhaserGlobal.audioContext;else if(a.AudioContext)try{this.context=new a.AudioContext}catch(b){this.context=null,this.usingWebAudio=!1,this.noAudio=!0,console.error("SoundManager boot error!",b),g.Util.popupError(b.message)}else if(a.webkitAudioContext)try{this.context=new a.webkitAudioContext}catch(b){this.context=null,this.usingWebAudio=!1,this.noAudio=!0,console.error("SoundManager boot error!",b),g.Util.popupError(b.message)}a.Audio&&null===this.context&&(this.usingWebAudio=!1,this.usingAudioTag=!0,this.noAudio=!1),null!==this.context&&(this.masterGain="undefined"==typeof this.context.createGain?this.context.createGainNode():this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination))},h.SoundManager.prototype.unlock=function(){if(this.touchLocked!==!1)if(this.game.device.webAudio===!1||a.PhaserGlobal&&a.PhaserGlobal.disableWebAudio===!0)this.touchLocked=!1,this._unlockSource=null,this.game.input._qc.touch.callbackContext=null,this.game.device.iOSVersion>8?this.game.input._qc.touch.touchEndCallback=null:this.game.input._qc.touch.touchStartCallback=null,this.game.input._qc.mouse.callbackContext=null,this.game.input._qc.mouse.mouseDownCallback=null;else{var b=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource(),this._unlockSource.buffer=b,this._unlockSource.connect(this.context.destination),"undefined"==typeof this._unlockSource.start?this._unlockSource.noteOn(0):this._unlockSource.start(0)}},h.SoundManager.prototype.update=function(){this.touchLocked&&this.game.device.webAudio&&null!==this._unlockSource&&(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)&&(this.touchLocked=!1,this._unlockSource=null,this.game.input._qc.touch.callbackContext=null,this.game.device.iOSVersion>8?this.game.input._qc.touch.touchEndCallback=null:this.game.input._qc.touch.touchStartCallback=null);for(var a=0;a<this._sounds.length;a++)this._sounds[a].update();if(this._watching){for(var b=this._watchList.first;b;)this.game.cache.isSoundDecoded(b)&&this._watchList.remove(b),b=this._watchList.next;0===this._watchList.total&&(this._watching=!1,this._watchCallback.call(this._watchContext))}},h.Loader.prototype.transformUrl=function(a){return/^http(s|):\/\//i.test(a)?a:this.baseURL+a},h.Loader.prototype.asyncComplete=function(a,b){"undefined"==typeof b&&(b=""),a.loaded=!0,a.error=!!b,a.requestObject&&200!==a.requestObject.status&&304!==a.requestObject.status&&(a.error=!0),b&&(a.errorMessage=b,console.warn("Phaser.Loader - "+a.type+"["+a.key+"]: "+b)),this.processLoadQueue()},i.CanvasRenderer.prototype.render=function(a){this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=i.blendModes.NORMAL,this.context.globalCompositeOperation=i.blendModesCanvas[i.blendModes.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=a.backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(a)},i.WebGLRenderer.prototype.render=function(a){if(!this.contextLost){
this.__stage!==a&&(this.__stage=a);var b=this.gl;b.viewport(0,0,this.width,this.height),b.bindFramebuffer(b.FRAMEBUFFER,null),this.clearBeforeRender&&(this.transparent?b.clearColor(0,0,0,0):b.clearColor(a.backgroundColorSplit[0],a.backgroundColorSplit[1],a.backgroundColorSplit[2],1),b.clear(b.COLOR_BUFFER_BIT)),this.renderDisplayObject(a,this.projection)}};var Ca=g.GameObjectFactory=function(a){this.game=a};Ca.prototype.constructor=Ca,Ca.prototype.clone=function(a,b){if(!a)return null;if(a instanceof s){var c=this.game.serializer.restoreBundle(a.json,b);return c._prefab=a.uuid,c}var d={},e=this.game.serializer.buildBundle(a,d);e.dependences=this.game.serializer.combineDependence(d);var c=this.game.serializer.restoreBundle(e,b?b:a.parent);return c},Ca.prototype.node=function(a,b){var c=new G(new h.Group(this.game.phaser,null),a,b);return c.name="node",c},Ca.prototype.text=function(a,b){return new Sa(this.game,a,b)},Ca.prototype.image=function(a,b){return new Da(this.game,a,b)},Ca.prototype.button=function(a,b){return new Ta(this.game,a,b)},Ca.prototype.toggle=function(a,b){return new Ua(this.game,a,b)},Ca.prototype.sprite=function(a,b){return new Ma(this.game,a,b)},Ca.prototype.sound=function(a,b){return new Va(this.game,a,b)},Ca.prototype.scrollView=function(a,b){return new Wa(this.game,a,b)},Ca.prototype.scrollBar=function(a,b,d){var e=new Xa(this.game,a,d),f=d!==c;if(f)return e;if(e.width=160,e.height=20,e.size=.2,e.direction=g.ScrollBar.LEFT_TO_RIGHT,b){var h=this.node(e);h.name="slidingArea",h.setAnchor(new g.Point(0,0),new g.Point(1,1)),h.setStretch(0,0,0,0),h.pivotX=h.pivotY=.5;var i=this.image(h);i.name="sliders",i.setAnchor(new g.Point(0,0),new g.Point(1,1)),i.setStretch(0,0,0,0),i.pivotX=i.pivotY=.5,e.sliders=i,e.interactive=!0}return e},Ca.prototype.progressBar=function(a,b,d){var e=new Ya(this.game,a,d),f=d!==c;if(f)return e;if(e.width=160,e.height=20,b){var h=this.node(e);h.name="progressArea",h.setAnchor(new g.Point(0,0),new g.Point(1,1)),h.setStretch(0,0,0,0),h.pivotX=h.pivotY=.5;var i=this.image(h);i.name="sliders",i.setAnchor(new g.Point(0,0),new g.Point(1,1)),i.setStretch(0,0,0,0),i.pivotX=i.pivotY=.5,e.sliders=i}return e},Ca.prototype.slider=function(a,b,d){var e=new Za(this.game,a,d),f=d!==c;if(f)return e;if(e.interactive=!0,e.width=160,e.height=20,b){var h=this.node(e);h.name="slidingArea",h.setAnchor(new g.Point(0,0),new g.Point(1,1)),h.setStretch(0,0,0,0),h.pivotX=h.pivotY=.5;var i=this.image(h);i.name="sliders",i.setAnchor(new g.Point(.5,.5),new g.Point(.5,.5)),i.setStretch(0,0,0,0),i.pivotX=i.pivotY=.5,e.sliders=i}return e},Ca.prototype.inputField=function(a,b){return new $a(this.game,a,b)},Ca.prototype.emitter=function(){throw new Error("Particle System is coming.")},Ca.prototype.tilemap=function(a,b){return new _a(this.game,a,b)},Ca.prototype.tileLayer=function(a,b){return new ab(this.game,a,b)},Ca.prototype.objectLayer=function(a,b){return new bb(this.game,a,b)},Ca.prototype.dom=function(a,b){return new cb(this.game,a,b)},Ca.prototype.graphics=function(a,b){return new db(this.game,a,b)};var Da=g.UIImage=function(a,b,c){var d=new h.Sprite(a.phaser);g.Node.call(this,d,b,c),d.updateTransform=Ka,d._renderWebGL=Ea,d._renderCanvas=Ia,this._borderLeft=0,this._borderRight=0,this._borderTop=0,this._borderBottom=0,this._imageType=g.UIImage.IMAGE_TYPE_SIMPLE,this.name="UIImage"};Da.prototype=b.create(g.Node.prototype),Da.prototype.constructor=Da,Da.IMAGE_TYPE_SIMPLE=0,Da.IMAGE_TYPE_SLICED=1,Da.IMAGE_TYPE_TILED=2,b.defineProperties(Da.prototype,{texture:{get:function(){return this._texture},set:function(a){if(!a)return this._texture=null,void this.phaser.loadTexture(null,this.frame);if(this._texture!==a){this._texture=a;var b=this.frame;a.getFrame(this.frame)||(b=0),this.phaser.key=a.key,this.frame=b,this._dispatchLayoutArgumentChanged("size"),this._onTextureChanged&&this._onTextureChanged.dispatch()}}},frame:{get:function(){return this.texture?this.phaser.frameName:null},set:function(a){this.texture&&(this.phaser.loadTexture(this.texture.key,a),this.setWidth(this.width),this.setHeight(this.height),this._resetNinePadding(),this._dispatchLayoutArgumentChanged("size"),this._onTextureChanged&&this._onTextureChanged.dispatch())}},nativeSize:{get:function(){return this.phaser&&this.phaser.texture&&this.phaser.texture.crop||new g.Rectangle(0,0,0,0)}},imageType:{get:function(){return this._imageType},set:function(a){this._imageType=a}},borderTop:{get:function(){return this._borderTop},set:function(a){this._borderTop=a}},borderBottom:{get:function(){return this._borderBottom},set:function(a){this._borderBottom=a}},borderLeft:{get:function(){return this._borderLeft},set:function(a){this._borderLeft=a}},borderRight:{get:function(){return this._borderRight},set:function(a){this._borderRight=a}},onTextureChanged:{get:function(){return this._onTextureChanged||(this._onTextureChanged=new h.Signal),this._onTextureChanged}},"class":{get:function(){return"qc.UIImage"}}}),Da.prototype.resetNativeSize=function(){this.parent?(this.width=this.nativeSize.width,this.height=this.nativeSize.height):(this.setWidth(this.nativeSize.width),this.setHeight(this.nativeSize.width))},Da.prototype.setWidth=function(a){G.prototype.setWidth.call(this,a),this.phaser.texture.trim||(this.phaser.texture.frame.width=a)},Da.prototype.setHeight=function(a){G.prototype.setHeight.call(this,a),this.phaser.texture.trim||(this.phaser.texture.frame.height=a)},Da.prototype._resetNinePadding=function(){var a=this.texture;if(a){var b=a.getPadding(this.frame);this._borderLeft=b[0],this._borderTop=b[1],this._borderRight=b[2],this._borderBottom=b[3]}},Da.prototype.getMeta=function(){var a=g.Serializer,b=g.Node.prototype.getMeta.call(this);return b.texture=a.TEXTURE,b.frame=a.AUTO,b.imageType=a.NUMBER,b};var Ea=function(a){var b=this._qc;if(b.imageType===g.UIImage.IMAGE_TYPE_SIMPLE)return h.Sprite.prototype._renderWebGL.call(this,a);if(this.visible&&!(this.alpha<=0)&&this.renderable){var c;if(this.softClip&&X.getManager(a).pushPolygon(this.softClip),this._graphicsFilter||this._mask||this._filters){var d=a.spriteBatch;for(this._graphicsFilter&&(d.flush(),a.filterManager.pushFilter(this._graphicsFilter)),this._filters&&!this.filterSelf&&(d.flush(),a.filterManager.pushFilter(this._filterBlock)),this._mask&&(d.stop(),a.maskManager.pushMask(this.mask,a),d.start()),this._filters&&this.filterSelf&&(d.flush(),a.filterManager.pushFilter(this._filterBlock)),Ja(d,this),this._filters&&this.filterSelf&&(d.stop(),a.filterManager.popFilter(),d.start()),c=0;c<this.children.length;c++)this.children[c]._renderWebGL(a);d.stop(),this._mask&&a.maskManager.popMask(this._mask,a),this._filters&&!this.filterSelf&&a.filterManager.popFilter(),this._graphicsFilter&&a.filterManager.popFilter(),d.start()}else for(Ja(a.spriteBatch,this),c=0;c<this.children.length;c++)this.children[c]._renderWebGL(a);this.softClip&&X.getManager(a).popPolygon()}},Fa=function(a,b){var c=b.texture,d=c._uvs;if(d){var e,f,g,i,j=b._qc,k=j.borderLeft,l=j.borderRight,m=j.borderTop,n=j.borderBottom,o=b.anchor.x,p=b.anchor.y;if(c.trim){var q=c.trim;f=q.x-o*q.width,e=f+c.crop.width,i=q.y-p*q.height,g=i+c.crop.height}else e=c.frame.width*(1-o),f=c.frame.width*-o,g=c.frame.height*(1-p),i=c.frame.height*-p;var r=c.baseTexture.width,s=c.baseTexture.height,t=[new h.Point(d.x0,d.y0),new h.Point(d.x0+k/r,d.y0+m/s),new h.Point(d.x2-l/r,d.y2-n/s),new h.Point(d.x2,d.y2)],u=Math.abs(e-f),v=Math.abs(g-i);k+l>u&&(k=u*k/(k+l),l=u-k),f>e&&(k=-k,l=-l),m+n>v&&(m=v*m/(m+n),n=v-m),i>g&&(m=-m,n=-n);var w=[new h.Point(f,i),new h.Point(f+k,i+m),new h.Point(e-l,g-n),new h.Point(e,g)],x=b.tint;x=(x>>16)+(65280&x)+((255&x)<<16)+(255*b.worldAlpha<<24);for(var y=c.baseTexture.resolution,z=b.worldTransform,A=z.a/y,B=z.b/y,C=z.c/y,D=z.d/y,E=z.tx,F=z.ty,G=0;3>G;++G)for(var H=G+1,I=0;3>I;++I){var J=I+1;Ga(a,b,w[G].x,w[I].y,w[H].x,w[J].y,t[G].x,t[I].y,t[H].x,t[J].y,A,B,C,D,E,F,x)}}},Ga=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=a.renderSession.softClipManager;if(r&&r.needClip)return void r.renderSprite(a.renderSession,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q);a.currentBatchSize>=a.size&&(a.flush(),a.currentBaseTexture=b.texture.baseTexture);var s=a.colors,t=a.positions,u=4*a.currentBatchSize*a.vertSize;a.renderSession.roundPixels?(t[u]=k*c+m*d+o|0,t[u+1]=n*d+l*c+p|0,t[u+5]=k*e+m*d+o|0,t[u+6]=n*d+l*e+p|0,t[u+10]=k*e+m*f+o|0,t[u+11]=n*f+l*e+p|0,t[u+15]=k*c+m*f+o|0,t[u+16]=n*f+l*c+p|0):(t[u]=k*c+m*d+o,t[u+1]=n*d+l*c+p,t[u+5]=k*e+m*d+o,t[u+6]=n*d+l*e+p,t[u+10]=k*e+m*f+o,t[u+11]=n*f+l*e+p,t[u+15]=k*c+m*f+o,t[u+16]=n*f+l*c+p),t[u+2]=g,t[u+3]=h,t[u+7]=i,t[u+8]=h,t[u+12]=i,t[u+13]=j,t[u+17]=g,t[u+18]=j,s[u+4]=s[u+9]=s[u+14]=s[u+19]=q,a.sprites[a.currentBatchSize++]=b},Ha=function(a,b){var c=b.texture,d=c._uvs;if(d){var e,f,g,i,j=b._qc,k=j.borderLeft,l=j.borderRight,m=j.borderTop,n=j.borderBottom,o=b.anchor.x,p=b.anchor.y;if(c.trim){var q=c.trim;f=q.x-o*q.width,e=f+c.crop.width,i=q.y-p*q.height,g=i+c.crop.height}else e=c.frame.width*(1-o),f=c.frame.width*-o,g=c.frame.height*(1-p),i=c.frame.height*-p;var r=c.baseTexture.width,s=c.baseTexture.height,t=[new h.Point(d.x0,d.y0),new h.Point(d.x0+k/r,d.y0+m/s),new h.Point(d.x2-l/r,d.y2-n/s),new h.Point(d.x2,d.y2)],u=d.x0+k/r,v=d.y0+m/s,w=d.x2-l/r,x=d.y2-n/s,y=Math.abs(e-f),z=Math.abs(g-i);k+l>y&&(k=y*k/(k+l),l=y-k),f>e&&(k=-k,l=-l),m+n>z&&(m=z*m/(m+n),n=z-m),i>g&&(m=-m,n=-n);var A=e-l,B=g-n,C=f+k,D=i+m,E=[new h.Point(f,i),new h.Point(C,D),new h.Point(A,B),new h.Point(e,g)],F=b.tint;F=(F>>16)+(65280&F)+((255&F)<<16)+(255*b.worldAlpha<<24);var G=c.baseTexture.resolution,H=b.worldTransform,I=H.a/G,J=H.b/G,K=H.c/G,L=H.d/G,M=H.tx,N=H.ty,O=(d.x2-d.x0)*r-k-l,P=(d.y2-d.y0)*s-m-n;y-k-l>32*O&&(O=(y-k-l)/32),z-m-n>32*P&&(P=(z-m-n)/32);var Q=w,R=x;if(O>0&&P>0)for(var S=D;B>S;S+=P){var T=S+P;T>B&&(R=v+(x-v)*(B-S)/(T-S),T=B),Q=w;for(var U=C;A>U;U+=O){var V=U+O;V>A&&(Q=u+(w-u)*(A-U)/(V-U),V=A),Ga(a,b,U,S,V,T,u,v,Q,R,I,J,K,L,M,N,F)}}if(Q=w,R=x,P)for(var S=D;B>S;S+=P){var T=S+P;T>B&&(R=v+(x-v)*(B-S)/(T-S),T=B),Ga(a,b,f,S,C,T,d.x0,v,u,R,I,J,K,L,M,N,F),Ga(a,b,A,S,e,T,w,v,d.x2,R,I,J,K,L,M,N,F)}if(Q=w,R=x,O)for(var U=C;A>U;U+=O){var V=U+O;V>A&&(Q=u+(w-u)*(A-U)/(V-U),V=A),Ga(a,b,U,i,V,D,u,d.y0,Q,v,I,J,K,L,M,N,F),Ga(a,b,U,B,V,g,u,x,Q,d.y2,I,J,K,L,M,N,F)}Ga(a,b,E[0].x,E[0].y,E[1].x,E[1].y,t[0].x,t[0].y,t[1].x,t[1].y,I,J,K,L,M,N,F),Ga(a,b,E[2].x,E[0].y,E[3].x,E[1].y,t[2].x,t[0].y,t[3].x,t[1].y,I,J,K,L,M,N,F),Ga(a,b,E[2].x,E[2].y,E[3].x,E[3].y,t[2].x,t[2].y,t[3].x,t[3].y,I,J,K,L,M,N,F),Ga(a,b,E[0].x,E[2].y,E[1].x,E[3].y,t[0].x,t[2].y,t[1].x,t[3].y,I,J,K,L,M,N,F)}},Ia=function(a){if(!(this.visible===!1||0===this.alpha||this.renderable===!1||this.texture.crop.width<=0||this.texture.crop.height<=0)){var b=this.texture.valid,c=this._qc,d=c.imageType;if(this.maskPixel&&b&&d===g.UIImage.IMAGE_TYPE_SIMPLE){var e=a.bufferPool||(a.bufferPool=[]),f=a.context,j=f.globalOffX||0,k=f.globalOffY||0,l=this.maskPixel.target.filterArea||this.maskPixel.target.getBounds(),m=Math.max(j,l.x),n=Math.max(k,l.y),o=Math.min(l.x+l.width,f.canvas.width+j),p=Math.min(l.y+l.height,f.canvas.height+k);l.x=m,l.y=n,l.width=o-m,l.height=p-n;var q=e.pop();q||(q=new i.CanvasBuffer(a.context.canvas.width*a.resolution,a.context.canvas.height*a.resolution),q.context._setTransform=q.context.setTransform,q.context.setTransform=function(a,b,c,d,e,f){this._setTransform(a,b,c,d,e-(this.globalOffX||0),f-(this.globalOffY||0))}),q.resize(l.width*a.resolution,l.height*a.resolution),q.context.clearRect(0,0,l.width*a.resolution,l.height*a.resolution),q.context.globalOffX=l.x*a.resolution+j,q.context.globalOffY=l.y*a.resolution+k,a.context=q.context}var r=a.context;if(this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,r.globalCompositeOperation=i.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a),b){var s=this.texture.baseTexture.resolution/a.resolution;r.globalAlpha=this.worldAlpha,!a.smoothProperty||a.scaleMode===this.texture.baseTexture.scaleMode&&r[a.smoothProperty]===(a.scaleMode===i.scaleModes.LINEAR)||(a.scaleMode=this.texture.baseTexture.scaleMode,r[a.smoothProperty]=a.scaleMode===i.scaleModes.LINEAR);var t=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,u=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,v=this.texture.trim?this.texture.crop.width:this.texture.frame.width,w=this.texture.trim?this.texture.crop.height:this.texture.frame.height;a.roundPixels?(r.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution|0,this.worldTransform.ty*a.resolution|0),t=0|t,u=0|u):r.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution,this.worldTransform.ty*a.resolution);var x,y,z,A,B,C=function(a,b,c,d,e,f,g,h,i,j){a.drawImage(b,c,d,e||1,f||1,g,h,i||1,j||1)};if(16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=i.CanvasTinter.getTintedTexture(this,this.tint)),x=this.tintedTexture,y=0,z=0,A=this.texture.crop.width,B=this.texture.crop.height):(x=this.texture.baseTexture.source,y=this.texture.crop.x,z=this.texture.crop.y,A=this.texture.crop.width,B=this.texture.crop.height),t=Math.round(t/s),u=Math.round(u/s),v=Math.round(v/s),w=Math.round(w/s),d===g.UIImage.IMAGE_TYPE_SIMPLE)this.maskPixel||C(r,x,y,z,A,B,t,u,v,w);else if(c.texture&&v&&w){var D=c.texture.uuid+d+c.frame+this.tint+v+w,E=g.CanvasPool.get(D),F=E.canvas;if(E.dirty){var G=F.getContext("2d");a.smoothProperty&&G[a.smoothProperty]!==(a.scaleMode===i.scaleModes.LINEAR)&&(G[a.smoothProperty]=a.scaleMode===i.scaleModes.LINEAR),F.width=v,F.height=w,G.clearRect(0,0,v,w);var H=c.borderLeft,I=c.borderRight,J=c.borderTop,K=c.borderBottom,L=[new h.Point(y,z),new h.Point(y+H,z+J),new h.Point(y+A-I,z+B-K),new h.Point(y+A,z+B)];H/=s,J/=s,I/=s,K/=s,H+I>v&&(H=v*H/(H+I),I=v-H),J+K>w&&(J=w*J/(J+K),K=w-J);var M=[new h.Point(0,0),new h.Point(H,J),new h.Point(v-I,w-K),new h.Point(v,w)];if(d==g.UIImage.IMAGE_TYPE_SLICED)for(var N=0;3>N;++N)for(var O=N+1,P=0;3>P;++P){var Q=P+1,R=L[N].x,S=L[P].y,T=L[O].x,U=L[Q].y,V=M[N].x,W=M[P].y,X=M[O].x,Y=M[Q].y;0>=T-R||0>=U-S||0>=X-V||0>=Y-W||C(G,x,R,S,T-R,U-S,V,W,X-V,Y-W)}else{var Z=L[1].x,$=L[1].y,_=L[2].x,aa=L[2].y,ba=v-I,ca=w-K,da=H,ea=J,fa=A/s-H-I,ga=B/s-J-K;v-H-I>32*fa&&(fa=(v-H-I)/32),w-J-K>32*ga&&(ga=(w-J-K)/32);var ha=_,ia=aa;if(fa>0&&ga>0)for(var ja=ea;ca>ja;ja+=ga){var Q=ja+ga;Q>ca&&(ia=$+(aa-$)*(ca-ja)/(Q-ja),Q=ca),ha=_;for(var ka=da;ba>ka;ka+=fa){var O=ka+fa;O>ba&&(ha=Z+(_-Z)*(ba-ka)/(O-ka),O=ba),0>=ha-Z||0>=ia-$||0>=O-ka||0>=Q-ja||C(G,x,Z,$,ha-Z,ia-$,ka,ja,O-ka,Q-ja)}}if(ia=aa,ga)for(var ja=ea;ca>ja;ja+=ga){var Q=ja+ga;Q>ca&&(ia=$+(aa-$)*(ca-ja)/(Q-ja),Q=ca),C(G,x,y,$,Z-y,ia-$,0,ja,H,Q-ja),C(G,x,_,$,y+A-_,ia-$,ba,ja,I,Q-ja)}if(ha=_,fa)for(var ka=da;ba>ka;ka+=fa){var O=ka+fa;O>ba&&(ha=Z+(_-Z)*(ba-ka)/(O-ka),O=ba),C(G,x,Z,z,ha-Z,$-z,ka,0,O-ka,J),C(G,x,Z,aa,ha-Z,z+B-aa,ka,ca,O-ka,K)}C(G,x,L[0].x,L[0].y,L[1].x-L[0].x,L[1].y-L[0].y,M[0].x,M[0].y,M[1].x-M[0].x,M[1].y-M[0].y),C(G,x,L[2].x,L[0].y,L[3].x-L[2].x,L[1].y-L[0].y,M[2].x,M[0].y,M[3].x-M[2].x,M[1].y-M[0].y),C(G,x,L[2].x,L[2].y,L[3].x-L[2].x,L[3].y-L[2].y,M[2].x,M[2].y,M[3].x-M[2].x,M[3].y-M[2].y),C(G,x,L[0].x,L[2].y,L[1].x-L[0].x,L[3].y-L[2].y,M[0].x,M[2].y,M[1].x-M[0].x,M[3].y-M[2].y)}}C(r,F,0,0,v,w,t,u,v,w)}}for(var la=0;la<this.children.length;la++)this.children[la]._renderCanvas(a);if(this._mask&&a.maskManager.popMask(a),this.maskPixel&&b&&d===g.UIImage.IMAGE_TYPE_SIMPLE){if(r.globalCompositeOperation="destination-in",a.roundPixels?(r.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution|0,this.worldTransform.ty*a.resolution|0),t=0|t,u=0|u):r.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution,this.worldTransform.ty*a.resolution),C(r,x,y,z,A,B,t,u,v,w),r.globalCompositeOperation="source-over",a.context=f,a.roundPixels?a.context.setTransform(1,0,0,1,l.x*a.resolution|0,l.y*a.resolution|0):a.context.setTransform(1,0,0,1,l.x*a.resolution,l.y*a.resolution),!q.canvas.height||!q.canvas.width)return;a.context.drawImage(q.canvas,0,0,q.canvas.width,q.canvas.height,0,0,q.canvas.width,q.canvas.height),e.push(q)}}},Ja=function(a,b){switch(b._qc.imageType){case Da.IMAGE_TYPE_SLICED:Fa(a,b);break;case Da.IMAGE_TYPE_TILED:Ha(a,b)}},Ka=function(){if(!this._qc.skewX&&!this._qc.skewY)return h.Sprite.prototype.updateTransform.call(this);if(this.parent&&this.visible){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var a,b,c,d,e,f,g,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;g=Math.cos(this._qc.skewY||0),i=Math.sin(this._qc.skewY||0),j=-Math.sin(this._qc.skewX||0),k=Math.cos(this._qc.skewX||0),l=this.position.x,m=this.position.y,n=this._cr*this.scale.x,o=this._sr*this.scale.x,p=-this._sr*this.scale.y,q=this._cr*this.scale.y,r=0,s=0,a=n*g+o*j,b=n*i+o*k,c=p*g+q*j,d=p*i+q*k,e=r*g+s*j+l,f=r*i+s*k+m;var x=this.worldTransform,y=this.parent.worldTransform;if(t=y.a,u=y.b,v=y.c,w=y.d,x.a=a*t+b*v,x.b=a*u+b*w,x.c=c*t+d*v,x.d=c*u+d*w,x.tx=e*t+f*v+y.tx,x.ty=e*u+f*w+y.ty,this.worldAlpha=this.alpha*this.parent.worldAlpha,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,x,y),!this._cacheAsBitmap)for(var z=0,A=this.children.length;A>z;z++)this.children[z].updateTransform()}},La=g.UIRoot=function(a,b){g.Node.call(this,new h.Group(a.phaser,null),null,b),this.name="UIRoot";var d=b!==c;if(!d){var e=this.addScript("qc.ScaleAdapter");e.referenceResolution=new g.Point(640,960),e.manualType=g.ScaleAdapter.EXPAND,e.fullTarget=!0}this.setAnchor(new g.Point(0,0),new g.Point(0,0)),this.pivotX=0,this.pivotY=0;var f=this.getWorldScale();this.setTransformToWorld(0,0,f.x,f.y,this.getWorldRotation())};La.prototype=b.create(g.Node.prototype),La.prototype.constructor=La,b.defineProperties(La.prototype,{"class":{get:function(){return"qc.UIRoot"}}}),La.prototype.postUpdate=function(){this.x=0,this.y=0};var Ma=g.Sprite=function(a,b,c){var d=new h.Sprite(a.phaser);g.Node.call(this,d,b,c),this.name="Sprite",this.animationType=g.Sprite.NONE_ANIMATION,this._phaserImageSetFrame=d.setFrame,d.setFrame=Oa,d._renderWebGL=Qa,d._renderCanvas=Ra};Ma.prototype=b.create(g.Node.prototype),Ma.prototype.constructor=Ma,Ma.NONE_ANIMATION=0,Ma.FRAME_ANIMATION=1,Ma.DRAGON_BONES=2,Ma.FRAME_SAMPLES=3;var Na=8;Ma.prototype.playAnimation=function(a,b,d){var e=this,f=e.animationType;if(f!==Ma.NONE_ANIMATION&&a){if(f===Ma.DRAGON_BONES){var g=e._armature.animation;if(g.animationNameList.indexOf(a)<0)return void console.warn("没有动作名为",a,"的动作");var h=c;if("number"==typeof b&&1!=b&&b>0){for(var i,j=g.animationNameList.length;j--;)if(g._animationDataList[j].name==a){i=g._animationDataList[j];break}i&&(h=i.duration/b)}var k;return k=d===!0?2097152:d===!1?1:c,e.paused=!1,void e._armature.animation.gotoAndPlay(a,c,h,k)}var i=this._animation[a];if(!i)return void e.game.log.error("Animation {0} not exists",a);var l=i.rate?i.rate:60;if(f===Ma.FRAME_SAMPLES&&(l*=Na),!e.phaser.animations._anims[a]){e.phaser.animations.add(a,i.frames,l);var g=e.phaser.animations._anims[a];g.onStart.add(function(){e._onStart&&e._onStart.dispatch(e.lastAnimationName)}),g.onComplete.add(function(){e._onFinished&&e._onFinished.dispatch(e.lastAnimationName)}),g.onLoop.add(function(){e._onLoopFinished&&e._onLoopFinished.dispatch(e.lastAnimationName)})}"boolean"!=typeof d&&(d=!!i.loop),this._slowMotion=this.game.time.timeScale,this._speed=(b?b:1)*l,e.phaser.animations.play(a,this._speed/this._slowMotion,d)}},Ma.prototype.stop=function(){var a=this,b=a.animationType;if(b!==Ma.NONE_ANIMATION&&a.isPlaying){if(b===Ma.DRAGON_BONES){var d=a._armature.animation;return void d.stop()}var e=a.phaser.animations.currentAnim;e&&e.stop(c,!0)}},Ma.prototype.update=function(){if(this.animationType===g.Sprite.DRAGON_BONES&&this._armature){if(this.isPaused())return;var a=.001*this.game.time.deltaTime;this._armature.advanceTime(a)}else if(this.animationType===g.Sprite.FRAME_ANIMATION||this.animationType===g.Sprite.FRAME_SAMPLES){var b=this.game.time.timeScale;if(b===this._slowMotion)return;this._slowMotion=b;var c=this.phaser.animations.currentAnim;c&&(c.speed=this._speed/b)}},Ma.prototype.bindDragonBonesEvent=function(){var a=this;a._armature.addEventListener("start",function(){a._onStart&&a._onStart.dispatch(a.lastAnimationName)}),a._armature.addEventListener("complete",function(){a._onFinished&&a._onFinished.dispatch(a.lastAnimationName)}),a._armature.addEventListener("loopComplete",function(){a._onLoopFinished&&a._onLoopFinished.dispatch(a.lastAnimationName)})},Ma.prototype.getAnimationInfo=function(a){var b=this.animationType;if(b!==Ma.NONE_ANIMATION){if(b===Ma.DRAGON_BONES){var c=this._armature.animation;if(c.animationNameList.indexOf(a)<0)return;for(var d,e=c.animationNameList.length;e--;)if(c._animationDataList[e].name==a){d=c._animationDataList[e];break}return d}var d=this._animation[a];if(d){var f=d.frames||[],g=d.rate?parseFloat(d.rate):30;return{frames:f,frameRate:g,loop:d.loop?0:1,duration:f.length/g}}}},b.defineProperties(Ma.prototype,{texture:{get:function(){return this._texture},set:function(a){if(this.animationType===Ma.DRAGON_BONES&&this._boneBase&&(this.removeChild(this._boneBase),this._armature=null,this._boneBase=null),!a)return this._texture=null,this.phaser.loadTexture(null,this.frame),void(this.animationType=Ma.NONE_ANIMATION);if(this._texture=a,this.animationType=a.animation?a.animation.type:Ma.NONE_ANIMATION,this.animationType===Ma.DRAGON_BONES){var b=self._armature=g.dragonBones.makeQcArmature(a.animation.data,a.json,a.img,a.key);if(!b)return void console.warn("生成骨骼失败，参数：（img:",a.img,"atlas:",a.json,"skeleton:",a.animation.data,"）");this._armature=b;var c=b.getDisplay();this.addChild(c),this._boneBase=c,this.colorTint=this.colorTint}else this.animationType===Ma.FRAME_ANIMATION?(this._animation=a.animation.data.animations,this.phaser.animations=new h.AnimationManager(this.phaser)):this.animationType===Ma.FRAME_SAMPLES&&(this._animation=a.animation.data.samples,this.phaser.animations=new h.AnimationManager(this.phaser));var d=this.frame;a.getFrame(this.frame)||(d=0),this.phaser.key=a.key,this.frame=d,this.paused=!1,this.animationType===Ma.DRAGON_BONES&&this.bindDragonBonesEvent(),this.defaultAnimation&&(!this.animationNameList||this.animationNameList.indexOf(this.defaultAnimation)<0?this.defaultAnimation=null:this.playAnimation(this.defaultAnimation)),this._dispatchLayoutArgumentChanged("size"),this._onTextureChanged&&this._onTextureChanged.dispatch()}},frame:{get:function(){return this.texture?this.phaser.frameName:null},set:function(a){this.texture&&(this.phaser.loadTexture(this.texture.key,a,!1),this._dispatchLayoutArgumentChanged("size"),this._onTextureChanged&&this._onTextureChanged.dispatch())}},defaultAnimation:{get:function(){return this._defaultAnimation},set:function(a){this._defaultAnimation=a,this.playAnimation(a)}},paused:{get:function(){return this.isPaused()},set:function(a){switch(this.animationType){case g.Sprite.FRAME_ANIMATION:case g.Sprite.FRAME_SAMPLES:if(!this.phaser.animations.currentAnim)return;this.phaser.animations.paused=a;break;case g.Sprite.DRAGON_BONES:this._paused=a}}},isPlaying:{get:function(){switch(this.animationType){case g.Sprite.FRAME_ANIMATION:case g.Sprite.FRAME_SAMPLES:var a=this.phaser.animations.currentAnim;return!!a&&a.isPlaying;case g.Sprite.DRAGON_BONES:return this._armature&&this._armature.animation.getIsPlaying();default:return!1}}},isComplete:{get:function(){switch(this.animationType){case g.Sprite.FRAME_ANIMATION:case g.Sprite.FRAME_SAMPLES:var a=this.phaser.animations.currentAnim;return!!a&&a.isFinished;case g.Sprite.DRAGON_BONES:return this._armature&&this._armature.animation.getIsComplete();default:return!1}}},lastAnimationName:{get:function(){switch(this.animationType){case g.Sprite.FRAME_ANIMATION:case g.Sprite.FRAME_SAMPLES:var a=this.phaser.animations.currentAnim;return a?a.name:null;case g.Sprite.DRAGON_BONES:return this._armature&&this._armature.animation.getLastAnimationName();default:return!1}}},onStart:{get:function(){return this._onStart||(this._onStart=new h.Signal),this._onStart}},onFinished:{get:function(){return this._onFinished||(this._onFinished=new h.Signal),this._onFinished}},onLoopFinished:{get:function(){return this._onLoopFinished||(this._onLoopFinished=new h.Signal),this._onLoopFinished}},nativeSize:{get:function(){return this.phaser&&this.phaser.texture&&this.phaser.texture.crop||new g.Rectangle(0,0,0,0)}},armature:{get:function(){return this._armature}},animationNameList:{get:function(){switch(this.animationType){case g.Sprite.FRAME_ANIMATION:if(!this.texture)return null;var a=this.texture.animation.data.animations;return a?b.keys(a):null;case g.Sprite.DRAGON_BONES:return this._armature?this._armature.animation.animationNameList:null;case g.Sprite.FRAME_SAMPLES:var c=this._animation;return c?b.keys(c):null;default:return null}}},colorTint:{get:function(){return new oa(this.phaser.tint)},set:function(a){if(!(a instanceof oa))throw new Error("Expected:qc.Color");this.phaser.tint=a.toNumber(),this.animationType===g.Sprite.DRAGON_BONES&&this._armature&&this._armature._slotList.forEach(function(b){b._displayList&&b._displayList.forEach(function(b){b.colorTint=a})})}},onTextureChanged:{get:function(){return this._onTextureChanged||(this._onTextureChanged=new h.Signal),this._onTextureChanged}},"class":{get:function(){return"qc.Sprite"}}}),Ma.prototype.resetNativeSize=function(){this.width=this.nativeSize.width,this.height=this.nativeSize.height},Ma.prototype.isPaused=function(){switch(this.animationType){case g.Sprite.FRAME_ANIMATION:case g.Sprite.FRAME_SAMPLES:return this.phaser.animations.currentAnim?this.phaser.animations.paused:!1;case g.Sprite.DRAGON_BONES:return this._paused;default:return!1}};var Oa=function(a){var b=this._qc;b._phaserImageSetFrame.call(this,a),b.animationType!==g.Sprite.DRAGON_BONES&&(b.setWidth(b.width),b.setHeight(b.height))},Pa=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){a.currentBatchSize>=a.size&&(a.flush(),a.currentBaseTexture=b.texture.baseTexture);var v=a.colors,w=a.positions,x=4*a.currentBatchSize*a.vertSize;a.renderSession.roundPixels?(w[x]=o*c+q*d+s|0,w[x+1]=r*d+p*c+t|0,w[x+5]=o*e+q*f+s|0,w[x+6]=r*f+p*e+t|0,w[x+10]=o*g+q*h+s|0,w[x+11]=r*h+p*g+t|0,w[x+15]=o*i+q*j+s|0,w[x+16]=r*j+p*i+t|0):(w[x]=o*c+q*d+s,w[x+1]=r*d+p*c+t,w[x+5]=o*e+q*f+s,w[x+6]=r*f+p*e+t,w[x+10]=o*g+q*h+s,w[x+11]=r*h+p*g+t,w[x+15]=o*i+q*j+s,w[x+16]=r*j+p*i+t),w[x+2]=k,w[x+3]=l,w[x+7]=m,w[x+8]=l,w[x+12]=m,w[x+13]=n,w[x+17]=k,w[x+18]=n,v[x+4]=v[x+9]=v[x+14]=v[x+19]=u,a.sprites[a.currentBatchSize++]=b},Qa=function(a){var b=this._qc,c=b.animationType;if(c===g.Sprite.FRAME_SAMPLES){if(!this.visible||this.alpha<=0||!this.renderable)return;if(!this.animations.currentAnim)return;var d,e,f,j,k=a.spriteBatch,l=this,m=this.animations.currentAnim._frameIndex,n=b.texture.animation.data,o=n.uvs,p=b.lastAnimationName,q=b._animation[p],r=q.frames,s=l.texture,t=s.baseTexture.resolution,u=l.worldTransform,v=u.a/t,w=u.b/t,x=u.c/t,y=u.d/t,z=u.tx,A=u.ty,B=l.tint,C=l.parent.worldAlpha,D=q.last;B=(B>>16)+(65280&B)+((255&B)<<16);var E,F,G,H,I=-1;n.convert||(n.convert={}),n.convert[p]?G=n.convert[p]:n.convert[p]=G=new Array(r.length),0===(7&m)?(I=m>>3,G[I]||(H=[I])):m===D-1?(I=(m>>3)+1,G[I]||(H=[I])):(E=m>>3,F=E+1,G[E]||G[F]?G[E]?G[F]||(H=[F]):H=[E]:H=[E,F]);var J,K,L,M,N,O,P,Q,R;if(H)for(var S=l.texture.baseTexture.width,T=l.texture.baseTexture.height,U=o.length>>2,V=0,W=H.length;W>V;V++){var X=H[V],Y=r[X];if(Y){j=new Array(U);for(var Z=0,$=Y.length/10;$>Z;Z++){d=10*Z,e=4*Y[d],j[e]=Z;var _=Y[d+1],aa=Y[d+2],ba=Y[d+3],ca=Y[d+4],da=Y[d+5],ea=Y[d+6],fa=Y[d+7],ga=Y[d+8],ha=(o[e+2]-o[e])*S,ia=(o[e+3]-o[e+1])*T,ja=ha*-fa,ka=ia*-ga,la=ha*(1-fa),ma=ia*(1-ga);Y[d+1]=_*ja+ba*ka+da,Y[d+2]=aa*ja+ca*ka+ea,Y[d+3]=_*la+ba*ka+da,Y[d+4]=aa*la+ca*ka+ea,Y[d+5]=_*la+ba*ma+da,Y[d+6]=aa*la+ca*ma+ea,Y[d+7]=_*ja+ba*ma+da,Y[d+8]=aa*ja+ca*ma+ea}n.convert[p][X]=!0,n.uvmap||(n.uvmap={}),n.uvmap[p]||(n.uvmap[p]={}),n.uvmap[p][X]=j}else console.log(X,H)}if(I>=0)for(var Y=r[I],Z=0,$=Y.length/10;$>Z;Z++)d=10*Z,e=4*Y[d],J=Y[d+1],K=Y[d+2],L=Y[d+3],M=Y[d+4],N=Y[d+5],O=Y[d+6],P=Y[d+7],Q=Y[d+8],R=Y[d+9],Pa(k,l,J,K,L,M,N,O,P,Q,o[e],o[e+1],o[e+2],o[e+3],v,w,x,y,z,A,B+(R*C<<24));else for(var na=(m-(E<<3))/(F===D?D-(E<<3):8),Y=r[E],oa=r[F],j=n.uvmap[p][F],Z=0,$=Y.length/10;$>Z;Z++)d=10*Z,e=4*Y[d],f=10*j[e],isNaN(f)?(J=Y[d+1],K=Y[d+2],L=Y[d+3],M=Y[d+4],N=Y[d+5],O=Y[d+6],P=Y[d+7],Q=Y[d+8],R=Y[d+9]):(J=Y[d+1],K=Y[d+2],L=Y[d+3],M=Y[d+4],N=Y[d+5],O=Y[d+6],P=Y[d+7],Q=Y[d+8],R=Y[d+9],J+=(oa[f+1]-J)*na,K+=(oa[f+2]-K)*na,L+=(oa[f+3]-L)*na,M+=(oa[f+4]-M)*na,N+=(oa[f+5]-N)*na,O+=(oa[f+6]-O)*na,P+=(oa[f+7]-P)*na,Q+=(oa[f+8]-Q)*na,R+=(oa[f+9]-R)*na),Pa(k,l,J,K,L,M,N,O,P,Q,o[e],o[e+1],o[e+2],o[e+3],v,w,x,y,z,A,B+(R*C<<24));return i.DisplayObjectContainer.prototype._renderWebGL.call(this,a)}return c===g.Sprite.DRAGON_BONES&&b._armature?i.DisplayObjectContainer.prototype._renderWebGL.call(this,a):h.Sprite.prototype._renderWebGL.call(this,a)},Ra=function(a){var b=this._qc,c=b.animationType;if(c!==g.Sprite.FRAME_SAMPLES)return c===g.Sprite.DRAGON_BONES&&b._armature?i.DisplayObjectContainer.prototype._renderCanvas.call(this,a):h.Sprite.prototype._renderCanvas.call(this,a);if(!(this.visible===!1||0===this.alpha||this.renderable===!1||this.texture.crop.width<=0||this.texture.crop.height<=0)&&this.animations.currentAnim){var d=a.context;if(this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,d.globalCompositeOperation=i.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a),this.texture.valid){var e=this.texture.baseTexture.resolution/a.resolution;!a.smoothProperty||a.scaleMode===this.texture.baseTexture.scaleMode&&d[a.smoothProperty]===(a.scaleMode===i.scaleModes.LINEAR)||(a.scaleMode=this.texture.baseTexture.scaleMode,d[a.smoothProperty]=a.scaleMode===i.scaleModes.LINEAR);var f,j=this.texture.baseTexture.width,k=this.texture.baseTexture.height;if(16777215!==this.tint){if(this.cachedTint!==this.tint){this.cachedTint=this.tint;var l=this.texture.crop,m=l.x,n=l.y,o=l.width,p=l.height;l.x=0,l.y=0,l.width=j,l.height=k,this.tintedTexture=i.CanvasTinter.getTintedTexture(this,this.tint),l.x=m,l.y=n,l.width=o,l.height=p}f=this.tintedTexture}else f=this.texture.baseTexture.source;var q,r,s,t,u,v,w,x,y,z,A,B=this,C=this.animations.currentAnim._frameIndex,D=b.texture.animation.data,E=D.uvs,F=b.lastAnimationName,G=b._animation[F].frames,H=B.texture.baseTexture.resolution,I=B.worldTransform,J=I.a/H,K=I.b/H,L=I.c/H,M=I.d/H,N=I.tx,O=I.ty,P=b._animation[F].last;if(0===(7&C))q=C>>3,v=G[q];else if(C===P-1)q=(C>>3)+1,v=G[q];else if(r=C>>3,s=r+1,v=G[r],w=G[s],x=(C-(r<<3))/(s===P?P-(r<<3):8),D.uvmap||(D.uvmap={}),D.uvmap[F]?t=D.uvmap[F]:D.uvmap[F]=t=new Array(G.length),t[s])u=t[s];else{var Q=E.length>>2;u=new Array(Q),w=G[s];for(var R=0,S=w.length/10;S>R;R++)z=4*w[10*R],u[z]=R;t[s]=u}for(var T=this.parent.worldAlpha,R=0,S=v.length/10;S>R;R++){y=10*R,z=4*v[y];var U=v[y+1],V=v[y+2],W=v[y+3],X=v[y+4],Y=v[y+5],Z=v[y+6],$=v[y+7],_=v[y+8],aa=v[y+9];s&&(A=10*u[z],isNaN(A)||(U+=(w[A+1]-U)*x,V+=(w[A+2]-V)*x,W+=(w[A+3]-W)*x,X+=(w[A+4]-X)*x,Y+=(w[A+5]-Y)*x,Z+=(w[A+6]-Z)*x,$+=(w[A+7]-$)*x,_+=(w[A+8]-_)*x,aa+=(w[A+9]-aa)*x));var ba=E[z]*j,ca=E[z+1]*k,da=E[z+2]*j,ea=E[z+3]*k,fa=U*J+V*L,ga=U*K+V*M,ha=W*J+X*L,ia=W*K+X*M,ja=(Y*J+Z*L+N)*a.resolution,ka=(Y*K+Z*M+O)*a.resolution,la=da-ba,ma=ea-ca,na=la*-$,oa=ma*-_;a.roundPixels?(d.setTransform(fa,ga,ha,ia,0|ja,0|ka),na=0|na,oa=0|oa):d.setTransform(fa,ga,ha,ia,ja,ka),d.globalAlpha=T*(aa/255),d.drawImage(f,ba,ca,la,ma,na/e,oa/e,la/e,ma/e)}}for(var pa=this.children,R=0;R<pa.length;R++)pa[R]._renderCanvas(a);this._mask&&a.maskManager.popMask(a);

}};Ma.prototype.setWidth=function(a){G.prototype.setWidth.call(this,a),this.phaser.texture.trim||(this.phaser.texture.frame.width=a)},Ma.prototype.setHeight=function(a){G.prototype.setHeight.call(this,a),this.phaser.texture.trim||(this.phaser.texture.frame.height=a)},Ma.prototype.getMeta=function(){var a=g.Serializer,b=g.Node.prototype.getMeta.call(this);return b.texture=a.TEXTURE,b.frame=a.AUTO,b.defaultAnimation=a.STRINGS,b};var Sa=g.UIText=function(a,b,d){g.Node.call(this,new h.Group(a.phaser,null),b,d),this.textPhaser=new h.Text(a.phaser),this.textPhaser._nqc=this,this.textPhaser.wordWrapWidth=this.width,this.phaser.addChildAt(this.textPhaser,0),this.textRealWidth=0,this.textRealHeight=0,this.fontSize=12,this._glowText=null,this.name="UIText",this._data="",this._colors=[],this.color=oa.black,this._gradient=!1,this.startColor=oa.red,this.endColor=oa.black,this._fontFamily=Sa.SYSTEMFONT,this.textPhaser.updateText=Sa._phaserUpdateText,this.textPhaser.determineFontProperties=Sa._phaserDetermineFontProperties,this.shadowBlur=10,this.shadowOffsetX=3,this.shadowOffsetY=3,this.shadowColor=oa.shadow,this._enableShadow=!1,this._enableGlow=!1,this.glowColor=oa.red,this.stroke=oa.black,this._strokeThickness=0,this._glowBlur=1,this._wrap=!1,this._wrapWidth=this.width,this._autoSize=!1,this._onPhaseTextSizeChange=new h.Signal,this._onPhaseTextSizeChange.add(function(a,b){this.autoSize&&(this.width=a,this.height=b)},this);var e=d!==c;e!==!0&&(this.bold=!1,this.alignH=Sa.LEFT,this.alignV=Sa.MIDDLE,this.overflow=!0)};Sa.prototype=b.create(g.Node.prototype),Sa.prototype.constructor=Sa,Sa.LEFT=0,Sa.RIGHT=1,Sa.CENTER=2,Sa.TOP=0,Sa.BOTTOM=1,Sa.MIDDLE=2,Sa.SYSTEMFONT=0,Sa.WEBFONT=1,Sa.BITMAPFONT=2,Sa._SYMBOL_COLOR=0,Sa._SYMBOL_END_COLOR=1,b.defineProperties(Sa.prototype,{colorTint:{get:function(){return new oa(this.textPhaser.tint)},set:function(a){if(a=a||new oa(16777215),!(a instanceof oa))throw new Error("Expected qc.Color");this.textPhaser.tint=a.toNumber()}},autoSize:{get:function(){return this._autoSize},set:function(a){a!==this._autoSize&&(this._autoSize=a,a&&this.textPhaser&&(this.width=this.textPhaser.width,this.height=this.textPhaser.height))}},fontFamily:{get:function(){return this._fontFamily},set:function(a){this._fontFamily!==a&&(this._fontFamily=a,this._changeText(""),this._isTransformDirty=!0)}},alignH:{get:function(){return this._alignH},set:function(a){a!==this._alignH&&(this._alignH=a,this.textPhaser.dirty=!0,this._isTransformDirty=!0)}},alignV:{get:function(){return this._alignV},set:function(a){a!==this._alignV&&(this._alignV=a,this.textPhaser.dirty=!0,this._isTransformDirty=!0)}},font:{get:function(){var a=this.textPhaser.font.replace(/\'/g,"");return this.fontFamily!==Sa.SYSTEMFONT?this.game.assets.find(a):a},set:function(a){if(a){var b=a;if(this.fontFamily!==Sa.SYSTEMFONT){if(!(a instanceof g.Font))return void this.game.log.error("Expected qc.Font");if(this.fontFamily!==a._fontFamily)return void this.game.log.error("Invalid font asset");b=this.fontFamily===Sa.WEBFONT?a.uuid:a.url}else if("string"!=typeof a)return void this.game.log.error("Expected string");b!==this.textPhaser.font&&(this._changeText(b),this.enableGlow&&(this._glowText.font=b),this._isTransformDirty=!0)}}},bold:{get:function(){return"normal"!==this.textPhaser.fontWeight},set:function(a){var b=a?"bold":"normal";b!==this.textPhaser.fontWeight&&(this.textPhaser.fontWeight=b,this._enableGlow&&(this._glowText.fontWeight=b),this._isTransformDirty=!0)}},fontSize:{get:function(){return this.textPhaser.fontSize},set:function(a){if("number"!=typeof a)throw new Error("Expected number");a!==this.textPhaser.fontSize&&(this.textPhaser.fontSize=a,this._enableGlow&&(this._glowText.fontSize=a),this._isTransformDirty=!0)}},color:{get:function(){return new oa(this.textPhaser.fill)},set:function(a){if(!(a instanceof oa))throw new Error("Expected qc.Color");var b=a.toString("rgb");b!==this.textPhaser.fill&&(this.textPhaser.fill=b,this._setTextColor(this.textPhaser),this._enableGlow&&(this._glowText.fill=b),this._isTransformDirty=!0)}},text:{get:function(){return this._data},set:function(a){if("string"!=typeof a)throw new Error("Expected string");a!==this._data&&(this._colors=[],this._data=a,this._parseTextColor(a),this._setTextColor(this.textPhaser),this._enableGlow&&(this._glowText.text=this.textPhaser.text),this._isTransformDirty=!0)}},lineSpacing:{get:function(){return this.textPhaser.lineSpacing},set:function(a){a!==this.textPhaser.lineSpacing&&(this.textPhaser.lineSpacing=a,this._enableGlow&&(this._glowText.lineSpacing=a),this._isTransformDirty=!0)}},wrap:{get:function(){return this._wrap},set:function(a){a!==this._wrap&&(this._wrap=a,this.textPhaser.wordWrap=a,this._enableGlow&&(this._glowText.wordWrap=a),this._isTransformDirty=!0)}},overflow:{get:function(){var a=this.getScript("qc.NodeMask");return a&&!a.enable?!0:!1},set:function(a){var b=this.getScript("qc.NodeMask");b||(b=this.addScript("qc.NodeMask")),b.enable=!a}},pivotX:{get:function(){return b.getOwnPropertyDescriptor(g.Node.prototype,"pivotX").get.call(this)},set:function(a){b.getOwnPropertyDescriptor(g.Node.prototype,"pivotX").set.call(this,a),this.textPhaser&&(this.textPhaser.dirty=!0,this._adjustTextPos()),this._isTransformDirty=!0}},pivotY:{get:function(){return b.getOwnPropertyDescriptor(g.Node.prototype,"pivotY").get.call(this)},set:function(a){b.getOwnPropertyDescriptor(g.Node.prototype,"pivotY").set.call(this,a),this.textPhaser&&(this.textPhaser.dirty=!0,this._adjustTextPos()),this._isTransformDirty=!0}},width:{get:function(){return b.getOwnPropertyDescriptor(g.Node.prototype,"width").get.call(this)},set:function(a){a!==this.width&&(b.getOwnPropertyDescriptor(g.Node.prototype,"width").set.call(this,a),this._wrapWidth=a,this._enableGlow&&(this._glowText.wordWrapWidth=a),this.textPhaser&&(this.textPhaser.wordWrapWidth=a,this._adjustTextPos()),this._isTransformDirty=!0)}},height:{get:function(){return b.getOwnPropertyDescriptor(g.Node.prototype,"height").get.call(this)},set:function(a){a!==this.height&&(b.getOwnPropertyDescriptor(g.Node.prototype,"height").set.call(this,a),this.textPhaser&&(this.textPhaser.dirty=!0,this._adjustTextPos()),this._isTransformDirty=!0)}},"class":{get:function(){return"qc.UIText"}},startColor:{get:function(){return new oa(this._startColor)},set:function(a){if(!(a instanceof oa))throw new Error("Expected qc.Color");var b=a.toString();b!==this._startColor&&(this._startColor=b,this.textPhaser.dirty=!0)}},endColor:{get:function(){return new oa(this._endColor)},set:function(a){if(!(a instanceof oa))throw new Error("Expected qc.Color");var b=a.toString();b!==this._endColor&&(this._endColor=b,this.textPhaser.dirty=!0)}},gradient:{get:function(){return this._gradient},set:function(a){a!==this._gradient&&(this._gradient=a,this.textPhaser.dirty=!0,this._isTransformDirty=!0)}},stroke:{get:function(){return new oa(this.textPhaser.stroke)},set:function(a){if(!(a instanceof oa))throw new Error("Expected qc.Color");var b=a.toString();b!==this.textPhaser.stroke&&(this.textPhaser.stroke=b,this._isTransformDirty=!0)}},strokeThickness:{get:function(){return this._strokeThickness},set:function(a){a!==this._strokeThickness&&(this._strokeThickness=a,this._enableGlow&&(this._glowText.strokeThickness=this.textPhaser.strokeThickness,this._glowText.dirty=!0),this.textPhaser.dirty=!0,this._isTransformDirty=!0)}},enableShadow:{get:function(){return this._enableShadow},set:function(a){this._enableShadow=a,this.textPhaser.dirty=!0,this._isTransformDirty=!0}},shadowColor:{get:function(){return new oa(this.textPhaser.shadowColor)},set:function(a){if(!(a instanceof oa))throw new Error("Expected qc.Color");var b=a.toString();b!==this.textPhaser.shadowColor&&(this.textPhaser.shadowColor=b,this._isTransformDirty=!0)}},shadowBlur:{get:function(){return this.textPhaser.shadowBlur},set:function(a){a!==this.textPhaser.shadowBlur&&(this.textPhaser.shadowBlur=a,this._isTransformDirty=!0)}},shadowOffsetX:{get:function(){return this.textPhaser.shadowOffsetX},set:function(a){this.textPhaser.shadowOffsetX=a,this._isTransformDirty=!0}},shadowOffsetY:{get:function(){return this.textPhaser.shadowOffsetY},set:function(a){this.textPhaser.shadowOffsetY=a,this._isTransformDirty=!0}},glowColor:{get:function(){return new oa(this._glowColor)},set:function(a){if(!(a instanceof oa))throw new Error("Expected qc.Color");var b=a.toString();b!==this._glowColor&&(this._glowColor=b,this._glowText&&(this._glowText.fill=b,this._glowText.stroke=b,this._glowText.dirty=!0))}},glowBlur:{get:function(){return this._glowBlur},set:function(a){a!==this._glowBlur&&(this._glowBlur=a,this.enableGlow&&(this._glowText.filterX.blur=a,this._glowText.filterY.blur=a))}},enableGlow:{get:function(){return this._enableGlow},set:function(a){if(a!==this._enableGlow){if(this._enableGlow=a,a){this._glowText=new h.Text(this.game.phaser),this._glowText._nqc=this,this._copyProperty(this._glowText,this.textPhaser),this._glowText.x=this.textPhaser.x,this._glowText.y=this.textPhaser.y,this._glowText.fill=this._glowColor,this._glowText.stroke=this._glowColor,this._glowText.shadowColor=this._glowColor,this._glowText.scale=this.textPhaser.scale,this._glowText.pivot=this.textPhaser.pivot,this._glowText.rotation=this.textPhaser.rotation,this._glowText.updateText=Sa._phaserUpdateText,this._glowText.determineFontProperties=Sa._phaserDetermineFontProperties,this._glowText.font=this.textPhaser.font,this.phaser.addChildAt(this._glowText,0);var b=new g.Filter.BlurX(this.game),c=new g.Filter.BlurY(this.game);b.blur=this.glowBlur,c.blur=this.glowBlur,this._glowText.filters=[b,c],this._glowText.filterX=b,this._glowText.filterY=c}else this.phaser.removeChild(this._glowText),this._glowText.destroy(),this._glowText=null,this.textPhaser.dirty=!0;this._isTransformDirty=!0}}},nativeSize:{get:function(){var a=this.rect;return a.width=this.textRealWidth,a.height=this.textRealHeight,a}}}),Sa.prototype._changeText=function(a){var b,c=i.BitmapText.fonts[a];c?(b=new h.BitmapText(this.game.phaser,0,0,a),this._glowText&&(this._glowText.visible=!1)):(b=new h.Text(this.game.phaser),b.updateText=Sa._phaserUpdateText,b.determineFontProperties=Sa._phaserDetermineFontProperties,this._glowText&&(this._glowText.visible=!0)),b.font=a,b._nqc=this,this._copyProperty(b,this.textPhaser),b.x=this.textPhaser.x,b.y=this.textPhaser.y,this._glowText&&(this._glowText.font=b.font);var d=this.phaser.getChildIndex(this.textPhaser);this.phaser.removeAt?this.phaser.removeAt(d):this.phaser.removeChildAt(d),this.phaser.addAt?this.phaser.addAt(b,d):this.phaser.addChildAt(b,d),this.textPhaser.destroy(),this.textPhaser=b,this._isTransformDirty=!0,this._setTextColor(this.textPhaser)},Sa.prototype.setWidth=function(a){g.Node.prototype.setWidth.call(this,a),this._wrapWidth=a,this.textPhaser&&(this.textPhaser.wordWrapWidth=a,this._adjustTextPos())},Sa.prototype.setHeight=function(a){g.Node.prototype.setHeight.call(this,a),this.textPhaser&&(this.textPhaser.dirty=!0,this._adjustTextPos())},Sa.prototype._copyProperty=function(a,b){a.align=b.align,a.fontWeight=b.fontWeight,a.fontSize=b.fontSize,a.lineSpacing=b.lineSpacing,a.wordWrap=this._wrap,a.name=b.name,a.scale=b.scale,a.pivot=b.pivot,a.rotation=b.rotation,a.alpha=b.alpha,a.visible=b.visible,a.renderable=b.renderable,a.mask=b.mask,a.text=b.text,a.wordWrapWidth=this._wrapWidth,a.stroke=b.stroke,a.strokeThickness=b.strokeThickness,a.shadowColor=b.shadowColor,a.shadowOffsetX=b.shadowOffsetX,a.shadowOffsetY=b.shadowOffsetY,a.fill=b.fill,a.fontFamily=this.fontFamily},Sa.prototype._parseSymbol=function(a,b,c){var d={};if(d.result=!1,"["!==a[b])return d;for(var e=b;++e;){if("["===a[e]||e>=a.length||e-b>25)return d;if("]"===a[e])break}var f=e-b;return f>2&&"#"===a[b+1]?(d.color=a.slice(b+1,e),d.result=!0,d.type=Sa._SYMBOL_COLOR):f>6&&"r"===a[b+1]&&"g"===a[b+2]&&"b"===a[b+3]?(d.color=a.slice(b+1,e),d.result=!0,d.type=Sa._SYMBOL_COLOR):"-"===a[b+1]&&"]"===a[b+2]&&(c.length>0&&(d.result=!0),d.type=Sa._SYMBOL_END_COLOR),d.result&&(d.pos=e),d},Sa.prototype._pushColor=function(a,b){var c={};c.color=a,c.pos=b,this._colors.push(c),this._isTransformDirty=!0},Sa.prototype._setTextColor=function(a){if(a.clearColors&&a.clearColors(),a.addColor){for(var b=0;b<this._colors.length;b++){var c="defaultColor"===this._colors[b].color?"defaultColor":this._colors[b].color;a.addColor(c,this._colors[b].pos)}this._isTransformDirty=!0}},Sa.prototype._parseTextColor=function(a){for(var b="",c=[],d=0;d<a.length;d++){var e=this._parseSymbol(a,d,c);if(e.result){if(d=e.pos,e.type===Sa._SYMBOL_COLOR)c.push(e.color),this._pushColor(e.color,b.length);else if(e.type===Sa._SYMBOL_END_COLOR){c.pop();var f=c.length>0?c[c.length-1]:"defaultColor";this._pushColor(f,b.length)}}else b+=a[d]}this.textPhaser.text=b,this._isTransformDirty=!0},Sa.prototype.getMeta=function(){var a=G.prototype.getMeta.call(this);return a.fontFamily=J.NUMBER,a.alignH=J.NUMBER,a.alignV=J.NUMBER,a.font=J.FONT,a.bold=J.BOOLEAN,a.fontSize=J.NUMBER,a.color=J.COLOR,a.text=J.STRING,a.lineSpacing=J.NUMBER,a.wrap=J.BOOLEAN,a.enableGlow=J.BOOLEAN,a.startColor=J.COLOR,a.endColor=J.COLOR,a.gradient=J.BOOLEAN,a.stroke=J.COLOR,a.strokeThickness=J.NUMBER,a.glowColor=J.COLOR,a.autoSize=J.BOOLEAN,a.overflow=J.BOOLEAN,a.shadowColor=J.COLOR,a.shadowBlur=J.NUMBER,a.shadowOffsetX=J.NUMBER,a.shadowOffsetY=J.NUMBER,a.enableShadow=J.BOOLEAN,a},Sa.prototype._adjustTextPos=function(){var a=this.textPhaser.realWidth,b=this.textPhaser.realHeight;this.textPhaser.x=-this.pivotX*this.width,this._alignH===Sa.RIGHT?this.textPhaser.x=this.textPhaser.x+this.width-a:this._alignH===Sa.CENTER&&(this.textPhaser.x=this.textPhaser.x+(this.width-a)/2),this.textPhaser.y=-this.pivotY*this.height,this._alignV===Sa.BOTTOM?this.textPhaser.y=this.textPhaser.y+this.height-b:this._alignV===Sa.MIDDLE&&(this.textPhaser.y=this.textPhaser.y+(this.height-b)/2),this._enableGlow&&(this._glowText.x=this.textPhaser.x,this._glowText.y=this.textPhaser.y,this._glowText.dirty=!0),this._isTransformDirty=!0},Sa.prototype._refreshWebFont=function(a){/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(a)||/['",]/.exec(a)||(a="'"+a+"'"),a===this.textPhaser.font&&(this.textPhaser.dirty=!0,this._glowText&&(this._glowText.dirty=!0),this._isTransformDirty=!0)},Sa._phaserUpdateText=function(){var a=this._nqc,b=this.canvas,c=this.context,d=a.getWorldScale(),e=a.game.device.desktop,f=e?1920:Math.max(960,a.game.world.width),h=e?1920:Math.max(960,a.game.world.height),j=a.game.device.phaser.UCBrowser;this._worldScale=new g.Point(d.x,d.y);var k=Math.max(.2,Math.min(10,Math.abs(d.x))),l=Math.max(.2,Math.min(10,Math.abs(d.y))),m=this.resolution=a.game.resolution;this.texture.baseTexture.resolution=m,this.texture.baseTexture.scaleMode=i.scaleModes.NEAREST,c.font=this.style.font;var n=this.text,o=a.width;if(this.style.wordWrap){n=n.replace(/\r/gi,"").replace(/\n/gi,"\n");var p=this.runWordWrap(n,o)}else for(var p=n.split(/(?:\r\n|\r|\n)/),q=0;q<p.length-1;q++)p[q]+="\n";for(var r=a,s=[],t=0,u=this.determineFontProperties(c.font).fontSize,q=0;q<p.length;q++){var v=this._getWorldWidth(p[q]);s[q]=v,t=Math.max(t,v)}t=Math.ceil(t);var w=r._strokeThickness,x=t+Math.max(this.style.stroke&&w?2*w:0,a.enableShadow&&this.style.shadowOffsetX?this.style.shadowOffsetX:0);this.realWidth=x;var y=x*m*k;y>f?(k=f/(x*m),x=f):x=y,b.width=x||1;var z=u,A=z*p.length,B=this._lineSpacing;if(0>B&&Math.abs(B)>z&&(B=-z),0!==B){var C=B*(p.length-1);A+=C}var D=a.wordHeight=A+Math.max(this.style.stroke&&w?2*w:0,a.enableShadow&&this.style.shadowOffsetY?this.style.shadowOffsetY:0);this.realHeight=D;var E=D*m*l;E>h?(l=h/(D*m),D=h):D=E,b.height=D||1,r.textRealWidth=t,r.textRealHeight=A,this._canvasDownScale=new g.Point(1/k,1/l),c.scale(m*k,m*l);var F=[];for(q=0;q<p.length;q++){var G=0;r._alignH===Sa.RIGHT?G=this.realWidth-s[q]:r._alignH===Sa.CENTER&&(G=(this.realWidth-s[q])/2),F.push(G)}var H=0;r._alignV===Sa.BOTTOM?H=this.realHeight-A:r._alignV===Sa.MIDDLE&&(H=(this.realHeight-A)/2),navigator.isCocoonJS&&c.clearRect(0,0,this.realWidth,this.realHeight),c.font=this.style.font,c.strokeStyle=this.style.stroke,c.textBaseline="middle",r.enableShadow&&(c.shadowOffsetX=this.style.shadowOffsetX,c.shadowOffsetY=this.style.shadowOffsetY,c.shadowColor=this.style.shadowColor,c.shadowBlur=this.style.shadowBlur),c.lineCap="round",c.lineJoin="round",c.lineWidth=w,this._charCount=0;var I;if(r._gradient){I=c.createLinearGradient(0,H,0,H+A*this.scale.y);var J=1/p.length;I.addColorStop(0,r._startColor);for(var q=1;q<p.length;q++)I.addColorStop(J*q,r._endColor),I.addColorStop(J*q,r._startColor);I.addColorStop(1,r._endColor),c.fillStyle=I}else c.fillStyle=this.style.fill;var K,L,M=c.fillStyle,N=c.strokeStyle;for(q=0;q<p.length;q++)if(K=F[q],L=H+q*z+z/2,q>0&&(L+=B*q),this.colors.length>0)this.updateLine(p[q],K,L,c,w,M,N,z,I,j);else if(this.style.stroke&&w&&c.strokeText(p[q],K,L),this.style.fill)if(I&&j){if(c.save(),c.fillStyle="black",c.fillText(p[q],K,L),c.globalCompositeOperation="source-in",c.fillStyle=I,c.beginPath(),c.rect(K,L-z/2,s[q],z),c.clip(),c.fillRect(K,L-z/2,s[q],z),c.restore(),g.__IS_ANDROID_UC){var O=g._tempCanvas;O||(O=g._tempCanvas=document.createElement("canvas"),O.width=128,O.height=128),c.drawImage(O,0,0,2,2,-5,-5,1,1)}}else c.fillText(p[q],K,L);this.updateTexture(),this.cachedTint=null,a._adjustTextPos()},Sa._phaserDetermineFontProperties=function(a){var b=i.Text.fontPropertiesCache[a];if(!b){b={};var c=i.Text.fontPropertiesCanvas,d=i.Text.fontPropertiesContext;d.font=a;var e=Math.ceil(d.measureText("|MÉq").width);0===e&&(e=1);var f=Math.ceil(d.measureText("M").width),g=2*f;0===g&&(g=1),f=1.4*f|0,c.width=e,c.height=g,d.fillStyle="#f00",d.fillRect(0,0,e,g),d.font=a,d.textBaseline="alphabetic",d.fillStyle="#000",d.fillText("|MÉq",0,f);var h,j,k=d.getImageData(0,0,e,g).data,l=k.length,m=4*e,n=0,o=!1;for(h=0;f>h;h++){for(j=0;m>j;j+=4)if(255!==k[n+j]){o=!0;break}if(o)break;n+=m}for(b.ascent=f-h,n=l-m,o=!1,h=g;h>f;h--){for(j=0;m>j;j+=4)if(255!==k[n+j]){o=!0;break}if(o)break;n-=m}b.descent=h-f,b.fontSize=b.ascent+b.descent,i.Text.fontPropertiesCache[a]=b}return b};var Ta=g.Button=function(a,b,d){g.UIImage.call(this,a,b,d),this.name="Button",this.onStateChange=new g.Signal;var e=d!==c;if(e!==!0){this.text=a.add.text(this),this.text.text="Button",this.text.name="Text",this.text.interactive=!1,this.interactive=!0,this.state=g.UIState.NORMAL;var f=this.addScript("qc.TransitionBehaviour");f.target=this,this.width=120,this.height=40,this.text.setAnchor(new g.Point(0,0),new g.Point(1,1)),this.text.left=0,this.text.right=0,this.text.top=0,this.text.bottom=0,this.text.alignH=Sa.CENTER}var h=this;this.onDown.add(function(){h.state!==g.UIState.DISABLED&&(h.state=g.UIState.PRESSED)}),this.onUp.add(function(){h.state===g.UIState.PRESSED&&(h.state=g.UIState.NORMAL)}),this._onNativeElementClick=this._processNativeClick.bind(this)};Ta.prototype=b.create(g.UIImage.prototype),Ta.prototype.constructor=Ta,b.defineProperties(Ta.prototype,{state:{get:function(){return this._state||g.UIState.NORMAL},set:function(a){this.state!==a&&(this._state=a,this.onStateChange.dispatch())}},colorTint:{get:function(){return b.getOwnPropertyDescriptor(g.Node.prototype,"colorTint").get.call(this)},set:function(a){b.getOwnPropertyDescriptor(g.Node.prototype,"colorTint").set.call(this,a),this.text&&(this.text.colorTint=a)}},frame:{get:function(){return b.getOwnPropertyDescriptor(g.UIImage.prototype,"frame").get.call(this)},set:function(a){b.getOwnPropertyDescriptor(g.UIImage.prototype,"frame").set.call(this,a)}},supportNativeEvent:{get:function(){return this._supportNativeEvent},set:function(a){a!==this._supportNativeEvent&&(this._supportNativeEvent=a,this._checkNativeElement())}},onNativeClick:{get:function(){return this._onNativeClick||(this._onNativeClick=new h.Signal),this._onNativeClick}},"class":{get:function(){return"qc.Button"}}}),Ta.prototype.getMeta=function(){var a=g.Serializer,b=g.UIImage.prototype.getMeta.call(this);return b.text=a.NODE,b.state=a.NUMBER,b.supportNativeEvent=a.BOOLEAN,b},Ta.prototype.update=function(a){this.phaser.visible&&this.supportNativeEvent?(this._checkNativeElement(),this._updateNativeElement(a)):this._removeNativeElement()},Ta.prototype.onDestroy=function(){this._removeNativeElement(),g.UIImage.prototype.onDestroy.call(this)},Ta.prototype._checkNativeElement=function(){this.supportNativeEvent&&this.worldVisible&&!this._nativeElement?this._createNativeElement():!this._nativeElement||this.supportNativeEvent&&this.worldVisible||this._removeNativeElement()},Ta.prototype._createNativeElement=function(){var a=this;if(!a._nativeElement){var b=a._nativeElement=document.createElement("div");b.addEventListener("click",a._onNativeElementClick,!1),b.addEventListener("touchstart",a._onNativeElementClick,!1);var c=b.style;c.position="absolute",c.padding=0,c.margin=0,c.border=0,c.outline=0,c.background="none",a.game.world.frontDomRoot.appendChild(b),a._updateNativeElement()}},Ta.prototype._removeNativeElement=function(){var a=this._nativeElement;a&&(this._nativeElement=null,a.removeEventListener("click",this._onNativeElementClick,!1),a.removeEventListener("touchstart",this._onNativeElementClick,!1),g.Util.removeHTML(a))},Ta.prototype._updateNativeElement=function(a){var b=this,c=b._nativeElement;if(c){var d=b.game.time.now;!a&&c._lastUpdate&&d-c._lastUpdate<300||(c._lastUpdate=d,g.Util.updateTransform(b,c))}},Ta.prototype._processNativeClick=function(a){this.worldVisible||this._checkNativeElement(),this._onNativeClick&&this._onNativeClick.getNumListeners()>0&&this._onNativeClick.dispatch(this,a)};var Ua=g.Toggle=function(a,b,d){g.Node.call(this,new h.Group(a.phaser,null),b,d),this.name="Toggle",this.interactive=!0,this.onStateChange=new g.Signal,this.onValueChange=new g.Signal,this.canValueChange=new g.Signal;var e=d!==c;if(e!==!0){this.background=a.add.image(this),this.background.name="Background",this.background.interactive=!1,this.background.width=80,this.background.height=80,this.checkMark=a.add.image(this.background),this.checkMark.name="CheckMark",this.checkMark.interactive=!1,this.text=a.add.text(this),this.text.text="Button",this.text.name="Text",this.text.interactive=!1,this.on=!1,this.state=g.UIState.NORMAL,this.checkMark.pivotX=.5,this.checkMark.pivotY=.5,this.checkMark.setAnchor(new g.Point(.5,.5),new g.Point(.5,.5)),this.checkMark.anchoredX=0,this.checkMark.anchoredY=0,this.checkMark.width=50,this.checkMark.height=50,this.text.x=this.background.width+5,this.text.height=this.background.height;var f=this.addScript("qc.TransitionBehaviour");f.target=this.background,f.transition=g.Transition.TEXTURE_SWAP}var i=this;this.onDown.add(function(){i.state!==g.UIState.DISABLED&&(i.state=g.UIState.PRESSED)}),this.onUp.add(function(){i.state===g.UIState.PRESSED&&(i.state=g.UIState.NORMAL)}),this.onClick.add(function(){i.on=!i.on,i.checkMark.visible=i.on})};Ua.prototype=b.create(g.Node.prototype),Ua.prototype.constructor=Ua,b.defineProperties(Ua.prototype,{on:{get:function(){return!!this._on},set:function(a){var b=this.on,c={};this.canValueChange.dispatch(this,a,b,c),c.ignore||(this._on=a,this.checkMark.visible=a,b!==a&&this.onValueChange.dispatch(this))}},state:{get:function(){return this._state||g.UIState.NORMAL},set:function(a){this.state!==a&&(this._state=a,this.onStateChange.dispatch())}},"class":{get:function(){return"qc.Toggle"}}}),Ua.prototype.getMeta=function(){var a=g.Serializer,b=g.Node.prototype.getMeta.call(this);return b.background=a.NODE,b.checkMark=a.NODE,b.text=a.NODE,b.on=I("on",a.BOOLEAN),b.state=I("state",a.NUMBER),b};var Va=g.Sound=function(a,b,c){this.soundPhaser=new h.Sound(a.phaser),this.soundPhaser._qc=this,this._loop=!1,this.game=a,g.Node.call(this,new h.Group(this.game.phaser,null),b,c),this.name="Sound",this._related(),a.phaser.sound._sounds.push(this.soundPhaser),this._playOnAwake=!1,this.destroyWhenStop=!0};Va.prototype=b.create(g.Node.prototype),Va.prototype.constructor=Va,b.defineProperties(Va.prototype,{loop:{get:function(){return this.soundPhaser.loop},set:function(a){this._loop=a,this.soundPhaser.loop=a,this.soundPhaser._sound&&(this.soundPhaser._sound.loop=a)}},audio:{get:function(){return this.game.assets.find(this.soundPhaser.key)},set:function(a){var b=this.soundPhaser;if(!a)return void(b.key=a);var c=a.key;if(b&&b.key){var d=this.loop,e=this.mute,f=this.volume;b.destroy(),b=this.soundPhaser=new h.Sound(this.game.phaser,c),b._qc=this,this.game.phaser.sound._sounds.push(b),this.loop=d,this.mute=e,this.volume=f}else b.key=c,b.usingAudioTag&&(b.game.cache.getSound(c)&&b.game.cache.isSoundReady(c)?(b._sound=b.game.cache.getSoundData(c),b.totalDuration=0,b._sound.duration&&(b.totalDuration=b._sound.duration)):b.game.cache.onSoundUnlock.add(b.soundHasUnlocked,b))}},volume:{get:function(){return this.soundPhaser.volume},set:function(a){this.soundPhaser.volume=a}},playOnAwake:{get:function(){return this._playOnAwake},set:function(a){this._playOnAwake=a}},mute:{get:function(){return this.soundPhaser.mute},set:function(a){this.soundPhaser.mute=a}},destroyWhenStop:{get:function(){return this._destroyWhenStop||!1},set:function(a){this._destroyWhenStop=a}},"class":{get:function(){return"qc.Sound"}},isPlaying:{get:function(){return this.soundPhaser.isPlaying}},isPaused:{get:function(){return this.soundPhaser.paused}}}),Va.prototype._dispatchAwake=function(){var a=this;G.prototype._dispatchAwake.call(a),!a.game.device.editor&&a.playOnAwake&&a.play()},Va.prototype._related=function(){var a=this;a.onDecoded=a.soundPhaser.onDecoded,a.onStop=a.soundPhaser.onStop,this.onStop.add(function(){!a.game.device.editor&&a.destroyWhenStop&&a.destroy()},a),a.onLoop=a.soundPhaser.onLoop},Va.prototype.play=function(){if(this.isPaused)return this.soundPhaser.resume(),this;this.soundPhaser.isPlaying&&this.soundPhaser._sound&&this.soundPhaser.usingWebAudio&&(this.soundPhaser._sound.onended=null);var a=this.marker?this.marker.name:null;return this.soundPhaser.play(a),this},Va.prototype.fadeIn=function(a){this.soundPhaser.fadeIn(a)},Va.prototype.pause=function(){this.soundPhaser.pause()},Va.prototype.resume=function(){this.soundPhaser.resume()},Va.prototype.stop=function(){this.soundPhaser.isPlaying&&this.soundPhaser._sound&&this.soundPhaser.usingWebAudio&&(this.soundPhaser._sound.onended=null),this.soundPhaser.stop()},Va.prototype.addMarker=function(a,b){this.removeMarker(),this.marker={},this.marker.name="s",this.marker.start=a,this.marker.duration=b,this.soundPhaser.addMarker(this.marker.name,a,b)},Va.prototype.removeMarker=function(){this.marker&&(this.soundPhaser.currentMarker="",this.soundPhaser.markers={},this.marker=null)},Va.prototype.onDestroy=function(){this.game.phaser.sound.remove(this.soundPhaser),g.Node.prototype.onDestroy.call(this)},Va.prototype.getMeta=function(){var a=g.Serializer,b=g.Node.prototype.getMeta.call(this);return b.audio=a.AUDIO,b.loop=a.BOOLEAN,b.volume=a.NUMBER,b.playOnAwake=a.BOOLEAN,b.mute=a.BOOLEAN,b.destroyWhenStop=a.BOOLEAN,b};var Wa=g.ScrollView=function(a,b,c){g.UIImage.call(this,a,b,c),this.name="ScrollView",this.canHorizontal=!0,this.canVertical=!0,this.movementType=Wa.MOVEMENT_ELASTIC,this.elasticity=1,this.inertia=!0,this.decelerationRate=.03,this.scrollSensitivity=1,this.propagationScroll=!1,this.onValueChange=new h.Signal,this._contentRect=null,this._viewRect=null,this._preContentPosition=null,this._preContentRect=null,this._preViewRect=null,this._velocity=new g.Point(0,0),this._isDragging=!1,this.onWheel.add(this._doWheel,this),this.onDragStart.add(this._doDragStart,this),this.onDrag.add(this._doDrag,this),this.onDragEnd.add(this._doDragEnd,this)};Wa.prototype=b.create(g.UIImage.prototype),Wa.prototype.constructor=Wa,b.defineProperties(Wa.prototype,{"class":{get:function(){return"qc.ScrollView"}},content:{get:function(){return this._content&&this._content._destroy&&(this._content=null),this._content},set:function(a){this._content=a,this._updateBounds()}},horizontalScrollBar:{get:function(){return this._horizontalScrollBar&&this._horizontalScrollBar._destroy&&(this._horizontalScrollBar=null),this._horizontalScrollBar},set:function(a){this._horizontalScrollBar&&this._horizontalScrollBar.onValueChange.remove(this._setHorizontalNormalizedPosition,this),this._horizontalScrollBar=a,this._horizontalScrollBar&&this._horizontalScrollBar.onValueChange.add(this._setHorizontalNormalizedPosition,this)}},verticalScrollBar:{get:function(){return this._verticalScrollBar&&this._verticalScrollBar._destroy&&(this._verticalScrollBar=null),this._verticalScrollBar},set:function(a){this._verticalScrollBar&&this._verticalScrollBar.onValueChange.remove(this._setVerticalNormalizedPosition,this),this._verticalScrollBar=a,this._verticalScrollBar&&this._verticalScrollBar.onValueChange.add(this._setVerticalNormalizedPosition,this)}},horizontalNormalizedPosition:{get:function(){return this._updateBounds(),this._contentRect.width<=this._viewRect.width?this._viewRect.x>this._contentRect.x?1:0:(this._viewRect.x-this._contentRect.x)/(this._contentRect.width-this._viewRect.width)},set:function(a){this.setNormalizedPosition(a,0)}},verticalNormalizedPosition:{get:function(){return this._updateBounds(),this._contentRect.height<=this._viewRect.height?this._viewRect.y>this._contentRect.y?1:0:(this._viewRect.y-this._contentRect.y)/(this._contentRect.height-this._viewRect.height)},set:function(a){this.setNormalizedPosition(a,1)}}}),Wa.prototype.getMeta=function(){var a=g.Serializer,b=g.UIImage.prototype.getMeta.call(this);return b.content=a.NODE,b.canHorizontal=a.BOOLEAN,b.canVertical=a.BOOLEAN,b.movementType=a.NUMBER,b.elasticity=a.NUMBER,b.inertia=a.BOOLEAN,b.decelerationRate=a.NUMBER,b.scrollSensitivity=a.NUMBER,b.horizontalScrollBar=a.NODE,b.verticalScrollBar=a.NODE,b.propagationScroll=a.BOOLEAN,b},Wa.prototype.onDestroy=function(){g.UIImage.prototype.onDestroy.call(this),this.content=null,this.horizontalScrollBar=null,this.verticalScrollBar=null,this.phaser.mask=null},Wa.prototype.update=function(){this._updateBounds()},Wa.prototype.postUpdate=function(){this._updateVelocity()},Wa.prototype._setHorizontalNormalizedPosition=function(a){this.setNormalizedPosition(a,0)},Wa.prototype._setVerticalNormalizedPosition=function(a){this.setNormalizedPosition(a,1)},Wa.prototype._setContentPosition=function(a,b){this.content.x=a,this.content.y=b},Wa.prototype._calculateOffset=function(a,b){var c=new g.Point(0,0);if(this.movementType===Wa.MOVEMENT_UNRESTRICTED)return c;var d=this.rect,e=this._contentRect,f=new g.Point(e.x,e.y),h=new g.Point(e.x+e.width,e.y+e.height);return this.canHorizontal&&(f.x+=a,h.x+=a,f.x>d.x?c.x=d.x-f.x:h.x<d.x+d.width&&(c.x=d.x+d.width-h.x)),this.canVertical&&(f.y+=b,h.y+=b,f.y>d.y?c.y=d.y-f.y:h.y<d.y+d.height&&(c.y=d.y+d.height-h.y)),c},Wa.prototype._calcVelocityEffect=function(a,b,c,d){if(this.movementType===Wa.MOVEMENT_ELASTIC&&0!==b[d]){var e=this["_lastOffset_"+d]||0;Math.abs(e)<Math.abs(b[d])?(this["_lastOffset_"+d]=b[d],this._currSmoothetTime=c):(this["_lastOffset_"+d]=b[d],this._currSmoothetTime+=c);var f=(this.elasticity<=0?c:this.elasticity,this.game.math.smoothDamp(a[d],a[d]+b[d],this._velocity[d],this.elasticity,Number.MAX_VALUE,c/100));Math.abs(a[d]+b[d]-f[0])<1e-4?(a[d]=a[d]+b[d],this._velocity[d]=0):(a[d]=f[0],this._velocity[d]=f[1])}else if(this.movementType===Wa.MOVEMENT_CLAMPED&&0!==b[d])a[d]=a[d]+b[d];else if(this.inertia){var g=this._velocity[d]*Math.pow(Math.abs(this.decelerationRate),c/1e3);Math.abs(g)<1&&(g=0),this._velocity[d]=g,a[d]=a[d]+g*c/1e3}else this._velocity[d]=0},Wa.prototype._rubberDelta=function(a,b){return(1-1/(.55*Math.abs(a)/b+1))*b*this.game.math.sign(a)},Wa.prototype._updateVelocity=function(){if(this.content){this._updateBounds();var a=this.game.time.deltaTime,b=this._calculateOffset(0,0),c=new g.Point(this.content.x,this.content.y);if(this._isDragging||0===b.x&&0===b.y&&0===this._velocity.x&&0===this._velocity.y||(this._calcVelocityEffect(c,b,a,"x"),this._calcVelocityEffect(c,b,a,"y"),(0!==this._velocity.x||0!==this._velocity.y)&&this.movementType===Wa.MOVEMENT_CLAMPED&&(b=this._calculateOffset(c.x-this.content.x,c.y-this.content.y),
c.x+=b.x,c.y+=b.y),this._setContentPosition(c.x,c.y)),this._isDragging&&this.inertia){var d=this.content.x-this._preContentPosition.x,e=this.content.y-this._preContentPosition.y,f=this.game.math.clamp(a/1e3,0,1);this._velocity.x=d/f,this._velocity.y=e/f}this._preViewRect&&g.Rectangle.equals(this._viewRect,this._preViewRect)&&this._preContentRect&&g.Rectangle.equals(this._contentRect,this._preContentRect)&&this._preContentPosition&&g.Point.equals(this._preContentPosition,c)||(this._updateScrollBars(b.x,b.y),this.onValueChange.dispatch(new g.Point(this.horizontalNormalizedPosition,this.verticalNormalizedPosition)),this._updatePrevData())}},Wa.prototype.setNormalizedPosition=function(a,b){if(this._updateBounds(),this.content&&this._contentRect){var c=b?"height":"width",d=b?"y":"x",e=this._contentRect[c]-this._viewRect[c],f=this._viewRect[d]-a*e,g=this.content[d]+f-this._contentRect[d],h=this.content[d];Math.abs(h-g)>1&&(this.content[d]=g,this._velocity[d]=0,this._updateBounds())}},Wa.prototype._updatePrevData=function(){this._preContentPosition=this.content?new g.Point(this.content.x,this.content.y):new g.Point(0,0),this._preContentRect=this._contentRect,this._preViewRect=this._viewRect},Wa.prototype._updateScrollBars=function(a,b){if(this.horizontalScrollBar){if(this._contentRect.width>0){var c=(this._viewRect.width-Math.abs(a))/this._contentRect.width;this.horizontalScrollBar.size=h.Math.clamp(c,0,1)}else this.horizontalScrollBar.size=1;this.horizontalScrollBar.value=this.horizontalNormalizedPosition}if(this.verticalScrollBar){if(this._contentRect.height>0){var c=(this._viewRect.height-Math.abs(b))/this._contentRect.height;this.verticalScrollBar.size=h.Math.clamp(c,0,1)}else this.verticalScrollBar.size=1;this.verticalScrollBar.value=this.verticalNormalizedPosition}},Wa.prototype._updateBounds=function(){if(this._viewRect=this.rect,this._updateContentBounds(),this.content){var a=this.rect,b=a.width-this._contentRect.width,c=a.height-this._contentRect.height;b>0&&(this._contentRect.width=a.width,this._contentRect.x-=b*this.content.pivotX),c>0&&(this._contentRect.height=a.height,this._contentRect.y-=c*this.content.pivotY)}},Wa.prototype._updateContentBounds=function(){return this.content?void(this._contentRect=g.Bounds.getBox(this.content,g.Bounds.USE_BOUNDS,!1,1,this)):void(this._contentRect=new g.Rectangle(0,0,0,0))},Wa.prototype._doWheel=function(a,b){if(this.content){this._updateBounds();var c=new g.Point(b.source.deltaX,b.source.deltaY);this.canVertical||(c.y=0),this.canHorizontal||(c.x=0);var d=c.x*this.scrollSensitivity,e=c.y*this.scrollSensitivity;this.doScroll(d,e,!1)}},Wa.prototype._doDragStart=function(a,b){b.source.eventId===g.Mouse.BUTTON_LEFT&&(this._updateBounds(),this._contentStartPosition=new g.Point(this.content.x,this.content.y),this._pointerStartCursor=this.toLocal(new g.Point(b.source.startX,b.source.startY)),this._isDragging=!0)},Wa.prototype._doDragEnd=function(a,b){b.source.eventId===g.Mouse.BUTTON_LEFT&&(this._isDragging=!1)},Wa.prototype._doDrag=function(a,b){if(b.source.eventId===g.Mouse.BUTTON_LEFT){this._updateBounds();var c=this.toLocal(new g.Point(b.source.x,b.source.y));if(this._pointerStartCursor){var d=this.canHorizontal?c.x-this._pointerStartCursor.x:0,e=this.canVertical?c.y-this._pointerStartCursor.y:0;this.doScroll(this._contentStartPosition.x+d-this.content.x,this._contentStartPosition.y+e-this.content.y,!0)}}},Wa.prototype.doScroll=function(a,b,c){var d=new g.Point(this.content.x,this.content.y);d.x+=a,d.y+=b;var e=this._calculateOffset(a,b);if(d.x+=e.x,d.y+=e.y,this.movementType===Wa.MOVEMENT_CLAMPED&&this.propagationScroll){for(var f=this.parent;!(f instanceof Wa)&&f!==this.game.world;)f=f.parent;f instanceof Wa&&f.doScroll(-e.x,-e.y,c)}else this.movementType===Wa.MOVEMENT_ELASTIC&&(c?(0!==e.x&&(d.x=d.x-this._rubberDelta(e.x,this._viewRect.width)),0!==e.y&&(d.y=d.y-this._rubberDelta(e.y,this._viewRect.height))):(d.x-=e.x,d.y-=e.y,Math.abs(e.x)>this._viewRect.width&&(d.x+=e.x-this.game.math.sign(e.x)*this._viewRect.width),Math.abs(e.y)>this._viewRect.height&&(d.y+=e.y-this.game.math.sign(e.y)*this._viewRect.height)));this._setContentPosition(d.x,d.y),c||this._updateBounds()},Wa.MOVEMENT_UNRESTRICTED=0,Wa.MOVEMENT_ELASTIC=1,Wa.MOVEMENT_CLAMPED=2;var Xa=g.ScrollBar=function(a,b,c){g.UIImage.call(this,a,b,c),this.name="ScrollBar",this._setValue(0,!1),this.onWheel.add(this._doWheel,this),this.onDown.add(this._doDown,this),this.onUp.add(this._doUp,this),this.onDragStart.add(this._doDragStart,this),this.onDrag.add(this._doDrag,this),this.onDragEnd.add(this._doDragEnd,this)};Xa.prototype=b.create(g.UIImage.prototype),Xa.prototype.constructor=Xa,b.defineProperties(Xa.prototype,{"class":{get:function(){return"qc.ScrollBar"}},sliders:{get:function(){return this._sliders&&this._sliders._destroy&&(this._sliders=null),this._sliders},set:function(a){this._sliders=a,this._updateSliders()}},direction:{get:function(){return this._direction||Xa.LEFT_TO_RIGHT},set:function(a){this._setDirection(a,!1)}},value:{get:function(){return this._value},set:function(a){this._setValue(a,!0)}},size:{get:function(){return this._size},set:function(a){this.fixSlidersSize||(this._size=h.Math.clamp(a,0,1),this._size=Math.max(5/Math.max(this.height,this.width),this._size),this._updateSliders())}},numberOfStep:{get:function(){return this._numberOfStep},set:function(a){this._numberOfStep=a}},onValueChange:{get:function(){return this._onValueChange||(this._onValueChange=new h.Signal),this._onValueChange}},stepSize:{get:function(){return this.numberOfStep>1?1/(this.numberOfStep-1):.1}},fixSlidersSize:{get:function(){return this._fixSlidersSize},set:function(a){this._fixSlidersSize=a}},_axisPos:{get:function(){return this.direction===Xa.LEFT_TO_RIGHT||this.direction===Xa.RIGHT_TO_LEFT?"x":"y"}},_axisSize:{get:function(){return this.direction===Xa.LEFT_TO_RIGHT||this.direction===Xa.RIGHT_TO_LEFT?"width":"height"}},_reverseValue:{get:function(){return this.direction===Xa.RIGHT_TO_LEFT||this.direction===Xa.BOTTOM_TO_TOP}},_slidingRect:{get:function(){return this.sliders&&this.sliders.parent?this.sliders.parent.rect:null}}}),Xa.prototype.getMeta=function(){var a=g.Serializer,b=g.UIImage.prototype.getMeta.call(this);return b.sliders=a.NODE,b.value=a.NUMBER,b.size=a.NUMBER,b.numberOfStep=a.NUMBER,b.direction=a.NUMBER,b.fixSlidersSize=a.BOOLEAN,b},Xa.prototype.onDestroy=function(){g.UIImage.prototype.onDestroy.call(this),this.sliders=null},Xa.prototype._setDirection=function(a,b){if(this._direction!==a){{var c=this._axisPos;this._reverseValue}if(this._direction=a,b&&c!=this._axisPos){var d=this.width;this.width=this.height,this.height=d}this._updateSliders()}},Xa.prototype._setValue=function(a,b){var c=this._value;this._value=h.Math.clamp(a,0,1),c!==this.value&&(this._updateSliders(),b&&this.onValueChange.dispatch(this.value))},Xa.prototype.postUpdate=function(){this._isMoveNotDragging&&this._doPursued()},Xa.prototype._updateSliders=function(){if(this._slidingRect){var a=new g.Point(0,0),b=new g.Point(1,1),c=this.value*(1-this.size),d=this._axisPos;this._reverseValue?(a[d]=1-c-this.size,b[d]=1-c):(a[d]=c,b[d]=c+this.size),this.sliders.setAnchor(a,b,!1)}},Xa.prototype._getSlidersRectInBar=function(){var a=this.sliders.minAnchor,b=this.sliders.maxAnchor,c=this._slidingRect,d=c.width*a.x,e=c.height*a.y,f=c.width*(b.x-a.x),h=c.height*(b.y-a.y),i=c.width/this.rect.width,j=c.height/this.rect.height;return new g.Rectangle(this.rect.x+d*i,this.rect.y+e*j,f*i,h*j)},Xa.prototype._getSlidersPointInBar=function(a){var b=this.sliders.minAnchor,c=(this.sliders.maxAnchor,this._slidingRect),d=this.sliders.rect.width/c.width,e=this.sliders.rect.height/c.height,f=c.width*b.x+a.x*d,h=c.height*b.y+a.y*e,i=c.width/this.rect.width,j=c.height/this.rect.height;return new g.Point(this.rect.x+f*i,this.rect.y+h*j)},Xa.prototype._doPursued=function(){var a=this._getSlidersRectInBar(),b=this._axisPos,c=this._axisSize;return this._pursuedPoint>=a[b]&&this._pursuedPoint<=a[b]+a[c]?(this._isMoveNotDragging=!1,this._offset=this._pursuedPoint-a[b]-a[c]/2,this._pursuedPoint=0,void(this._pursuedType=0)):void(this._pursuedPoint<a[b]^this._reverseValue?2!==this._pursuedType&&(this.value-=this.stepSize,this._pursuedType=1):1!==this._pursuedType&&(this.value+=this.stepSize,this._pursuedType=2))},Xa.prototype._doDown=function(a,b){if(this.sliders&&b.source.eventId==g.Mouse.BUTTON_LEFT){var c=new g.Point(b.source.x,b.source.y);if(!this.sliders.rectContains(c)){var d=this.toLocal(c);this._isMoveNotDragging=!0,this._pursuedPoint=d[this._axisPos],this._pursuedType=0}}},Xa.prototype._doUp=function(){this._isMoveNotDragging=!1},Xa.prototype._doDragStart=function(a,b){if(this.sliders&&b.source.eventId==g.Mouse.BUTTON_LEFT){this._isMoveNotDragging=!1;var c=new g.Point(b.source.x,b.source.y),d=this.toLocal(c),e=this._getSlidersRectInBar(),f=this._axisPos,h=this._axisSize;this._offset=d[f]-e[f]-e[h]/2}},Xa.prototype._doDragEnd=function(){this._isMoveNotDragging=!1},Xa.prototype._doDrag=function(a,b){if(this.sliders&&b.source.eventId==g.Mouse.BUTTON_LEFT){var c=new g.Point(b.source.x,b.source.y),d=this.toLocal(c),e=this._getSlidersRectInBar(),f=this._axisPos,h=this._axisSize,i=d[f]-this._offset-this.rect[f]-e[h]/2,j=this.rect[h]*(1-this.size);switch(this.direction){case Xa.LEFT_TO_RIGHT:case Xa.TOP_TO_BOTTOM:this._setValue(i/j,!0);break;case Xa.RIGHT_TO_LEFT:case Xa.BOTTOM_TO_TOP:this._setValue(1-i/j,!0)}}},Xa.prototype._doWheel=function(a,b){if(this.sliders){var c=b.source["delta"+this._axisPos.toUpperCase()],d=this.value;d+=(this._reverseValue?-1:1)*Math.sign(c)*this.stepSize,this._setValue(d,!0)}},Xa.LEFT_TO_RIGHT=0,Xa.RIGHT_TO_LEFT=1,Xa.TOP_TO_BOTTOM=2,Xa.BOTTOM_TO_TOP=3;var Ya=g.ProgressBar=function(a,b,c){g.UIImage.call(this,a,b,c),this.name="ProgressBar",this.style=Ya.STYLE_HORIZONTAL,this.value=0,this.minValue=0,this.maxValue=1,this.indeterminable=!1,this.loopTime=3e3,this.numberOfStep=0,this.fixedSize=-1,this._canSlideOut=!0,this.clipSliders=!1,this.showMode=Ya.SHOW_PROCESSED,this.reverse=!1};Ya.prototype=b.create(g.UIImage.prototype),Ya.prototype.constructor=Ya,b.defineProperties(Ya.prototype,{"class":{get:function(){return"qc.ProgressBar"}},style:{get:function(){return this._style},set:function(a){this._setStyle(a)}},sliders:{get:function(){return this._sliders&&this._sliders._destroy&&(this._sliders=null),this._sliders},set:function(a){this._sliders=a,this._updateSliders()}},indeterminable:{get:function(){return this._indeterminable},set:function(a){this._indeterminable=a}},minValue:{get:function(){return isNaN(this._minValue)||null===this._minValue?0:this._minValue},set:function(a){this.setMinMax(a)}},maxValue:{get:function(){return isNaN(this._maxValue)||null===this._maxValue?1:this._maxValue},set:function(a){this.setMinMax(null,a)}},length:{get:function(){return this.maxValue-this.minValue}},stepValue:{get:function(){var a=this.stepSize;return a>0?this.minValue+Math.round((this.value-this.minValue)/a)*a:this.value},set:function(a){var b=this.stepSize;b>0?this._setValue(this.minValue+Math.round((a-this.minValue)/b)*b,!0):this._setValue(a)}},value:{get:function(){return this._value||0},set:function(a){a!==this._value&&this._setValue(a,!0)}},loopTime:{get:function(){return this._loopTime},set:function(a){this._loopTime=a}},numberOfStep:{get:function(){return this._numberOfStep},set:function(a){this._numberOfStep=a}},stepSize:{get:function(){return this.numberOfStep>1?this.length/(this.numberOfStep-1):this.style===Ya.STYLE_CIRCLE?this.length/360:this.style===Ya.STYLE_HORIZONTAL?this.length/(this._slidingRect?this._slidingRect.width:this.width):this.length/(this._slidingRect?this._slidingRect.height:this.height)}},fixedSize:{get:function(){return this._fixedSize},set:function(a){this._fixedSize!==a&&(this._fixedSize=a,this._updateSliders())}},onValueChange:{get:function(){return this._onValueChange||(this._onValueChange=new h.Signal),this._onValueChange}},clipSliders:{get:function(){if(!this.sliders)return!1;var a=this.sliders.getScript(g.NodeMask);return a&&a.enable},set:function(a){this._setClipSliders(a)}},showMode:{get:function(){return this._showMode},set:function(a){this._setShowMode(a)}},reverse:{get:function(){return this._reverse},set:function(a){this._reverse=a,this._updateSliders()}},startRadian:{get:function(){return this._startRadian||0},set:function(a){this.setCircleScope(a)}},endRadian:{get:function(){return this._endRadian||2*Math.PI},set:function(a){this.setCircleScope(null,a)}},startAngle:{get:function(){return 180*this.startRadian/Math.PI},set:function(a){this.setCircleAngle(a)}},endAngle:{get:function(){return 180*this.endRadian/Math.PI},set:function(a){this.setCircleAngle(null,a)}},showRadian:{get:function(){return this.endRadian-this.startRadian}},_slidingRect:{get:function(){return this.sliders&&this.sliders.parent?this.sliders.parent.rect:null}},_axisPos:{get:function(){return this.style===Ya.STYLE_CIRCLE?"rotation":this.style===Ya.STYLE_HORIZONTAL?"x":"y"}},_axisSize:{get:function(){return this.style===Ya.STYLE_CIRCLE?"rotation":this.style===Ya.STYLE_HORIZONTAL?"width":"height"}}}),Ya.prototype.getMeta=function(){var a=(g.Serializer,g.UIImage.prototype.getMeta.call(this));return a.style=g.Serializer.NUMBER,a.sliders=g.Serializer.NODE,a._minValue=g.Serializer.NUMBER,a._maxValue=g.Serializer.NUMBER,a.value=g.Serializer.NUMBER,a._startRadian=g.Serializer.NUMBER,a._endRadian=g.Serializer.NUMBER,a.indeterminable=g.Serializer.BOOLEAN,a.loopTime=g.Serializer.NUMBER,a.numberOfStep=g.Serializer.NUMBER,a.fixedSize=g.Serializer.NUMBER,a.clipSliders=g.Serializer.BOOLEAN,a.showMode=g.Serializer.NUMBER,a.reverse=g.Serializer.NUMBER,a},Ya.prototype.onDestroy=function(){g.UIImage.prototype.onDestroy.call(this),this.sliders=null},Ya.prototype._resetSliders=function(){if(this.sliders){this.sliders.rotation=0,this.sliders.setAnchor(new g.Point(0,0),new g.Point(1,1),!1);var a=this.sliders.getScript(g.NodeMask);a&&a.setMask(new g.Point(0,0),new g.Point(1,1),0,2*Math.PI)}},Ya.prototype._setStyle=function(a){this._style!==a&&(this._style=a,this._resetSliders(),this._updateSliders())},Ya.prototype._setClipSliders=function(a){if(this.clipSliders!==a){if(this.sliders){this._resetSliders();var b=this.sliders.getScript(g.NodeMask);!b&&a&&(b=this.sliders.addScript("qc.NodeMask")),b&&(b.enable=a)}this._updateSliders()}},Ya.prototype._setShowMode=function(a){this._showMode!==a&&(this._showMode=a,this.sliders&&this._resetSliders(),this._updateSliders())},Ya.prototype.update=function(){this._indeterminable&&this._processIndeterminable()},Ya.prototype.setMinMax=function(a,b){if(a="undefined"==typeof a||null===a?this.minValue:a,b="undefined"==typeof b||null===b?this.maxValue:b,a>=b)throw new Error("Expected:min < max");this._minValue=a,this._maxValue=b,this._setValue(this.value,!0)},Ya.prototype.setCircleScope=function(a,b){if(a="undefined"==typeof a||null===a?this.startRadian:a,b="undefined"==typeof b||null===b?this.endRadian:b,a>=b||b>a+2*Math.PI)throw new Error("Expected:start < end and end <= 2*PI + start");this._startRadian=a,this._endRadian=b,this._updateSliders()},Ya.prototype.setCircleAngle=function(a,b){if(a="undefined"==typeof a||null===a?this.startAngle:a,b="undefined"==typeof b||null===b?this.endAngle:b,a>=b||b>a+360)throw new Error("Expected:start < end and end <= 360 + start");this._startRadian=a*Math.PI/180,this._endRadian=b*Math.PI/180,this._updateSliders()},Ya.prototype._setValue=function(a,b){var c=this.stepValue;this._value=h.Math.clamp(a,this.minValue,this.maxValue),c!==this.stepValue&&this._updateSliders(),b&&this.onValueChange.dispatch(this.value)},Ya.prototype._processIndeterminable=function(){this._loopValue=this._loopValue||this.value,this._loopValue+=this.length*this.game.time.deltaTime/this.loopTime,this._loopValue>this.maxValue+this.stepSize&&(this._loopValue=this.minValue),this.value=this._loopValue},Ya.prototype._updateSliders=function(){if(this._slidingRect){var a=this.sliders.getScript(g.NodeMask),b=(this.stepValue-this.minValue)/this.length;if(this.reverse&&(b=1-b),this.clipSliders&&a)switch(this.style){case Ya.STYLE_HORIZONTAL:case Ya.STYLE_VERTICAL:var c=new g.Point(0,0),d=new g.Point(1,1),e=this._axisPos;this.fixedSize>=0?this._canSlideOut?(b*=1+this.fixedSize,d[e]=Math.min(1,b),c[e]=Math.max(0,b-this.fixedSize-1e-5)):(b*=1-this.fixedSize,c[e]=Math.max(0,b),d[e]=Math.min(1,b+this.fixedSize+1e-5)):this.showMode===Ya.SHOW_PROCESSED?d[e]=Math.min(1,b):c[e]=Math.min(1,b),a.setMask(c,d);break;case Ya.STYLE_CIRCLE:if(this.fixedSize>=0){var f=this.startRadian+(b-this.fixedSize)*this.showRadian,h=this.startRadian+b*this.showRadian;if(this.showMode===Ya.SHOW_REMAINED&&this.showRadian===2*Math.PI){var i=h;h=f+2*Math.PI,f=i}a.setMask(null,null,f,h)}else{var f=-Math.PI/2+this.startRadian,h=-Math.PI/2+this.endRadian;this.showMode===Ya.SHOW_PROCESSED?h=f+b*this.showRadian:f+=b*this.showRadian,a.setMask(null,null,f,h)}}else switch(this.style){case Ya.STYLE_HORIZONTAL:case Ya.STYLE_VERTICAL:var c=new g.Point(0,0),d=new g.Point(1,1),e=this._axisPos;this.fixedSize>=0?this._canSlideOut?(b*=1+this.fixedSize,d[e]=Math.min(1,b),c[e]=Math.max(0,b-this.fixedSize-1e-5)):(b*=1-this.fixedSize,c[e]=Math.max(0,b),d[e]=Math.min(1,b+this.fixedSize+1e-5)):this.showMode===Ya.SHOW_PROCESSED?d[e]=Math.max(1e-5,Math.min(1,b)):c[e]=Math.min(.99999,b),this.sliders.setAnchor(c,d,!1);break;case Ya.STYLE_CIRCLE:this.sliders.rotation=b*this.showRadian+this.startRadian}}},Ya.STYLE_HORIZONTAL=0,Ya.STYLE_VERTICAL=1,Ya.STYLE_CIRCLE=2,Ya.SHOW_PROCESSED=0,Ya.SHOW_REMAINED=1;var Za=g.Slider=function(a,b,d){g.ProgressBar.call(this,a,b,d),this.name="Slider",this.canPursue=!0,this._canSlideOut=!1,this.onWheel.add(this._doWheel,this),this.onDown.add(this._doDown,this),this.onUp.add(this._doUp,this),this.onDragStart.add(this._doDragStart,this),this.onDrag.add(this._doDrag,this),this.onDragEnd.add(this._doDragEnd,this);var e=d!==c;if(e!==!0){this.state=g.UIState.NORMAL;var f=this.addScript("qc.TransitionBehaviour");f.target=this.sliders,f.transition=g.Transition.TEXTURE_SWAP}};Za.prototype=b.create(g.ProgressBar.prototype),Za.prototype.constructor=Za,b.defineProperties(Za.prototype,{state:{get:function(){return this._state||g.UIState.NORMAL},set:function(a){this.state!==a&&(this._state=a,this._onStateChange&&this._onStateChange.dispatch())}},sliders:{get:function(){return this._sliders&&this._sliders._destroy&&(this._sliders=null),this._sliders},set:function(a){this._sliders=a;var b=this.getScript("qc.TransitionBehaviour");b&&(b.target=a?a:this),this._updateSliders()}},onStateChange:{get:function(){return this._onStateChange||(this._onStateChange=new g.Signal),this._onStateChange}},"class":{get:function(){return"qc.Slider"}},canPursue:{get:function(){return this._canPursue},set:function(a){this._canPursue=a}},interactive:{get:function(){return this._interactive},set:function(a){this._interactive=a,this._onInteractive&&this._onInteractive.dispatch(),this.state=this.interactive?g.UIState.NORMAL:g.UIState.DISABLED}}}),Za.prototype.getMeta=function(){var a=(g.Serializer,g.ProgressBar.prototype.getMeta.call(this));return a.canPursue=g.Serializer.BOOLEAN,a},Za.prototype.update=function(){g.ProgressBar.prototype.update.call(this),this._isMoveNotDragging&&this._canPursue&&this._doPursued()},Za.prototype._setStyle=function(a){g.ProgressBar.prototype._setStyle.call(this,a),this.fixedSize=a===Za.STYLE_CIRCLE?0:-1},Za.prototype._calcPointValue=function(a,b){var c=0,d=this.rect;switch(this.style){case Za.STYLE_HORIZONTAL:case Za.STYLE_VERTICAL:c=this.minValue+(a[this._axisPos]-d[this._axisPos])*this.length/d[this._axisSize];break;case Za.STYLE_CIRCLE:var e=2*Math.PI,f=Math.atan2(a.x-d.centerX,d.centerY-a.y);if(0>f&&(f+=e),b)if("undefined"==typeof this._tempDragAngle||null===this._tempDragAngle)this._tempDragAngle=f,this._recordDragAngle=f;else{var g=f-this._tempDragAngle;this._tempDragAngle=f,Math.abs(g)>Math.PI&&(g=h.Math.sign(g)*(e-Math.abs(g))),this._recordDragAngle+=g,f=this._recordDragAngle}c=this.minValue+(f-this.startRadian)*this.length/this.showRadian}return this.reverse&&(c=this.maxValue-c+this.minValue),c},Za.prototype._doWheel=function(a,b){if(this.sliders){var c=Math.abs(b.source.deltaX)>=Math.abs(b.source.deltaY)?b.source.deltaX:b.source.deltaY,d=this.value;d+=(this.reverse?-1:1)*Math.sign(c)*this.stepSize,this.value=d}},Za.prototype._doDown=function(a,b){if(this.sliders&&b.source.eventId==g.Mouse.BUTTON_LEFT){this.state=g.UIState.PRESSED,this._tempDragAngle=null,this._recordDragAngle=null;var c=new g.Point(b.source.x,b.source.y);if(!this.sliders.rectContains(c)){var d=this.toLocal(c);this._isMoveNotDragging=!0,this._pursuedPoint=this._calcPointValue(d),this._pursuedType=0}}},Za.prototype._doUp=function(){this._isMoveNotDragging=!1,this.state===g.UIState.PRESSED&&(this.state=g.UIState.NORMAL)},Za.prototype._doDragStart=function(a,b){if(this.sliders&&b.source.eventId==g.Mouse.BUTTON_LEFT){this.state=g.UIState.PRESSED,this._isMoveNotDragging=!1;var c=new g.Point(b.source.x,b.source.y),d=this.toLocal(c);this._offset=this._calcPointValue(d,!0)-this.value}},Za.prototype._doDragEnd=function(){this._isMoveNotDragging=!1,this._tempDragAngle=null,this._recordDragAngle=null,this.state===g.UIState.PRESSED&&(this.state=g.UIState.NORMAL)},Za.prototype._doDrag=function(a,b){if(this.sliders&&b.source.eventId==g.Mouse.BUTTON_LEFT){var c=new g.Point(b.source.x,b.source.y),d=this.toLocal(c),e=this._calcPointValue(d,!0)-this._offset;this._setValue(e,!0)}},Za.prototype._doPursued=function(){for(var a=this.stepSize,b=Math.max(1,Math.ceil(this.length/10/a));b--;){if(this._pursuedPoint>=this.value&&this._pursuedPoint<=this.value+a)return this._isMoveNotDragging=!1,this._offset=this._pursuedPoint-this.value,this._pursuedPoint=0,void(this._pursuedType=0);this._pursuedPoint<this.value^this.reverse?2!==this._pursuedType&&(this.value-=a,this._pursuedType=1):1!==this._pursuedType&&(this.value+=a,this._pursuedType=2)}},Za.STYLE_HORIZONTAL=g.ProgressBar.STYLE_HORIZONTAL,Za.STYLE_VERTICAL=g.ProgressBar.STYLE_VERTICAL,Za.STYLE_CIRCLE=g.ProgressBar.STYLE_CIRCLE,Za.SHOW_PROCESSED=g.ProgressBar.SHOW_PROCESSED,Za.SHOW_REMAINED=g.ProgressBar.SHOW_REMAINED;var $a=g.InputField=function(a,b,d){var e=this;g.UIImage.call(e,a,b,d),e.name="InputField",e.onStateChange=new g.Signal,e.onValueChange=new g.Signal,e.interactive=!0;var f=e.div=document.createElement("div"),h=f.style;h.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null),h.position="absolute",h.padding=0,h.margin=0,h.border=0,h.outline=0,h.background="none",e.game.world.frontDomRoot.appendChild(f);var i=d!==c;if(i!==!0){var j=e.textComponent=a.add.text(e);j.text="",j.name="Text",j.setAnchor(new g.Point(0,0),new g.Point(1,1)),j.left=5,j.right=5,j.top=5,j.bottom=5,j.interactive=!1,j.color=oa.black,j.alignV=Sa.MIDDLE,j.alignH=Sa.LEFT;var k=e.placeholder=a.add.text(e);k.text="Enter text...",k.name="Placeholder",k.setAnchor(new g.Point(0,0),new g.Point(1,1)),k.left=5,k.right=5,k.top=5,k.bottom=5,k.interactive=!1,k.color=oa.grey,k.alignV=Sa.MIDDLE,k.alignH=Sa.LEFT,this.state=g.UIState.NORMAL;var l=this.addScript("qc.TransitionBehaviour");l.target=this}var m=function(a){a.preventDefault(),e.state!==g.UIState.DISABLED&&e.startEditing()};f.addEventListener("mouseup",m,!1),f.addEventListener("touchend",m,!1),this.onDown.add(function(){e.state!==g.UIState.DISABLED&&(e.state=g.UIState.PRESSED)}),this.onUp.add(function(){e.state===g.UIState.PRESSED&&(e.state=g.UIState.NORMAL)}),this.text="",this.width=120,this.height=30};$a.SINGLE_LINE=0,$a.MULTI_LINE=1,$a.STANDARD=0,$a.INT=1,$a.NUMBER=2,$a.TEL=3,$a.EMAIL=4,$a.PASSWORD=5,$a.prototype=b.create(g.UIImage.prototype),$a.prototype.constructor=$a,$a.prototype._characterLimit=-1,$a.prototype._lineType=$a.SINGLE_LINE,$a.prototype._contentType=$a.STANDARD,$a.prototype._input=null,$a.prototype._password="",$a.prototype.textComponent=null,$a.prototype.placeholder=null,b.defineProperties($a.prototype,{"class":{get:function(){return"qc.InputField"}},state:{get:function(){return this._state||g.UIState.NORMAL},set:function(a){this.state!==a&&(this._state=a,this.onStateChange.dispatch())}},lineType:{get:function(){return this._lineType},set:function(a){this._lineType=a}},contentType:{get:function(){return this._contentType},set:function(a){this._contentType!==a&&(this._contentType=a,this.text=this.text)}},textComponent:{get:function(){return this._textComponent&&this._textComponent._destroy&&(this._textComponent=null),this._textComponent},set:function(a){this._textComponent=a}},placeholder:{get:function(){return this._placeholder&&this._placeholder._destroy&&(this._placeholder=null),this._placeholder},set:function(a){this._placeholder=a}},placeholderText:{get:function(){var a=this.placeholder;return a?a.text:""},set:function(a){var b=this.placeholder;b&&(b.text=a)}},text:{get:function(){var a=this.textComponent;return a?this._contentType===$a.PASSWORD?this._password:this.textComponent.text:""},set:function(a){if(this.textComponent&&(a=this.toValidateText(a),a!==this.text)){if(this._contentType===$a.PASSWORD){this._password=a;for(var b="",c=0;c<a.length;c++)b+="·";this.textComponent.text=b}else this.textComponent.text=a;this.onValueChange.dispatch(a)}}},characterLimit:{get:function(){return this._characterLimit},set:function(a){this.characterLimit!==a&&(this._characterLimit=a,this.text=this.text)}},overflow:{get:function(){return this.textComponent?this.textComponent.overflow:!1},set:function(a){this.textComponent&&(this.textComponent.overflow=a)}},isFocused:{get:function(){return!!this.getInput()},set:function(a){a?this.startEditing():this.stopEditing()}}}),$a.prototype.getMeta=function(){var a=g.Serializer,b=g.UIImage.prototype.getMeta.call(this);return b.lineType=a.NUMBER,b.contentType=a.NUMBER,b.placeholder=a.NODE,b.textComponent=a.NODE,b.text=a.STRING,b.overflow=a.BOOLEAN,b.state=a.NUMBER,b._password=a.STRING,b.characterLimit=a.NUMBER,b},$a.prototype.update=function(){var a=this.getInput(),b=this.textComponent,c=this.placeholder;a?(b&&(b.textPhaser.renderable=!1),c&&(c.textPhaser.renderable=!1),this._updateInput(a)):(b&&(b.textPhaser.renderable=!0),c&&(c.textPhaser.renderable=""===this.text));var d=this.div,e=this.game.time.now;d._lastUpdate&&e-d._lastUpdate<200||(d._lastUpdate=e,g.Util.updateTransform(this,d))},$a.prototype.toValidateText=function(a){switch(a=a||"",this.contentType){case $a.INT:a=a.replace(/[^\d\-]/g,"");break;case $a.NUMBER:a=a.replace(/[^\d\.\-]/g,"");break;case $a.EMAIL:a=a.replace(/[^\w0-9\@\.]/g,"");break;case $a.TEL:a=a.replace(/[^\d\(\)\+\-\s]/g,"")}return this.characterLimit>0&&a.length>this.characterLimit&&(a=a.substr(0,this.characterLimit)),a},$a.prototype.startEditing=function(){var a=this,b=a.textComponent;if(b){var c=this._input;if(!c){if(this.lineType===$a.MULTI_LINE)c=a._input=document.createElement("textarea"),c.onkeydown=function(b){_.ESC===b.keyCode&&a.cancelEditing()};else{switch(c=a._input=document.createElement("input"),c.onkeydown=function(b){_.ENTER===b.keyCode?a.stopEditing():_.ESC===b.keyCode&&a.cancelEditing()},a.contentType){case $a.PASSWORD:c.type="password";break;case $a.EMAIL:c.type="email";break;case $a.TEL:c.type="tel";break;case $a.INT:case $a.NUMBER:c.type="number";break;default:c.type="text"}switch(b.alignH){case Sa.LEFT:c.style.textAlign="left";break;case Sa.RIGHT:c.style.textAlign="right";break;default:c.style.textAlign="center"}switch(b.alignV){case Sa.TOP:c.style.verticalAlign="top";break;case Sa.BOTTOM:c.style.verticalAlign="bottom";break;default:c.style.verticalAlign="middle"}}this.characterLimit>0&&c.setAttribute("maxlength",this.characterLimit),c.value=this.text;var d=c.style;d.position="absolute",d.padding=0,d.margin=0,d.border=0,d.outline=0,d.background="none",c.onblur=function(){a.stopEditing()},c._handleClick=function(b){b.target!==a.div&&a.stopEditing()};var e=a.game.world.frontDomRoot;e.addEventListener("mousedown",c._handleClick,!1),e.addEventListener("touchstart",c._handleClick,!1),a.game.input._inputting++,e.appendChild(c),a._updateInput(c),c.focus()}}},$a.prototype._updateInput=function(a){var b=this.game.time.now;if(!(a._lastUpdate&&b-a._lastUpdate<100)){a._lastUpdate=b;var c=this.textComponent;c.textPhaser instanceof h.Text&&(a.style.font=c.textPhaser.style.font),a.style.fontSize=c.fontSize+"px",a.style.color=c.color.toString(),g.Util.updateTransform(c,a),a._lastValue!==a.value&&(a._lastValue=a.value,this.text=a.value)}},$a.prototype.getInput=function(){return this._input&&!this.textComponent&&this.cancelEditing(),this._input},$a.prototype.cancelEditing=function(){var a=this._input;if(a){this._input=null,this.game.input._inputting--;var b=this.game.world.frontDomRoot;b.removeEventListener("mousedown",a._handleClick,!1),b.removeEventListener("touchstart",a._handleClick,!1),g.Util.removeHTML(a)}},$a.prototype.stopEditing=function(){var a=this.getInput();a&&(this.text=a.value,this.cancelEditing())},$a.prototype.onDestroy=function(){this.cancelEditing(),g.Util.removeHTML(this.div),g.UIImage.prototype.onDestroy.call(this)},$a.prototype.onVisibleChange=function(){this.div.style.display=this.isWorldVisible()?"block":"none"};var _a=g.Tilemap=function(a,b,c){g.Node.call(this,new h.Group(a.phaser,null),b,c),this.name="Tilemap"};_a.prototype=b.create(g.Node.prototype),_a.prototype.constructor=_a,_a.prototype._data=null,_a.prototype._scrollX=0,_a.prototype._scrollY=0,_a.prototype._layers=0,_a.prototype._tilesets=0,_a.prototype.getMeta=function(){var a=g.Node.prototype.getMeta.call(this);return a.data=J.TEXTASSET,a.scrollX=J.NUMBER,a.scrollY=J.NUMBER,a.layers=J.NODES,a.tilesets=J.TEXTURES,a},_a.prototype.generateLayers=function(a){var b=this,c=b.data;if(c){for(var d=b.game,e=b._dataInfo,f=e.json,g=f.tilesets,h=[],i=0;i<g.length;i++)h.push({key:g[i].name,url:e.prefix+g[i].name+".bin"});d.assets.loadBatch(h,function(){for(var c=[],e=0;e<h.length;e++)c.push(h[e].asset);b.tilesets=c,b.removeChildren();for(var g=[],e=0;e<f.layers.length;e++){var i=f.layers[e];if("tilelayer"===i.type){var j=new ab(d,b);j.name=i.name,j.tilemap=b,j.layerIndex=e,g.push(j)}else if("objectgroup"===i.type){var k=new bb(d,b);k.name=i.name,k.tilemap=b,k.layerIndex=e,g.push(k)}}b.layers=g,a&&a()})}},_a.prototype.getLayerByIndex=function(a){var b=this._layers;return b&&a>=0&&a<b.length?b[a]:null},_a.prototype.getLayerByName=function(a){var b=this._layers;if(b)for(var c=0;c<b.length;c++)if(b[c].name===a)return b[c];return null},_a.prototype._getLayerJson=function(a,b){if(this._dataInfo){var c=this._dataInfo.json.layers;if(a>=0&&a<c.length){var d=c[a];if(d.type===b)return d}return null}},_a.prototype.resetNativeSize=function(){var a=this.nativeSize;a&&(this.width=a.width,this.height=a.height)},_a.prototype.getTilePosition=function(a,b){return new g.Point(Math.floor(a/this.tileWidth),Math.floor(b/this.tileHeight))},b.defineProperties(_a.prototype,{nativeSize:{get:function(){var a=this._dataInfo;return a?new g.Rectangle(0,0,a.map.widthInPixels,a.map.heightInPixels):null}},layers:{get:function(){return this._layers},set:function(a){this._layers=a}},tilesets:{get:function(){return this._tilesets},set:function(a){this._tilesets=a}},scrollX:{get:function(){return this._scrollX},set:function(a){this._scrollX=a}},scrollY:{get:function(){return this._scrollY},set:function(a){this._scrollY=a}},tileWidth:{get:function(){return this._dataInfo.json.tilewidth}},tileHeight:{get:function(){return this._dataInfo.json.tileheight}},mapWidth:{get:function(){return this._dataInfo.json.width}},mapHeight:{get:function(){return this._dataInfo.json.height}},data:{get:function(){return this._data},set:function(a){var b=this,c=b.game,d=null;if(a){if(!(a instanceof v))return;try{var e=JSON.parse(a.text);if(!e.layers||!e.tilesets)throw new Error("Invalid tilemap data format");c.phaser.load.tilemap(a.url,null,e,h.Tilemap.TILED_JSON);for(var f=c.phaser.add.tilemap(a.url),i=0,j=0,k=0;k<f.tilesets.length;k++)i=Math.max(i,f.tilesets[k].tileWidth),j=Math.max(j,f.tilesets[k].tileHeight);f.maxTileWidth=i,f.maxTileHeight=j;

var l=a.url.lastIndexOf("/");d={json:e,map:f,prefix:l>=0?a.url.substring(0,l+1):""}}catch(m){return c.log.error("Asset{0}/{1} Parse fail",a.key,a.url,m),void g.Util.popupError(m.message)}}b._data=a,b._dataInfo=d}},"class":{get:function(){return"qc.Tilemap"}}});var ab=g.TileLayer=function(a,b,c){var d=new h.Sprite(a.phaser);g.Node.call(this,d,b,c),this.name="TileLayer",this._cache={},d.copyCanvas=h.Canvas.create(1,1),d.copyContext=d.copyCanvas.getContext("2d"),d.canvas=h.Canvas.create(1,1),d.context=d.canvas.getContext("2d"),d.baseTexture=new i.BaseTexture(d.canvas),d.texture=new i.Texture(d.baseTexture),this.setAnchor(new g.Point(0,0),new g.Point(1,1)),this.setStretch(0,0,0,0)};ab.prototype=b.create(g.Node.prototype),ab.prototype.constructor=ab,ab.prototype._tilemap=null,ab.prototype._layerIndex=-1,ab.prototype._scrollXRatio=1,ab.prototype._scrollYRatio=1,ab.prototype.getMeta=function(){var a=g.Node.prototype.getMeta.call(this);return a.tilemap=J.NODE,a.layerIndex=J.INT,a.scrollXRatio=J.NUMBER,a.scrollYRatio=J.NUMBER,a},ab.prototype.getTile=function(a,b){return this._cache&&this._cache.phaserLayer&&this._cache.phaserLayer.data&&this._cache.phaserLayer.data[b]?this._cache.phaserLayer.data[b][a]:c},ab.prototype.getTileIndex=function(a,b){return this._cache&&this._cache.phaserLayer&&this._cache.phaserLayer.data&&this._cache.phaserLayer.data[b]&&this._cache.phaserLayer.data[b][a]?this._cache.phaserLayer.data[b][a].index:1/0},ab.prototype.update=function(){var a=this,b=a.tilemap;if(b){var c=!1,d=a._cache,e=a.phaser,f=b._dataInfo.map;c=this._checkTileLayerChange(f)||c;var g=d.phaserLayer;if(g){var i=Math.round(a.width),j=Math.round(a.height),k=b.scrollX,l=b.scrollY,m=a.scrollXRatio,n=a.scrollYRatio;if(c=this._checkSizeChange(i,j)||c,c||d.scrollX!==k||d.scrollY!==l||d.scrollXRatio!==m||d.scrollYRatio!==n){var o=e.context,p=e.copyContext,q=Math.round(k*m),r=Math.round(l*n),s=d.viewRect,t=new h.Rectangle(-q,-r,i,j),u=g.data;if(!c){var v=h.Rectangle.intersection(s,t);if(v.width>10&&v.height>10){var w=v.x-s.x,x=v.y-s.y,y=v.width,z=v.height;p.clearRect(w,x,y,z),p.drawImage(e.canvas,w,x,y,z,w,x,y,z)}else c=!0}o.clearRect(0,0,i,j),o.translate(q,r),c?this._drawRect(o,f,u,-q,-r,i,j):(o.drawImage(e.copyCanvas,w,x,y,z,v.x,v.y,y,z),t.contains(s.left,s.top)?(this._drawRect(o,f,u,t.x,t.y,v.x-t.x,t.height),this._drawRect(o,f,u,v.x,t.y,t.right-v.x,v.y-t.y)):t.contains(s.right,s.top)?(this._drawRect(o,f,u,t.x,t.y,v.right-t.x,v.y-t.y),this._drawRect(o,f,u,v.right,t.y,t.right-v.right,t.height)):t.contains(s.left,s.bottom)?(this._drawRect(o,f,u,t.x,t.y,v.x-t.x,t.height),this._drawRect(o,f,u,v.x,v.bottom,t.right-v.x,t.bottom-v.bottom)):t.contains(s.right,s.bottom)&&(this._drawRect(o,f,u,t.x,v.bottom,v.right-t.x,t.bottom-v.bottom),this._drawRect(o,f,u,v.right,t.y,t.right-v.right,t.height))),o.translate(-q,-r),e.texture.baseTexture.dirty(),d.scrollX=k,d.scrollY=l,d.scrollXRatio=m,d.scrollYRatio=n,d.viewRect=t}}}},ab.prototype._checkTileLayerChange=function(a){var b=this._cache,c=this.tilemap,d=this.layerIndex;if(b.tilemap!==c||b.layerIndex!==d){b.phaserLayer=null;var e=c._getLayerJson(d,"tilelayer");if(e){var f=a.getLayerIndex(e.name);f>=0&&(b.phaserLayer=a.layers[f])}return b.tilemap=c,b.layerIndex=d,!0}return!1},ab.prototype._checkSizeChange=function(a,b){var c=this._cache,d=this.phaser,e=d.texture;return c.width!==a||c.height!==b?(d.canvas.width=a,d.canvas.height=b,d.copyCanvas.width=a,d.copyCanvas.height=b,e.frame.width=a,e.frame.height=b,e.width=a,e.height=b,e.crop.width=a,e.crop.height=b,e.baseTexture.width=a,e.baseTexture.height=b,e.baseTexture.dirty(),c.width=a,c.height=b,!0):!1},ab.prototype._drawRect=function(a,b,c,d,e,f,g){if(f&&g){var h=b.maxTileWidth,i=b.maxTileHeight,j=b.tileWidth,k=b.tileHeight,l=Math.floor((h>j?d-h:d)/j),m=Math.floor(e/k),n=Math.ceil((d+f)/j),o=Math.ceil((i>k?e+g+i:e+g)/k);for(0>l&&(l=0),0>m&&(m=0),n>b.width&&(n=b.width),o>b.height&&(o=b.height),e=m;o>e;e++){var p=c[e];for(d=l;n>d;d++)this._drawTile(a,b,p[d])}}},ab.prototype._drawTile=function(a,b,d){var e=d.index;if(!(0>=e)){var f=b.tiles[d.index],g=b.tilesets[f[2]],h=g.asset;if(h===c){var i=this.tilemap._dataInfo.prefix+g.name+".bin",j=this.tilemap.tilesets;if(j)for(var k=0;k<j.length;k++)if(j[k].url===i){h=j[k];break}g.asset=h?h:null}h&&a.drawImage(h.img,f[0],f[1],g.tileWidth,g.tileHeight,d.worldX,d.worldY+b.tileHeight-g.tileHeight,g.tileWidth,g.tileHeight)}},b.defineProperties(ab.prototype,{tilemap:{get:function(){return this._tilemap&&this._tilemap._destroy&&(this._tilemap=null),this._tilemap},set:function(a){(!a||a instanceof _a)&&(this._tilemap=a)}},layerIndex:{get:function(){return this._layerIndex},set:function(a){this._layerIndex=a}},scrollXRatio:{get:function(){return this._scrollXRatio},set:function(a){this._scrollXRatio=a}},scrollYRatio:{get:function(){return this._scrollYRatio},set:function(a){this._scrollYRatio=a}},"class":{get:function(){return"qc.TileLayer"}}});var bb=g.ObjectLayer=function(a,b,c){g.Node.call(this,new h.Group(a.phaser,null),b,c),this.name="ObjectLayer",this.setAnchor(new g.Point(0,0),new g.Point(1,1)),this.setStretch(0,0,0,0)};bb.prototype=b.create(g.Node.prototype),bb.prototype.constructor=bb,bb.prototype._tilemap=null,bb.prototype._layerIndex=-1,bb.prototype._scrollXRatio=1,bb.prototype._scrollYRatio=1,bb.prototype.getMeta=function(){var a=g.Node.prototype.getMeta.call(this);return a.tilemap=J.NODE,a.layerIndex=J.INT,a.scrollXRatio=J.NUMBER,a.scrollYRatio=J.NUMBER,a},bb.prototype.update=function(){this._tilemap&&this._tilemap._destroy&&(this._tilemap=null);var a=this._tilemap;a&&(this.x=a.scrollX*this.scrollXRatio,this.y=a.scrollY*this.scrollXRatio)},b.defineProperties(bb.prototype,{tilemap:{get:function(){return this._tilemap&&this._tilemap._destroy&&(this._tilemap=null),this._tilemap},set:function(a){(!a||a instanceof _a)&&(this._tilemap=a)}},layerIndex:{get:function(){return this._layerIndex},set:function(a){this._layerIndex=a}},scrollXRatio:{get:function(){return this._scrollXRatio},set:function(a){this._scrollXRatio=a}},scrollYRatio:{get:function(){return this._scrollYRatio},set:function(a){this._scrollYRatio=a}},"class":{get:function(){return"qc.ObjectLayer"}}});var cb=g.Dom=function(a,b,c){var d=this;d.game=a,g.Node.call(this,new h.Group(this.game.phaser,null),b,c),d.name="dom";var e=d.div=document.createElement("div");e.style.position="absolute",e.setAttribute("id",d.uuid),e._qc=d,d.overflow="hidden",d.serializable=!0,d.phaser.worldTransformChangedCallback=d._updateDomTransform,d.phaser.worldTransformChangedContext=d,this.pos=cb.POS_FRONT};cb.prototype=b.create(g.Node.prototype),cb.prototype.constructor=cb,cb.POS_BACK=0,cb.POS_FRONT=1,b.defineProperties(cb.prototype,{"class":{get:function(){return"qc.Dom"}},pos:{get:function(){return this._pos},set:function(a){this.pos!==a&&(this._pos=a,this.div.parentNode&&this.div.parentNode.removeChild(this.div),a===cb.POS_BACK?(this.game.world.backDomRoot.appendChild(this.div),this.zIndex>=0&&(this.zIndex=-1)):(this.game.world.frontDomRoot.appendChild(this.div),this.zIndex<=0&&(this.zIndex=1)))}},zIndex:{get:function(){return this.div.style.zIndex||0},set:function(a){a!==this.div.style.zIndex&&(this._pos===cb.POS_BACK&&a>=0?a=-1:this._pos===cb.POS_FRONT&&0>=a&&(a=1),this.div.style.zIndex=a)}},innerHTML:{get:function(){return this.div.innerHTML},set:function(a){this.div.innerHTML=a}},className:{get:function(){return this.div.className},set:function(a){this.div.className=a}},overflow:{get:function(){return this._overflow},set:function(a){a!==this._overflow&&(this._overflow=a,this.div.style.overflow=a)}}}),cb.prototype.onVisibleChange=function(){this.div.style.display=this.isWorldVisible()?"block":"none"},cb.prototype.onDestroy=function(){this.div._qc=null,this.div.parentNode&&this.div.parentNode.removeChild(this.div),g.Node.prototype.onDestroy.call(this)},cb.prototype.getMeta=function(){var a=this,b=g.Serializer,d=g.Node.prototype.getMeta.call(this);return d.pos=b.NUMBER,d.className=b.STRING,d.overflow=b.STRING,d.innerHTML={get:function(a){return a.serializable?[!0,a.innerHTML]:c},set:function(b,c){c?(a.serializable=!0,a.innerHTML=c[1]):(a.serializable=!1,a.innerHTML="")}},d.zIndex=b.INT,d},cb.prototype._updateDomTransform=function(){g.Util.updateTransform(this,this.div)};var db=g.Graphics=function(a,b,c){var d=this;d.game=a,g.Node.call(this,new h.Graphics(this.game.phaser),b,c),d.name="graphics"};db.prototype=b.create(g.Node.prototype),db.prototype.constructor=db,b.defineProperties(db.prototype,{"class":{get:function(){return"qc.Graphics"}},fillAlpha:{get:function(){return this.phaser.fillAlpha},set:function(a){this.phaser.fillAlpha=a}},lineWidth:{get:function(){return this.phaser.lineWidth},set:function(a){this.phaser.lineWidth=a}},lineColor:{get:function(){return this.phaser.lineColor},set:function(a){this.phaser.lineColor=a}},blendMode:{get:function(){return this.phaser.blendMode},set:function(a){this.phaser.blendMode=a}}}),db.prototype.getMeta=function(){var a=(g.Serializer,g.Node.prototype.getMeta.call(this));return a},db.prototype.drawTriangle=function(a,b){return this.phaser.drawTriangle(a,b)},db.prototype.drawTriangles=function(a,b,c){return this.phaser.drawTriangles(a,b,c)},db.prototype.lineStyle=function(a,b,c){return this.phaser.lineStyle(a,b,c)},db.prototype.moveTo=function(a,b){return this.phaser.moveTo(a,b)},db.prototype.lineTo=function(a,b){return this.phaser.lineTo(a,b)},db.prototype.quadraticCurveTo=function(a,b,c,d){return this.quadraticCurveTo(a,b,c,d)},db.prototype.bezierCurveTo=function(a,b,c,d,e,f){return this.phaser.bezierCurveTo(a,b,c,d,e,f)},db.prototype.arcTo=function(a,b,c,d,e){return this.phaser.arcTo(a,b,c,d,e)},db.prototype.arc=function(a,b,c,d,e,f){return this.phaser.arc(a,b,c,d,e,f)},db.prototype.beginFill=function(a,b){return this.phaser.beginFill(a,b)},db.prototype.endFill=function(){return this.phaser.endFill()},db.prototype.drawRect=function(a,b,c,d){return this.phaser.drawRect(a,b,c,d)},db.prototype.drawRoundedRect=function(a,b,c,d,e){return this.phaser.drawRoundedRect(a,b,c,d,e)},db.prototype.drawCircle=function(a,b,c){return this.phaser.drawCircle(a,b,c)},db.prototype.drawEllipse=function(a,b,c,d){return this.phaser.drawEllipse(a,b,c,d)},db.prototype.drawPolygon=function(a){return this.phaser.drawPolygon(a)},db.prototype.clear=function(){return this.phaser.clear()},db.prototype.generateTexture=function(a,b){return this.phaser.generateTexture(a,b)},db.prototype.containsPoint=function(a){return this.phaser.containsPoint(a)},db.prototype.drawShape=function(a){return this.phaser.drawShape(a)};var eb=E("qc.Bounds",g.Behaviour,function(){this._sizeProvider=eb.USE_BOUNDS,this._autoCalcBounds=!0,this._marginTop=this._marginBottom=this._marginLeft=this._marginRight=0,this._paddingTop=this._paddingBottom=this._paddingLeft=this._paddingRight=0,this._deep=1},{_sizeProvider:g.Serializer.NUMBER,_marginTop:g.Serializer.NUMBER,_marginBottom:g.Serializer.NUMBER,_marginLeft:g.Serializer.NUMBER,_marginRight:g.Serializer.NUMBER,_paddingTop:g.Serializer.NUMBER,_paddingBottom:g.Serializer.NUMBER,_paddingLeft:g.Serializer.NUMBER,_paddingRight:g.Serializer.NUMBER,_autoCalcBounds:g.Serializer.BOOLEAN});eb.__hiddenInMenu=!0,b.defineProperties(eb.prototype,{sizeProvider:{get:function(){return this._sizeProvider},set:function(a){this._sizeProvider!==a&&(this._sizeProvider=a,this.getBounds(!0))}},marginTop:{get:function(){return this._marginTop},set:function(a){this.setMargin(a)}},marginBottom:{get:function(){return this._marginBottom},set:function(a){this.setMargin(null,null,a)}},marginLeft:{get:function(){return this._marginLeft},set:function(a){this.setMargin(null,null,null,a)}},marginRight:{get:function(){return this._marginRight},set:function(a){this.setMargin(null,a)}},paddingTop:{get:function(){return this._paddingTop},set:function(a){this.setPadding(a)}},paddingBottom:{get:function(){return this._paddingBottom},set:function(a){this.setPadding(null,null,a)}},paddingLeft:{get:function(){return this._paddingLeft},set:function(a){this.setPadding(null,null,null,a)}},paddingRight:{get:function(){return this._paddingRight},set:function(a){this.setPadding(null,a)}},autoCalcBounds:{get:function(){return this._autoCalcBounds},set:function(a){this._autoCalcBounds=a}}}),eb.prototype.setPadding=function(a,b,c,d){"undefined"!=typeof a&&null!==a&&(this._paddingTop=a),"undefined"!=typeof b&&null!==b&&(this._paddingRight=b),"undefined"!=typeof c&&null!==c&&(this._paddingBottom=c),"undefined"!=typeof d&&null!==d&&(this._paddingLeft=d),this._lastWrapTime=null,this.relayout&&this.relayout(),this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout")},eb.prototype.setMargin=function(a,b,c,d){"undefined"!=typeof a&&null!==a&&(this._marginTop=a),"undefined"!=typeof b&&null!==b&&(this._marginRight=b),"undefined"!=typeof c&&null!==c&&(this._marginBottom=c),"undefined"!=typeof d&&null!==d&&(this._marginLeft=d),this._lastWrapTime=null,this.relayout&&this.relayout(),this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout")},eb.prototype.calcBounds=function(){this.getBounds(!0)},eb.prototype.getBounds=function(a){var b=this._recordBounds||new g.Rectangle(0,0,0,0);if(!this.enable||!this.gameObject||!this.gameObject.isWorldVisible())return b;if(this._recordBounds&&!a&&(!this.autoCalcBounds||this._lastWrapTime===this.gameObject.game.time.fixedTime))return this._recordBounds;this._lastWrapTime=this.gameObject.game.time.fixedTime;var c=new g.Point(0,0),d=new g.Point(0,0);return eb._calcBounds(c,d,this.sizeProvider,this.gameObject,this._deep),b.x=c.x,b.y=c.y,b.width=d.x-c.x,b.height=d.y-c.y,this._recordBounds=b,b},eb.prototype.getWorldCorners=function(a){var b=this.getBounds(a),c=new g.Point(b.x,b.y),d=new g.Point(b.x+b.width,b.y),e=new g.Point(b.x+b.width,b.y+b.height),f=new g.Point(b.x,b.y+b.height),h=this.gameObject.worldTransform;return[h.apply(c),h.apply(d),h.apply(e),h.apply(f)]},eb._calcBounds=function(a,b,c,d,e){var f=d.getScript("qc.Bounds");c=f&&f.enable?f.sizeProvider:c,c===eb.USE_BOUNDS?this._calcRealBounds(a,b,d,e):this._calcRectBounds(a,b,d,e)},eb._calcRectBounds=function(a,b,c,d){var e=c.getScript("qc.Bounds"),f=c.rect,h=f.x,i=f.y,j=f.x+f.width,k=f.y+f.height;if(0!==d)for(var l=c.children,m=l.length;m--;){var n=l[m];if(n.isWorldVisible()){var o=n.getScript("qc.Bounds"),p=new g.Point(0,0),q=new g.Point(0,0);if(o){var r=o.getBounds();p.x=r.x,p.y=r.y,q.x=r.x+r.width,q.y=r.y+r.height}else eb._calcRectBounds(p,q,n,d-1);e&&e.enable&&(p.x-=e.paddingLeft,p.y-=e.paddingTop,q.x+=e.paddingRight,q.y+=e.paddingBottom),h=Math.min(h,p.x),i=Math.min(i,p.y),j=Math.max(j,q.x),k=Math.max(k,q.y)}}e&&e.enable&&(h-=e.marginLeft,i-=e.marginTop,j+=e.marginRight,k+=e.marginBottom),a.x=Math.min(a.x,h),a.y=Math.min(a.y,i),b.x=Math.max(b.x,j),b.y=Math.max(b.y,k)},eb._calcRealBounds=function(a,b,c,d){var e=c.getScript("qc.Bounds"),f=c.rect,h=f.x,i=f.y,j=f.x+f.width,k=f.y+f.height;if(0!==d)for(var l=c.worldTransform,m=c.children,n=m.length;n--;){var o=m[n];if(o.isWorldVisible()){var p=o.getScript("qc.Bounds"),q=new g.Point(0,0),r=new g.Point(0,0);if(p){var s=p.getBounds();q.x=s.x,q.y=s.y,r.x=s.x+s.width,r.y=s.y+s.height}else eb._calcRealBounds(q,r,o,d-1);var t=new g.Point(q.x,q.y),u=new g.Point(r.x,q.y),v=new g.Point(r.x,r.y),w=new g.Point(q.x,r.y),x=o.worldTransform;t=l.applyInverse(x.apply(t)),u=l.applyInverse(x.apply(u)),v=l.applyInverse(x.apply(v)),w=l.applyInverse(x.apply(w));var y=Math.min(t.x,u.x,v.x,w.x),z=Math.min(t.y,u.y,v.y,w.y),A=Math.max(t.x,u.x,v.x,w.x),B=Math.max(t.y,u.y,v.y,w.y);e&&e.enable&&(y-=e.paddingLeft,z-=e.paddingTop,A+=e.paddingRight,B+=e.paddingBottom),h=Math.min(h,y),i=Math.min(i,z),j=Math.max(j,A),k=Math.max(k,B)}}e&&e.enable&&(h-=e.marginLeft,i-=e.marginTop,j+=e.marginRight,k+=e.marginBottom),a.x=Math.min(a.x,h),a.y=Math.min(a.y,i),b.x=Math.max(b.x,j),b.y=Math.max(b.y,k)},eb.getBounds=function(a,b,c,d){d="undefined"==typeof d||null===d?0:d;var e=a.getScript("qc.Bounds");if(e&&e.enable)return e.getBounds(c);var f=new g.Point(0,0),h=new g.Point(0,0);eb._calcBounds(f,h,b,a,d);var i=new g.Rectangle(0,0,0,0);return i.x=f.x,i.y=f.y,i.width=h.x-f.x,i.height=h.y-f.y,i},eb.getCorners=function(a,b,c,d,e){var f=eb.getBounds(a,b,c,d),h=a.worldTransform,i=e&&e.worldTransform;if(b===eb.USE_RECTTRANSFORM){for(var j=eb.findCommonRoot(a,e||a.game.world),k=0,l=0,m=a;m&&m!==a.game.world&&m!==j;)k+=m.x,l+=m.y,m=a.parent;for(m=e;m&&m!==a.game.world&&m!==j;)k-=m.x,l-=m.y;var n=new g.Point(f.x+k,f.y+l),o=new g.Point(f.x+f.width+k,f.y+l),p=new g.Point(f.x+f.width+k,f.y+f.height+l),q=new g.Point(f.x+k,f.y+f.height+l);return[n,o,p,q]}var n=new g.Point(f.x,f.y),o=new g.Point(f.x+f.width,f.y),p=new g.Point(f.x+f.width,f.y+f.height),q=new g.Point(f.x,f.y+f.height);return i?[i.applyInverse(h.apply(n)),i.applyInverse(h.apply(o)),i.applyInverse(h.apply(p)),i.applyInverse(h.apply(q))]:[h.apply(n),h.apply(o),h.apply(p),h.apply(q)]},eb.getBox=function(a,b,c,d,e){for(var f=eb.getCorners(a,b,c,d,e),h=new g.Point(-Number.MAX_VALUE,-Number.MAX_VALUE),i=new g.Point(Number.MAX_VALUE,Number.MAX_VALUE),j=0;4>j;j++){var k=f[j];h.x=Math.max(h.x,k.x),h.y=Math.max(h.y,k.y),i.x=Math.min(i.x,k.x),i.y=Math.min(i.y,k.y)}return new g.Rectangle(i.x,i.y,h.x-i.x,h.y-i.y)},eb.getContentRect=function(a){var b=a.rect,c=a.getScript("qc.Bounds");return c&&c.enable&&(b.x+=c.paddingLeft,b.y+=c.paddingTop,b.width-=c.paddingLeft+c.paddingRight,b.height-=c.paddingTop+c.paddingBottom),b},eb.getMargin=function(a){var b=a.getScript("qc.Bounds");return b&&b.enable?{top:b._marginTop,bottom:b._marginBottom,left:b._marginLeft,right:b._marginRight}:{top:0,bottom:0,left:0,right:0}},eb.findCommonRoot=function(a,b){if(!a||!b)return null;for(var c=a,d=b;c;){for(d=b;d;){if(c===d)return c;d=d.parent}c=c.parent}return null},eb.USE_BOUNDS=0,eb.USE_RECTTRANSFORM=1;var fb=E("qc.LayoutElement",g.Bounds,function(){this.ignoreLayout=!1,this.minWidth=-1,this.minHeight=-1,this.preferredWidth=-1,this.preferredHeight=-1,this.flexibleWidth=-1,this.flexibleHeight=-1,this._deep=0},{ignoreLayout:g.Serializer.BOOLEAN,minWidth:g.Serializer.NUMBER,minHeight:g.Serializer.NUMBER,preferredWidth:g.Serializer.NUMBER,preferredHeight:g.Serializer.NUMBER,flexibleWidth:g.Serializer.NUMBER,flexibleHeight:g.Serializer.NUMBER});fb.__menu="UI/Layout/LayoutElement",b.defineProperties(fb.prototype,{ignoreLayout:{get:function(){return this._ignoreLayout},set:function(a){a!==this._ignoreLayout&&(this._ignoreLayout=a)}},minWidth:{get:function(){return this._minWidth},set:function(a){a!==this._minWidth&&(this._minWidth=a,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},minHeight:{get:function(){return this._minHeight},set:function(a){a!==this._minHeight&&(this._minHeight=a,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},preferredWidth:{get:function(){return this._preferredWidth},set:function(a){a!==this._preferredWidth&&(this._preferredWidth=a,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},preferredHeight:{get:function(){return this._preferredHeight},set:function(a){a!==this._preferredHeight&&(this._preferredHeight=a,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},flexibleWidth:{get:function(){return this._flexibleWidth},set:function(a){a!==this._flexibleWidth&&(this._flexibleWidth=a,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},flexibleHeight:{get:function(){return this._flexibleHeight},set:function(a){a!==this._flexibleHeight&&(this._flexibleHeight=a,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},hasMinWidth:{get:function(){return this.minWidth>=0},set:function(a){this.hasMinWidth!==a&&(this.minWidth=a?0:-1)}},hasMinHeight:{get:function(){return this.minHeight>=0},set:function(a){this.hasMinHeight!==a&&(this.minHeight=a?0:-1)}},hasPreferredWidth:{get:function(){return this.preferredWidth>=0},set:function(a){this.hasPreferredWidth!==a&&(this.preferredWidth=a?this.gameObject?this.gameObject.width:0:-1)}},hasPreferredHeight:{get:function(){return this.preferredHeight>=0},set:function(a){this.hasPreferredHeight!==a&&(this.preferredHeight=a?this.gameObject?this.gameObject.height:0:-1)}},hasFlexibleWidth:{get:function(){return this.flexibleWidth>=0},set:function(a){this.hasFlexibleWidth!==a&&(this.flexibleWidth=a?1:-1)}},hasFlexibleHeight:{get:function(){return this.flexibleHeight>=0},set:function(a){this.hasFlexibleHeight!==a&&(this.flexibleHeight=a?1:-1)}}}),fb.getLayoutElement=function(a){var b=new fb,c=a.getScript("qc.LayoutElement");return c&&!c.ignoreLayout&&(b.ignoreLayout=c.ignoreLayout,b.minWidth=c.minWidth,b.minHeight=c.minHeight,b.preferredWidth=c.preferredWidth,b.preferredHeight=c.preferredHeight,b.flexibleWidth=c.flexibleWidth,b.flexibleHeight=c.flexibleHeight),b},fb.USE_RECTTRANSFORM=g.Bounds.USE_RECTTRANSFORM,fb.USE_BOUNDS=g.Bounds.USE_BOUNDS;var gb=E("qc.TableLayout",g.Bounds,function(){this._cellStyle=[[this._buildCellInfo()]],this._constraint=gb.CONSTRAINT_FLEXIBLE,this.runInEditor=!0,this.cellAlignment=gb.ALIGN_TOP_LEFT,this.gameObject.onChildrenChanged.add(this._doChildrenChanged,this),this.gameObject.onLayoutArgumentChanged.add(this._doLayoutArgumentChanged,this)},{constraint:g.Serializer.NUMBER,stride:g.Serializer.NUMBER,startCorner:g.Serializer.NUMBER,startAxis:g.Serializer.NUMBER,contentSizeProvider:g.Serializer.NUMBER,style:g.Serializer.NUMBER,_cellStyle:g.Serializer.MAPPING,autoUpdate:g.Serializer.BOOLEAN,contentAlignment:g.Serializer.NUMBER,cellAlignment:g.Serializer.NUMBER,spacingX:g.Serializer.NUMBER,spacingY:g.Serializer.NUMBER,ignoreX:g.Serializer.BOOLEAN,ignoreY:g.Serializer.BOOLEAN});gb.__menu="UI/Layout/TableLayout",gb._precision=1e-7,b.defineProperties(gb.prototype,{constraint:{get:function(){return isNaN(this._constraint)?gb.CONSTRAINT_FLEXIBLE:this._constraint},set:function(a){this._constraint!==a&&(this._constraint=a,this.rebuildTable())}},stride:{get:function(){return isNaN(this._stride)?0:this._stride},set:function(a){a!==this._stride&&(this._stride=a,this.rebuildTable())}},startCorner:{get:function(){return this._startCorner||gb.CORNER_TOP_LEFT},set:function(a){a!==this._startCorner&&(this._startCorner=a,this.rebuildTable())}},startAxis:{get:function(){return this._startAxis||gb.AXIS_HORIZONTAL},set:function(a){a!==this._startAxis&&(this._startAxis=a,this.rebuildTable())}},contentSizeProvider:{get:function(){return this._contentSizeProvider||gb.USE_BOUNDS},set:function(a){a!==this._contentSizeProvider&&(this._contentSizeProvider=a,this.rebuildTable())}},style:{get:function(){return this._style||gb.STYLE_WRAP_ELEMENT},set:function(a){a!==this._style&&(this._style=a,this.rebuildTable())}},autoUpdate:{get:function(){return this._autoUpdate},set:function(a){this._autoUpdate=a}},spacingX:{get:function(){return this._spacingX||0},set:function(a){this._spacingX!==a&&(this._spacingX=a,this.rebuildTable())}},spacingY:{get:function(){return this._spacingY||0},set:function(a){this._spacingY!==a&&(this._spacingY=a,this.rebuildTable())}},cellWidth:{get:function(){return this.getCellStyle(null,null).cellWidth},set:function(a){this.setCellStyle(null,null,null,null,null,null,null,a)}},cellHeight:{get:function(){return this.getCellStyle(null,null).cellHeight},set:function(a){this.setCellStyle(null,null,null,null,null,null,null,null,a)}},contentAlignment:{get:function(){return this._contentAlignment||gb.ALIGN_TOP_LEFT},set:function(a){this._contentAlignment!==a&&(this._contentAlignment=a,this.rebuildTable())}},cellAlignment:{get:function(){return this.getCellStyle(null,null).align},set:function(a){this.cellAlignment!==a&&(this.setCellStyle(null,null,a),this.rebuildTable())}},columnsCount:{get:function(){var a=this._calcColumnRow();return a.x}},rowsCount:{get:function(){var a=this._calcColumnRow();return a.y}},ignoreX:{get:function(){return!!this._ignoreX},set:function(a){this._ignoreX!==a&&(this._ignoreX=a)}},ignoreY:{get:function(){return!!this._ignoreY},set:function(a){this._ignoreY!==a&&(this._ignoreY=a)}}}),gb.prototype.postUpdate=function(){this.enable&&(this.autoUpdate||this._needRebuildTable)&&(this.rebuildTable(),this._needRebuildTable=!1)},gb.prototype._getChildrenCount=function(){for(var a=0,b=this.gameObject.children,c=0;c<b.length;++c)b[c]&&b[c].isWorldVisible()&&a++;return a},gb.prototype._getChildren=function(){for(var a=[],b=this.gameObject.children,c=0;c<b.length;++c)b[c]&&b[c].isWorldVisible()&&a.push(b[c]);return a},gb.prototype._mixinStyle=function(a,b){return{align:(0===(240&b.align)?240&a.align:240&b.align)|(0===(15&b.align)?15&a.align:15&b.align),timestamp:Math.max(b.timestamp,a.timestamp),paddingLeft:isNaN(b.paddingLeft)?a.paddingLeft:b.paddingLeft,paddingRight:isNaN(b.paddingRight)?a.paddingRight:b.paddingRight,paddingTop:isNaN(b.paddingTop)?a.paddingTop:b.paddingTop,paddingBottom:isNaN(b.paddingBottom)?a.paddingBottom:b.paddingBottom,cellWidth:isNaN(b.cellWidth)?a.cellWidth:b.cellWidth,cellHeight:isNaN(b.cellHeight)?a.cellHeight:b.cellHeight}},gb._calcRectTransform=function(a,b){b=isNaN(b)?0:b;var c=a.rect;if(0!==b)return c;for(var d=a.children,e=d.length;e--;){var f=gb._calcRectTransform(d[e],b-1);c.x=Math.min(c.x,f.x),c.y=Math.min(c.y,f.y),c.w=Math.max(c.x+c.width,f.x+f.width)-c.x,c.h=Math.max(c.y+c.height,f.y+f.height)-c.y}return c},gb.prototype.getCellRect=function(a,b){return g.Bounds.getBox(a,this.contentSizeProvider,b,0,this.gameObject)},gb.prototype.getCellStyle=function(a,b){a=null==a?0:a+1,b=null==b?0:b+1;var c=this._cellStyle[0][0],d=this._cellStyle[b]&&this._cellStyle[b][0],e=this._cellStyle[0][a];!e||d&&d.timestamp>e.timestamp?(e&&(c=this._mixinStyle(c,e)),d&&(c=this._mixinStyle(c,d))):(d&&(c=this._mixinStyle(c,d)),e&&(c=this._mixinStyle(c,e)));var f=this._cellStyle[b]&&this._cellStyle[b][a];return f&&(c=this._mixinStyle(c,f)),c.paddingTop=isNaN(c.paddingTop)?0:c.paddingTop,c.paddingLeft=isNaN(c.paddingLeft)?0:c.paddingLeft,c.paddingRight=isNaN(c.paddingRight)?0:c.paddingRight,c.paddingBottom=isNaN(c.paddingBottom)?0:c.paddingBottom,c.cellWidth=isNaN(c.cellWidth)?0:c.cellWidth,c.cellHeight=isNaN(c.cellHeight)?0:c.cellHeight,c},gb.prototype.setCellStyle=function(a,b,c,d,e,f,g,h,i){a=null==a?0:a+1,b=null==b?0:b+1,this._cellStyle[b]||(this._cellStyle[b]=[]),this._cellStyle[b][a]||(this._cellStyle[b][a]=this._buildCellInfo());var j=this._cellStyle[b][a];null!=c&&(j.align=c),null!=d&&(j.paddingTop=d),null!=e&&(j.paddingRight=e),null!=f&&(j.paddingBottom=f),null!=g&&(j.paddingLeft=g),null!=h&&(j.cellWidth=h),null!=i&(j.cellHeight=i),this._cellStyle[b][a].timestamp=this.gameObject.game.time.fixedTime,this.rebuildTable()},gb.prototype.clearCellStyle=function(a,b){return a=null==a?0:a+1,b=null==b?0:b+1,0===a&&0===b?void(this._cellStyle[0][0]=this._buildCellInfo()):void(this._cellStyle[b]&&this._cellStyle[b][a]&&(this._cellStyle[b][a]=null))},gb.prototype._buildCellInfo=function(){return{align:0,timestamp:0,paddingLeft:0/0,paddingRight:0/0,paddingTop:0/0,paddingBottom:0/0,cellWidth:0/0,cellHeight:0/0}},gb.prototype._calcColumnRow=function(){var a=this._getChildrenCount(),b=this.stride,c=this.constraint;if(c===gb.CONSTRAINT_FLEXIBLE){var d=this.getCellStyle(null,null),e=g.Bounds.getContentRect(this.gameObject);this.startAxis===gb.AXIS_HORIZONTAL?(b=Math.min(Math.max(1,Math.floor((e.width+this.spacingX)/(d.cellWidth+this.spacingX))),a),c=gb.CONSTRAINT_FIX_COLUMN_COUNT):(b=Math.min(Math.max(1,Math.floor((e.height+this.spacingY)/(d.cellHeight+this.spacingY))),a),c=gb.CONSTRAINT_FIX_ROW_COUNT)}var f=c===gb.CONSTRAINT_FIX_ROW_COUNT?Math.ceil(a/b):b,h=c===gb.CONSTRAINT_FIX_ROW_COUNT?b:Math.ceil(a/b);return new g.Point(f,h)},gb.prototype._calcPos=function(a,b){var c=this._calcColumnRow();return b=b||new g.Point(0,0),this.startAxis===gb.AXIS_HORIZONTAL?(b.x=a%c.x,b.y=Math.floor(a/c.x)):(b.x=Math.floor(a/c.y),b.y=a%c.y),0!==(240&this.startCorner)&&(b.x=c.x-1-b.x),0!==(15&this.startCorner)&&(b.y=c.y-1-b.y),b},gb.prototype._setCellPosition=function(a,b){if(!this.ignoreX||this.columnsCount>1){var c=a.node.x;c+=0!==(a.style.align&gb.ALIGN_RIGHT)?b.x-a.bounds.x+(b.width-a.bounds.width):0!==(a.style.align&gb.ALIGN_CENTER)?b.x-a.bounds.x+(b.width-a.bounds.width)/2:b.x-a.bounds.x,Math.abs(c-a.node.x)>gb._precision&&(a.node.x=c)}if(!this.ignoreY||this.rowsCount>1){var d=a.node.y;d+=0!==(a.style.align&gb.ALIGN_BOTTOM)?b.y-a.bounds.y+(b.height-a.bounds.height):0!==(a.style.align&gb.ALIGN_MIDDLE)?b.y-a.bounds.y+(b.height-a.bounds.height)/2:b.y-a.bounds.y,Math.abs(d-a.node.y)>gb._precision&&(a.node.y=d)}},gb.prototype._setCellSize=function(a,b,c){if(!(Math.abs(a.bounds.width-b)<gb._precision&&Math.abs(a.bounds.height-c)<gb._precision)){var d=eb.getMargin(a.node),e=b-d.left-d.right,f=c-d.top-d.bottom,h=a.bounds.width-d.left-d.right,i=a.bounds.height-d.top-d.bottom;a.node.setAnchor(new g.Point(0,0),new g.Point(0,0),!1),a.node.x=0,a.node.y=0,0>=h?a.node.width=e:a.node.width*=e/h,0>=i?a.node.height=f:a.node.height*=f/i,a.node.setStretch(0,0,0,0),a.bounds=this.getCellRect(a.node,!0)}},gb.prototype.relayout=function(){this.rebuildTable()},gb.prototype.rebuildTable=function(){this.getCellStyle(null,null);this.style===gb.STYLE_WRAP_ELEMENT?this._rebuildWrapTable():this._rebuildResizeTable()},gb.prototype._getDefaultLayout=function(){return{min:0,preferred:0,flexible:0,extra:0}},gb.prototype.getCellLayout=function(a){return g.LayoutElement.getLayoutElement(a)},gb.prototype._rebuildResizeTable=function(){for(var a=this._getChildren(),b=[],c=[],d=[],e=[],f=[],h=a.length,i=new g.Point(0,0),j=-1;++j<h;){this._calcPos(j,i);var k=this.getCellLayout(a[j]),l=this.getCellStyle(i.x,i.y),m=this.getCellRect(a[j]);(b[i.y]||(b[i.y]=[]))[i.x]={node:a[j],layout:k,bounds:m,style:l};var n=e[i.x]||(e[i.x]=this._getDefaultLayout("x")),o=f[i.y]||(f[i.y]=this._getDefaultLayout("y"));k.preferredWidth<0&&a[j].nativeSize&&(k.preferredWidth=a[j].nativeSize.width),k.preferredHeight<0&&a[j].nativeSize&&(k.preferredHeight=a[j].nativeSize.height),!isNaN(l.cellWidth)&&l.cellWidth>0&&(k.minWidth=l.cellWidth,k.preferredWidth=l.cellWidth),!isNaN(l.cellHeight)&&l.cellHeight>0&&(k.minHeight=l.cellHeight,k.preferredHeight=l.cellHeight),k.minWidth>=0&&(n.min=Math.max(n.min,k.minWidth)),k.minHeight>=0&&(o.min=Math.max(o.min,k.minHeight)),n.preferred=Math.max(n.preferred,k.preferredWidth,n.min),o.preferred=Math.max(o.preferred,k.preferredHeight,n.min),k.flexibleWidth>=0&&(n.flexible=Math.max(n.flexible,k.flexibleWidth)),k.flexibleHeight>=0&&(o.flexible=Math.max(o.flexible,k.flexibleHeight)),n.extra=Math.max(n.extra,l.paddingLeft+l.paddingRight),o.extra=Math.max(o.extra,l.paddingTop+l.paddingBottom)}var p={min:0,preferred:0,flexible:0,extra:0,fixed:0},q={min:0,preferred:0,flexible:0,extra:0,fixed:0};e.forEach(function(a){p.min+=a.min,p.preferred+=a.preferred,p.flexible+=a.flexible,p.extra+=a.extra}),f.forEach(function(a){q.min+=a.min,q.preferred+=a.preferred,q.flexible+=a.flexible,q.extra+=a.extra});var r=g.Bounds.getContentRect(this.gameObject),s=Math.max(0,e.length-1)*this.spacingX,t=Math.max(0,f.length-1)*this.spacingY,u=new g.Point(0,0);if(r.width<=p.min+p.extra+s)for(var v=0;v<e.length;++v)c[v]=e[v]?e[v].min+e[v].extra:0;else if(r.width<=p.preferred+p.extra+s)for(var w=r.width-p.extra-p.min-s,v=0;v<e.length;++v)c[v]=e[v]?w*e[v].preferred/(p.preferred||1)+e[v].min+e[v].extra:0;else{for(var w=r.width-p.extra-p.preferred-s,v=0;v<e.length;++v)c[v]=e[v]?w*e[v].flexible/(p.flexible||1)+e[v].preferred+e[v].extra:0;0===p.flexible&&(0!==(this.contentAlignment&gb.ALIGN_RIGHT)?u.x=w:0!==(this.contentAlignment&gb.ALIGN_CENTER)&&(u.x=w/2))}if(r.height<=q.min+q.extra+t)for(var v=0;v<f.length;++v)d[v]=f[v]?f[v].min+f[v].extra:0;else if(r.height<=q.preferred+q.extra+t)for(var w=r.height-q.extra-q.min-t,v=0;v<f.length;++v)d[v]=f[v]?w*f[v].preferred/(q.preferred||1)+f[v].min+f[v].extra:0;else{for(var w=r.height-q.extra-q.preferred-t,v=0;v<f.length;++v)d[v]=f[v]?w*f[v].flexible/(q.flexible||1)+f[v].preferred+f[v].extra:0;0===q.flexible&&(0!==(this.contentAlignment&gb.ALIGN_BOTTOM)?u.y=w:0!==(this.contentAlignment&gb.ALIGN_MIDDLE)&&(u.y=w/2));

}for(var x=g.Bounds.getContentRect(this.gameObject),y=new g.Rectangle(0,0,0,0),z=0,A=0,B=0;B<d.length;B++){z=0;for(var C=0;C<c.length;C++){var D=b[B][C];if(D){y.x=x.x+z+D.style.paddingLeft+u.x,y.y=x.y+A+D.style.paddingTop+u.y,y.width=c[C]-D.style.paddingLeft-D.style.paddingRight,y.height=d[B]-D.style.paddingTop-D.style.paddingBottom;var E=y.width,F=y.height;D.layout.flexibleWidth<=0&&y.width>D.layout.preferredWidth&&D.layout.preferredWidth>0&&(E=D.layout.preferredWidth),D.layout.flexibleHeight<=0&&y.height>D.layout.preferredHeight&&D.layout.preferredHeight>0&&(F=D.layout.preferredHeight),this._setCellSize(D,E,F),this._setCellPosition(D,y),z+=c[C]+this.spacingX}else z+=c[C]+this.spacingX}A+=d[B]+this.spacingY}},gb.prototype._rebuildWrapTable=function(){for(var a=this._getChildren(),b=[],d=[],e=[],f=a.length,h=new g.Point(0,0);f--;){this._calcPos(f,h);var i=this.getCellStyle(h.x,h.y),j=this.getCellRect(a[f]);(b[h.y]||(b[h.y]=[]))[h.x]={node:a[f],bounds:j,style:i},d[h.x]=i.cellWidth>0?i.cellWidth:Math.max(j.width+i.paddingLeft+i.paddingRight,d[h.x]||0,i.cellWidth),e[h.y]=i.cellHeight>0?i.cellHeight:Math.max(j.height+i.paddingTop+i.paddingBottom,e[h.y]||0,i.cellHeight)}for(var k=0,l=0,m=0;m<d.length;m++)k+=d[m];for(var n=0;n<e.length;n++)l+=e[n];var o=g.Bounds.getContentRect(this.gameObject),p=new g.Point(0,0);0!==(this.contentAlignment&gb.ALIGN_BOTTOM)?p.y=o.height-l:0!==(this.contentAlignment&gb.ALIGN_MIDDLE)&&(p.y=(o.height-l)/2),0!==(this.contentAlignment&gb.ALIGN_RIGHT)?p.x=o.width-k:0!==(this.contentAlignment&gb.ALIGN_CENTER)&&(p.x=(o.width-k)/2);for(var q=new g.Rectangle(0,0,0,0),r=0,s=0,n=0;n<e.length;n++){r=0;for(var m=0;m<d.length;m++){var t=b[n][m];if(t)q.x=o.x+r+t.style.paddingLeft+p.x,q.y=o.y+s+t.style.paddingTop+p.y,q.width=d[m]-t.style.paddingLeft-t.style.paddingRight,q.height=e[n]-t.style.paddingTop-t.style.paddingBottom,this._setCellPosition(t,q),r+=d[m]+this.spacingX;else{var i=this.getCellStyle(m,n),u=d[m]===c?i.cellWidth:d[m];r+=u+this.spacingX}}s+=e[n]+this.spacingY}},gb.prototype._doChildrenChanged=function(a){var b=a.children.length;if("add"===a.type)for(;b--;)a.children[b]&&a.children[b].onLayoutArgumentChanged.add(this._doLayoutArgumentChanged,this);else if("remove"===a.type)for(;b--;)a.children[b]&&a.children[b].onLayoutArgumentChanged.remove(this._doLayoutArgumentChanged,this);this._needRebuildTable=!0},gb.prototype._doLayoutArgumentChanged=function(){this._needRebuildTable=!0},gb.CONSTRAINT_FLEXIBLE=0,gb.CONSTRAINT_FIX_COLUMN_COUNT=1,gb.CONSTRAINT_FIX_ROW_COUNT=2,gb.STYLE_WRAP_ELEMENT=0,gb.STYLE_RESIZE_ELEMENT=1,gb.USE_RECTTRANSFORM=g.LayoutElement.USE_RECTTRANSFORM,gb.USE_BOUNDS=g.LayoutElement.USE_BOUNDS,gb.AXIS_HORIZONTAL=0,gb.AXIS_VERTICAL=1,gb.CORNER_TOP_LEFT=0,gb.CORNER_TOP_RIGHT=16,gb.CORNER_BOTTOM_RIGHT=17,gb.CORNER_BOTTOM_LEFT=1,gb.ALIGN_LEFT=1,gb.ALIGN_CENTER=2,gb.ALIGN_RIGHT=4,gb.ALIGN_TOP=16,gb.ALIGN_MIDDLE=32,gb.ALIGN_BOTTOM=64,gb.ALIGN_TOP_LEFT=gb.ALIGN_TOP|gb.ALIGN_LEFT,gb.ALIGN_TOP_CENTER=gb.ALIGN_TOP|gb.ALIGN_CENTER,gb.ALIGN_TOP_RIGHT=gb.ALIGN_TOP|gb.ALIGN_RIGHT,gb.ALIGN_MIDDLE_LEFT=gb.ALIGN_MIDDLE|gb.ALIGN_LEFT,gb.ALIGN_MIDDLE_CENTER=gb.ALIGN_MIDDLE|gb.ALIGN_CENTER,gb.ALIGN_MIDDLE_RIGHT=gb.ALIGN_MIDDLE|gb.ALIGN_RIGHT,gb.ALIGN_BOTTOM_LEFT=gb.ALIGN_BOTTOM|gb.ALIGN_LEFT,gb.ALIGN_BOTTOM_CENTER=gb.ALIGN_BOTTOM|gb.ALIGN_CENTER,gb.ALIGN_BOTTOM_RIGHT=gb.ALIGN_BOTTOM|gb.ALIGN_RIGHT;var hb=E("qc.AspectRatioFitter",g.Behaviour,function(){this.mode=hb.NONE,this.ratio=1,this.runInEditor=!0},{mode:g.Serializer.NUMBER,ratio:g.Serializer.NUMBER});hb.__menu="UI/AspectRatioFitter",b.defineProperties(hb.prototype,{mode:{get:function(){return this._mode||hb.NONE},set:function(a){this.mode!==a&&(this._mode=a,this._reset())}},ratio:{get:function(){return this._ratio||1},set:function(a){0>=a&&(a=.001),this.ratio!==a&&(this._ratio=a,this._reset())}}}),hb.NONE=0,hb.WIDTH_CONTROLS_HEIGHT=1,hb.HEIGHT_CONTROLS_WIDTH=2,hb.FIT_IN_PARENT=3,hb.ENVELOPE_PARENT=4,hb.prototype.awake=function(){var a=this;a._reset();var b=a.gameObject;a.addListener(b.onRelayout,function(){a._reset()})},hb.prototype._reset=function(){if(this.mode!==hb.NONE){var a=this.gameObject;if(this.mode===hb.WIDTH_CONTROLS_HEIGHT)return void(a.height=a.width/this.ratio);if(this.mode===hb.HEIGHT_CONTROLS_WIDTH)return void(a.width=a.height*this.ratio);var b=a.parent.rect;if(a.setAnchor(new g.Point(0,0),new g.Point(1,1)),this.mode===hb.FIT_IN_PARENT){var c=b.width,d=c/this.ratio;return d>b.height&&(d=b.height,c=d*this.ratio),void a.setStretch((b.width-c)/2,(b.width-c)/2,(b.height-d)/2,(b.height-d)/2)}if(this.mode===hb.ENVELOPE_PARENT){var c=b.width,d=c/this.ratio;return d<b.height&&(d=b.height,c=d*this.ratio),void a.setStretch((b.width-c)/2,(b.width-c)/2,(b.height-d)/2,(b.height-d)/2)}}};var ib=E("qc.CacheAsBitmap",g.Behaviour,function(){this._boundsType=ib.BOUNDS_SELF,this._cacheType=ib.CACHE_FOR_SCREEN,this._dirty=!0,this.boundsInScreen=!1,this.runInEditor=!0,this.offX=0,this.offY=0},{boundsType:g.Serializer.NUMBER,cacheType:g.Serializer.NUMBER,boundsInScreen:g.Serializer.BOOLEAN});ib.__menu="UI/CacheAsBitmap",b.defineProperties(ib.prototype,{boundsType:{get:function(){return this._boundsType},set:function(a){this._boundsType!==a&&(this._boundsType=a,this.dirty=!0)}},cacheType:{get:function(){return this._cacheType},set:function(a){this._cacheType!==a&&(this._cacheType=a,this.dirty=!0)}},dirty:{get:function(){return this._dirty},set:function(a){this._dirty!==a&&(this._dirty=a)}}}),ib.prototype.awake=function(){var a=this,b=a.gameObject;a.game.assets.webFontLoaded.addOnce(a._setDirty,a),b.onRelayout.add(a._setDirty,a)},ib.prototype._setDirty=function(){this.dirty=!0},ib.prototype.onEnable=function(){var a=this,b=a.gameObject;b._destroy||(a._cache||(a._cache=new g.RenderTexture(100,100,this.game.phaser.render,null,this.game.resolution),a._cacheSprite=new i.Sprite(a._cache)),a.dirty=!0,a._nodeRenderCanvas||(a._nodeRenderCanvas=a.gameObject.phaser._renderCanvas,a.gameObject.phaser._renderCanvas=a.renderCanvas.bind(a)),a._nodeRenderWebGL||(a._nodeRenderWebGL=a.gameObject.phaser._renderWebGL,a.gameObject.phaser._renderWebGL=a.renderWebGL.bind(a)))},ib.prototype.onDisable=function(){var a=this;a._nodeRenderCanvas&&(a.gameObject.phaser._renderCanvas=a._nodeRenderCanvas,a._nodeRenderCanvas=null),a._nodeRenderWebGL&&(a.gameObject.phaser._renderWebGL=a._nodeRenderWebGL,a._nodeRenderWebGL=null)},ib.prototype.onDestroy=function(){var a=this;a._nodeRenderCanvas&&(a.gameObject.phaser._renderCanvas=a._nodeRenderCanvas,a._nodeRenderCanvas=null),a._nodeRenderWebGL&&(a.gameObject.phaser._renderWebGL=a._nodeRenderWebGL,a._nodeRenderWebGL=null),a._cache&&(a._cache.destroy(!0),a._cache=null),a._cacheSprite&&(a._cacheSprite=null),a.gameObject.onRelayout.remove(a._setDirty,a)},ib.prototype._updateCache=function(){var a=this,b=a._cache,c=a._cacheSprite;a._updatingCache=!0;var d=null;d=a._cacheBounds=this._cacheType!==ib.CACHE_FOR_SCREEN?a.getLocalBounds():a.getBounds(),a.boundsInScreen?(d.x<0&&(d.width+=d.x,d.x=0),d.y<0&&(d.height+=d.y,d.y=0),d.width=Math.round(Math.max(1,Math.min(a.game.width*a.game.resolution-d.x,d.width))),d.height=Math.round(Math.max(1,Math.min(a.game.height*a.game.resolution-d.y,d.height)))):(d.width=Math.round(d.width),d.height=Math.round(d.height)),b.resize(d.width+(1&d.width),d.height+(1&d.height),!0);var e=a.gameObject.worldTransform;if(this._cacheType!==ib.CACHE_FOR_SCREEN){var f=c.worldTransform;f.a=e.a,f.b=e.b,f.c=e.c,f.d=e.d,f.tx=e.tx,f.ty=e.ty,i.DisplayObject._tempMatrix.tx=-d.x,i.DisplayObject._tempMatrix.ty=-d.y,b.render(a.gameObject.phaser,i.DisplayObject._tempMatrix,!0),c.anchor.x=-(d.x/d.width),c.anchor.y=-(d.y/d.height)}else a.offX=d.x-e.tx,a.offY=d.y-e.ty,ib._tempMatrix.a=e.a,ib._tempMatrix.b=e.b,ib._tempMatrix.c=e.c,ib._tempMatrix.d=e.d,ib._tempMatrix.tx=Math.round(e.tx-d.x),ib._tempMatrix.ty=Math.round(e.ty-d.y),b.render(a.gameObject.phaser,ib._tempMatrix,!0),e=c.worldTransform,e.identity(),e.tx=d.x,e.ty=d.y;a._updatingCache=!1,a.dirty=!1,a.gameObject._isTransformDirty=!0,b.baseTexture.scaleMode=i.scaleModes.NEAREST},ib.prototype.postUpdate=function(){var a=this,b=a._cacheSprite;if(a.dirty)a.game.log.trace("[CacheAsBitmap]Update Cache."),a._updateCache();else if(a._cacheType!==ib.CACHE_FOR_SCREEN){var c=b.worldTransform,d=a.gameObject.worldTransform;c.a=d.a,c.b=d.b,c.c=d.c,c.d=d.d,c.tx=d.tx,c.ty=d.ty}else{var e=a.gameObject.worldTransform,d=b.worldTransform;d.identity(),d.tx=e.tx+a.offX,d.ty=e.ty+a.offY}},ib.prototype.getBounds=function(){var a=this;return a.boundsType===ib.BOUNDS_SELF?g.Bounds.getBox(a.gameObject,g.Bounds.USE_BOUNDS,!0,0):a.boundsType===ib.BOUNDS_ALL?g.Bounds.getBox(a.gameObject,g.Bounds.USE_BOUNDS,!0,-1):new g.Rectangle(0,0,1,1)},ib.prototype.getLocalBounds=function(){var a=this;return a.boundsType===ib.BOUNDS_SELF?g.Bounds.getBox(a.gameObject,g.Bounds.USE_BOUNDS,!0,0,a.gameObject):a.boundsType===ib.BOUNDS_ALL?g.Bounds.getBox(a.gameObject,g.Bounds.USE_BOUNDS,!0,-1,a.gameObject):new g.Rectangle(0,0,1,1)},ib.prototype.renderCanvas=function(a){var b=this,c=b.gameObject;if(c.phaser.visible!==!1&&c.renderable!==!1)return b._updatingCache&&b._nodeRenderCanvas?void b._nodeRenderCanvas.call(b.gameObject.phaser,a):void b._cacheSprite._renderCanvas(a)},ib.prototype.renderWebGL=function(a){var b=this,c=b.gameObject;if(c.phaser.visible!==!1&&c.renderable!==!1)return b._updatingCache&&b._nodeRenderWebGL?void b._nodeRenderWebGL.call(b.gameObject.phaser,a):void b._cacheSprite._renderWebGL(a)},ib._tempMatrix=new i.Matrix,b.defineProperties(g.Node.prototype,{cacheAsBitmap:{get:function(){var a=this.getScript("qc.CacheAsBitmap");return a&&a.enable},set:function(a){var b=this.getScript("qc.CacheAsBitmap");(a||b)&&(b||(b=this.addScript("qc.CacheAsBitmap")),b.enable=a)}}}),ib.BOUNDS_SELF=0,ib.BOUNDS_ALL=1,ib.CACHE_FOR_SCREEN=0,ib.CAHCE_FOR_SELF=1;var jb=E("qc.DebugViewer",g.Behaviour,function(){var a=this;a.count=1,a.now=a.game.time.now,a.runInEditor=!0,a.duration=1},{debugOn:g.Serializer.BOOLEAN,duration:g.Serializer.NUMBER});jb.__menu="Debug/DebugViewer",b.defineProperties(jb.prototype,{debugOn:{get:function(){return this.game.debug.on},set:function(a){this.game.debug.on=a}}}),jb.prototype.postUpdate=function(){var a=this.game.debug,b=this.game.time.now;if(b-this.now>=1e3*this.duration){var c=1e3*this.count/(b-this.now),d=(a.preUpdate/this.count).toFixed(1),e=(a.update/this.count).toFixed(1),f=(a.postUpdate/this.count).toFixed(1),h=(a.logic/this.count).toFixed(1),i=(a.render/this.count).toFixed(1),j=(a.total/this.count).toFixed(1),k=this.game.phaser.renderer.renderSession.drawCount;null==k&&(k="(N/A)");var l=this.game.phaser._lastCalcTransformCount,m="FPS: "+c.toFixed(1)+"\nDraw Calls: "+k+"\nTotal: "+j+" ms\nLogic: "+h+" ms\nRender: "+i+" ms\nPreUpdate: "+d+" ms\nUpdate: "+e+" ms\nPostUpdate: "+f+" ms\nTransformCalc: "+l;this.gameObject instanceof g.UIText?this.gameObject.text=m:this.gameObject instanceof g.Dom&&(m=m.replace(/\n/g,"<br/>"),this.gameObject.innerHTML=m),this.count=1,this.now=b,a.total=0,a.logic=0,a.preUpdate=0,a.update=0,a.postUpdate=0,a.render=0}else this.count++};var kb=E("qc.FilterGroup",g.Behaviour,function(){this._filters=[]},{filters:J.FILTERS,inherited:J.BOOLEAN});kb.__menu="UI/FilterGroup",b.defineProperties(kb.prototype,{filters:{get:function(){return this._filters},set:function(a){this._filters=a,this.refresh()}},inherited:{get:function(){return!(this.gameObject&&this.gameObject.filterSelf)},set:function(a){this.gameObject&&(this.gameObject.filterSelf=!a)}}}),kb.prototype.onDisable=function(){this.gameObject&&!this.gameObject._destroy&&this.refresh()},kb.prototype.onEnable=function(){this.gameObject&&!this.gameObject._destroy&&this.refresh()},kb.prototype.onDestroy=function(){this.gameObject&&!this.gameObject._destroy&&this.gameObject.phaser&&(this.gameObject.phaser.filters=null)},kb.prototype.refresh=function(){this.gameObject&&!this.gameObject._destroy&&(this.enable?this.enable&&(this.gameObject.phaser.filters=this.filters&&this.filters.length>0?this.filters:null):this.gameObject.phaser.filters=null)},kb.prototype.findFilter=function(a){"string"==typeof a&&(a=g.Util.findClass(a));var b=[];for(var c in this.filters)this.filters[c]instanceof a&&b.push(this.filters[c]);return b},kb.prototype.removeFilterAt=function(a){if(!(0>a||a>=this.filters.length)){var b=this.filters.splice(a,1);return this.refresh(),b}},kb.prototype.removeFilter=function(a){"string"==typeof a&&(a=g.Util.findClass(a));var b=[],c=this.filters.length;if("function"==typeof a)for(;c-->0;)this.filters[c]instanceof a&&b.push(this.filters.splice(c,1));else for(;c-->0;)this.filters[c]===a&&b.push(this.filters.splice(c,1));return this.refresh(),b},kb.prototype.addFilter=function(a,b){if("string"==typeof a&&(a=g.Util.findClass(a),"function"!=typeof a))return null;if("function"==typeof a)a=new a;else for(var b=this.filters.length;b-->0;)if(this.filters[b]===a)return;return isNaN(b)||0>b||b>this.filters.length?this.filters.push(a):this.filters.splice(b,0,a),this.refresh(),a};var lb=E("qc.HorizontalLayout",g.TableLayout,function(){this.style=g.TableLayout.STYLE_RESIZE_ELEMENT,this.constraint=g.TableLayout.CONSTRAINT_FIX_ROW_COUNT,this.contentSizeProvider=g.TableLayout.USE_RECTTRANSFORM,this.stride=1,this.startCorner=g.TableLayout.CORNER_TOP_LEFT,this.startAxis=g.TableLayout.AXIS_HORIZONTAL},{childForceExpandWidth:g.Serializer.NUMBER,childForceExpandHeight:g.Serializer.NUMBER});lb.__menu="UI/Layout/HorizontalLayout",b.defineProperties(lb.prototype,{spacing:{get:function(){return this.spacingX},set:function(a){this.spacingX=a}},childForceExpandWidth:{get:function(){return!!this._childForceExpandWidth},set:function(a){this._childForceExpandWidth!==a&&(this._childForceExpandWidth=a,this.rebuildTable())}},childForceExpandHeight:{get:function(){return!!this._childForceExpandHeight},set:function(a){this._childForceExpandHeight!==a&&(this._childForceExpandHeight=a,this.rebuildTable())}}}),lb.prototype._getDefaultLayout=function(a){return"x"===a?{min:0,preferred:0,flexible:this.childForceExpandWidth?1:0,extra:0}:{min:0,preferred:this.childForceExpandHeight?this.gameObject.rect.height:-1,flexible:1,extra:0}},lb.prototype.getCellLayout=function(a){var b=g.LayoutElement.getLayoutElement(a);return this.childForceExpandWidth&&(b.flexibleWidth=1),this.childForceExpandHeight&&(b.flexibleHeight=1),b};var mb=E("qc.NodeMask",g.Behaviour,function(){this._mask=this.gameObject.game.phaser.add.graphics(0,0),this._mask.parent&&this._mask.parent.removeChild(this._mask),this.gameObject.onTextureChanged&&this.gameObject.onTextureChanged.add(this._doTextureChange,this),this.onEnable(),this.runInEditor=!0},{checkInField:g.Serializer.BOOLEAN,minAnchor:g.Serializer.GEOM,maxAnchor:g.Serializer.GEOM,minRotation:g.Serializer.NUMBER,maxRotation:g.Serializer.NUMBER,clipType:g.Serializer.NUMBER,mode:g.Serializer.NUMBER});mb.__menu="UI/NodeMask",b.defineProperties(mb.prototype,{checkInField:{get:function(){return!!this._checkInField},set:function(a){this._checkInField!==a&&(this._checkInField=a,a||this._resetRenderAble(this.gameObject))}},minAnchor:{get:function(){return this._minAnchor||new g.Point(0,0)},set:function(a){this.setMask(a)}},maxAnchor:{get:function(){return this._maxAnchor||new g.Point(1,1)},set:function(a){this.setMask(null,a)}},minRotation:{get:function(){return"undefined"!=typeof this._minRotation||null===this._minRotation?this._minRotation:0},set:function(a){this.setMask(null,null,a)}},maxRotation:{get:function(){return"undefined"!=typeof this._maxRotation||null===this._maxRotation?this._maxRotation:2*Math.PI},set:function(a){this.setMask(null,null,null,a)}},clipType:{get:function(){return mb.CLIP_STENCIL},set:function(){}},mode:{get:function(){return this._mode||mb.MODE_DEFAULT},set:function(a){this._mode!==a&&(this._mode=a,this._refresh())}},customGraphics:{get:function(){return this._customGraphics||(this._customGraphics=this.game.phaser.add.graphics(0,0),this._customGraphics.parent&&this._customGraphics.parent.removeChild(this._customGraphics)),this._customGraphics}},_maskFilter:{get:function(){return this.__maskFilter||(this.__maskFilter=new g.Filter.AlphaMask(this.game),this.__maskFilter.otherTexture=new g.Filter.FilterTexture(this.game),this.__maskFilter.otherTexture.texture=this.gameObject.texture,this.__maskFilter.otherTexture.frame=this.gameObject.frame),this.__maskFilter}},_graphicsFilter:{get:function(){return this.__graphicsFilter||(this.__graphicsFilter=new g.Filter.AlphaMask(this.game),this.__graphicsFilter.otherTexture=new g.Filter.GraphicsTexture(this.game)),this.__graphicsFilter}}}),mb.prototype.onEnable=function(){this._refresh()},mb.prototype.onDisable=function(){this._refresh()},mb.prototype.onDestroy=function(){this.gameObject.phaser.mask=null,this.gameObject.phaser.softClip=null,this.gameObject.phaser.maskPixel=null,this.gameObject.phaser._graphicsFilter=null,this.gameObject.onTextureChanged&&this.gameObject.onTextureChanged.remove(this._doTextureChange,this),this.gameObject._destroy||this._resetRenderAble(this.gameObject)},mb.prototype._doTextureChange=function(){this.__maskFilter&&(this.__maskFilter.otherTexture.texture=this.gameObject.texture,this.__maskFilter.otherTexture.frame=this.gameObject.frame)},mb.prototype._isNeedUseClipReplaceStencil=function(){return!this.game.device.phaser.supportStencil&&this.game.phaser.renderType===h.WEBGL&&this.clipType===mb.CLIP_STENCIL},mb.prototype._refresh=function(){this._isNeedUseClipReplaceStencil()?(this.gameObject.phaser.softClip=null,this.gameObject.phaser.mask=null,this.gameObject.phaser.maskPixel=null,this._graphicsFilter.otherTexture.updateTexture(),this.gameObject.phaser._graphicsFilter=this.enable?{target:this.gameObject.phaser,filterPasses:this._graphicsFilter.passes}:null):this.game.phaser.renderType!==h.WEBGL||this.clipType===mb.CLIP_STENCIL?(this.gameObject.phaser.mask=this.enable&&this.mode!==mb.MODE_PIXEL?this.mode===mb.MODE_GRAPHICS?this.customGraphics:this._mask:null,this.gameObject.phaser.maskPixel=this.enable&&this.mode===mb.MODE_PIXEL?{target:this.gameObject.phaser,filterPasses:this._maskFilter.passes}:null,this.gameObject.phaser.softClip=null,this.gameObject._destroy||this._resetRenderAble(this.gameObject),this.gameObject.phaser._clipTexture=null,this.gameObject.phaser._graphicsFilter=null):(this.gameObject.phaser.softClip=this.enable&&this.mode!==mb.MODE_PIXEL?this._softClip:null,this.gameObject.phaser.maskPixel=this.enable&&this.mode===mb.MODE_PIXEL?{target:this.gameObject.phaser,filterPasses:this._maskFilter.passes}:null,this.gameObject.phaser.mask=null,this.gameObject.phaser._clipTexture=null,this.gameObject.phaser._graphicsFilter=null)},mb.prototype.postUpdate=function(){if(this.enable&&this.mode===mb.MODE_DEFAULT&&(this._updateMask(),this._checkInField))for(var a=this.gameObject.children,b=this.gameObject.getWorldBox(),c=0;c<a.length;c++)this._checkRenderable(b,a[c])},mb.prototype.setMask=function(a,b,c,d){var e=a||this.minAnchor,f=b||this.maxAnchor;if(c="undefined"==typeof c||null===c?this.minRotation:c,d="undefined"==typeof d||null===d?this.maxRotation:d,e.x<0&&(e.x=0),e.y<0&&(e.y=0),e.x>1&&(e.x=1),e.y>1&&(e.y=1),f.x<0&&(f.x=0),f.y<0&&(f.y=0),f.x>1&&(f.x=1),f.y>1&&(f.y=1),e.x>f.x||e.y>f.y)throw new Error("Expected:min < max");if(c>d)throw new Error("Expected:minRotation < maxRotation");(e.x!==this.minAnchor.x||e.y!==this.minAnchor.y||f.x!==this.maxAnchor.x||f.y!==this.maxAnchor.y||c!==this.minRotation||d!==this.maxRotation)&&(this._minAnchor=e,this._maxAnchor=f,this._minRotation=c,this._maxRotation=d,this._maskForceChange=!0)},mb.prototype._updateMask=function(){var a=this._mask,b=this.gameObject.worldTransform,c=this.gameObject.rect,d=[c.x,c.y,c.width,c.height,b.a,b.b,b.c,b.d,b.tx,b.ty];if(this._maskForceChange||!this._lastMaskRect||this._lastMaskRect[0]!==d[0]||this._lastMaskRect[1]!==d[1]||this._lastMaskRect[2]!==d[2]||this._lastMaskRect[3]!==d[3]||this._lastMaskRect[4]!==d[4]||this._lastMaskRect[5]!==d[5]||this._lastMaskRect[6]!==d[6]||this._lastMaskRect[7]!==d[7]||this._lastMaskRect[8]!==d[8]||this._lastMaskRect[9]!==d[9]){this._maskForceChange=!1,this._lastMaskRect=d;var e=this.minAnchor,f=this.maxAnchor,h=this.minRotation,i=this.maxRotation,j=c.x+e.x*c.width,k=c.y+e.y*c.height,l=c.x+f.x*c.width,m=c.y+f.y*c.height,n=this.gameObject.getWorldScale(),o=n.x*n.y<0,p=(j+l)/2,q=(k+m)/2,r=null;if(i-h>=2*Math.PI)r=[new g.Point(j,k),new g.Point(l,k),new g.Point(l,m),new g.Point(j,m)];else{for(var s=2*Math.PI,t=Math.atan2(m-k,l-j);-t>h||h>s-t;){var u=0>h?s:-s;h+=u,i+=u}var v,w,x;h>=-t&&t>h?(v=l,w=q+(l-p)*Math.tan(h),x=0):h<Math.PI-t?(w=m,v=p+(m-q)/Math.tan(h),x=1):h<Math.PI+t?(v=j,w=q+(p-j)*Math.tan(Math.PI-h),x=2):(w=k,v=p+(q-k)/Math.tan(s-h),x=3);for(var y,z,A=0;i>s-t;)i-=s,A+=4;i>=-t&&t>i?(y=l,z=q+(l-p)*Math.tan(i),A+=0):i<Math.PI-t?(z=m,y=p+(m-q)/Math.tan(i),A+=1):i<Math.PI+t?(y=j,z=q+(p-j)*Math.tan(Math.PI-i),A+=2):(z=k,y=p+(q-k)/Math.tan(s-i),A+=3);var B=[new g.Point(l,m),new g.Point(j,m),new g.Point(j,k),new g.Point(l,k)];for(r=[new g.Point(p,q),new g.Point(v,w)];A>x;)r.push(B[x%4]),x++;r.push(new g.Point(y,z))}if(!this._isNeedUseClipReplaceStencil()){for(var C=0;C<r.length;C++)r[C]=b.apply(r[C]);o&&r.reverse()}if(this._softClip=r,this._isNeedUseClipReplaceStencil()){var D=this.gameObject.phaser.getBounds(),E=this._graphicsFilter.otherTexture;E.resize(D.width,D.height),E.offset.x=-D.x,E.offset.y=-D.y;var F=E.graphics;F.clear(),F.beginFill(16777215),F.drawPolygon(r),F.worldTransform=this.gameObject.worldTransform}else a.clear(),a.beginFill(16777215),a.drawPolygon(r);this._refresh()}},mb.prototype._checkRenderable=function(a,b){var c=b.getWorldBox();b.renderable=g.Rectangle.intersects(a,c)?!0:!1;for(var d=b.children,e=0;e<d.length;e++)this._checkRenderable(a,d[e])},mb.prototype._resetRenderAble=function(a){if(a){a.renderable=!0;for(var b=a.children,c=0;c<b.length;c++)this._resetRenderAble(b[c])}},mb.MODE_DEFAULT=0,mb.MODE_PIXEL=1,mb.MODE_GRAPHICS=2,mb.CLIP_STENCIL=1;var nb=E("qc.NonexistScript",g.Behaviour,function(){this.script="",this.data={}},{});nb.__hiddenInMenu=!0;var ob=E("qc.ScaleAdapter",g.Behaviour,function(){this.target=null,this.referenceResolution=new g.Point(0,0),this.manualType=ob.NONE,this._fullTarget=!1,this.gameObjectRecord=this.gameObject?[this.gameObject.scaleX,this.gameObject.scaleY,this.gameObject.width,this.gameObject.height]:[],this.runInEditor=!0,this.__menu="UI/ScaleAdapter"},{target:g.Serializer.NODE,referenceResolution:g.Serializer.GEOM,manualType:g.Serializer.NUMBER,fullTarget:g.Serializer.BOOLEAN,gameObjectRecord:g.Serializer.NUMBERS});ob.__menu="UI/ScaleAdapter",b.defineProperties(ob.prototype,{fullTarget:{get:function(){return this._fullTarget},set:function(a){this._fullTarget!=a&&(this._fullTarget=a,!a&&this.gameObject&&(this.gameObject.width=this.gameObjectRecord[2],this.gameObject.height=this.gameObjectRecord[3]),this._forceUpdate=!0)}}}),ob.NONE=0,ob.MANUAL_HEIGHT=1,ob.MANUAL_WIDTH=2,ob.EXPAND=3,ob.SHRINK=4,ob.FILL=5,ob.prototype.getTargetSize=function(){var a=this.target||this.gameObject.game.world;return a&&a.width&&a.height?new g.Point(a.width,a.height):new g.Point(0,0)},ob.prototype.preUpdate=function(){if(this.enable&&this.gameObject&&this.gameObject.scaleX){var a=this.getTargetSize(),b=this.getReferenceResolution();if(0!==a.x&&0!==a.y&&0!==b.x&&0!==b.y){var c=1,d=1;switch(this.manualType){case g.ScaleAdapter.MANUAL_HEIGHT:d=c=a.y/b.y;break;case g.ScaleAdapter.MANUAL_WIDTH:d=c=a.x/b.x;break;case g.ScaleAdapter.EXPAND:d=c=Math.min(a.x/b.x,a.y/b.y);break;case g.ScaleAdapter.SHRINK:d=c=Math.max(a.x/b.x,a.y/b.y);break;case g.ScaleAdapter.FILL:c=a.x/b.x,d=a.y/b.y}isNaN(c)||isNaN(d)||(this.fullTarget&&(this.gameObject.width=a.x/c,this.gameObject.height=a.y/d),(this._forceUpdate||this.gameObject.scaleX!==c||this.gameObject.scaleY!==d)&&(this._forceUpdate=!1,this.gameObject.scaleX=c,this.gameObject.scaleY=d))}}},ob.prototype.onEnable=function(){this.gameObjectRecord[0]=this.gameObject.scaleX,this.gameObjectRecord[1]=this.gameObject.scaleY,this.gameObjectRecord[2]=this.gameObject.width,this.gameObjectRecord[3]=this.gameObject.height},ob.prototype.onDisable=function(){this.gameObjectRecord.length<4||null===this.gameObjectRecord[0]||isNaN(this.gameObjectRecord[0])||(this.gameObject.scaleX=this.gameObjectRecord[0],this.gameObject.scaleY=this.gameObjectRecord[1],this.gameObject.width=this.gameObjectRecord[2],this.gameObject.height=this.gameObjectRecord[3])},ob.prototype.onDestroy=function(){this.target=null},ob.prototype.getReferenceResolution=function(){return this.referenceResolution};var pb=g.defineBehaviour("qc.ToggleGroup",g.Behaviour,function(){this._toggles=[],this.runInEditor=!0,this.onValueChange=new g.Signal},{toggles:g.Serializer.NODES,allowSwitchOff:g.Serializer.BOOLEAN});pb.__menu="UI/ToggleGroup",b.defineProperties(pb.prototype,{toggle:{get:function(){for(var a=0;a<this._toggles.length;a++){var b=this._toggles[a];if(b&&b.on)return b}return null},set:function(a){var b=this._toggles.indexOf(a);if(-1===b)return void this.game.log.error("target is not in this group");for(var c=0;c<this._toggles.length;c++){var d=this._toggles[c];d&&(d.on=d===a)}this.onValueChange.dispatch(this,a,!0)}},toggles:{get:function(){return this._toggles},set:function(a){var b=this;b._toggles.forEach(function(a){a&&(a.onValueChange.remove(b._onValueChange,b),a.canValueChange.remove(b._canValueChange,b))}),b._toggles=a||[],b._toggles.forEach(function(a){a&&(a.onValueChange.add(b._onValueChange,b),a.canValueChange.add(b._canValueChange,b))})}},allowSwitchOff:{get:function(){var a=this._allowSwitchOff;return a==c?!0:a},set:function(a){a=!!a;var b=this.allowSwitchOff;b!==a&&(this._allowSwitchOff=a,a||this._assureSelection())}}}),pb.prototype._assureSelection=function(){if(null==this.toggle){var a=this.toggles;if(a&&a.length){var b=a[0];b&&(b.on=!0)}}},pb.prototype.add=function(a){-1===this._toggles.indexOf(a)&&(this._toggles.push(a),a.on=!1,a.onValueChange.add(this._onValueChange,this),a.canValueChange.add(this._canValueChange,this),this.allowSwitchOff||this._assureSelection())},pb.prototype.remove=function(a){var b=this._toggles.indexOf(a);-1!==b&&(this._toggles.splice(b,1),a.onValueChange.remove(this._onValueChange,this),a.canValueChange.remove(this._canValueChange,this),this.allowSwitchOff||this._assureSelection())},pb.prototype._canValueChange=function(a,b,c,d){if(!this.allowSwitchOff&&c&&!b){for(var e=!1,f=0,g=this.toggles.length;g>f;f++){var h=this.toggles[f];if(h!==a){if(h&&h.on)return}else e=!0}e&&(d.ignore=!0)}},pb.prototype._onValueChange=function(a){a.on?this.toggle=a:this.toggle||this.onValueChange.dispatch(this,a,!1)};var qb=g.defineBehaviour("qc.TransitionBehaviour",g.Behaviour,function(){if(this.gameObject.state===c)throw new Error("The target node does not have the interactive function, and can not be added to this component.");this.target=this.gameObject,this._transition=g.Transition.TEXTURE_SWAP},{target:g.Serializer.NODE,_transition:g.Serializer.NUMBER,_normalTexture:g.Serializer.AUTO,_pressedTexture:g.Serializer.AUTO,_disabledTexture:g.Serializer.AUTO,_normalColor:g.Serializer.COLOR,_pressedColor:g.Serializer.COLOR,_disabledColor:g.Serializer.COLOR});qb.__menu="UI/TransitionBehaviour",b.defineProperties(qb.prototype,{target:{get:function(){return this._target},set:function(a){this._target=a,this._reset()}},transition:{get:function(){return this._transition},set:function(a){this._transition!==a&&(this._transition=a,this.target&&this._reset())}},normalTexture:{get:function(){return this._normalTexture},set:function(a){a!==this._normalTexture&&(this._normalTexture=a,this.target&&this.gameObject.state===g.UIState.NORMAL&&this.transition===g.Transition.TEXTURE_SWAP&&(this.target.frame=this.normalTexture))}},pressedTexture:{get:function(){return this._pressedTexture},set:function(a){a!==this._pressedTexture&&(this._pressedTexture=a,this.target&&this.gameObject.state===g.UIState.PRESSED&&this.transition===g.Transition.TEXTURE_SWAP&&(this.target.frame=this.pressedTexture))}},disabledTexture:{get:function(){return this._disabledTexture},set:function(a){a!==this._disabledTexture&&(this._disabledTexture=a,this.target&&this.gameObject.state===g.UIState.DISABLED&&this.transition===g.Transition.TEXTURE_SWAP&&(this.target.frame=this.disabledTexture))}},normalColor:{get:function(){return this._normalColor},set:function(a){if(this._normalColor!==a&&this.target){if(a=a||oa.white,!(a instanceof oa))return void this.game.log.error("Expected qc.Color, got:{0}",a);this._normalColor=a,this.gameObject.state===g.UIState.NORMAL&&this.transition===g.Transition.COLOR_TINT&&(this.target.colorTint=this.normalColor)}}},pressedColor:{get:function(){return this._pressedColor},set:function(a){if(this._pressedColor!==a&&this.target){if(a=a||oa.grey,!(a instanceof oa))return void this.game.log.error("Expected qc.Color, got:{0}",a);this._pressedColor=a,this.gameObject.state===g.UIState.PRESSED&&this.transition===g.Transition.COLOR_TINT&&(this.target.colorTint=this.pressedColor)}}},disabledColor:{get:function(){return this._disabledColor},set:function(a){if(this._disabledColor!==a&&this.target){if(a=a||oa.grey,!(a instanceof oa))return void this.game.log.error("Expected:qc.Color, got:{0}",a);this._disabledColor=a,this.gameObject.state===g.UIState.DISABLED&&this.transition===g.Transition.COLOR_TINT&&(this.target.colorTint=this.disabledColor)}}},pressedAnimation:{get:function(){return this._pressedAnimation},set:function(a){this._pressedAnimation!==a&&(this._pressedAnimation=a)}}}),qb.prototype._normalTexture="",qb.prototype._pressedTexture="",qb.prototype._disabledTexture="",qb.prototype._normalColor=oa.white,qb.prototype._pressedColor=oa.grey,qb.prototype._disabledColor=oa.grey,qb.prototype.awake=function(){this.gameObject.onStateChange.add(this._reset,this),this._reset()},qb.prototype.onDestroy=function(){this.gameObject.onStateChange.remove(this._reset,this)},qb.prototype._reset=function(){if(this.target&&this.enable)switch(this.transition){case g.Transition.NONE:break;case g.Transition.TEXTURE_SWAP:switch(this.gameObject.state){case g.UIState.NORMAL:this.normalTexture&&(this.target.frame=this.normalTexture);break;case g.UIState.PRESSED:this.pressedTexture&&(this.target.frame=this.pressedTexture);break;case g.UIState.DISABLED:this.disabledTexture&&(this.target.frame=this.disabledTexture)}break;case g.Transition.COLOR_TINT:switch(this.gameObject.state){case g.UIState.NORMAL:this.target.colorTint=this.normalColor;break;case g.UIState.PRESSED:this.target.colorTint=this.pressedColor;break;case g.UIState.DISABLED:this.target.colorTint=this.disabledColor}break;case g.Transition.ANIMATION:}};var rb=E("qc.Tween",g.Behaviour,function(){this._curve=new g.BezierCurve(new g.Keyframe(0,0,1,1),new g.Keyframe(1,1,1,1)),this._started=!1,this._startTime=0,this._amountPerDelta=1e3,this._factor=0,this.runInEditor=!0,this.flag="",this.playOnAwake=!1,this.canRunInEditor=!1},{_curve:g.Serializer.GEOM,sampleMethod:g.Serializer.NUMBER,style:g.Serializer.NUMBER,delay:g.Serializer.NUMBER,duration:g.Serializer.NUMBER,tweenGroup:g.Serializer.NUMBER,flag:g.Serializer.STRING,playOnAwake:g.Serializer.BOOLEAN});rb.__hiddenInMenu=!0,b.defineProperties(rb.prototype,{curve:{get:function(){return this._curve}},sampleMethod:{get:function(){return this._sampleMethod||rb.SAMPLE_LINEAR},set:function(a){this._sampleMethod!==a&&(this._sampleMethod=a)}},style:{get:function(){return this._style||0},set:function(a){this._style!==a&&(this._style=a)}},delay:{get:function(){return isNaN(this._delay)||this._delay<0?0:this._delay},set:function(a){this._delay!==a&&(this._delay=a)}},duration:{get:function(){return isNaN(this._duration)||this._duration<0?0:this._duration},set:function(a){this._duration!==a&&(this._duration=a,this._amountPerDelta=Math.abs(a>0?1/(1e3*a):1e3)*(this._amountPerDelta>=0?1:-1))}},tweenGroup:{get:function(){return this._tweenGroup||0},set:function(a){this._tweenGroup!==a&&(this._tweenGroup=a)}},onStart:{get:function(){return this._onStart||(this._onStart=new h.Signal),
this._onStart}},onFinished:{get:function(){return this._onFinished||(this._onFinished=new h.Signal),this._onFinished}},onLoopFinished:{get:function(){return this._onLoopFinished||(this._onLoopFinished=new h.Signal),this._onLoopFinished}},amountPerDelta:{get:function(){return this._amountPerDelta}},tweenFactor:{get:function(){return this._factor},set:function(a){this._factor=h.Math.clamp(a,0,1)}},direction:{get:function(){return this.amountPerDelta<0?rb.DIR_REVERSE:rb.DIR_FORWARD}}}),rb.prototype.awake=function(){var a=this;a.enable=!1,a.playOnAwake&&(a.resetToBeginning(),a.playForward())},rb.prototype._lineSample=function(a){return a},rb.prototype.start=function(){this.update()},rb.prototype.update=function(){if(this.enable&&(!this.gameObject||!this.game.device.editor||this.canRunInEditor)){var a=this.game.time.deltaTime,b=this.game.time.scaledTime;this._started||(this._started=!0,this._dispatchStart=!1,this._startTime=b+1e3*this.delay),b<this._startTime||(b===this._startTime?a=0:b-this._startTime<a&&(a=b-this._startTime),this._dispatchStart||(this._dispatchStart=!0,this._onStart&&this._onStart.dispatch(this)),this._factor+=this.amountPerDelta*a,this.style===rb.STYLE_LOOP?this._factor>1&&(this._factor-=Math.floor(this._factor),this._onLoopFinished&&this._onLoopFinished.dispatch(this)):this.style===rb.STYLE_PINGPONG&&(this._factor>1?(this._factor=1-(this._factor-Math.floor(this._factor)),this._amountPerDelta=-this._amountPerDelta,this._onLoopFinished&&this._onLoopFinished.dispatch(this)):this._factor<0&&(this._factor=-this._factor,this._factor-=Math.floor(this._factor),this._amountPerDelta=-this._amountPerDelta,this._onLoopFinished&&this._onLoopFinished.dispatch(this))),this.style===rb.STYLE_ONCE&&(0===this.duration||this._factor>1||this._factor<0)?(this._factor=h.Math.clamp(this._factor,0,1),this.sample(this._factor,!0),this._onFinished&&this._onFinished.dispatch(this),(0===this.duration||1===this._factor&&this._amountPerDelta>0||0===this._factor&&this._amountPerDelta<0)&&(this.enable=!1)):this.sample(this._factor,!1))}},rb.prototype.onDisable=function(){this._started=!1,this.canRunInEditor=!1},rb.prototype.sample=function(a,b){var c=h.Math.clamp(a,0,1);switch(this.sampleMethod){case rb.SAMPLE_LINEAR:c=this._lineSample(c)}this.onUpdate(this.curve.evaluate(c),b)},rb.prototype._funcGroup=function(a){var b=this;return 0===b.tweenGroup?void a(b):void rb._funcGroup(b.gameObject,b.tweenGroup,a)},rb.prototype.reset=function(a){this._started||(a?this.setEndToCurrValue():this.setStartToCurrValue())},rb.prototype.resetGroup=function(a){var b=function(b){b.reset(a)};this._funcGroup(b)},rb.prototype.playForward=function(){this.play(!1)},rb.prototype.playGroupForward=function(){var a=function(a){a.playForward()};this._funcGroup(a)},rb.prototype.playReverse=function(){this.play(!0)},rb.prototype.playGroupReverse=function(){var a=function(a){a.playReverse()};this._funcGroup(a)},rb.prototype.stop=function(){this.enable=!1,this.canRunInEditor=!1},rb.prototype.stopGroup=function(){var a=function(a){a.stop()};this._funcGroup(a)},rb.prototype.play=function(a){this._amountPerDelta=Math.abs(this.amountPerDelta)*(a?-1:1),this.enable=!0,this.canRunInEditor=!0,this.update()},rb.prototype.playGroup=function(a){var b=function(b){b.play(a)};this._funcGroup(b)},rb.prototype.resetToBeginning=function(a){this._started=!1,this._amountPerDelta=Math.abs(this.amountPerDelta)*(a?-1:1),this._factor=this.amountPerDelta<0?1:0,this.sample(this._factor,!1),a?this.setEndToCurrValue():this.setStartToCurrValue()},rb.prototype.resetGroupToBeginning=function(a){var b=function(b){b.resetToBeginning(a)};this._funcGroup(b)},rb.prototype.toggle=function(){this._amountPerDelta=this._factor>0?-this.amountPerDelta:Math.abs(this.amountPerDelta),this.enable=!0},rb.prototype.onUpdate=function(){},rb.prototype.setStartToCurrValue=function(){},rb.prototype.setEndToCurrValue=function(){},rb.prototype.setCurrToStartValue=function(){},rb.prototype.setCurrToEndValue=function(){},rb.begin=function(a,b,c){var d=b.getScript(a,!1);if(d&&0!=d.tweenGroup){d=null;for(var e=b.getScripts(a,!1),f=0;f<e.length;++f)if(e[f]&&0===e[f].tweenGroup){d=e[f];break}}if((d||(d=b.addScript(a)))&&d instanceof rb)return d._started=!1,d.duration=c,d._factor=0,d._amountPerDelta=Math.abs(d.amountPerDelta),d.style=rb.STYLE_ONCE,d._curve=new g.BezierCurve(new g.Keyframe(0,0,1,1),new g.Keyframe(1,1,1,1)),d.enable=!0,d},rb._funcGroup=function(a,b,c){for(var d=a.getScripts?a.getScripts("qc.Tween"):[],e=d.length;e-->0;)d[e].tweenGroup===b&&c(d[e]);var f=a.children;if(f)for(var g=f.length;g-->0;){var h=f[g];rb._funcGroup(h,b,c)}},rb.resetGroup=function(a,b,c){var d=function(a){a.reset(c)};rb._funcGroup(a,b,d)},rb.playGroupForward=function(a,b){var c=function(a){a.playForward()};rb._funcGroup(a,b,c)},rb.playGroupReverse=function(a,b){var c=function(a){a.playReverse()};rb._funcGroup(a,b,c)},rb.stopGroup=function(a,b){var c=function(a){a.stop()};rb._funcGroup(a,b,c)},rb.playGroup=function(a,b,c){var d=function(a){a.play(c)};rb._funcGroup(a,b,d)},rb.resetGroupToBeginning=function(a,b,c){var d=function(a){a.resetToBeginning(c)};rb._funcGroup(a,b,d)},rb.STYLE_ONCE=0,rb.STYLE_LOOP=1,rb.STYLE_PINGPONG=2,rb.DIR_FORWARD=0,rb.DIR_REVERSE=1,rb.SAMPLE_LINEAR=0;var sb=E("qc.TweenAlpha",g.Tween,function(){var a=this;a.from=0,a.to=1,a.enable=!1},{from:g.Serializer.NUMBER,to:g.Serializer.NUMBER});sb.__menu="Tween/TweenAlpha",sb.prototype.onUpdate=function(a){var b=this,c=b.from,d=b.to;b.gameObject.alpha=h.Math.clamp(c+a*(d-c),0,1)},sb.prototype.setStartToCurrValue=function(){this.gameObject.alpha=this.from},sb.prototype.setEndToCurrValue=function(){this.gameObject.alpha=this.to},sb.prototype.setCurrToStartValue=function(){this.from=this.gameObject.alpha},sb.prototype.setCurrToEndValue=function(){this.to=this.gameObject.alpha},sb.begin=function(a,b,c){var d=g.Tween.begin("qc.TweenAlpha",a,b);return d.from=a.alpha,d.to=c,0>=b&&(d.sample(1,!0),d.enable=!1),d};var tb=E("qc.TweenColor",g.Tween,function(){var a=this;a.from=oa.black,a.to=oa.white,a.enable=!1},{from:g.Serializer.COLOR,to:g.Serializer.COLOR});tb.__menu="Tween/TweenColor",tb.prototype.onUpdate=function(a){var b=this,c=b.from.rgb,d=b.to.rgb,e=[h.Math.clamp(Math.round(c[0]+a*(d[0]-c[0])),0,255),h.Math.clamp(Math.round(c[1]+a*(d[1]-c[1])),0,255),h.Math.clamp(Math.round(c[2]+a*(d[2]-c[2])),0,255),h.Math.clamp(b.from.alpha+a*(b.to.alpha-b.from.alpha),0,1)],f=new oa(e);b.gameObject.colorTint=f},tb.prototype.setStartToCurrValue=function(){this.gameObject.colorTint=new oa(this.from.toString())},tb.prototype.setEndToCurrValue=function(){this.gameObject.colorTint=new oa(this.to.toString())},tb.prototype.setCurrToStartValue=function(){this.from=new oa(this.gameObject.colorTint.toString())},tb.prototype.setCurrToEndValue=function(){this.to=new oa(this.gameObject.colorTint.toString())},tb.begin=function(a,b,c){var d=g.Tween.begin("qc.TweenColor",a,b);return d.from=new oa(a.colorTint.toString()),d.to=c,0>=b&&(d.sample(1,!0),d.enable=!1),d};var ub=E("qc.TweenPosition",g.Tween,function(){var a=this;a.from=new g.Point(0,0),a.to=new g.Point(0,0),a.moveAxis=ub.BOTH,a.enable=!1},{from:g.Serializer.POINT,to:g.Serializer.POINT,moveAxis:g.Serializer.NUMBER});ub.__menu="Tween/TweenPosition",ub.prototype.onUpdate=function(a){var b=this,c=b.from,d=b.to;0!==(b.moveAxis&ub.ONLY_X)&&(b.gameObject.x=c.x+a*(d.x-c.x)),0!==(b.moveAxis&ub.ONLY_Y)&&(b.gameObject.y=c.y+a*(d.y-c.y))},ub.prototype.setStartToCurrValue=function(){0!==(this.moveAxis&ub.ONLY_X)&&(this.gameObject.x=this.from.x),0!==(this.moveAxis&ub.ONLY_Y)&&(this.gameObject.y=this.from.y)},ub.prototype.setEndToCurrValue=function(){0!==(this.moveAxis&ub.ONLY_X)&&(this.gameObject.x=this.to.x),0!==(this.moveAxis&ub.ONLY_Y)&&(this.gameObject.y=this.to.y)},ub.prototype.setCurrToStartValue=function(){this.from=new g.Point(this.gameObject.x,this.gameObject.y)},ub.prototype.setCurrToEndValue=function(){this.to=new g.Point(this.gameObject.x,this.gameObject.y)},ub.begin=function(a,b,c){var d=g.Tween.begin("qc.TweenPosition",a,b);return d.from=new g.Point(a.x,a.y),d.to=c.clone(),0>=b&&(d.sample(1,!0),d.enable=!1),d},ub.BOTH=255,ub.ONLY_X=1,ub.ONLY_Y=2;var vb=E("qc.TweenProperty",g.Tween,function(){var a=this;a.from=0,a.to=1,a.property="",a.enable=!1},{from:g.Serializer.NUMBER,to:g.Serializer.NUMBER,property:g.Serializer.STRING});vb.__menu="Tween/TweenProperty",b.defineProperties(vb.prototype,{property:{get:function(){return this._property},set:function(a){if(a!==this._property){for(var b=a.split("."),c=this.gameObject,d=0;d<b.length-1;d++)if(c=c[b[d]],!c)return void this.game.log.important("The property({0}) non-exist.",a);this._ob=c,this._attrib=b[b.length-1],this._property=a}}}}),vb.prototype.onUpdate=function(a){var b=this,c=b.from,d=b.to;b._ob[b._attrib]=c+a*(d-c)},vb.prototype.setStartToCurrValue=function(){this._ob[this._attrib]=this.from},vb.prototype.setEndToCurrValue=function(){this._ob[this._attrib]=this.to},vb.prototype.setCurrToStartValue=function(){this.from=this._ob[this._attrib]},vb.prototype.setCurrToEndValue=function(){this.to=this._ob[this._attrib]},vb.begin=function(a,b,c){var d=g.Tween.begin("qc.TweenProperty",a,b);return d.from=this._ob[this._attrib],d.to=c,0>=b&&(d.sample(1,!0),d.enable=!1),d};var wb=E("qc.TweenRotation",g.Tween,function(){var a=this;a.from=0,a.to=1,a.enable=!1},{from:g.Serializer.NUMBER,to:g.Serializer.NUMBER});wb.__menu="Tween/TweenRotation",wb.prototype.onUpdate=function(a){var b=this,c=b.from,d=b.to;b.gameObject.rotation=c+a*(d-c)},wb.prototype.setStartToCurrValue=function(){this.gameObject.rotation=this.from},wb.prototype.setEndToCurrValue=function(){this.gameObject.rotation=this.to},wb.prototype.setCurrToStartValue=function(){this.from=this.gameObject.rotation},wb.prototype.setCurrToEndValue=function(){this.to=this.gameObject.rotation},wb.begin=function(a,b,c){var d=g.Tween.begin("qc.TweenRotation",a,b);return d.from=a.rotation,d.to=c,0>=b&&(d.sample(1,!0),d.enable=!1),d};var xb=E("qc.TweenScale",g.Tween,function(){var a=this;a.from=new g.Point(0,0),a.to=new g.Point(1,1),a.enable=!1},{from:g.Serializer.POINT,to:g.Serializer.POINT});xb.__menu="Tween/TweenScale",xb.prototype.onUpdate=function(a){var b=this,c=b.from,d=b.to,e=new g.Point(c.x+a*(d.x-c.x),c.y+a*(d.y-c.y));b.gameObject.scaleX=e.x,b.gameObject.scaleY=e.y},xb.prototype.setStartToCurrValue=function(){this.gameObject.scaleX=this.from.x,this.gameObject.scaleY=this.from.y},xb.prototype.setEndToCurrValue=function(){this.gameObject.scaleX=this.to.x,this.gameObject.scaleY=this.to.y},xb.prototype.setCurrToStartValue=function(){this.from=new g.Point(this.gameObject.scaleX,this.gameObject.scaleY)},xb.prototype.setCurrToEndValue=function(){this.to=new g.Point(this.gameObject.scaleX,this.gameObject.scaleY)},xb.begin=function(a,b,c){var d=g.Tween.begin("qc.TweenScale",a,b);return d.from=new g.Point(a.scaleX,a.scaleY),d.to=c.clone(),0>=b&&(d.sample(1,!0),d.enable=!1),d};var yb=E("qc.VerticalLayout",g.TableLayout,function(){this.style=g.TableLayout.STYLE_RESIZE_ELEMENT,this.constraint=g.TableLayout.CONSTRAINT_FIX_COLUMN_COUNT,this.contentSizeProvider=g.TableLayout.USE_RECTTRANSFORM,this.stride=1,this.startCorner=g.TableLayout.CORNER_TOP_LEFT,this.startAxis=g.TableLayout.AXIS_VERTICAL},{childForceExpandWidth:g.Serializer.NUMBER,childForceExpandHeight:g.Serializer.NUMBER});yb.__menu="UI/Layout/VerticalLayout",b.defineProperties(yb.prototype,{spacing:{get:function(){return this.spacingY},set:function(a){this.spacingY=a}},childForceExpandWidth:{get:function(){return!!this._childForceExpandWidth},set:function(a){this._childForceExpandWidth!==a&&(this._childForceExpandWidth=a,this.rebuildTable())}},childForceExpandHeight:{get:function(){return!!this._childForceExpandHeight},set:function(a){this._childForceExpandHeight!==a&&(this._childForceExpandHeight=a,this.rebuildTable())}}}),yb.prototype._getDefaultLayout=function(a){return"y"===a?{min:0,preferred:0,flexible:this.childForceExpandHeight?1:0,extra:0}:{min:0,preferred:this.childForceExpandWidth?this.gameObject.rect.width:-1,flexible:0,extra:0}},yb.prototype.getCellLayout=function(a){var b=g.LayoutElement.getLayoutElement(a);return this.childForceExpandWidth&&(b.flexibleWidth=1),this.childForceExpandHeight&&(b.flexibleHeight=1),b};var zb=g.Time=function(a){this.phaser=a.phaser.time,this.phaser._qc=this};zb.prototype.constructor=zb,b.defineProperties(zb.prototype,{game:{get:function(){return this.phaser.game._qc}},now:{get:function(){return Date.now()}},fixedTime:{get:function(){return 1e3*this.phaser.totalElapsedSeconds()}},scaledTime:{get:function(){return this.phaser._totalEscapeTime||0}},timeScale:{get:function(){return this.phaser.slowMotion},set:function(a){0>=a&&(a=1e-6),this.phaser.slowMotion=a}},frameRate:{get:function(){return this.phaser.desiredFps},set:function(a){this.phaser.desiredFps=a}},deltaTime:{get:function(){return this.phaser.frameDeltaTime}}}),zb.prototype.applyFrameRate=function(a){var b=this.game.device.desktop?a.desktop:a.mobile;this.frameRate=b};var Ab=g.LinkList=function(a){for(this.length=a,this.head=null,this.tail=null;a--;)this.push({})};Ab.prototype={},Ab.prototype.constructor=Ab,Ab.prototype.push=function(a){a.pre=null,a.next=null,this.head?(this.tail.next=a,a.pre=this.tail,this.tail=this.tail.next):(this.head=a,this.tail=this.head),this.length++},Ab.prototype.insertBefore=function(a,b){if(!a)return void this.push(b);var c=a.pre;a.pre=b,b.next=a,b.pre=c,c&&(c.next=b),b.pre||(this.head=b)},Ab.prototype.remove=function(a){var b=a.pre,c=a.next;b&&(b.next=c),c&&(c.pre=b),a===this.head&&(this.head=c),a===this.tail&&(this.tail=b),a.pre=null,a.next=null,this.length--};var Bb=g.Timer=function(a){var b=this;b.game=a,b.paused=!1,b.events=new g.LinkList(0),b.loopEvents=new g.LinkList(0),this._nextTimerBegin=0,this._nextLoopTimerBegin=0};Bb.prototype.constructor=Bb,Bb.prototype.create=function(a,b,c,d,e){a=Math.round(a);var f=new h.TimerEvent(this,a,a,0,b,c,d,e);return this._pushEvent(b?this.loopEvents:this.events,f),f},Bb.prototype.add=function(a,b,c){var a=a>0?a:1;return a+=this._nextTimerBegin,this.create(a,!1,b,c,Array.prototype.splice.call(arguments,3))},Bb.prototype.loop=function(a,b,c){var a=a>0?a:1;return a+=this._nextLoopTimerBegin,this.create(a,!0,b,c,Array.prototype.splice.call(arguments,3))},Bb.prototype.remove=function(a){a.__delete=!0},Bb.prototype.update=function(a){if(!this.paused){this._now=this._now?this._now:a;var b=(a-this._now)/this.game.time.timeScale;this._now=a;for(var c=this.events.head,d=b,e=0;c&&(c.delta-=d,!(c.delta>0));){if(e++,e>2e3)throw new Error("timer loop forever!");this._nextTimerBegin=d=-c.delta,this.events.remove(c),c.__delete||c.callback.apply(c.callbackContext,c.args),c=this.events.head}this._nextTimerBegin=0;var f=[];for(c=this.loopEvents.head,d=b;c&&(c.delta-=d,!(c.delta>0));)this._nextLoopTimerBegin=d=-c.delta,this.loopEvents.remove(c),c.__delete||(f.push(c),c.callback.apply(c.callbackContext,c.args)),c=this.loopEvents.head;this._nextLoopTimerBegin=0;for(var g=0;g<f.length;g++)this._pushEvent(this.loopEvents,f[g])}},Bb.prototype._pushEvent=function(a,b){var c=a.head;if(!c)return b.delta=b.delay,void a.push(b);for(var d=b.delay;c;){if(!(d>=c.delta))return c.delta-=d,b.delta=d,a.insertBefore(c,b),b;d-=c.delta,c=c.next}return b.delta=d,a.push(b),b},g.TimerEvent=h.TimerEvent;var Cb=g.Filter=function(a){h.Filter.call(this,a),this._textureCount=1,this.extraAttribute=[]};Cb.prototype=b.create(h.Filter.prototype),Cb.prototype.constructor=Cb,b.defineProperties(Cb.prototype,{textureCount:{get:function(){return this._textureCount}}}),Cb.filters={},Cb.F1="1f",Cb.F1V="1fv",Cb.I1="1i",Cb.F2="2f",Cb.F2V="2fv",Cb.I2="2i",Cb.I2V="2iv",Cb.F3="3f",Cb.F3V="3fv",Cb.I3="3i",Cb.I3V="3iv",Cb.F4="4f",Cb.F4V="4fv",Cb.I4="4i",Cb.I4V="4iv",Cb.MAT2="mat2",Cb.MAT3="mat3",Cb.MAT4="mat4",Cb.SAMPLER2D="sampler2D",Cb.MAX_SAMPLE_COUNT=8,Cb.mixinUniform=function(a,b){if(b)for(var c in b){var d=b[c],e=d===Cb.SAMPLER2D;if(!(e&&a.textureCount>=Cb.MAX_SAMPLE_COUNT)){var f=function(){var b=c;return e?(a._textureCount++,function(){return a[b]&&a[b].filterTexture}):function(){return a[b]}};if(a.uniforms[c]=new Fb(d,f()),e){var g="a"+c.substring(0,1).toUpperCase()+c.substring(1)+"Coord";a.extraAttribute.push({name:g,texture:c})}}}},Cb.uniformToJson=function(a,b,c){switch(a){case Cb.F1:case Cb.I1:case Cb.I2V:case Cb.F2V:case Cb.I3V:case Cb.F3V:case Cb.I4V:case Cb.F4V:case Cb.MAT2:case Cb.MAT3:case Cb.MAT4:return[a,b];case Cb.I2:case Cb.F2:return[a,[b.x,b.y]];case Cb.I3:case Cb.F3:return[a,[b.x,b.y,b.z]];case Cb.I4:case Cb.F4:return[a,[b.x,b.y,b.z,b.w]];case Cb.SAMPLER2D:if(!(b instanceof Eb))return[a,[]];var d=b.texture;return d?(c.dependences.push({key:d.key,uuid:d.uuid}),[a,[d.key,d.url,d.uuid,b.frame]]):[a,[]]}return[a,[]]},Cb.uniformFromJson=function(a,b,c,d,e){if(e)switch(d){case Cb.F1:case Cb.I1:case Cb.I2V:case Cb.F2V:case Cb.I3V:case Cb.F3V:case Cb.I4V:case Cb.F4V:case Cb.MAT2:case Cb.MAT3:case Cb.MAT4:return void(b[c]=e);case Cb.I2:case Cb.F2:return void(b[c]?(b[c].x=e[0],b[c].y=e[1]):b[c]={x:e[0],y:e[1]});case Cb.I3:case Cb.F3:return void(b[c]?(b[c].x=e[0],b[c].y=e[1],b[c].z=e[2]):b[c]={x:e[0],y:e[1],z:e[2]});case Cb.I4:case Cb.F4:return void(b[c]?(b[c].x=e[0],b[c].y=e[1],b[c].z=e[2],b[c].w=e[3]):b[c]={x:e[0],y:e[1],z:e[2],w:e[3]});case Cb.SAMPLER2D:if(!e)return;var f=new Eb(a);if(e.length>0){var h=a.assets.find(e[0],e[1]);if(h||(h=a.assets.findByUUID(e[2])),!h)return void a.log.error("Texture({0}) not loaded, deserialize fail.",e[1]);if(!(h instanceof g.Atlas))return;f.texture=h,f.frame=e[3]}return void(b[c]=f)}},J.prototype._saveFilter=function(a,b,c,d,e){e&&(b[d]=this._saveFilterItem(e,c))},J.prototype._restoreFilter=function(a,b,c,d){a[c]=this._restoreFilterItem(d)},J.prototype._saveFilterItem=function(a,b){var c=a.getExtraUniforms(),d={};for(var e in c){var f=c[e];d[e]=Cb.uniformToJson(f,a[e],b)}return[J.FILTER,a["class"],d]},J.prototype._restoreFilterItem=function(a){var b=g.Util.findClass(a[1]);if(!b)return void console.warn("着色器脚本：{0}未找到，无法反序列化。",a[1]);var c=a[2],d=new b,e=d.getExtraUniforms();for(var f in e){var h=e[f];c[f]&&h===c[f][0]&&Cb.uniformFromJson(this.game,d,f,h,c[f][1])}return d};var Db=g.defineFilter=function(c,d,e,h){for(var i=c.split("."),j=a,k=0;k<i.length-1;k++)j[i[k]]||(j[i[k]]={}),j=j[i[k]];var l=i[i.length-1];return d=d||g.Filter,"function"==typeof h&&(h=h.call(this)),h=h||{},j[l]=function(a){d.call(this,a),this["class"]=c,this["super"]=d.prototype;var b=this.getExtraUniforms();Cb.mixinUniform(this,b),"function"==typeof e&&e.call(this,a)},j[l].prototype=b.create(d.prototype),j[l].prototype.constructor=j[l],j[l].prototype.getExtraUniforms=function(){var a=d.prototype.getExtraUniforms?d.prototype.getExtraUniforms.call(this):{};return f(a,h)},j[l].prototype.clazz=c,Cb.filters[c]=j[l],j[l]},Eb=g.Filter.FilterTexture=function(a){this._image=new g.UIImage(a,null,!1),this._image.parent.removeChild(this._image)};Eb.prototype={},Eb.prototype.constructor=Eb,b.defineProperties(Eb.prototype,{texture:{get:function(){return this._image.texture},set:function(a){this._image.texture=a}},frame:{get:function(){return this._image.frame},set:function(a){this._image.frame=a}},filterTexture:{get:function(){return this._image.phaser.texture}}});var Fb=g.Filter.UniformHelp=function(a,b){this._type=a,this._value=b,this._valueIsFunc="function"==typeof this._value};Fb.prototype={},Fb.prototype.constructor=Fb,b.defineProperties(Fb.prototype,{type:{get:function(){return this._type}},value:{get:function(){return this._valueIsFunc?this._value():this._value}}});var Gb=(Db("qc.Filter.AlphaMask",g.Filter,function(){this.otherTexture=null,this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aOtherTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vOtherTextureCoord = aOtherTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform sampler2D otherTexture;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   vec4 add =  texture2D(otherTexture, vOtherTextureCoord);","   gl_FragColor = add.a * original;","}"]},{otherTexture:g.Filter.SAMPLER2D}),Db("qc.Filter.BlendTexture",g.Filter,function(){this.mixing=.5,this.otherTexture=null,this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aOtherTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vOtherTextureCoord = aOtherTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform sampler2D otherTexture;","uniform float mixing;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   vec4 add =  texture2D(otherTexture, vOtherTextureCoord);","   gl_FragColor = mixing * add + (1.0 - mixing) * original;","}"]},{otherTexture:g.Filter.SAMPLER2D,mixing:g.Filter.F1}),Db("qc.Filter.BlurX",g.Filter,function(){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","uniform vec2 pixelSize;","void main(void) {","vec4 sum = vec4(0.0);","sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur*pixelSize.x, vTextureCoord.y)) * 0.05;","sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur*pixelSize.x, vTextureCoord.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur*pixelSize.x, vTextureCoord.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x - blur*pixelSize.x, vTextureCoord.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","sum += texture2D(uSampler, vec2(vTextureCoord.x + blur*pixelSize.x, vTextureCoord.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur*pixelSize.x, vTextureCoord.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur*pixelSize.x, vTextureCoord.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur*pixelSize.x, vTextureCoord.y)) * 0.05;","gl_FragColor = sum;","}"],this.blur=1},{blur:g.Filter.F1}));b.defineProperty(Gb.prototype,"blur",{get:function(){return this._blur},set:function(a){this.dirty=!0,this._blur=a}});var Hb=Db("qc.Filter.BlurY",g.Filter,function(){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","uniform vec2 pixelSize;","void main(void) {","vec4 sum = vec4(0.0);","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur*pixelSize.y)) * 0.05;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur*pixelSize.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur*pixelSize.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur*pixelSize.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur*pixelSize.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur*pixelSize.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur*pixelSize.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur*pixelSize.y)) * 0.05;","gl_FragColor = sum;","}"],this.blur=1},{blur:g.Filter.F1});b.defineProperty(Hb.prototype,"blur",{get:function(){return this._blur},set:function(a){this.dirty=!0,this._blur=a}});var Ib=g.Filter.GraphicsTexture=function(a,b,c,d,e){var f=this;f.game=a,f._texture=new g.RenderTexture(b||100,c||100,d||f.game.phaser.render,null,e||f.game.resolution),f.offset=new g.Point(0,0),f._graphics=f.game.phaser.add.graphics(0,0),f._graphics.parent&&f._graphics.parent.removeChild(f._graphics)};Ib.prototype={},Ib.prototype.constructor=Ib,b.defineProperties(Ib.prototype,{graphics:{get:function(){return this._graphics}},filterTexture:{get:function(){return this._texture}}}),Ib.prototype.updateTexture=function(){var a=this,b=a._texture,c=a._graphics;c.dirty&&b.directRenderWebGL(c,a.offset,!0)},Ib.prototype.resize=function(a,b){a=1>=a?1:a,b=1>=b?1:b,this._texture.resize(a,b,!0)};{Db("qc.Filter.Gray",g.Filter,function(){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float gray = original.r * 0.3 + original.g * 0.59 + original.b * 0.11;","   gl_FragColor =  original;","   gl_FragColor.r = gray;","   gl_FragColor.g = gray;","   gl_FragColor.b = gray;","}"]},{}),Db("qc.Filter.Highlight",g.Filter,function(){this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float light;","uniform vec3 lightColor;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying vec4 vLight;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","   vLight = light * vec4(lightColor, 0.0);","}"],this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying vec4 vLight;","uniform sampler2D uSampler;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   gl_FragColor = original + original.a * vLight;","}"],this.light=.5,this.lightColor=[1,1,1]},{light:g.Filter.F1,lightColor:g.Filter.F3V}),Db("qc.Filter.KeepSource",g.Filter,function(){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying vec2 vMaskCoord;","varying vec4 vMaskLimit;","uniform sampler2D uSampler;","uniform sampler2D uSourceSampler;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   vec4 add =  texture2D(uSourceSampler, vTextureCoord);","   gl_FragColor =  add.a * add + (1.0 - add.a) * original;","}"]},{})}}}).call(this,this,Object);